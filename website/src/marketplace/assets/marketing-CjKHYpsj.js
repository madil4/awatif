var wf=Object.defineProperty;var yf=(s,e,t)=>e in s?wf(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var Zr=(s,e,t)=>yf(s,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();let ln=Object.getPrototypeOf,rr,or,ci,Dn,du={isConnected:1},Sf=1e3,Jr,wa={},Ef=ln(du),uu=ln(ln),Nn,pu=(s,e,t,i)=>(s??(setTimeout(t,i),new Set)).add(e),fu=(s,e,t)=>{let i=ci;ci=e;try{return s(t)}catch(n){return console.error(n),t}finally{ci=i}},Wo=s=>s.filter(e=>{var t;return(t=e._dom)==null?void 0:t.isConnected}),mu=s=>Jr=pu(Jr,s,()=>{for(let e of Jr)e._bindings=Wo(e._bindings),e._listeners=Wo(e._listeners);Jr=Nn},Sf),Xo={get val(){var s;return(s=ci==null?void 0:ci._getters)==null||s.add(this),this.rawVal},get oldVal(){var s;return(s=ci==null?void 0:ci._getters)==null||s.add(this),this._oldVal},set val(s){var e;(e=ci==null?void 0:ci._setters)==null||e.add(this),s!==this.rawVal&&(this.rawVal=s,this._bindings.length+this._listeners.length?(or==null||or.add(this),rr=pu(rr,this,Mf)):this._oldVal=s)}},gu=s=>({__proto__:Xo,rawVal:s,_oldVal:s,_bindings:[],_listeners:[]}),fr=(s,e)=>{let t={_getters:new Set,_setters:new Set},i={f:s},n=Dn;Dn=[];let r=fu(s,t,e);r=(r??document).nodeType?r:new Text(r);for(let o of t._getters)t._setters.has(o)||(mu(o),o._bindings.push(i));for(let o of Dn)o._dom=r;return Dn=n,i._dom=r},gc=(s,e=gu(),t)=>{let i={_getters:new Set,_setters:new Set},n={f:s,s:e};n._dom=t??(Dn==null?void 0:Dn.push(n))??du,e.val=fu(s,i,e.rawVal);for(let r of i._getters)i._setters.has(r)||(mu(r),r._listeners.push(n));return e},vu=(s,...e)=>{for(let t of e.flat(1/0)){let i=ln(t??0),n=i===Xo?fr(()=>t.val):i===uu?fr(t):t;n!=Nn&&s.append(n)}return s},_u=(s,e,...t)=>{var o;let[i,...n]=ln(t[0]??0)===Ef?t:[{},...t],r=s?document.createElementNS(s,e):document.createElement(e);for(let[a,l]of Object.entries(i)){let c=f=>f?Object.getOwnPropertyDescriptor(f,a)??c(ln(f)):Nn,h=e+","+a,d=wa[h]??(wa[h]=((o=c(ln(r)))==null?void 0:o.set)??0),u=a.startsWith("on")?(f,_)=>{let g=a.slice(2);r.removeEventListener(g,_),r.addEventListener(g,f)}:d?d.bind(r):r.setAttribute.bind(r,a),m=ln(l??0);a.startsWith("on")||m===uu&&(l=gc(l),m=Xo),m===Xo?fr(()=>(u(l.val,l._oldVal),r)):u(l)}return vu(r,n)},mh=s=>({get:(e,t)=>_u.bind(Nn,s,t)}),bu=(s,e)=>e?e!==s&&s.replaceWith(e):s.remove(),Mf=()=>{let s=0,e=[...rr].filter(i=>i.rawVal!==i._oldVal);do{or=new Set;for(let i of new Set(e.flatMap(n=>n._listeners=Wo(n._listeners))))gc(i.f,i.s,i._dom),i._dom=Nn}while(++s<100&&(e=[...or]).length);let t=[...rr].filter(i=>i.rawVal!==i._oldVal);rr=Nn;for(let i of new Set(t.flatMap(n=>n._bindings=Wo(n._bindings))))bu(i._dom,fr(i.f,i._dom)),i._dom=Nn;for(let i of t)i._oldVal=i.rawVal};const Ae={tags:new Proxy(s=>new Proxy(_u,mh(s)),mh()),hydrate:(s,e)=>bu(s,fr(e,s)),add:vu,state:gu,derive:gc};/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const vc="169",xs={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},vs={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Cf=0,gh=1,Tf=2,xu=1,Af=2,Fi=3,pn=0,Zt=1,qt=2,hn=0,ws=1,vh=2,_h=3,bh=4,Rf=5,Rn=100,Pf=101,Df=102,Lf=103,If=104,kf=200,Nf=201,Of=202,Ff=203,gl=204,vl=205,Uf=206,zf=207,Bf=208,Vf=209,Hf=210,Gf=211,$f=212,Wf=213,Xf=214,_l=0,bl=1,xl=2,As=3,wl=4,yl=5,Sl=6,El=7,wu=0,jf=1,Yf=2,dn=0,qf=1,Kf=2,Zf=3,Jf=4,Qf=5,em=6,tm=7,yu=300,Rs=301,Ps=302,Ml=303,Cl=304,la=306,Tl=1e3,Ln=1001,Al=1002,pi=1003,im=1004,Qr=1005,bi=1006,ya=1007,In=1008,Gi=1009,Su=1010,Eu=1011,mr=1012,_c=1013,Un=1014,Ui=1015,Lr=1016,bc=1017,xc=1018,Ds=1020,Mu=35902,Cu=1021,Tu=1022,wi=1023,Au=1024,Ru=1025,ys=1026,Ls=1027,Pu=1028,wc=1029,Du=1030,yc=1031,Sc=1033,Oo=33776,Fo=33777,Uo=33778,zo=33779,Rl=35840,Pl=35841,Dl=35842,Ll=35843,Il=36196,kl=37492,Nl=37496,Ol=37808,Fl=37809,Ul=37810,zl=37811,Bl=37812,Vl=37813,Hl=37814,Gl=37815,$l=37816,Wl=37817,Xl=37818,jl=37819,Yl=37820,ql=37821,Bo=36492,Kl=36494,Zl=36495,Lu=36283,Jl=36284,Ql=36285,ec=36286,nm=3200,sm=3201,rm=0,om=1,on="",Si="srgb",vn="srgb-linear",Ec="display-p3",ca="display-p3-linear",jo="linear",ht="srgb",Yo="rec709",qo="p3",Zn=7680,xh=519,am=512,lm=513,cm=514,Iu=515,hm=516,dm=517,um=518,pm=519,tc=35044,wh="300 es",zi=2e3,Ko=2001;class Xn{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const n=this._listeners[e];if(n!==void 0){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const n=i.slice(0);for(let r=0,o=n.length;r<o;r++)n[r].call(this,e);e.target=null}}}const kt=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let yh=1234567;const ar=Math.PI/180,gr=180/Math.PI;function Ci(){const s=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(kt[s&255]+kt[s>>8&255]+kt[s>>16&255]+kt[s>>24&255]+"-"+kt[e&255]+kt[e>>8&255]+"-"+kt[e>>16&15|64]+kt[e>>24&255]+"-"+kt[t&63|128]+kt[t>>8&255]+"-"+kt[t>>16&255]+kt[t>>24&255]+kt[i&255]+kt[i>>8&255]+kt[i>>16&255]+kt[i>>24&255]).toLowerCase()}function Pt(s,e,t){return Math.max(e,Math.min(t,s))}function Mc(s,e){return(s%e+e)%e}function fm(s,e,t,i,n){return i+(s-e)*(n-i)/(t-e)}function mm(s,e,t){return s!==e?(t-s)/(e-s):0}function lr(s,e,t){return(1-t)*s+t*e}function gm(s,e,t,i){return lr(s,e,1-Math.exp(-t*i))}function vm(s,e=1){return e-Math.abs(Mc(s,e*2)-e)}function _m(s,e,t){return s<=e?0:s>=t?1:(s=(s-e)/(t-e),s*s*(3-2*s))}function bm(s,e,t){return s<=e?0:s>=t?1:(s=(s-e)/(t-e),s*s*s*(s*(s*6-15)+10))}function xm(s,e){return s+Math.floor(Math.random()*(e-s+1))}function wm(s,e){return s+Math.random()*(e-s)}function ym(s){return s*(.5-Math.random())}function Sm(s){s!==void 0&&(yh=s);let e=yh+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function Em(s){return s*ar}function Mm(s){return s*gr}function Cm(s){return(s&s-1)===0&&s!==0}function Tm(s){return Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function Am(s){return Math.pow(2,Math.floor(Math.log(s)/Math.LN2))}function Rm(s,e,t,i,n){const r=Math.cos,o=Math.sin,a=r(t/2),l=o(t/2),c=r((e+i)/2),h=o((e+i)/2),d=r((e-i)/2),u=o((e-i)/2),m=r((i-e)/2),f=o((i-e)/2);switch(n){case"XYX":s.set(a*h,l*d,l*u,a*c);break;case"YZY":s.set(l*u,a*h,l*d,a*c);break;case"ZXZ":s.set(l*d,l*u,a*h,a*c);break;case"XZX":s.set(a*h,l*f,l*m,a*c);break;case"YXY":s.set(l*m,a*h,l*f,a*c);break;case"ZYZ":s.set(l*f,l*m,a*h,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function xi(s,e){switch(e.constructor){case Float32Array:return s;case Uint32Array:return s/4294967295;case Uint16Array:return s/65535;case Uint8Array:return s/255;case Int32Array:return Math.max(s/2147483647,-1);case Int16Array:return Math.max(s/32767,-1);case Int8Array:return Math.max(s/127,-1);default:throw new Error("Invalid component type.")}}function it(s,e){switch(e.constructor){case Float32Array:return s;case Uint32Array:return Math.round(s*4294967295);case Uint16Array:return Math.round(s*65535);case Uint8Array:return Math.round(s*255);case Int32Array:return Math.round(s*2147483647);case Int16Array:return Math.round(s*32767);case Int8Array:return Math.round(s*127);default:throw new Error("Invalid component type.")}}const Pm={DEG2RAD:ar,RAD2DEG:gr,generateUUID:Ci,clamp:Pt,euclideanModulo:Mc,mapLinear:fm,inverseLerp:mm,lerp:lr,damp:gm,pingpong:vm,smoothstep:_m,smootherstep:bm,randInt:xm,randFloat:wm,randFloatSpread:ym,seededRandom:Sm,degToRad:Em,radToDeg:Mm,isPowerOfTwo:Cm,ceilPowerOfTwo:Tm,floorPowerOfTwo:Am,setQuaternionFromProperEuler:Rm,normalize:it,denormalize:xi};class le{constructor(e=0,t=0){le.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6],this.y=n[1]*t+n[4]*i+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Pt(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),n=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*i-o*n+e.x,this.y=r*n+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ie{constructor(e,t,i,n,r,o,a,l,c){Ie.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,n,r,o,a,l,c)}set(e,t,i,n,r,o,a,l,c){const h=this.elements;return h[0]=e,h[1]=n,h[2]=a,h[3]=t,h[4]=r,h[5]=l,h[6]=i,h[7]=o,h[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,r=this.elements,o=i[0],a=i[3],l=i[6],c=i[1],h=i[4],d=i[7],u=i[2],m=i[5],f=i[8],_=n[0],g=n[3],v=n[6],y=n[1],x=n[4],E=n[7],R=n[2],M=n[5],C=n[8];return r[0]=o*_+a*y+l*R,r[3]=o*g+a*x+l*M,r[6]=o*v+a*E+l*C,r[1]=c*_+h*y+d*R,r[4]=c*g+h*x+d*M,r[7]=c*v+h*E+d*C,r[2]=u*_+m*y+f*R,r[5]=u*g+m*x+f*M,r[8]=u*v+m*E+f*C,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return t*o*h-t*a*c-i*r*h+i*a*l+n*r*c-n*o*l}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=h*o-a*c,u=a*l-h*r,m=c*r-o*l,f=t*d+i*u+n*m;if(f===0)return this.set(0,0,0,0,0,0,0,0,0);const _=1/f;return e[0]=d*_,e[1]=(n*c-h*i)*_,e[2]=(a*i-n*o)*_,e[3]=u*_,e[4]=(h*t-n*l)*_,e[5]=(n*r-a*t)*_,e[6]=m*_,e[7]=(i*l-c*t)*_,e[8]=(o*t-i*r)*_,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,n,r,o,a){const l=Math.cos(r),c=Math.sin(r);return this.set(i*l,i*c,-i*(l*o+c*a)+o+e,-n*c,n*l,-n*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(Sa.makeScale(e,t)),this}rotate(e){return this.premultiply(Sa.makeRotation(-e)),this}translate(e,t){return this.premultiply(Sa.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let n=0;n<9;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const Sa=new Ie;function ku(s){for(let e=s.length-1;e>=0;--e)if(s[e]>=65535)return!0;return!1}function Zo(s){return document.createElementNS("http://www.w3.org/1999/xhtml",s)}function Dm(){const s=Zo("canvas");return s.style.display="block",s}const Sh={};function Vo(s){s in Sh||(Sh[s]=!0,console.warn(s))}function Lm(s,e,t){return new Promise(function(i,n){function r(){switch(s.clientWaitSync(e,s.SYNC_FLUSH_COMMANDS_BIT,0)){case s.WAIT_FAILED:n();break;case s.TIMEOUT_EXPIRED:setTimeout(r,t);break;default:i()}}setTimeout(r,t)})}function Im(s){const e=s.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function km(s){const e=s.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const Eh=new Ie().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),Mh=new Ie().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Hs={[vn]:{transfer:jo,primaries:Yo,luminanceCoefficients:[.2126,.7152,.0722],toReference:s=>s,fromReference:s=>s},[Si]:{transfer:ht,primaries:Yo,luminanceCoefficients:[.2126,.7152,.0722],toReference:s=>s.convertSRGBToLinear(),fromReference:s=>s.convertLinearToSRGB()},[ca]:{transfer:jo,primaries:qo,luminanceCoefficients:[.2289,.6917,.0793],toReference:s=>s.applyMatrix3(Mh),fromReference:s=>s.applyMatrix3(Eh)},[Ec]:{transfer:ht,primaries:qo,luminanceCoefficients:[.2289,.6917,.0793],toReference:s=>s.convertSRGBToLinear().applyMatrix3(Mh),fromReference:s=>s.applyMatrix3(Eh).convertLinearToSRGB()}},Nm=new Set([vn,ca]),Qe={enabled:!0,_workingColorSpace:vn,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(s){if(!Nm.has(s))throw new Error(`Unsupported working color space, "${s}".`);this._workingColorSpace=s},convert:function(s,e,t){if(this.enabled===!1||e===t||!e||!t)return s;const i=Hs[e].toReference,n=Hs[t].fromReference;return n(i(s))},fromWorkingColorSpace:function(s,e){return this.convert(s,this._workingColorSpace,e)},toWorkingColorSpace:function(s,e){return this.convert(s,e,this._workingColorSpace)},getPrimaries:function(s){return Hs[s].primaries},getTransfer:function(s){return s===on?jo:Hs[s].transfer},getLuminanceCoefficients:function(s,e=this._workingColorSpace){return s.fromArray(Hs[e].luminanceCoefficients)}};function Ss(s){return s<.04045?s*.0773993808:Math.pow(s*.9478672986+.0521327014,2.4)}function Ea(s){return s<.0031308?s*12.92:1.055*Math.pow(s,.41666)-.055}let Jn;class Om{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Jn===void 0&&(Jn=Zo("canvas")),Jn.width=e.width,Jn.height=e.height;const i=Jn.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Jn}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Zo("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const n=i.getImageData(0,0,e.width,e.height),r=n.data;for(let o=0;o<r.length;o++)r[o]=Ss(r[o]/255)*255;return i.putImageData(n,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(Ss(t[i]/255)*255):t[i]=Ss(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Fm=0;class Nu{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Fm++}),this.uuid=Ci(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(n!==null){let r;if(Array.isArray(n)){r=[];for(let o=0,a=n.length;o<a;o++)n[o].isDataTexture?r.push(Ma(n[o].image)):r.push(Ma(n[o]))}else r=Ma(n);i.url=r}return t||(e.images[this.uuid]=i),i}}function Ma(s){return typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&s instanceof ImageBitmap?Om.getDataURL(s):s.data?{data:Array.from(s.data),width:s.width,height:s.height,type:s.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Um=0;class Vt extends Xn{constructor(e=Vt.DEFAULT_IMAGE,t=Vt.DEFAULT_MAPPING,i=Ln,n=Ln,r=bi,o=In,a=wi,l=Gi,c=Vt.DEFAULT_ANISOTROPY,h=on){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Um++}),this.uuid=Ci(),this.name="",this.source=new Nu(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new le(0,0),this.repeat=new le(1,1),this.center=new le(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ie,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=h,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==yu)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Tl:e.x=e.x-Math.floor(e.x);break;case Ln:e.x=e.x<0?0:1;break;case Al:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Tl:e.y=e.y-Math.floor(e.y);break;case Ln:e.y=e.y<0?0:1;break;case Al:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Vt.DEFAULT_IMAGE=null;Vt.DEFAULT_MAPPING=yu;Vt.DEFAULT_ANISOTROPY=1;class wt{constructor(e=0,t=0,i=0,n=1){wt.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*n+o[12]*r,this.y=o[1]*t+o[5]*i+o[9]*n+o[13]*r,this.z=o[2]*t+o[6]*i+o[10]*n+o[14]*r,this.w=o[3]*t+o[7]*i+o[11]*n+o[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,n,r;const l=e.elements,c=l[0],h=l[4],d=l[8],u=l[1],m=l[5],f=l[9],_=l[2],g=l[6],v=l[10];if(Math.abs(h-u)<.01&&Math.abs(d-_)<.01&&Math.abs(f-g)<.01){if(Math.abs(h+u)<.1&&Math.abs(d+_)<.1&&Math.abs(f+g)<.1&&Math.abs(c+m+v-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const x=(c+1)/2,E=(m+1)/2,R=(v+1)/2,M=(h+u)/4,C=(d+_)/4,P=(f+g)/4;return x>E&&x>R?x<.01?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(x),n=M/i,r=C/i):E>R?E<.01?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(E),i=M/n,r=P/n):R<.01?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(R),i=C/r,n=P/r),this.set(i,n,r,t),this}let y=Math.sqrt((g-f)*(g-f)+(d-_)*(d-_)+(u-h)*(u-h));return Math.abs(y)<.001&&(y=1),this.x=(g-f)/y,this.y=(d-_)/y,this.z=(u-h)/y,this.w=Math.acos((c+m+v-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class zm extends Xn{constructor(e=1,t=1,i={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new wt(0,0,e,t),this.scissorTest=!1,this.viewport=new wt(0,0,e,t);const n={width:e,height:t,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:bi,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},i);const r=new Vt(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);r.flipY=!1,r.generateMipmaps=i.generateMipmaps,r.internalFormat=i.internalFormat,this.textures=[];const o=i.count;for(let a=0;a<o;a++)this.textures[a]=r.clone(),this.textures[a].isRenderTargetTexture=!0;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let n=0,r=this.textures.length;n<r;n++)this.textures[n].image.width=e,this.textures[n].image.height=t,this.textures[n].image.depth=i;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let i=0,n=e.textures.length;i<n;i++)this.textures[i]=e.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new Nu(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class zn extends zm{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}}class Ou extends Vt{constructor(e=null,t=1,i=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=pi,this.minFilter=pi,this.wrapR=Ln,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class Bm extends Vt{constructor(e=null,t=1,i=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=pi,this.minFilter=pi,this.wrapR=Ln,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Bn{constructor(e=0,t=0,i=0,n=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=n}static slerpFlat(e,t,i,n,r,o,a){let l=i[n+0],c=i[n+1],h=i[n+2],d=i[n+3];const u=r[o+0],m=r[o+1],f=r[o+2],_=r[o+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=h,e[t+3]=d;return}if(a===1){e[t+0]=u,e[t+1]=m,e[t+2]=f,e[t+3]=_;return}if(d!==_||l!==u||c!==m||h!==f){let g=1-a;const v=l*u+c*m+h*f+d*_,y=v>=0?1:-1,x=1-v*v;if(x>Number.EPSILON){const R=Math.sqrt(x),M=Math.atan2(R,v*y);g=Math.sin(g*M)/R,a=Math.sin(a*M)/R}const E=a*y;if(l=l*g+u*E,c=c*g+m*E,h=h*g+f*E,d=d*g+_*E,g===1-a){const R=1/Math.sqrt(l*l+c*c+h*h+d*d);l*=R,c*=R,h*=R,d*=R}}e[t]=l,e[t+1]=c,e[t+2]=h,e[t+3]=d}static multiplyQuaternionsFlat(e,t,i,n,r,o){const a=i[n],l=i[n+1],c=i[n+2],h=i[n+3],d=r[o],u=r[o+1],m=r[o+2],f=r[o+3];return e[t]=a*f+h*d+l*m-c*u,e[t+1]=l*f+h*u+c*d-a*m,e[t+2]=c*f+h*m+a*u-l*d,e[t+3]=h*f-a*d-l*u-c*m,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,n=e._y,r=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(i/2),h=a(n/2),d=a(r/2),u=l(i/2),m=l(n/2),f=l(r/2);switch(o){case"XYZ":this._x=u*h*d+c*m*f,this._y=c*m*d-u*h*f,this._z=c*h*f+u*m*d,this._w=c*h*d-u*m*f;break;case"YXZ":this._x=u*h*d+c*m*f,this._y=c*m*d-u*h*f,this._z=c*h*f-u*m*d,this._w=c*h*d+u*m*f;break;case"ZXY":this._x=u*h*d-c*m*f,this._y=c*m*d+u*h*f,this._z=c*h*f+u*m*d,this._w=c*h*d-u*m*f;break;case"ZYX":this._x=u*h*d-c*m*f,this._y=c*m*d+u*h*f,this._z=c*h*f-u*m*d,this._w=c*h*d+u*m*f;break;case"YZX":this._x=u*h*d+c*m*f,this._y=c*m*d+u*h*f,this._z=c*h*f-u*m*d,this._w=c*h*d-u*m*f;break;case"XZY":this._x=u*h*d-c*m*f,this._y=c*m*d-u*h*f,this._z=c*h*f+u*m*d,this._w=c*h*d+u*m*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],n=t[4],r=t[8],o=t[1],a=t[5],l=t[9],c=t[2],h=t[6],d=t[10],u=i+a+d;if(u>0){const m=.5/Math.sqrt(u+1);this._w=.25/m,this._x=(h-l)*m,this._y=(r-c)*m,this._z=(o-n)*m}else if(i>a&&i>d){const m=2*Math.sqrt(1+i-a-d);this._w=(h-l)/m,this._x=.25*m,this._y=(n+o)/m,this._z=(r+c)/m}else if(a>d){const m=2*Math.sqrt(1+a-i-d);this._w=(r-c)/m,this._x=(n+o)/m,this._y=.25*m,this._z=(l+h)/m}else{const m=2*Math.sqrt(1+d-i-a);this._w=(o-n)/m,this._x=(r+c)/m,this._y=(l+h)/m,this._z=.25*m}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Pt(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const n=Math.min(1,t/i);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,n=e._y,r=e._z,o=e._w,a=t._x,l=t._y,c=t._z,h=t._w;return this._x=i*h+o*a+n*c-r*l,this._y=n*h+o*l+r*a-i*c,this._z=r*h+o*c+i*l-n*a,this._w=o*h-i*a-n*l-r*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,n=this._y,r=this._z,o=this._w;let a=o*e._w+i*e._x+n*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=n,this._z=r,this;const l=1-a*a;if(l<=Number.EPSILON){const m=1-t;return this._w=m*o+t*this._w,this._x=m*i+t*this._x,this._y=m*n+t*this._y,this._z=m*r+t*this._z,this.normalize(),this}const c=Math.sqrt(l),h=Math.atan2(c,a),d=Math.sin((1-t)*h)/c,u=Math.sin(t*h)/c;return this._w=o*d+this._w*u,this._x=i*d+this._x*u,this._y=n*d+this._y*u,this._z=r*d+this._z*u,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),n=Math.sqrt(1-i),r=Math.sqrt(i);return this.set(n*Math.sin(e),n*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class k{constructor(e=0,t=0,i=0){k.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Ch.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Ch.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*n,this.y=r[1]*t+r[4]*i+r[7]*n,this.z=r[2]*t+r[5]*i+r[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,r=e.elements,o=1/(r[3]*t+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*n+r[12])*o,this.y=(r[1]*t+r[5]*i+r[9]*n+r[13])*o,this.z=(r[2]*t+r[6]*i+r[10]*n+r[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,n=this.z,r=e.x,o=e.y,a=e.z,l=e.w,c=2*(o*n-a*i),h=2*(a*t-r*n),d=2*(r*i-o*t);return this.x=t+l*c+o*d-a*h,this.y=i+l*h+a*c-r*d,this.z=n+l*d+r*h-o*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n,this.y=r[1]*t+r[5]*i+r[9]*n,this.z=r[2]*t+r[6]*i+r[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,n=e.y,r=e.z,o=t.x,a=t.y,l=t.z;return this.x=n*l-r*a,this.y=r*o-i*l,this.z=i*a-n*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return Ca.copy(this).projectOnVector(e),this.sub(Ca)}reflect(e){return this.sub(Ca.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Pt(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const n=Math.sin(t)*e;return this.x=n*Math.sin(i),this.y=Math.cos(t)*e,this.z=n*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Ca=new k,Ch=new Bn;class Ir{constructor(e=new k(1/0,1/0,1/0),t=new k(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(gi.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(gi.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=gi.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const r=i.getAttribute("position");if(t===!0&&r!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=r.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,gi):gi.fromBufferAttribute(r,o),gi.applyMatrix4(e.matrixWorld),this.expandByPoint(gi);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),eo.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),eo.copy(i.boundingBox)),eo.applyMatrix4(e.matrixWorld),this.union(eo)}const n=e.children;for(let r=0,o=n.length;r<o;r++)this.expandByObject(n[r],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,gi),gi.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Gs),to.subVectors(this.max,Gs),Qn.subVectors(e.a,Gs),es.subVectors(e.b,Gs),ts.subVectors(e.c,Gs),qi.subVectors(es,Qn),Ki.subVectors(ts,es),xn.subVectors(Qn,ts);let t=[0,-qi.z,qi.y,0,-Ki.z,Ki.y,0,-xn.z,xn.y,qi.z,0,-qi.x,Ki.z,0,-Ki.x,xn.z,0,-xn.x,-qi.y,qi.x,0,-Ki.y,Ki.x,0,-xn.y,xn.x,0];return!Ta(t,Qn,es,ts,to)||(t=[1,0,0,0,1,0,0,0,1],!Ta(t,Qn,es,ts,to))?!1:(io.crossVectors(qi,Ki),t=[io.x,io.y,io.z],Ta(t,Qn,es,ts,to))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,gi).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(gi).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Di[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Di[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Di[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Di[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Di[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Di[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Di[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Di[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Di),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Di=[new k,new k,new k,new k,new k,new k,new k,new k],gi=new k,eo=new Ir,Qn=new k,es=new k,ts=new k,qi=new k,Ki=new k,xn=new k,Gs=new k,to=new k,io=new k,wn=new k;function Ta(s,e,t,i,n){for(let r=0,o=s.length-3;r<=o;r+=3){wn.fromArray(s,r);const a=n.x*Math.abs(wn.x)+n.y*Math.abs(wn.y)+n.z*Math.abs(wn.z),l=e.dot(wn),c=t.dot(wn),h=i.dot(wn);if(Math.max(-Math.max(l,c,h),Math.min(l,c,h))>a)return!1}return!0}const Vm=new Ir,$s=new k,Aa=new k;class kr{constructor(e=new k,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):Vm.setFromPoints(e).getCenter(i);let n=0;for(let r=0,o=e.length;r<o;r++)n=Math.max(n,i.distanceToSquared(e[r]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;$s.subVectors(e,this.center);const t=$s.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),n=(i-this.radius)*.5;this.center.addScaledVector($s,n/i),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(Aa.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint($s.copy(e.center).add(Aa)),this.expandByPoint($s.copy(e.center).sub(Aa))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Li=new k,Ra=new k,no=new k,Zi=new k,Pa=new k,so=new k,Da=new k;class Nr{constructor(e=new k,t=new k(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Li)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Li.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Li.copy(this.origin).addScaledVector(this.direction,t),Li.distanceToSquared(e))}distanceSqToSegment(e,t,i,n){Ra.copy(e).add(t).multiplyScalar(.5),no.copy(t).sub(e).normalize(),Zi.copy(this.origin).sub(Ra);const r=e.distanceTo(t)*.5,o=-this.direction.dot(no),a=Zi.dot(this.direction),l=-Zi.dot(no),c=Zi.lengthSq(),h=Math.abs(1-o*o);let d,u,m,f;if(h>0)if(d=o*l-a,u=o*a-l,f=r*h,d>=0)if(u>=-f)if(u<=f){const _=1/h;d*=_,u*=_,m=d*(d+o*u+2*a)+u*(o*d+u+2*l)+c}else u=r,d=Math.max(0,-(o*u+a)),m=-d*d+u*(u+2*l)+c;else u=-r,d=Math.max(0,-(o*u+a)),m=-d*d+u*(u+2*l)+c;else u<=-f?(d=Math.max(0,-(-o*r+a)),u=d>0?-r:Math.min(Math.max(-r,-l),r),m=-d*d+u*(u+2*l)+c):u<=f?(d=0,u=Math.min(Math.max(-r,-l),r),m=u*(u+2*l)+c):(d=Math.max(0,-(o*r+a)),u=d>0?r:Math.min(Math.max(-r,-l),r),m=-d*d+u*(u+2*l)+c);else u=o>0?-r:r,d=Math.max(0,-(o*u+a)),m=-d*d+u*(u+2*l)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,d),n&&n.copy(Ra).addScaledVector(no,u),m}intersectSphere(e,t){Li.subVectors(e.center,this.origin);const i=Li.dot(this.direction),n=Li.dot(Li)-i*i,r=e.radius*e.radius;if(n>r)return null;const o=Math.sqrt(r-n),a=i-o,l=i+o;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,n,r,o,a,l;const c=1/this.direction.x,h=1/this.direction.y,d=1/this.direction.z,u=this.origin;return c>=0?(i=(e.min.x-u.x)*c,n=(e.max.x-u.x)*c):(i=(e.max.x-u.x)*c,n=(e.min.x-u.x)*c),h>=0?(r=(e.min.y-u.y)*h,o=(e.max.y-u.y)*h):(r=(e.max.y-u.y)*h,o=(e.min.y-u.y)*h),i>o||r>n||((r>i||isNaN(i))&&(i=r),(o<n||isNaN(n))&&(n=o),d>=0?(a=(e.min.z-u.z)*d,l=(e.max.z-u.z)*d):(a=(e.max.z-u.z)*d,l=(e.min.z-u.z)*d),i>l||a>n)||((a>i||i!==i)&&(i=a),(l<n||n!==n)&&(n=l),n<0)?null:this.at(i>=0?i:n,t)}intersectsBox(e){return this.intersectBox(e,Li)!==null}intersectTriangle(e,t,i,n,r){Pa.subVectors(t,e),so.subVectors(i,e),Da.crossVectors(Pa,so);let o=this.direction.dot(Da),a;if(o>0){if(n)return null;a=1}else if(o<0)a=-1,o=-o;else return null;Zi.subVectors(this.origin,e);const l=a*this.direction.dot(so.crossVectors(Zi,so));if(l<0)return null;const c=a*this.direction.dot(Pa.cross(Zi));if(c<0||l+c>o)return null;const h=-a*Zi.dot(Da);return h<0?null:this.at(h/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class at{constructor(e,t,i,n,r,o,a,l,c,h,d,u,m,f,_,g){at.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,n,r,o,a,l,c,h,d,u,m,f,_,g)}set(e,t,i,n,r,o,a,l,c,h,d,u,m,f,_,g){const v=this.elements;return v[0]=e,v[4]=t,v[8]=i,v[12]=n,v[1]=r,v[5]=o,v[9]=a,v[13]=l,v[2]=c,v[6]=h,v[10]=d,v[14]=u,v[3]=m,v[7]=f,v[11]=_,v[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new at().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,n=1/is.setFromMatrixColumn(e,0).length(),r=1/is.setFromMatrixColumn(e,1).length(),o=1/is.setFromMatrixColumn(e,2).length();return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,n=e.y,r=e.z,o=Math.cos(i),a=Math.sin(i),l=Math.cos(n),c=Math.sin(n),h=Math.cos(r),d=Math.sin(r);if(e.order==="XYZ"){const u=o*h,m=o*d,f=a*h,_=a*d;t[0]=l*h,t[4]=-l*d,t[8]=c,t[1]=m+f*c,t[5]=u-_*c,t[9]=-a*l,t[2]=_-u*c,t[6]=f+m*c,t[10]=o*l}else if(e.order==="YXZ"){const u=l*h,m=l*d,f=c*h,_=c*d;t[0]=u+_*a,t[4]=f*a-m,t[8]=o*c,t[1]=o*d,t[5]=o*h,t[9]=-a,t[2]=m*a-f,t[6]=_+u*a,t[10]=o*l}else if(e.order==="ZXY"){const u=l*h,m=l*d,f=c*h,_=c*d;t[0]=u-_*a,t[4]=-o*d,t[8]=f+m*a,t[1]=m+f*a,t[5]=o*h,t[9]=_-u*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const u=o*h,m=o*d,f=a*h,_=a*d;t[0]=l*h,t[4]=f*c-m,t[8]=u*c+_,t[1]=l*d,t[5]=_*c+u,t[9]=m*c-f,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const u=o*l,m=o*c,f=a*l,_=a*c;t[0]=l*h,t[4]=_-u*d,t[8]=f*d+m,t[1]=d,t[5]=o*h,t[9]=-a*h,t[2]=-c*h,t[6]=m*d+f,t[10]=u-_*d}else if(e.order==="XZY"){const u=o*l,m=o*c,f=a*l,_=a*c;t[0]=l*h,t[4]=-d,t[8]=c*h,t[1]=u*d+_,t[5]=o*h,t[9]=m*d-f,t[2]=f*d-m,t[6]=a*h,t[10]=_*d+u}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Hm,e,Gm)}lookAt(e,t,i){const n=this.elements;return ii.subVectors(e,t),ii.lengthSq()===0&&(ii.z=1),ii.normalize(),Ji.crossVectors(i,ii),Ji.lengthSq()===0&&(Math.abs(i.z)===1?ii.x+=1e-4:ii.z+=1e-4,ii.normalize(),Ji.crossVectors(i,ii)),Ji.normalize(),ro.crossVectors(ii,Ji),n[0]=Ji.x,n[4]=ro.x,n[8]=ii.x,n[1]=Ji.y,n[5]=ro.y,n[9]=ii.y,n[2]=Ji.z,n[6]=ro.z,n[10]=ii.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,r=this.elements,o=i[0],a=i[4],l=i[8],c=i[12],h=i[1],d=i[5],u=i[9],m=i[13],f=i[2],_=i[6],g=i[10],v=i[14],y=i[3],x=i[7],E=i[11],R=i[15],M=n[0],C=n[4],P=n[8],N=n[12],w=n[1],S=n[5],D=n[9],I=n[13],V=n[2],q=n[6],H=n[10],te=n[14],X=n[3],oe=n[7],ae=n[11],fe=n[15];return r[0]=o*M+a*w+l*V+c*X,r[4]=o*C+a*S+l*q+c*oe,r[8]=o*P+a*D+l*H+c*ae,r[12]=o*N+a*I+l*te+c*fe,r[1]=h*M+d*w+u*V+m*X,r[5]=h*C+d*S+u*q+m*oe,r[9]=h*P+d*D+u*H+m*ae,r[13]=h*N+d*I+u*te+m*fe,r[2]=f*M+_*w+g*V+v*X,r[6]=f*C+_*S+g*q+v*oe,r[10]=f*P+_*D+g*H+v*ae,r[14]=f*N+_*I+g*te+v*fe,r[3]=y*M+x*w+E*V+R*X,r[7]=y*C+x*S+E*q+R*oe,r[11]=y*P+x*D+E*H+R*ae,r[15]=y*N+x*I+E*te+R*fe,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],o=e[1],a=e[5],l=e[9],c=e[13],h=e[2],d=e[6],u=e[10],m=e[14],f=e[3],_=e[7],g=e[11],v=e[15];return f*(+r*l*d-n*c*d-r*a*u+i*c*u+n*a*m-i*l*m)+_*(+t*l*m-t*c*u+r*o*u-n*o*m+n*c*h-r*l*h)+g*(+t*c*d-t*a*m-r*o*d+i*o*m+r*a*h-i*c*h)+v*(-n*a*h-t*l*d+t*a*u+n*o*d-i*o*u+i*l*h)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=e[9],u=e[10],m=e[11],f=e[12],_=e[13],g=e[14],v=e[15],y=d*g*c-_*u*c+_*l*m-a*g*m-d*l*v+a*u*v,x=f*u*c-h*g*c-f*l*m+o*g*m+h*l*v-o*u*v,E=h*_*c-f*d*c+f*a*m-o*_*m-h*a*v+o*d*v,R=f*d*l-h*_*l-f*a*u+o*_*u+h*a*g-o*d*g,M=t*y+i*x+n*E+r*R;if(M===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const C=1/M;return e[0]=y*C,e[1]=(_*u*r-d*g*r-_*n*m+i*g*m+d*n*v-i*u*v)*C,e[2]=(a*g*r-_*l*r+_*n*c-i*g*c-a*n*v+i*l*v)*C,e[3]=(d*l*r-a*u*r-d*n*c+i*u*c+a*n*m-i*l*m)*C,e[4]=x*C,e[5]=(h*g*r-f*u*r+f*n*m-t*g*m-h*n*v+t*u*v)*C,e[6]=(f*l*r-o*g*r-f*n*c+t*g*c+o*n*v-t*l*v)*C,e[7]=(o*u*r-h*l*r+h*n*c-t*u*c-o*n*m+t*l*m)*C,e[8]=E*C,e[9]=(f*d*r-h*_*r-f*i*m+t*_*m+h*i*v-t*d*v)*C,e[10]=(o*_*r-f*a*r+f*i*c-t*_*c-o*i*v+t*a*v)*C,e[11]=(h*a*r-o*d*r-h*i*c+t*d*c+o*i*m-t*a*m)*C,e[12]=R*C,e[13]=(h*_*n-f*d*n+f*i*u-t*_*u-h*i*g+t*d*g)*C,e[14]=(f*a*n-o*_*n-f*i*l+t*_*l+o*i*g-t*a*g)*C,e[15]=(o*d*n-h*a*n+h*i*l-t*d*l-o*i*u+t*a*u)*C,this}scale(e){const t=this.elements,i=e.x,n=e.y,r=e.z;return t[0]*=i,t[4]*=n,t[8]*=r,t[1]*=i,t[5]*=n,t[9]*=r,t[2]*=i,t[6]*=n,t[10]*=r,t[3]*=i,t[7]*=n,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,n))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),n=Math.sin(t),r=1-i,o=e.x,a=e.y,l=e.z,c=r*o,h=r*a;return this.set(c*o+i,c*a-n*l,c*l+n*a,0,c*a+n*l,h*a+i,h*l-n*o,0,c*l-n*a,h*l+n*o,r*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,n,r,o){return this.set(1,i,r,0,e,1,o,0,t,n,1,0,0,0,0,1),this}compose(e,t,i){const n=this.elements,r=t._x,o=t._y,a=t._z,l=t._w,c=r+r,h=o+o,d=a+a,u=r*c,m=r*h,f=r*d,_=o*h,g=o*d,v=a*d,y=l*c,x=l*h,E=l*d,R=i.x,M=i.y,C=i.z;return n[0]=(1-(_+v))*R,n[1]=(m+E)*R,n[2]=(f-x)*R,n[3]=0,n[4]=(m-E)*M,n[5]=(1-(u+v))*M,n[6]=(g+y)*M,n[7]=0,n[8]=(f+x)*C,n[9]=(g-y)*C,n[10]=(1-(u+_))*C,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,i){const n=this.elements;let r=is.set(n[0],n[1],n[2]).length();const o=is.set(n[4],n[5],n[6]).length(),a=is.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),e.x=n[12],e.y=n[13],e.z=n[14],vi.copy(this);const c=1/r,h=1/o,d=1/a;return vi.elements[0]*=c,vi.elements[1]*=c,vi.elements[2]*=c,vi.elements[4]*=h,vi.elements[5]*=h,vi.elements[6]*=h,vi.elements[8]*=d,vi.elements[9]*=d,vi.elements[10]*=d,t.setFromRotationMatrix(vi),i.x=r,i.y=o,i.z=a,this}makePerspective(e,t,i,n,r,o,a=zi){const l=this.elements,c=2*r/(t-e),h=2*r/(i-n),d=(t+e)/(t-e),u=(i+n)/(i-n);let m,f;if(a===zi)m=-(o+r)/(o-r),f=-2*o*r/(o-r);else if(a===Ko)m=-o/(o-r),f=-o*r/(o-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=c,l[4]=0,l[8]=d,l[12]=0,l[1]=0,l[5]=h,l[9]=u,l[13]=0,l[2]=0,l[6]=0,l[10]=m,l[14]=f,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,i,n,r,o,a=zi){const l=this.elements,c=1/(t-e),h=1/(i-n),d=1/(o-r),u=(t+e)*c,m=(i+n)*h;let f,_;if(a===zi)f=(o+r)*d,_=-2*d;else if(a===Ko)f=r*d,_=-1*d;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-u,l[1]=0,l[5]=2*h,l[9]=0,l[13]=-m,l[2]=0,l[6]=0,l[10]=_,l[14]=-f,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let n=0;n<16;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const is=new k,vi=new at,Hm=new k(0,0,0),Gm=new k(1,1,1),Ji=new k,ro=new k,ii=new k,Th=new at,Ah=new Bn;class $i{constructor(e=0,t=0,i=0,n=$i.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,n=this._order){return this._x=e,this._y=t,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const n=e.elements,r=n[0],o=n[4],a=n[8],l=n[1],c=n[5],h=n[9],d=n[2],u=n[6],m=n[10];switch(t){case"XYZ":this._y=Math.asin(Pt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,m),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(u,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Pt(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,m),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-d,r),this._z=0);break;case"ZXY":this._x=Math.asin(Pt(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-d,m),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,r));break;case"ZYX":this._y=Math.asin(-Pt(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(u,m),this._z=Math.atan2(l,r)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(Pt(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-d,r)):(this._x=0,this._y=Math.atan2(a,m));break;case"XZY":this._z=Math.asin(-Pt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(u,c),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-h,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return Th.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Th,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Ah.setFromEuler(this),this.setFromQuaternion(Ah,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}$i.DEFAULT_ORDER="XYZ";class Cc{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let $m=0;const Rh=new k,ns=new Bn,Ii=new at,oo=new k,Ws=new k,Wm=new k,Xm=new Bn,Ph=new k(1,0,0),Dh=new k(0,1,0),Lh=new k(0,0,1),Ih={type:"added"},jm={type:"removed"},ss={type:"childadded",child:null},La={type:"childremoved",child:null};class Lt extends Xn{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:$m++}),this.uuid=Ci(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Lt.DEFAULT_UP.clone();const e=new k,t=new $i,i=new Bn,n=new k(1,1,1);function r(){i.setFromEuler(t,!1)}function o(){t.setFromQuaternion(i,void 0,!1)}t._onChange(r),i._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new at},normalMatrix:{value:new Ie}}),this.matrix=new at,this.matrixWorld=new at,this.matrixAutoUpdate=Lt.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Lt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Cc,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return ns.setFromAxisAngle(e,t),this.quaternion.multiply(ns),this}rotateOnWorldAxis(e,t){return ns.setFromAxisAngle(e,t),this.quaternion.premultiply(ns),this}rotateX(e){return this.rotateOnAxis(Ph,e)}rotateY(e){return this.rotateOnAxis(Dh,e)}rotateZ(e){return this.rotateOnAxis(Lh,e)}translateOnAxis(e,t){return Rh.copy(e).applyQuaternion(this.quaternion),this.position.add(Rh.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Ph,e)}translateY(e){return this.translateOnAxis(Dh,e)}translateZ(e){return this.translateOnAxis(Lh,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Ii.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?oo.copy(e):oo.set(e,t,i);const n=this.parent;this.updateWorldMatrix(!0,!1),Ws.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ii.lookAt(Ws,oo,this.up):Ii.lookAt(oo,Ws,this.up),this.quaternion.setFromRotationMatrix(Ii),n&&(Ii.extractRotation(n.matrixWorld),ns.setFromRotationMatrix(Ii),this.quaternion.premultiply(ns.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Ih),ss.child=e,this.dispatchEvent(ss),ss.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(jm),La.child=e,this.dispatchEvent(La),La.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Ii.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Ii.multiply(e.parent.matrixWorld)),e.applyMatrix4(Ii),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Ih),ss.child=e,this.dispatchEvent(ss),ss.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,n=this.children.length;i<n;i++){const o=this.children[i].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const n=this.children;for(let r=0,o=n.length;r<o;r++)n[r].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ws,e,Wm),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ws,Xm,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const n=this.children;for(let r=0,o=n.length;r<o;r++)n[r].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),n.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(n.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(n.type="BatchedMesh",n.perObjectFrustumCulled=this.perObjectFrustumCulled,n.sortObjects=this.sortObjects,n.drawRanges=this._drawRanges,n.reservedRanges=this._reservedRanges,n.visibility=this._visibility,n.active=this._active,n.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),n.maxInstanceCount=this._maxInstanceCount,n.maxVertexCount=this._maxVertexCount,n.maxIndexCount=this._maxIndexCount,n.geometryInitialized=this._geometryInitialized,n.geometryCount=this._geometryCount,n.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(n.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(n.boundingSphere={center:n.boundingSphere.center.toArray(),radius:n.boundingSphere.radius}),this.boundingBox!==null&&(n.boundingBox={min:n.boundingBox.min.toArray(),max:n.boundingBox.max.toArray()}));function r(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(n.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=r(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,h=l.length;c<h;c++){const d=l[c];r(e.shapes,d)}else r(e.shapes,l)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(r(e.materials,this.material[l]));n.material=a}else n.material=r(e.materials,this.material);if(this.children.length>0){n.children=[];for(let a=0;a<this.children.length;a++)n.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];n.animations.push(r(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),h=o(e.images),d=o(e.shapes),u=o(e.skeletons),m=o(e.animations),f=o(e.nodes);a.length>0&&(i.geometries=a),l.length>0&&(i.materials=l),c.length>0&&(i.textures=c),h.length>0&&(i.images=h),d.length>0&&(i.shapes=d),u.length>0&&(i.skeletons=u),m.length>0&&(i.animations=m),f.length>0&&(i.nodes=f)}return i.object=n,i;function o(a){const l=[];for(const c in a){const h=a[c];delete h.metadata,l.push(h)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const n=e.children[i];this.add(n.clone())}return this}}Lt.DEFAULT_UP=new k(0,1,0);Lt.DEFAULT_MATRIX_AUTO_UPDATE=!0;Lt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const _i=new k,ki=new k,Ia=new k,Ni=new k,rs=new k,os=new k,kh=new k,ka=new k,Na=new k,Oa=new k,Fa=new wt,Ua=new wt,za=new wt;class ui{constructor(e=new k,t=new k,i=new k){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,n){n.subVectors(i,t),_i.subVectors(e,t),n.cross(_i);const r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(e,t,i,n,r){_i.subVectors(n,t),ki.subVectors(i,t),Ia.subVectors(e,t);const o=_i.dot(_i),a=_i.dot(ki),l=_i.dot(Ia),c=ki.dot(ki),h=ki.dot(Ia),d=o*c-a*a;if(d===0)return r.set(0,0,0),null;const u=1/d,m=(c*l-a*h)*u,f=(o*h-a*l)*u;return r.set(1-m-f,f,m)}static containsPoint(e,t,i,n){return this.getBarycoord(e,t,i,n,Ni)===null?!1:Ni.x>=0&&Ni.y>=0&&Ni.x+Ni.y<=1}static getInterpolation(e,t,i,n,r,o,a,l){return this.getBarycoord(e,t,i,n,Ni)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(r,Ni.x),l.addScaledVector(o,Ni.y),l.addScaledVector(a,Ni.z),l)}static getInterpolatedAttribute(e,t,i,n,r,o){return Fa.setScalar(0),Ua.setScalar(0),za.setScalar(0),Fa.fromBufferAttribute(e,t),Ua.fromBufferAttribute(e,i),za.fromBufferAttribute(e,n),o.setScalar(0),o.addScaledVector(Fa,r.x),o.addScaledVector(Ua,r.y),o.addScaledVector(za,r.z),o}static isFrontFacing(e,t,i,n){return _i.subVectors(i,t),ki.subVectors(e,t),_i.cross(ki).dot(n)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this}setFromAttributeAndIndices(e,t,i,n){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return _i.subVectors(this.c,this.b),ki.subVectors(this.a,this.b),_i.cross(ki).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return ui.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return ui.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,n,r){return ui.getInterpolation(e,this.a,this.b,this.c,t,i,n,r)}containsPoint(e){return ui.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return ui.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,n=this.b,r=this.c;let o,a;rs.subVectors(n,i),os.subVectors(r,i),ka.subVectors(e,i);const l=rs.dot(ka),c=os.dot(ka);if(l<=0&&c<=0)return t.copy(i);Na.subVectors(e,n);const h=rs.dot(Na),d=os.dot(Na);if(h>=0&&d<=h)return t.copy(n);const u=l*d-h*c;if(u<=0&&l>=0&&h<=0)return o=l/(l-h),t.copy(i).addScaledVector(rs,o);Oa.subVectors(e,r);const m=rs.dot(Oa),f=os.dot(Oa);if(f>=0&&m<=f)return t.copy(r);const _=m*c-l*f;if(_<=0&&c>=0&&f<=0)return a=c/(c-f),t.copy(i).addScaledVector(os,a);const g=h*f-m*d;if(g<=0&&d-h>=0&&m-f>=0)return kh.subVectors(r,n),a=(d-h)/(d-h+(m-f)),t.copy(n).addScaledVector(kh,a);const v=1/(g+_+u);return o=_*v,a=u*v,t.copy(i).addScaledVector(rs,o).addScaledVector(os,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Fu={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Qi={h:0,s:0,l:0},ao={h:0,s:0,l:0};function Ba(s,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?s+(e-s)*6*t:t<1/2?e:t<2/3?s+(e-s)*6*(2/3-t):s}class We{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const n=e;n&&n.isColor?this.copy(n):typeof n=="number"?this.setHex(n):typeof n=="string"&&this.setStyle(n)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Si){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Qe.toWorkingColorSpace(this,t),this}setRGB(e,t,i,n=Qe.workingColorSpace){return this.r=e,this.g=t,this.b=i,Qe.toWorkingColorSpace(this,n),this}setHSL(e,t,i,n=Qe.workingColorSpace){if(e=Mc(e,1),t=Pt(t,0,1),i=Pt(i,0,1),t===0)this.r=this.g=this.b=i;else{const r=i<=.5?i*(1+t):i+t-i*t,o=2*i-r;this.r=Ba(o,r,e+1/3),this.g=Ba(o,r,e),this.b=Ba(o,r,e-1/3)}return Qe.toWorkingColorSpace(this,n),this}setStyle(e,t=Si){function i(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const o=n[1],a=n[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=n[1],o=r.length;if(o===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(r,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Si){const i=Fu[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Ss(e.r),this.g=Ss(e.g),this.b=Ss(e.b),this}copyLinearToSRGB(e){return this.r=Ea(e.r),this.g=Ea(e.g),this.b=Ea(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Si){return Qe.fromWorkingColorSpace(Nt.copy(this),e),Math.round(Pt(Nt.r*255,0,255))*65536+Math.round(Pt(Nt.g*255,0,255))*256+Math.round(Pt(Nt.b*255,0,255))}getHexString(e=Si){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Qe.workingColorSpace){Qe.fromWorkingColorSpace(Nt.copy(this),t);const i=Nt.r,n=Nt.g,r=Nt.b,o=Math.max(i,n,r),a=Math.min(i,n,r);let l,c;const h=(a+o)/2;if(a===o)l=0,c=0;else{const d=o-a;switch(c=h<=.5?d/(o+a):d/(2-o-a),o){case i:l=(n-r)/d+(n<r?6:0);break;case n:l=(r-i)/d+2;break;case r:l=(i-n)/d+4;break}l/=6}return e.h=l,e.s=c,e.l=h,e}getRGB(e,t=Qe.workingColorSpace){return Qe.fromWorkingColorSpace(Nt.copy(this),t),e.r=Nt.r,e.g=Nt.g,e.b=Nt.b,e}getStyle(e=Si){Qe.fromWorkingColorSpace(Nt.copy(this),e);const t=Nt.r,i=Nt.g,n=Nt.b;return e!==Si?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(n*255)})`}offsetHSL(e,t,i){return this.getHSL(Qi),this.setHSL(Qi.h+e,Qi.s+t,Qi.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Qi),e.getHSL(ao);const i=lr(Qi.h,ao.h,t),n=lr(Qi.s,ao.s,t),r=lr(Qi.l,ao.l,t);return this.setHSL(i,n,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,n=this.b,r=e.elements;return this.r=r[0]*t+r[3]*i+r[6]*n,this.g=r[1]*t+r[4]*i+r[7]*n,this.b=r[2]*t+r[5]*i+r[8]*n,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Nt=new We;We.NAMES=Fu;let Ym=0;class jn extends Xn{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Ym++}),this.uuid=Ci(),this.name="",this.type="Material",this.blending=ws,this.side=pn,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=gl,this.blendDst=vl,this.blendEquation=Rn,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new We(0,0,0),this.blendAlpha=0,this.depthFunc=As,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=xh,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Zn,this.stencilZFail=Zn,this.stencilZPass=Zn,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const n=this[t];if(n===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==ws&&(i.blending=this.blending),this.side!==pn&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==gl&&(i.blendSrc=this.blendSrc),this.blendDst!==vl&&(i.blendDst=this.blendDst),this.blendEquation!==Rn&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==As&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==xh&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Zn&&(i.stencilFail=this.stencilFail),this.stencilZFail!==Zn&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==Zn&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function n(r){const o=[];for(const a in r){const l=r[a];delete l.metadata,o.push(l)}return o}if(t){const r=n(e.textures),o=n(e.images);r.length>0&&(i.textures=r),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const n=t.length;i=new Array(n);for(let r=0;r!==n;++r)i[r]=t[r].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class Vi extends jn{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new We(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new $i,this.combine=wu,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const St=new k,lo=new le;class yi{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=tc,this.updateRanges=[],this.gpuType=Ui,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[e+n]=t.array[i+n];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)lo.fromBufferAttribute(this,t),lo.applyMatrix3(e),this.setXY(t,lo.x,lo.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)St.fromBufferAttribute(this,t),St.applyMatrix3(e),this.setXYZ(t,St.x,St.y,St.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)St.fromBufferAttribute(this,t),St.applyMatrix4(e),this.setXYZ(t,St.x,St.y,St.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)St.fromBufferAttribute(this,t),St.applyNormalMatrix(e),this.setXYZ(t,St.x,St.y,St.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)St.fromBufferAttribute(this,t),St.transformDirection(e),this.setXYZ(t,St.x,St.y,St.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=xi(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=it(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=xi(t,this.array)),t}setX(e,t){return this.normalized&&(t=it(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=xi(t,this.array)),t}setY(e,t){return this.normalized&&(t=it(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=xi(t,this.array)),t}setZ(e,t){return this.normalized&&(t=it(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=xi(t,this.array)),t}setW(e,t){return this.normalized&&(t=it(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=it(t,this.array),i=it(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,n){return e*=this.itemSize,this.normalized&&(t=it(t,this.array),i=it(i,this.array),n=it(n,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e*=this.itemSize,this.normalized&&(t=it(t,this.array),i=it(i,this.array),n=it(n,this.array),r=it(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==tc&&(e.usage=this.usage),e}}class Uu extends yi{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class zu extends yi{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class dt extends yi{constructor(e,t,i){super(new Float32Array(e),t,i)}}let qm=0;const ai=new at,Va=new Lt,as=new k,ni=new Ir,Xs=new Ir,Rt=new k;class mt extends Xn{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:qm++}),this.uuid=Ci(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(ku(e)?zu:Uu)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const r=new Ie().getNormalMatrix(e);i.applyNormalMatrix(r),i.needsUpdate=!0}const n=this.attributes.tangent;return n!==void 0&&(n.transformDirection(e),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return ai.makeRotationFromQuaternion(e),this.applyMatrix4(ai),this}rotateX(e){return ai.makeRotationX(e),this.applyMatrix4(ai),this}rotateY(e){return ai.makeRotationY(e),this.applyMatrix4(ai),this}rotateZ(e){return ai.makeRotationZ(e),this.applyMatrix4(ai),this}translate(e,t,i){return ai.makeTranslation(e,t,i),this.applyMatrix4(ai),this}scale(e,t,i){return ai.makeScale(e,t,i),this.applyMatrix4(ai),this}lookAt(e){return Va.lookAt(e),Va.updateMatrix(),this.applyMatrix4(Va.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(as).negate(),this.translate(as.x,as.y,as.z),this}setFromPoints(e){const t=[];for(let i=0,n=e.length;i<n;i++){const r=e[i];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new dt(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ir);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new k(-1/0,-1/0,-1/0),new k(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,n=t.length;i<n;i++){const r=t[i];ni.setFromBufferAttribute(r),this.morphTargetsRelative?(Rt.addVectors(this.boundingBox.min,ni.min),this.boundingBox.expandByPoint(Rt),Rt.addVectors(this.boundingBox.max,ni.max),this.boundingBox.expandByPoint(Rt)):(this.boundingBox.expandByPoint(ni.min),this.boundingBox.expandByPoint(ni.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new kr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new k,1/0);return}if(e){const i=this.boundingSphere.center;if(ni.setFromBufferAttribute(e),t)for(let r=0,o=t.length;r<o;r++){const a=t[r];Xs.setFromBufferAttribute(a),this.morphTargetsRelative?(Rt.addVectors(ni.min,Xs.min),ni.expandByPoint(Rt),Rt.addVectors(ni.max,Xs.max),ni.expandByPoint(Rt)):(ni.expandByPoint(Xs.min),ni.expandByPoint(Xs.max))}ni.getCenter(i);let n=0;for(let r=0,o=e.count;r<o;r++)Rt.fromBufferAttribute(e,r),n=Math.max(n,i.distanceToSquared(Rt));if(t)for(let r=0,o=t.length;r<o;r++){const a=t[r],l=this.morphTargetsRelative;for(let c=0,h=a.count;c<h;c++)Rt.fromBufferAttribute(a,c),l&&(as.fromBufferAttribute(e,c),Rt.add(as)),n=Math.max(n,i.distanceToSquared(Rt))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.position,n=t.normal,r=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new yi(new Float32Array(4*i.count),4));const o=this.getAttribute("tangent"),a=[],l=[];for(let P=0;P<i.count;P++)a[P]=new k,l[P]=new k;const c=new k,h=new k,d=new k,u=new le,m=new le,f=new le,_=new k,g=new k;function v(P,N,w){c.fromBufferAttribute(i,P),h.fromBufferAttribute(i,N),d.fromBufferAttribute(i,w),u.fromBufferAttribute(r,P),m.fromBufferAttribute(r,N),f.fromBufferAttribute(r,w),h.sub(c),d.sub(c),m.sub(u),f.sub(u);const S=1/(m.x*f.y-f.x*m.y);isFinite(S)&&(_.copy(h).multiplyScalar(f.y).addScaledVector(d,-m.y).multiplyScalar(S),g.copy(d).multiplyScalar(m.x).addScaledVector(h,-f.x).multiplyScalar(S),a[P].add(_),a[N].add(_),a[w].add(_),l[P].add(g),l[N].add(g),l[w].add(g))}let y=this.groups;y.length===0&&(y=[{start:0,count:e.count}]);for(let P=0,N=y.length;P<N;++P){const w=y[P],S=w.start,D=w.count;for(let I=S,V=S+D;I<V;I+=3)v(e.getX(I+0),e.getX(I+1),e.getX(I+2))}const x=new k,E=new k,R=new k,M=new k;function C(P){R.fromBufferAttribute(n,P),M.copy(R);const N=a[P];x.copy(N),x.sub(R.multiplyScalar(R.dot(N))).normalize(),E.crossVectors(M,N);const S=E.dot(l[P])<0?-1:1;o.setXYZW(P,x.x,x.y,x.z,S)}for(let P=0,N=y.length;P<N;++P){const w=y[P],S=w.start,D=w.count;for(let I=S,V=S+D;I<V;I+=3)C(e.getX(I+0)),C(e.getX(I+1)),C(e.getX(I+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new yi(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let u=0,m=i.count;u<m;u++)i.setXYZ(u,0,0,0);const n=new k,r=new k,o=new k,a=new k,l=new k,c=new k,h=new k,d=new k;if(e)for(let u=0,m=e.count;u<m;u+=3){const f=e.getX(u+0),_=e.getX(u+1),g=e.getX(u+2);n.fromBufferAttribute(t,f),r.fromBufferAttribute(t,_),o.fromBufferAttribute(t,g),h.subVectors(o,r),d.subVectors(n,r),h.cross(d),a.fromBufferAttribute(i,f),l.fromBufferAttribute(i,_),c.fromBufferAttribute(i,g),a.add(h),l.add(h),c.add(h),i.setXYZ(f,a.x,a.y,a.z),i.setXYZ(_,l.x,l.y,l.z),i.setXYZ(g,c.x,c.y,c.z)}else for(let u=0,m=t.count;u<m;u+=3)n.fromBufferAttribute(t,u+0),r.fromBufferAttribute(t,u+1),o.fromBufferAttribute(t,u+2),h.subVectors(o,r),d.subVectors(n,r),h.cross(d),i.setXYZ(u+0,h.x,h.y,h.z),i.setXYZ(u+1,h.x,h.y,h.z),i.setXYZ(u+2,h.x,h.y,h.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Rt.fromBufferAttribute(e,t),Rt.normalize(),e.setXYZ(t,Rt.x,Rt.y,Rt.z)}toNonIndexed(){function e(a,l){const c=a.array,h=a.itemSize,d=a.normalized,u=new c.constructor(l.length*h);let m=0,f=0;for(let _=0,g=l.length;_<g;_++){a.isInterleavedBufferAttribute?m=l[_]*a.data.stride+a.offset:m=l[_]*h;for(let v=0;v<h;v++)u[f++]=c[m++]}return new yi(u,h,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new mt,i=this.index.array,n=this.attributes;for(const a in n){const l=n[a],c=e(l,i);t.setAttribute(a,c)}const r=this.morphAttributes;for(const a in r){const l=[],c=r[a];for(let h=0,d=c.length;h<d;h++){const u=c[h],m=e(u,i);l.push(m)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const l in i){const c=i[l];e.data.attributes[l]=c.toJSON(e.data)}const n={};let r=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],h=[];for(let d=0,u=c.length;d<u;d++){const m=c[d];h.push(m.toJSON(e.data))}h.length>0&&(n[l]=h,r=!0)}r&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const n=e.attributes;for(const c in n){const h=n[c];this.setAttribute(c,h.clone(t))}const r=e.morphAttributes;for(const c in r){const h=[],d=r[c];for(let u=0,m=d.length;u<m;u++)h.push(d[u].clone(t));this.morphAttributes[c]=h}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,h=o.length;c<h;c++){const d=o[c];this.addGroup(d.start,d.count,d.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Nh=new at,yn=new Nr,co=new kr,Oh=new k,ho=new k,uo=new k,po=new k,Ha=new k,fo=new k,Fh=new k,mo=new k;class Ft extends Lt{constructor(e=new mt,t=new Vi){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const n=t[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=n.length;r<o;r++){const a=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}getVertexPosition(e,t){const i=this.geometry,n=i.attributes.position,r=i.morphAttributes.position,o=i.morphTargetsRelative;t.fromBufferAttribute(n,e);const a=this.morphTargetInfluences;if(r&&a){fo.set(0,0,0);for(let l=0,c=r.length;l<c;l++){const h=a[l],d=r[l];h!==0&&(Ha.fromBufferAttribute(d,e),o?fo.addScaledVector(Ha,h):fo.addScaledVector(Ha.sub(t),h))}t.add(fo)}return t}raycast(e,t){const i=this.geometry,n=this.material,r=this.matrixWorld;n!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),co.copy(i.boundingSphere),co.applyMatrix4(r),yn.copy(e.ray).recast(e.near),!(co.containsPoint(yn.origin)===!1&&(yn.intersectSphere(co,Oh)===null||yn.origin.distanceToSquared(Oh)>(e.far-e.near)**2))&&(Nh.copy(r).invert(),yn.copy(e.ray).applyMatrix4(Nh),!(i.boundingBox!==null&&yn.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,yn)))}_computeIntersections(e,t,i){let n;const r=this.geometry,o=this.material,a=r.index,l=r.attributes.position,c=r.attributes.uv,h=r.attributes.uv1,d=r.attributes.normal,u=r.groups,m=r.drawRange;if(a!==null)if(Array.isArray(o))for(let f=0,_=u.length;f<_;f++){const g=u[f],v=o[g.materialIndex],y=Math.max(g.start,m.start),x=Math.min(a.count,Math.min(g.start+g.count,m.start+m.count));for(let E=y,R=x;E<R;E+=3){const M=a.getX(E),C=a.getX(E+1),P=a.getX(E+2);n=go(this,v,e,i,c,h,d,M,C,P),n&&(n.faceIndex=Math.floor(E/3),n.face.materialIndex=g.materialIndex,t.push(n))}}else{const f=Math.max(0,m.start),_=Math.min(a.count,m.start+m.count);for(let g=f,v=_;g<v;g+=3){const y=a.getX(g),x=a.getX(g+1),E=a.getX(g+2);n=go(this,o,e,i,c,h,d,y,x,E),n&&(n.faceIndex=Math.floor(g/3),t.push(n))}}else if(l!==void 0)if(Array.isArray(o))for(let f=0,_=u.length;f<_;f++){const g=u[f],v=o[g.materialIndex],y=Math.max(g.start,m.start),x=Math.min(l.count,Math.min(g.start+g.count,m.start+m.count));for(let E=y,R=x;E<R;E+=3){const M=E,C=E+1,P=E+2;n=go(this,v,e,i,c,h,d,M,C,P),n&&(n.faceIndex=Math.floor(E/3),n.face.materialIndex=g.materialIndex,t.push(n))}}else{const f=Math.max(0,m.start),_=Math.min(l.count,m.start+m.count);for(let g=f,v=_;g<v;g+=3){const y=g,x=g+1,E=g+2;n=go(this,o,e,i,c,h,d,y,x,E),n&&(n.faceIndex=Math.floor(g/3),t.push(n))}}}}function Km(s,e,t,i,n,r,o,a){let l;if(e.side===Zt?l=i.intersectTriangle(o,r,n,!0,a):l=i.intersectTriangle(n,r,o,e.side===pn,a),l===null)return null;mo.copy(a),mo.applyMatrix4(s.matrixWorld);const c=t.ray.origin.distanceTo(mo);return c<t.near||c>t.far?null:{distance:c,point:mo.clone(),object:s}}function go(s,e,t,i,n,r,o,a,l,c){s.getVertexPosition(a,ho),s.getVertexPosition(l,uo),s.getVertexPosition(c,po);const h=Km(s,e,t,i,ho,uo,po,Fh);if(h){const d=new k;ui.getBarycoord(Fh,ho,uo,po,d),n&&(h.uv=ui.getInterpolatedAttribute(n,a,l,c,d,new le)),r&&(h.uv1=ui.getInterpolatedAttribute(r,a,l,c,d,new le)),o&&(h.normal=ui.getInterpolatedAttribute(o,a,l,c,d,new k),h.normal.dot(i.direction)>0&&h.normal.multiplyScalar(-1));const u={a,b:l,c,normal:new k,materialIndex:0};ui.getNormal(ho,uo,po,u.normal),h.face=u,h.barycoord=d}return h}class Os extends mt{constructor(e=1,t=1,i=1,n=1,r=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:r,depthSegments:o};const a=this;n=Math.floor(n),r=Math.floor(r),o=Math.floor(o);const l=[],c=[],h=[],d=[];let u=0,m=0;f("z","y","x",-1,-1,i,t,e,o,r,0),f("z","y","x",1,-1,i,t,-e,o,r,1),f("x","z","y",1,1,e,i,t,n,o,2),f("x","z","y",1,-1,e,i,-t,n,o,3),f("x","y","z",1,-1,e,t,i,n,r,4),f("x","y","z",-1,-1,e,t,-i,n,r,5),this.setIndex(l),this.setAttribute("position",new dt(c,3)),this.setAttribute("normal",new dt(h,3)),this.setAttribute("uv",new dt(d,2));function f(_,g,v,y,x,E,R,M,C,P,N){const w=E/C,S=R/P,D=E/2,I=R/2,V=M/2,q=C+1,H=P+1;let te=0,X=0;const oe=new k;for(let ae=0;ae<H;ae++){const fe=ae*S-I;for(let ze=0;ze<q;ze++){const Se=ze*w-D;oe[_]=Se*y,oe[g]=fe*x,oe[v]=V,c.push(oe.x,oe.y,oe.z),oe[_]=0,oe[g]=0,oe[v]=M>0?1:-1,h.push(oe.x,oe.y,oe.z),d.push(ze/C),d.push(1-ae/P),te+=1}}for(let ae=0;ae<P;ae++)for(let fe=0;fe<C;fe++){const ze=u+fe+q*ae,Se=u+fe+q*(ae+1),U=u+(fe+1)+q*(ae+1),K=u+(fe+1)+q*ae;l.push(ze,Se,K),l.push(Se,U,K),X+=6}a.addGroup(m,X,N),m+=X,u+=te}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Os(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Is(s){const e={};for(const t in s){e[t]={};for(const i in s[t]){const n=s[t][i];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?n.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=n.clone():Array.isArray(n)?e[t][i]=n.slice():e[t][i]=n}}return e}function zt(s){const e={};for(let t=0;t<s.length;t++){const i=Is(s[t]);for(const n in i)e[n]=i[n]}return e}function Zm(s){const e=[];for(let t=0;t<s.length;t++)e.push(s[t].clone());return e}function Bu(s){const e=s.getRenderTarget();return e===null?s.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Qe.workingColorSpace}const Jm={clone:Is,merge:zt};var Qm=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,eg=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class fn extends jn{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Qm,this.fragmentShader=eg,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Is(e.uniforms),this.uniformsGroups=Zm(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const o=this.uniforms[n].value;o&&o.isTexture?t.uniforms[n]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[n]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[n]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[n]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[n]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[n]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[n]={type:"m4",value:o.toArray()}:t.uniforms[n]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const n in this.extensions)this.extensions[n]===!0&&(i[n]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class Vu extends Lt{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new at,this.projectionMatrix=new at,this.projectionMatrixInverse=new at,this.coordinateSystem=zi}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const en=new k,Uh=new le,zh=new le;class di extends Vu{constructor(e=50,t=1,i=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=gr*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(ar*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return gr*2*Math.atan(Math.tan(ar*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){en.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(en.x,en.y).multiplyScalar(-e/en.z),en.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(en.x,en.y).multiplyScalar(-e/en.z)}getViewSize(e,t){return this.getViewBounds(e,Uh,zh),t.subVectors(zh,Uh)}setViewOffset(e,t,i,n,r,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(ar*.5*this.fov)/this.zoom,i=2*t,n=this.aspect*i,r=-.5*n;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;r+=o.offsetX*n/l,t-=o.offsetY*i/c,n*=o.width/l,i*=o.height/c}const a=this.filmOffset;a!==0&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const ls=-90,cs=1;class tg extends Lt{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const n=new di(ls,cs,e,t);n.layers=this.layers,this.add(n);const r=new di(ls,cs,e,t);r.layers=this.layers,this.add(r);const o=new di(ls,cs,e,t);o.layers=this.layers,this.add(o);const a=new di(ls,cs,e,t);a.layers=this.layers,this.add(a);const l=new di(ls,cs,e,t);l.layers=this.layers,this.add(l);const c=new di(ls,cs,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,n,r,o,a,l]=t;for(const c of t)this.remove(c);if(e===zi)i.up.set(0,1,0),i.lookAt(1,0,0),n.up.set(0,1,0),n.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===Ko)i.up.set(0,-1,0),i.lookAt(-1,0,0),n.up.set(0,-1,0),n.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:n}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,o,a,l,c,h]=this.children,d=e.getRenderTarget(),u=e.getActiveCubeFace(),m=e.getActiveMipmapLevel(),f=e.xr.enabled;e.xr.enabled=!1;const _=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,n),e.render(t,r),e.setRenderTarget(i,1,n),e.render(t,o),e.setRenderTarget(i,2,n),e.render(t,a),e.setRenderTarget(i,3,n),e.render(t,l),e.setRenderTarget(i,4,n),e.render(t,c),i.texture.generateMipmaps=_,e.setRenderTarget(i,5,n),e.render(t,h),e.setRenderTarget(d,u,m),e.xr.enabled=f,i.texture.needsPMREMUpdate=!0}}class Hu extends Vt{constructor(e,t,i,n,r,o,a,l,c,h){e=e!==void 0?e:[],t=t!==void 0?t:Rs,super(e,t,i,n,r,o,a,l,c,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class ig extends zn{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},n=[i,i,i,i,i,i];this.texture=new Hu(n,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:bi}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},n=new Os(5,5,5),r=new fn({name:"CubemapFromEquirect",uniforms:Is(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Zt,blending:hn});r.uniforms.tEquirect.value=t;const o=new Ft(n,r),a=t.minFilter;return t.minFilter===In&&(t.minFilter=bi),new tg(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,i,n){const r=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,i,n);e.setRenderTarget(r)}}const Ga=new k,ng=new k,sg=new Ie;class rn{constructor(e=new k(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const n=Ga.subVectors(i,t).cross(ng.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(Ga),n=this.normal.dot(i);if(n===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:t.copy(e.start).addScaledVector(i,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||sg.getNormalMatrix(e),n=this.coplanarPoint(Ga).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Sn=new kr,vo=new k;class Gu{constructor(e=new rn,t=new rn,i=new rn,n=new rn,r=new rn,o=new rn){this.planes=[e,t,i,n,r,o]}set(e,t,i,n,r,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(n),a[4].copy(r),a[5].copy(o),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=zi){const i=this.planes,n=e.elements,r=n[0],o=n[1],a=n[2],l=n[3],c=n[4],h=n[5],d=n[6],u=n[7],m=n[8],f=n[9],_=n[10],g=n[11],v=n[12],y=n[13],x=n[14],E=n[15];if(i[0].setComponents(l-r,u-c,g-m,E-v).normalize(),i[1].setComponents(l+r,u+c,g+m,E+v).normalize(),i[2].setComponents(l+o,u+h,g+f,E+y).normalize(),i[3].setComponents(l-o,u-h,g-f,E-y).normalize(),i[4].setComponents(l-a,u-d,g-_,E-x).normalize(),t===zi)i[5].setComponents(l+a,u+d,g+_,E+x).normalize();else if(t===Ko)i[5].setComponents(a,d,_,x).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Sn.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),Sn.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Sn)}intersectsSprite(e){return Sn.center.set(0,0,0),Sn.radius=.7071067811865476,Sn.applyMatrix4(e.matrixWorld),this.intersectsSphere(Sn)}intersectsSphere(e){const t=this.planes,i=e.center,n=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(i)<n)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const n=t[i];if(vo.x=n.normal.x>0?e.max.x:e.min.x,vo.y=n.normal.y>0?e.max.y:e.min.y,vo.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(vo)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function $u(){let s=null,e=!1,t=null,i=null;function n(r,o){t(r,o),i=s.requestAnimationFrame(n)}return{start:function(){e!==!0&&t!==null&&(i=s.requestAnimationFrame(n),e=!0)},stop:function(){s.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){s=r}}}function rg(s){const e=new WeakMap;function t(a,l){const c=a.array,h=a.usage,d=c.byteLength,u=s.createBuffer();s.bindBuffer(l,u),s.bufferData(l,c,h),a.onUploadCallback();let m;if(c instanceof Float32Array)m=s.FLOAT;else if(c instanceof Uint16Array)a.isFloat16BufferAttribute?m=s.HALF_FLOAT:m=s.UNSIGNED_SHORT;else if(c instanceof Int16Array)m=s.SHORT;else if(c instanceof Uint32Array)m=s.UNSIGNED_INT;else if(c instanceof Int32Array)m=s.INT;else if(c instanceof Int8Array)m=s.BYTE;else if(c instanceof Uint8Array)m=s.UNSIGNED_BYTE;else if(c instanceof Uint8ClampedArray)m=s.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:u,type:m,bytesPerElement:c.BYTES_PER_ELEMENT,version:a.version,size:d}}function i(a,l,c){const h=l.array,d=l.updateRanges;if(s.bindBuffer(c,a),d.length===0)s.bufferSubData(c,0,h);else{d.sort((m,f)=>m.start-f.start);let u=0;for(let m=1;m<d.length;m++){const f=d[u],_=d[m];_.start<=f.start+f.count+1?f.count=Math.max(f.count,_.start+_.count-f.start):(++u,d[u]=_)}d.length=u+1;for(let m=0,f=d.length;m<f;m++){const _=d[m];s.bufferSubData(c,_.start*h.BYTES_PER_ELEMENT,h,_.start,_.count)}l.clearUpdateRanges()}l.onUploadCallback()}function n(a){return a.isInterleavedBufferAttribute&&(a=a.data),e.get(a)}function r(a){a.isInterleavedBufferAttribute&&(a=a.data);const l=e.get(a);l&&(s.deleteBuffer(l.buffer),e.delete(a))}function o(a,l){if(a.isInterleavedBufferAttribute&&(a=a.data),a.isGLBufferAttribute){const h=e.get(a);(!h||h.version<a.version)&&e.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}const c=e.get(a);if(c===void 0)e.set(a,t(a,l));else if(c.version<a.version){if(c.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");i(c.buffer,a,l),c.version=a.version}}return{get:n,remove:r,update:o}}class Or extends mt{constructor(e=1,t=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n};const r=e/2,o=t/2,a=Math.floor(i),l=Math.floor(n),c=a+1,h=l+1,d=e/a,u=t/l,m=[],f=[],_=[],g=[];for(let v=0;v<h;v++){const y=v*u-o;for(let x=0;x<c;x++){const E=x*d-r;f.push(E,-y,0),_.push(0,0,1),g.push(x/a),g.push(1-v/l)}}for(let v=0;v<l;v++)for(let y=0;y<a;y++){const x=y+c*v,E=y+c*(v+1),R=y+1+c*(v+1),M=y+1+c*v;m.push(x,E,M),m.push(E,R,M)}this.setIndex(m),this.setAttribute("position",new dt(f,3)),this.setAttribute("normal",new dt(_,3)),this.setAttribute("uv",new dt(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Or(e.width,e.height,e.widthSegments,e.heightSegments)}}var og=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,ag=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,lg=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,cg=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,hg=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,dg=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,ug=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,pg=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,fg=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,mg=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,gg=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,vg=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,_g=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,bg=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,xg=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,wg=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,yg=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Sg=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,Eg=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Mg=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Cg=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Tg=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,Ag=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,Rg=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,Pg=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Dg=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Lg=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Ig=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,kg=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Ng=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Og="gl_FragColor = linearToOutputTexel( gl_FragColor );",Fg=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Ug=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,zg=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Bg=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Vg=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Hg=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Gg=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,$g=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Wg=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Xg=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,jg=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,Yg=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,qg=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Kg=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,Zg=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Jg=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,Qg=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,ev=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,tv=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,iv=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,nv=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,sv=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,rv=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,ov=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,av=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,lv=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,cv=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,hv=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,dv=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,uv=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,pv=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,fv=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,mv=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,gv=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,vv=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,_v=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,bv=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,xv=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,wv=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,yv=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,Sv=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,Ev=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,Mv=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Cv=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Tv=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Av=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,Rv=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,Pv=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,Dv=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,Lv=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Iv=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,kv=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,Nv=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Ov=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Fv=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Uv=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,zv=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Bv=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Vv=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,Hv=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Gv=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,$v=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Wv=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Xv=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,jv=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Yv=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,qv=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Kv=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Zv=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Jv=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,Qv=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,e0=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,t0=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,i0=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,n0=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,s0=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const r0=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,o0=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,a0=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,l0=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,c0=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,h0=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,d0=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,u0=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,p0=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,f0=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,m0=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,g0=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,v0=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,_0=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,b0=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,x0=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,w0=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,y0=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,S0=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,E0=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,M0=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,C0=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,T0=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,A0=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,R0=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,P0=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,D0=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,L0=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,I0=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,k0=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,N0=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,O0=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,F0=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,U0=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Oe={alphahash_fragment:og,alphahash_pars_fragment:ag,alphamap_fragment:lg,alphamap_pars_fragment:cg,alphatest_fragment:hg,alphatest_pars_fragment:dg,aomap_fragment:ug,aomap_pars_fragment:pg,batching_pars_vertex:fg,batching_vertex:mg,begin_vertex:gg,beginnormal_vertex:vg,bsdfs:_g,iridescence_fragment:bg,bumpmap_pars_fragment:xg,clipping_planes_fragment:wg,clipping_planes_pars_fragment:yg,clipping_planes_pars_vertex:Sg,clipping_planes_vertex:Eg,color_fragment:Mg,color_pars_fragment:Cg,color_pars_vertex:Tg,color_vertex:Ag,common:Rg,cube_uv_reflection_fragment:Pg,defaultnormal_vertex:Dg,displacementmap_pars_vertex:Lg,displacementmap_vertex:Ig,emissivemap_fragment:kg,emissivemap_pars_fragment:Ng,colorspace_fragment:Og,colorspace_pars_fragment:Fg,envmap_fragment:Ug,envmap_common_pars_fragment:zg,envmap_pars_fragment:Bg,envmap_pars_vertex:Vg,envmap_physical_pars_fragment:Jg,envmap_vertex:Hg,fog_vertex:Gg,fog_pars_vertex:$g,fog_fragment:Wg,fog_pars_fragment:Xg,gradientmap_pars_fragment:jg,lightmap_pars_fragment:Yg,lights_lambert_fragment:qg,lights_lambert_pars_fragment:Kg,lights_pars_begin:Zg,lights_toon_fragment:Qg,lights_toon_pars_fragment:ev,lights_phong_fragment:tv,lights_phong_pars_fragment:iv,lights_physical_fragment:nv,lights_physical_pars_fragment:sv,lights_fragment_begin:rv,lights_fragment_maps:ov,lights_fragment_end:av,logdepthbuf_fragment:lv,logdepthbuf_pars_fragment:cv,logdepthbuf_pars_vertex:hv,logdepthbuf_vertex:dv,map_fragment:uv,map_pars_fragment:pv,map_particle_fragment:fv,map_particle_pars_fragment:mv,metalnessmap_fragment:gv,metalnessmap_pars_fragment:vv,morphinstance_vertex:_v,morphcolor_vertex:bv,morphnormal_vertex:xv,morphtarget_pars_vertex:wv,morphtarget_vertex:yv,normal_fragment_begin:Sv,normal_fragment_maps:Ev,normal_pars_fragment:Mv,normal_pars_vertex:Cv,normal_vertex:Tv,normalmap_pars_fragment:Av,clearcoat_normal_fragment_begin:Rv,clearcoat_normal_fragment_maps:Pv,clearcoat_pars_fragment:Dv,iridescence_pars_fragment:Lv,opaque_fragment:Iv,packing:kv,premultiplied_alpha_fragment:Nv,project_vertex:Ov,dithering_fragment:Fv,dithering_pars_fragment:Uv,roughnessmap_fragment:zv,roughnessmap_pars_fragment:Bv,shadowmap_pars_fragment:Vv,shadowmap_pars_vertex:Hv,shadowmap_vertex:Gv,shadowmask_pars_fragment:$v,skinbase_vertex:Wv,skinning_pars_vertex:Xv,skinning_vertex:jv,skinnormal_vertex:Yv,specularmap_fragment:qv,specularmap_pars_fragment:Kv,tonemapping_fragment:Zv,tonemapping_pars_fragment:Jv,transmission_fragment:Qv,transmission_pars_fragment:e0,uv_pars_fragment:t0,uv_pars_vertex:i0,uv_vertex:n0,worldpos_vertex:s0,background_vert:r0,background_frag:o0,backgroundCube_vert:a0,backgroundCube_frag:l0,cube_vert:c0,cube_frag:h0,depth_vert:d0,depth_frag:u0,distanceRGBA_vert:p0,distanceRGBA_frag:f0,equirect_vert:m0,equirect_frag:g0,linedashed_vert:v0,linedashed_frag:_0,meshbasic_vert:b0,meshbasic_frag:x0,meshlambert_vert:w0,meshlambert_frag:y0,meshmatcap_vert:S0,meshmatcap_frag:E0,meshnormal_vert:M0,meshnormal_frag:C0,meshphong_vert:T0,meshphong_frag:A0,meshphysical_vert:R0,meshphysical_frag:P0,meshtoon_vert:D0,meshtoon_frag:L0,points_vert:I0,points_frag:k0,shadow_vert:N0,shadow_frag:O0,sprite_vert:F0,sprite_frag:U0},re={common:{diffuse:{value:new We(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Ie},alphaMap:{value:null},alphaMapTransform:{value:new Ie},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Ie}},envmap:{envMap:{value:null},envMapRotation:{value:new Ie},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Ie}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Ie}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Ie},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Ie},normalScale:{value:new le(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Ie},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Ie}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Ie}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Ie}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new We(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new We(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Ie},alphaTest:{value:0},uvTransform:{value:new Ie}},sprite:{diffuse:{value:new We(16777215)},opacity:{value:1},center:{value:new le(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Ie},alphaMap:{value:null},alphaMapTransform:{value:new Ie},alphaTest:{value:0}}},Ei={basic:{uniforms:zt([re.common,re.specularmap,re.envmap,re.aomap,re.lightmap,re.fog]),vertexShader:Oe.meshbasic_vert,fragmentShader:Oe.meshbasic_frag},lambert:{uniforms:zt([re.common,re.specularmap,re.envmap,re.aomap,re.lightmap,re.emissivemap,re.bumpmap,re.normalmap,re.displacementmap,re.fog,re.lights,{emissive:{value:new We(0)}}]),vertexShader:Oe.meshlambert_vert,fragmentShader:Oe.meshlambert_frag},phong:{uniforms:zt([re.common,re.specularmap,re.envmap,re.aomap,re.lightmap,re.emissivemap,re.bumpmap,re.normalmap,re.displacementmap,re.fog,re.lights,{emissive:{value:new We(0)},specular:{value:new We(1118481)},shininess:{value:30}}]),vertexShader:Oe.meshphong_vert,fragmentShader:Oe.meshphong_frag},standard:{uniforms:zt([re.common,re.envmap,re.aomap,re.lightmap,re.emissivemap,re.bumpmap,re.normalmap,re.displacementmap,re.roughnessmap,re.metalnessmap,re.fog,re.lights,{emissive:{value:new We(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Oe.meshphysical_vert,fragmentShader:Oe.meshphysical_frag},toon:{uniforms:zt([re.common,re.aomap,re.lightmap,re.emissivemap,re.bumpmap,re.normalmap,re.displacementmap,re.gradientmap,re.fog,re.lights,{emissive:{value:new We(0)}}]),vertexShader:Oe.meshtoon_vert,fragmentShader:Oe.meshtoon_frag},matcap:{uniforms:zt([re.common,re.bumpmap,re.normalmap,re.displacementmap,re.fog,{matcap:{value:null}}]),vertexShader:Oe.meshmatcap_vert,fragmentShader:Oe.meshmatcap_frag},points:{uniforms:zt([re.points,re.fog]),vertexShader:Oe.points_vert,fragmentShader:Oe.points_frag},dashed:{uniforms:zt([re.common,re.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Oe.linedashed_vert,fragmentShader:Oe.linedashed_frag},depth:{uniforms:zt([re.common,re.displacementmap]),vertexShader:Oe.depth_vert,fragmentShader:Oe.depth_frag},normal:{uniforms:zt([re.common,re.bumpmap,re.normalmap,re.displacementmap,{opacity:{value:1}}]),vertexShader:Oe.meshnormal_vert,fragmentShader:Oe.meshnormal_frag},sprite:{uniforms:zt([re.sprite,re.fog]),vertexShader:Oe.sprite_vert,fragmentShader:Oe.sprite_frag},background:{uniforms:{uvTransform:{value:new Ie},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Oe.background_vert,fragmentShader:Oe.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Ie}},vertexShader:Oe.backgroundCube_vert,fragmentShader:Oe.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Oe.cube_vert,fragmentShader:Oe.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Oe.equirect_vert,fragmentShader:Oe.equirect_frag},distanceRGBA:{uniforms:zt([re.common,re.displacementmap,{referencePosition:{value:new k},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Oe.distanceRGBA_vert,fragmentShader:Oe.distanceRGBA_frag},shadow:{uniforms:zt([re.lights,re.fog,{color:{value:new We(0)},opacity:{value:1}}]),vertexShader:Oe.shadow_vert,fragmentShader:Oe.shadow_frag}};Ei.physical={uniforms:zt([Ei.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Ie},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Ie},clearcoatNormalScale:{value:new le(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Ie},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Ie},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Ie},sheen:{value:0},sheenColor:{value:new We(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Ie},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Ie},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Ie},transmissionSamplerSize:{value:new le},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Ie},attenuationDistance:{value:0},attenuationColor:{value:new We(0)},specularColor:{value:new We(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Ie},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Ie},anisotropyVector:{value:new le},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Ie}}]),vertexShader:Oe.meshphysical_vert,fragmentShader:Oe.meshphysical_frag};const _o={r:0,b:0,g:0},En=new $i,z0=new at;function B0(s,e,t,i,n,r,o){const a=new We(0);let l=r===!0?0:1,c,h,d=null,u=0,m=null;function f(y){let x=y.isScene===!0?y.background:null;return x&&x.isTexture&&(x=(y.backgroundBlurriness>0?t:e).get(x)),x}function _(y){let x=!1;const E=f(y);E===null?v(a,l):E&&E.isColor&&(v(E,1),x=!0);const R=s.xr.getEnvironmentBlendMode();R==="additive"?i.buffers.color.setClear(0,0,0,1,o):R==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,o),(s.autoClear||x)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),s.clear(s.autoClearColor,s.autoClearDepth,s.autoClearStencil))}function g(y,x){const E=f(x);E&&(E.isCubeTexture||E.mapping===la)?(h===void 0&&(h=new Ft(new Os(1,1,1),new fn({name:"BackgroundCubeMaterial",uniforms:Is(Ei.backgroundCube.uniforms),vertexShader:Ei.backgroundCube.vertexShader,fragmentShader:Ei.backgroundCube.fragmentShader,side:Zt,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(R,M,C){this.matrixWorld.copyPosition(C.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(h)),En.copy(x.backgroundRotation),En.x*=-1,En.y*=-1,En.z*=-1,E.isCubeTexture&&E.isRenderTargetTexture===!1&&(En.y*=-1,En.z*=-1),h.material.uniforms.envMap.value=E,h.material.uniforms.flipEnvMap.value=E.isCubeTexture&&E.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=x.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,h.material.uniforms.backgroundRotation.value.setFromMatrix4(z0.makeRotationFromEuler(En)),h.material.toneMapped=Qe.getTransfer(E.colorSpace)!==ht,(d!==E||u!==E.version||m!==s.toneMapping)&&(h.material.needsUpdate=!0,d=E,u=E.version,m=s.toneMapping),h.layers.enableAll(),y.unshift(h,h.geometry,h.material,0,0,null)):E&&E.isTexture&&(c===void 0&&(c=new Ft(new Or(2,2),new fn({name:"BackgroundMaterial",uniforms:Is(Ei.background.uniforms),vertexShader:Ei.background.vertexShader,fragmentShader:Ei.background.fragmentShader,side:pn,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(c)),c.material.uniforms.t2D.value=E,c.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,c.material.toneMapped=Qe.getTransfer(E.colorSpace)!==ht,E.matrixAutoUpdate===!0&&E.updateMatrix(),c.material.uniforms.uvTransform.value.copy(E.matrix),(d!==E||u!==E.version||m!==s.toneMapping)&&(c.material.needsUpdate=!0,d=E,u=E.version,m=s.toneMapping),c.layers.enableAll(),y.unshift(c,c.geometry,c.material,0,0,null))}function v(y,x){y.getRGB(_o,Bu(s)),i.buffers.color.setClear(_o.r,_o.g,_o.b,x,o)}return{getClearColor:function(){return a},setClearColor:function(y,x=1){a.set(y),l=x,v(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(y){l=y,v(a,l)},render:_,addToRenderList:g}}function V0(s,e){const t=s.getParameter(s.MAX_VERTEX_ATTRIBS),i={},n=u(null);let r=n,o=!1;function a(w,S,D,I,V){let q=!1;const H=d(I,D,S);r!==H&&(r=H,c(r.object)),q=m(w,I,D,V),q&&f(w,I,D,V),V!==null&&e.update(V,s.ELEMENT_ARRAY_BUFFER),(q||o)&&(o=!1,E(w,S,D,I),V!==null&&s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e.get(V).buffer))}function l(){return s.createVertexArray()}function c(w){return s.bindVertexArray(w)}function h(w){return s.deleteVertexArray(w)}function d(w,S,D){const I=D.wireframe===!0;let V=i[w.id];V===void 0&&(V={},i[w.id]=V);let q=V[S.id];q===void 0&&(q={},V[S.id]=q);let H=q[I];return H===void 0&&(H=u(l()),q[I]=H),H}function u(w){const S=[],D=[],I=[];for(let V=0;V<t;V++)S[V]=0,D[V]=0,I[V]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:S,enabledAttributes:D,attributeDivisors:I,object:w,attributes:{},index:null}}function m(w,S,D,I){const V=r.attributes,q=S.attributes;let H=0;const te=D.getAttributes();for(const X in te)if(te[X].location>=0){const ae=V[X];let fe=q[X];if(fe===void 0&&(X==="instanceMatrix"&&w.instanceMatrix&&(fe=w.instanceMatrix),X==="instanceColor"&&w.instanceColor&&(fe=w.instanceColor)),ae===void 0||ae.attribute!==fe||fe&&ae.data!==fe.data)return!0;H++}return r.attributesNum!==H||r.index!==I}function f(w,S,D,I){const V={},q=S.attributes;let H=0;const te=D.getAttributes();for(const X in te)if(te[X].location>=0){let ae=q[X];ae===void 0&&(X==="instanceMatrix"&&w.instanceMatrix&&(ae=w.instanceMatrix),X==="instanceColor"&&w.instanceColor&&(ae=w.instanceColor));const fe={};fe.attribute=ae,ae&&ae.data&&(fe.data=ae.data),V[X]=fe,H++}r.attributes=V,r.attributesNum=H,r.index=I}function _(){const w=r.newAttributes;for(let S=0,D=w.length;S<D;S++)w[S]=0}function g(w){v(w,0)}function v(w,S){const D=r.newAttributes,I=r.enabledAttributes,V=r.attributeDivisors;D[w]=1,I[w]===0&&(s.enableVertexAttribArray(w),I[w]=1),V[w]!==S&&(s.vertexAttribDivisor(w,S),V[w]=S)}function y(){const w=r.newAttributes,S=r.enabledAttributes;for(let D=0,I=S.length;D<I;D++)S[D]!==w[D]&&(s.disableVertexAttribArray(D),S[D]=0)}function x(w,S,D,I,V,q,H){H===!0?s.vertexAttribIPointer(w,S,D,V,q):s.vertexAttribPointer(w,S,D,I,V,q)}function E(w,S,D,I){_();const V=I.attributes,q=D.getAttributes(),H=S.defaultAttributeValues;for(const te in q){const X=q[te];if(X.location>=0){let oe=V[te];if(oe===void 0&&(te==="instanceMatrix"&&w.instanceMatrix&&(oe=w.instanceMatrix),te==="instanceColor"&&w.instanceColor&&(oe=w.instanceColor)),oe!==void 0){const ae=oe.normalized,fe=oe.itemSize,ze=e.get(oe);if(ze===void 0)continue;const Se=ze.buffer,U=ze.type,K=ze.bytesPerElement,Y=U===s.INT||U===s.UNSIGNED_INT||oe.gpuType===_c;if(oe.isInterleavedBufferAttribute){const Q=oe.data,Me=Q.stride,Ee=oe.offset;if(Q.isInstancedInterleavedBuffer){for(let Fe=0;Fe<X.locationSize;Fe++)v(X.location+Fe,Q.meshPerAttribute);w.isInstancedMesh!==!0&&I._maxInstanceCount===void 0&&(I._maxInstanceCount=Q.meshPerAttribute*Q.count)}else for(let Fe=0;Fe<X.locationSize;Fe++)g(X.location+Fe);s.bindBuffer(s.ARRAY_BUFFER,Se);for(let Fe=0;Fe<X.locationSize;Fe++)x(X.location+Fe,fe/X.locationSize,U,ae,Me*K,(Ee+fe/X.locationSize*Fe)*K,Y)}else{if(oe.isInstancedBufferAttribute){for(let Q=0;Q<X.locationSize;Q++)v(X.location+Q,oe.meshPerAttribute);w.isInstancedMesh!==!0&&I._maxInstanceCount===void 0&&(I._maxInstanceCount=oe.meshPerAttribute*oe.count)}else for(let Q=0;Q<X.locationSize;Q++)g(X.location+Q);s.bindBuffer(s.ARRAY_BUFFER,Se);for(let Q=0;Q<X.locationSize;Q++)x(X.location+Q,fe/X.locationSize,U,ae,fe*K,fe/X.locationSize*Q*K,Y)}}else if(H!==void 0){const ae=H[te];if(ae!==void 0)switch(ae.length){case 2:s.vertexAttrib2fv(X.location,ae);break;case 3:s.vertexAttrib3fv(X.location,ae);break;case 4:s.vertexAttrib4fv(X.location,ae);break;default:s.vertexAttrib1fv(X.location,ae)}}}}y()}function R(){P();for(const w in i){const S=i[w];for(const D in S){const I=S[D];for(const V in I)h(I[V].object),delete I[V];delete S[D]}delete i[w]}}function M(w){if(i[w.id]===void 0)return;const S=i[w.id];for(const D in S){const I=S[D];for(const V in I)h(I[V].object),delete I[V];delete S[D]}delete i[w.id]}function C(w){for(const S in i){const D=i[S];if(D[w.id]===void 0)continue;const I=D[w.id];for(const V in I)h(I[V].object),delete I[V];delete D[w.id]}}function P(){N(),o=!0,r!==n&&(r=n,c(r.object))}function N(){n.geometry=null,n.program=null,n.wireframe=!1}return{setup:a,reset:P,resetDefaultState:N,dispose:R,releaseStatesOfGeometry:M,releaseStatesOfProgram:C,initAttributes:_,enableAttribute:g,disableUnusedAttributes:y}}function H0(s,e,t){let i;function n(c){i=c}function r(c,h){s.drawArrays(i,c,h),t.update(h,i,1)}function o(c,h,d){d!==0&&(s.drawArraysInstanced(i,c,h,d),t.update(h,i,d))}function a(c,h,d){if(d===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,c,0,h,0,d);let m=0;for(let f=0;f<d;f++)m+=h[f];t.update(m,i,1)}function l(c,h,d,u){if(d===0)return;const m=e.get("WEBGL_multi_draw");if(m===null)for(let f=0;f<c.length;f++)o(c[f],h[f],u[f]);else{m.multiDrawArraysInstancedWEBGL(i,c,0,h,0,u,0,d);let f=0;for(let _=0;_<d;_++)f+=h[_];for(let _=0;_<u.length;_++)t.update(f,i,u[_])}}this.setMode=n,this.render=r,this.renderInstances=o,this.renderMultiDraw=a,this.renderMultiDrawInstances=l}function G0(s,e,t,i){let n;function r(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){const C=e.get("EXT_texture_filter_anisotropic");n=s.getParameter(C.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function o(C){return!(C!==wi&&i.convert(C)!==s.getParameter(s.IMPLEMENTATION_COLOR_READ_FORMAT))}function a(C){const P=C===Lr&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(C!==Gi&&i.convert(C)!==s.getParameter(s.IMPLEMENTATION_COLOR_READ_TYPE)&&C!==Ui&&!P)}function l(C){if(C==="highp"){if(s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.HIGH_FLOAT).precision>0&&s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT).precision>0)return"highp";C="mediump"}return C==="mediump"&&s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.MEDIUM_FLOAT).precision>0&&s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let c=t.precision!==void 0?t.precision:"highp";const h=l(c);h!==c&&(console.warn("THREE.WebGLRenderer:",c,"not supported, using",h,"instead."),c=h);const d=t.logarithmicDepthBuffer===!0,u=t.reverseDepthBuffer===!0&&e.has("EXT_clip_control");if(u===!0){const C=e.get("EXT_clip_control");C.clipControlEXT(C.LOWER_LEFT_EXT,C.ZERO_TO_ONE_EXT)}const m=s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS),f=s.getParameter(s.MAX_VERTEX_TEXTURE_IMAGE_UNITS),_=s.getParameter(s.MAX_TEXTURE_SIZE),g=s.getParameter(s.MAX_CUBE_MAP_TEXTURE_SIZE),v=s.getParameter(s.MAX_VERTEX_ATTRIBS),y=s.getParameter(s.MAX_VERTEX_UNIFORM_VECTORS),x=s.getParameter(s.MAX_VARYING_VECTORS),E=s.getParameter(s.MAX_FRAGMENT_UNIFORM_VECTORS),R=f>0,M=s.getParameter(s.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:r,getMaxPrecision:l,textureFormatReadable:o,textureTypeReadable:a,precision:c,logarithmicDepthBuffer:d,reverseDepthBuffer:u,maxTextures:m,maxVertexTextures:f,maxTextureSize:_,maxCubemapSize:g,maxAttributes:v,maxVertexUniforms:y,maxVaryings:x,maxFragmentUniforms:E,vertexTextures:R,maxSamples:M}}function $0(s){const e=this;let t=null,i=0,n=!1,r=!1;const o=new rn,a=new Ie,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(d,u){const m=d.length!==0||u||i!==0||n;return n=u,i=d.length,m},this.beginShadows=function(){r=!0,h(null)},this.endShadows=function(){r=!1},this.setGlobalState=function(d,u){t=h(d,u,0)},this.setState=function(d,u,m){const f=d.clippingPlanes,_=d.clipIntersection,g=d.clipShadows,v=s.get(d);if(!n||f===null||f.length===0||r&&!g)r?h(null):c();else{const y=r?0:i,x=y*4;let E=v.clippingState||null;l.value=E,E=h(f,u,x,m);for(let R=0;R!==x;++R)E[R]=t[R];v.clippingState=E,this.numIntersection=_?this.numPlanes:0,this.numPlanes+=y}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function h(d,u,m,f){const _=d!==null?d.length:0;let g=null;if(_!==0){if(g=l.value,f!==!0||g===null){const v=m+_*4,y=u.matrixWorldInverse;a.getNormalMatrix(y),(g===null||g.length<v)&&(g=new Float32Array(v));for(let x=0,E=m;x!==_;++x,E+=4)o.copy(d[x]).applyMatrix4(y,a),o.normal.toArray(g,E),g[E+3]=o.constant}l.value=g,l.needsUpdate=!0}return e.numPlanes=_,e.numIntersection=0,g}}function W0(s){let e=new WeakMap;function t(o,a){return a===Ml?o.mapping=Rs:a===Cl&&(o.mapping=Ps),o}function i(o){if(o&&o.isTexture){const a=o.mapping;if(a===Ml||a===Cl)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const c=new ig(l.height);return c.fromEquirectangularTexture(s,o),e.set(o,c),o.addEventListener("dispose",n),t(c.texture,o.mapping)}else return null}}return o}function n(o){const a=o.target;a.removeEventListener("dispose",n);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function r(){e=new WeakMap}return{get:i,dispose:r}}class X0 extends Vu{constructor(e=-1,t=1,i=1,n=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,n,r,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let r=i-e,o=i+e,a=n+t,l=n-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=c*this.view.offsetX,o=r+c*this.view.width,a-=h*this.view.offsetY,l=a-h*this.view.height}this.projectionMatrix.makeOrthographic(r,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const _s=4,Bh=[.125,.215,.35,.446,.526,.582],Pn=20,$a=new X0,Vh=new We;let Wa=null,Xa=0,ja=0,Ya=!1;const An=(1+Math.sqrt(5))/2,hs=1/An,Hh=[new k(-An,hs,0),new k(An,hs,0),new k(-hs,0,An),new k(hs,0,An),new k(0,An,-hs),new k(0,An,hs),new k(-1,1,-1),new k(1,1,-1),new k(-1,1,1),new k(1,1,1)];class Gh{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,n=100){Wa=this._renderer.getRenderTarget(),Xa=this._renderer.getActiveCubeFace(),ja=this._renderer.getActiveMipmapLevel(),Ya=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,i,n,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Xh(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Wh(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Wa,Xa,ja),this._renderer.xr.enabled=Ya,e.scissorTest=!1,bo(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Rs||e.mapping===Ps?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Wa=this._renderer.getRenderTarget(),Xa=this._renderer.getActiveCubeFace(),ja=this._renderer.getActiveMipmapLevel(),Ya=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:bi,minFilter:bi,generateMipmaps:!1,type:Lr,format:wi,colorSpace:vn,depthBuffer:!1},n=$h(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=$h(e,t,i);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=j0(r)),this._blurMaterial=Y0(r,e,t)}return n}_compileMaterial(e){const t=new Ft(this._lodPlanes[0],e);this._renderer.compile(t,$a)}_sceneToCubeUV(e,t,i,n){const a=new di(90,1,t,i),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],h=this._renderer,d=h.autoClear,u=h.toneMapping;h.getClearColor(Vh),h.toneMapping=dn,h.autoClear=!1;const m=new Vi({name:"PMREM.Background",side:Zt,depthWrite:!1,depthTest:!1}),f=new Ft(new Os,m);let _=!1;const g=e.background;g?g.isColor&&(m.color.copy(g),e.background=null,_=!0):(m.color.copy(Vh),_=!0);for(let v=0;v<6;v++){const y=v%3;y===0?(a.up.set(0,l[v],0),a.lookAt(c[v],0,0)):y===1?(a.up.set(0,0,l[v]),a.lookAt(0,c[v],0)):(a.up.set(0,l[v],0),a.lookAt(0,0,c[v]));const x=this._cubeSize;bo(n,y*x,v>2?x:0,x,x),h.setRenderTarget(n),_&&h.render(f,a),h.render(e,a)}f.geometry.dispose(),f.material.dispose(),h.toneMapping=u,h.autoClear=d,e.background=g}_textureToCubeUV(e,t){const i=this._renderer,n=e.mapping===Rs||e.mapping===Ps;n?(this._cubemapMaterial===null&&(this._cubemapMaterial=Xh()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Wh());const r=n?this._cubemapMaterial:this._equirectMaterial,o=new Ft(this._lodPlanes[0],r),a=r.uniforms;a.envMap.value=e;const l=this._cubeSize;bo(t,0,0,3*l,2*l),i.setRenderTarget(t),i.render(o,$a)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;const n=this._lodPlanes.length;for(let r=1;r<n;r++){const o=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),a=Hh[(n-r-1)%Hh.length];this._blur(e,r-1,r,o,a)}t.autoClear=i}_blur(e,t,i,n,r){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,n,"latitudinal",r),this._halfBlur(o,e,i,i,n,"longitudinal",r)}_halfBlur(e,t,i,n,r,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const h=3,d=new Ft(this._lodPlanes[n],c),u=c.uniforms,m=this._sizeLods[i]-1,f=isFinite(r)?Math.PI/(2*m):2*Math.PI/(2*Pn-1),_=r/f,g=isFinite(r)?1+Math.floor(h*_):Pn;g>Pn&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${Pn}`);const v=[];let y=0;for(let C=0;C<Pn;++C){const P=C/_,N=Math.exp(-P*P/2);v.push(N),C===0?y+=N:C<g&&(y+=2*N)}for(let C=0;C<v.length;C++)v[C]=v[C]/y;u.envMap.value=e.texture,u.samples.value=g,u.weights.value=v,u.latitudinal.value=o==="latitudinal",a&&(u.poleAxis.value=a);const{_lodMax:x}=this;u.dTheta.value=f,u.mipInt.value=x-i;const E=this._sizeLods[n],R=3*E*(n>x-_s?n-x+_s:0),M=4*(this._cubeSize-E);bo(t,R,M,3*E,2*E),l.setRenderTarget(t),l.render(d,$a)}}function j0(s){const e=[],t=[],i=[];let n=s;const r=s-_s+1+Bh.length;for(let o=0;o<r;o++){const a=Math.pow(2,n);t.push(a);let l=1/a;o>s-_s?l=Bh[o-s+_s-1]:o===0&&(l=0),i.push(l);const c=1/(a-2),h=-c,d=1+c,u=[h,h,d,h,d,d,h,h,d,d,h,d],m=6,f=6,_=3,g=2,v=1,y=new Float32Array(_*f*m),x=new Float32Array(g*f*m),E=new Float32Array(v*f*m);for(let M=0;M<m;M++){const C=M%3*2/3-1,P=M>2?0:-1,N=[C,P,0,C+2/3,P,0,C+2/3,P+1,0,C,P,0,C+2/3,P+1,0,C,P+1,0];y.set(N,_*f*M),x.set(u,g*f*M);const w=[M,M,M,M,M,M];E.set(w,v*f*M)}const R=new mt;R.setAttribute("position",new yi(y,_)),R.setAttribute("uv",new yi(x,g)),R.setAttribute("faceIndex",new yi(E,v)),e.push(R),n>_s&&n--}return{lodPlanes:e,sizeLods:t,sigmas:i}}function $h(s,e,t){const i=new zn(s,e,t);return i.texture.mapping=la,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function bo(s,e,t,i,n){s.viewport.set(e,t,i,n),s.scissor.set(e,t,i,n)}function Y0(s,e,t){const i=new Float32Array(Pn),n=new k(0,1,0);return new fn({name:"SphericalGaussianBlur",defines:{n:Pn,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${s}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:Tc(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:hn,depthTest:!1,depthWrite:!1})}function Wh(){return new fn({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Tc(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:hn,depthTest:!1,depthWrite:!1})}function Xh(){return new fn({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Tc(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:hn,depthTest:!1,depthWrite:!1})}function Tc(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function q0(s){let e=new WeakMap,t=null;function i(a){if(a&&a.isTexture){const l=a.mapping,c=l===Ml||l===Cl,h=l===Rs||l===Ps;if(c||h){let d=e.get(a);const u=d!==void 0?d.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==u)return t===null&&(t=new Gh(s)),d=c?t.fromEquirectangular(a,d):t.fromCubemap(a,d),d.texture.pmremVersion=a.pmremVersion,e.set(a,d),d.texture;if(d!==void 0)return d.texture;{const m=a.image;return c&&m&&m.height>0||h&&m&&n(m)?(t===null&&(t=new Gh(s)),d=c?t.fromEquirectangular(a):t.fromCubemap(a),d.texture.pmremVersion=a.pmremVersion,e.set(a,d),a.addEventListener("dispose",r),d.texture):null}}}return a}function n(a){let l=0;const c=6;for(let h=0;h<c;h++)a[h]!==void 0&&l++;return l===c}function r(a){const l=a.target;l.removeEventListener("dispose",r);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:o}}function K0(s){const e={};function t(i){if(e[i]!==void 0)return e[i];let n;switch(i){case"WEBGL_depth_texture":n=s.getExtension("WEBGL_depth_texture")||s.getExtension("MOZ_WEBGL_depth_texture")||s.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=s.getExtension("WEBGL_compressed_texture_s3tc")||s.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||s.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=s.getExtension("WEBGL_compressed_texture_pvrtc")||s.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=s.getExtension(i)}return e[i]=n,n}return{has:function(i){return t(i)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(i){const n=t(i);return n===null&&Vo("THREE.WebGLRenderer: "+i+" extension not supported."),n}}}function Z0(s,e,t,i){const n={},r=new WeakMap;function o(d){const u=d.target;u.index!==null&&e.remove(u.index);for(const f in u.attributes)e.remove(u.attributes[f]);for(const f in u.morphAttributes){const _=u.morphAttributes[f];for(let g=0,v=_.length;g<v;g++)e.remove(_[g])}u.removeEventListener("dispose",o),delete n[u.id];const m=r.get(u);m&&(e.remove(m),r.delete(u)),i.releaseStatesOfGeometry(u),u.isInstancedBufferGeometry===!0&&delete u._maxInstanceCount,t.memory.geometries--}function a(d,u){return n[u.id]===!0||(u.addEventListener("dispose",o),n[u.id]=!0,t.memory.geometries++),u}function l(d){const u=d.attributes;for(const f in u)e.update(u[f],s.ARRAY_BUFFER);const m=d.morphAttributes;for(const f in m){const _=m[f];for(let g=0,v=_.length;g<v;g++)e.update(_[g],s.ARRAY_BUFFER)}}function c(d){const u=[],m=d.index,f=d.attributes.position;let _=0;if(m!==null){const y=m.array;_=m.version;for(let x=0,E=y.length;x<E;x+=3){const R=y[x+0],M=y[x+1],C=y[x+2];u.push(R,M,M,C,C,R)}}else if(f!==void 0){const y=f.array;_=f.version;for(let x=0,E=y.length/3-1;x<E;x+=3){const R=x+0,M=x+1,C=x+2;u.push(R,M,M,C,C,R)}}else return;const g=new(ku(u)?zu:Uu)(u,1);g.version=_;const v=r.get(d);v&&e.remove(v),r.set(d,g)}function h(d){const u=r.get(d);if(u){const m=d.index;m!==null&&u.version<m.version&&c(d)}else c(d);return r.get(d)}return{get:a,update:l,getWireframeAttribute:h}}function J0(s,e,t){let i;function n(u){i=u}let r,o;function a(u){r=u.type,o=u.bytesPerElement}function l(u,m){s.drawElements(i,m,r,u*o),t.update(m,i,1)}function c(u,m,f){f!==0&&(s.drawElementsInstanced(i,m,r,u*o,f),t.update(m,i,f))}function h(u,m,f){if(f===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,m,0,r,u,0,f);let g=0;for(let v=0;v<f;v++)g+=m[v];t.update(g,i,1)}function d(u,m,f,_){if(f===0)return;const g=e.get("WEBGL_multi_draw");if(g===null)for(let v=0;v<u.length;v++)c(u[v]/o,m[v],_[v]);else{g.multiDrawElementsInstancedWEBGL(i,m,0,r,u,0,_,0,f);let v=0;for(let y=0;y<f;y++)v+=m[y];for(let y=0;y<_.length;y++)t.update(v,i,_[y])}}this.setMode=n,this.setIndex=a,this.render=l,this.renderInstances=c,this.renderMultiDraw=h,this.renderMultiDrawInstances=d}function Q0(s){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(r,o,a){switch(t.calls++,o){case s.TRIANGLES:t.triangles+=a*(r/3);break;case s.LINES:t.lines+=a*(r/2);break;case s.LINE_STRIP:t.lines+=a*(r-1);break;case s.LINE_LOOP:t.lines+=a*r;break;case s.POINTS:t.points+=a*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function n(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:n,update:i}}function e_(s,e,t){const i=new WeakMap,n=new wt;function r(o,a,l){const c=o.morphTargetInfluences,h=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,d=h!==void 0?h.length:0;let u=i.get(a);if(u===void 0||u.count!==d){let N=function(){C.dispose(),i.delete(a),a.removeEventListener("dispose",N)};u!==void 0&&u.texture.dispose();const m=a.morphAttributes.position!==void 0,f=a.morphAttributes.normal!==void 0,_=a.morphAttributes.color!==void 0,g=a.morphAttributes.position||[],v=a.morphAttributes.normal||[],y=a.morphAttributes.color||[];let x=0;m===!0&&(x=1),f===!0&&(x=2),_===!0&&(x=3);let E=a.attributes.position.count*x,R=1;E>e.maxTextureSize&&(R=Math.ceil(E/e.maxTextureSize),E=e.maxTextureSize);const M=new Float32Array(E*R*4*d),C=new Ou(M,E,R,d);C.type=Ui,C.needsUpdate=!0;const P=x*4;for(let w=0;w<d;w++){const S=g[w],D=v[w],I=y[w],V=E*R*4*w;for(let q=0;q<S.count;q++){const H=q*P;m===!0&&(n.fromBufferAttribute(S,q),M[V+H+0]=n.x,M[V+H+1]=n.y,M[V+H+2]=n.z,M[V+H+3]=0),f===!0&&(n.fromBufferAttribute(D,q),M[V+H+4]=n.x,M[V+H+5]=n.y,M[V+H+6]=n.z,M[V+H+7]=0),_===!0&&(n.fromBufferAttribute(I,q),M[V+H+8]=n.x,M[V+H+9]=n.y,M[V+H+10]=n.z,M[V+H+11]=I.itemSize===4?n.w:1)}}u={count:d,texture:C,size:new le(E,R)},i.set(a,u),a.addEventListener("dispose",N)}if(o.isInstancedMesh===!0&&o.morphTexture!==null)l.getUniforms().setValue(s,"morphTexture",o.morphTexture,t);else{let m=0;for(let _=0;_<c.length;_++)m+=c[_];const f=a.morphTargetsRelative?1:1-m;l.getUniforms().setValue(s,"morphTargetBaseInfluence",f),l.getUniforms().setValue(s,"morphTargetInfluences",c)}l.getUniforms().setValue(s,"morphTargetsTexture",u.texture,t),l.getUniforms().setValue(s,"morphTargetsTextureSize",u.size)}return{update:r}}function t_(s,e,t,i){let n=new WeakMap;function r(l){const c=i.render.frame,h=l.geometry,d=e.get(l,h);if(n.get(d)!==c&&(e.update(d),n.set(d,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),n.get(l)!==c&&(t.update(l.instanceMatrix,s.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,s.ARRAY_BUFFER),n.set(l,c))),l.isSkinnedMesh){const u=l.skeleton;n.get(u)!==c&&(u.update(),n.set(u,c))}return d}function o(){n=new WeakMap}function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:r,dispose:o}}class Wu extends Vt{constructor(e,t,i,n,r,o,a,l,c,h=ys){if(h!==ys&&h!==Ls)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&h===ys&&(i=Un),i===void 0&&h===Ls&&(i=Ds),super(null,n,r,o,a,l,h,i,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:pi,this.minFilter=l!==void 0?l:pi,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const Xu=new Vt,jh=new Wu(1,1),ju=new Ou,Yu=new Bm,qu=new Hu,Yh=[],qh=[],Kh=new Float32Array(16),Zh=new Float32Array(9),Jh=new Float32Array(4);function Fs(s,e,t){const i=s[0];if(i<=0||i>0)return s;const n=e*t;let r=Yh[n];if(r===void 0&&(r=new Float32Array(n),Yh[n]=r),e!==0){i.toArray(r,0);for(let o=1,a=0;o!==e;++o)a+=t,s[o].toArray(r,a)}return r}function Tt(s,e){if(s.length!==e.length)return!1;for(let t=0,i=s.length;t<i;t++)if(s[t]!==e[t])return!1;return!0}function At(s,e){for(let t=0,i=e.length;t<i;t++)s[t]=e[t]}function ha(s,e){let t=qh[e];t===void 0&&(t=new Int32Array(e),qh[e]=t);for(let i=0;i!==e;++i)t[i]=s.allocateTextureUnit();return t}function i_(s,e){const t=this.cache;t[0]!==e&&(s.uniform1f(this.addr,e),t[0]=e)}function n_(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(s.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Tt(t,e))return;s.uniform2fv(this.addr,e),At(t,e)}}function s_(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(s.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(s.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Tt(t,e))return;s.uniform3fv(this.addr,e),At(t,e)}}function r_(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(s.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Tt(t,e))return;s.uniform4fv(this.addr,e),At(t,e)}}function o_(s,e){const t=this.cache,i=e.elements;if(i===void 0){if(Tt(t,e))return;s.uniformMatrix2fv(this.addr,!1,e),At(t,e)}else{if(Tt(t,i))return;Jh.set(i),s.uniformMatrix2fv(this.addr,!1,Jh),At(t,i)}}function a_(s,e){const t=this.cache,i=e.elements;if(i===void 0){if(Tt(t,e))return;s.uniformMatrix3fv(this.addr,!1,e),At(t,e)}else{if(Tt(t,i))return;Zh.set(i),s.uniformMatrix3fv(this.addr,!1,Zh),At(t,i)}}function l_(s,e){const t=this.cache,i=e.elements;if(i===void 0){if(Tt(t,e))return;s.uniformMatrix4fv(this.addr,!1,e),At(t,e)}else{if(Tt(t,i))return;Kh.set(i),s.uniformMatrix4fv(this.addr,!1,Kh),At(t,i)}}function c_(s,e){const t=this.cache;t[0]!==e&&(s.uniform1i(this.addr,e),t[0]=e)}function h_(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(s.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Tt(t,e))return;s.uniform2iv(this.addr,e),At(t,e)}}function d_(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(s.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Tt(t,e))return;s.uniform3iv(this.addr,e),At(t,e)}}function u_(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(s.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Tt(t,e))return;s.uniform4iv(this.addr,e),At(t,e)}}function p_(s,e){const t=this.cache;t[0]!==e&&(s.uniform1ui(this.addr,e),t[0]=e)}function f_(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(s.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Tt(t,e))return;s.uniform2uiv(this.addr,e),At(t,e)}}function m_(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(s.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Tt(t,e))return;s.uniform3uiv(this.addr,e),At(t,e)}}function g_(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(s.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Tt(t,e))return;s.uniform4uiv(this.addr,e),At(t,e)}}function v_(s,e,t){const i=this.cache,n=t.allocateTextureUnit();i[0]!==n&&(s.uniform1i(this.addr,n),i[0]=n);let r;this.type===s.SAMPLER_2D_SHADOW?(jh.compareFunction=Iu,r=jh):r=Xu,t.setTexture2D(e||r,n)}function __(s,e,t){const i=this.cache,n=t.allocateTextureUnit();i[0]!==n&&(s.uniform1i(this.addr,n),i[0]=n),t.setTexture3D(e||Yu,n)}function b_(s,e,t){const i=this.cache,n=t.allocateTextureUnit();i[0]!==n&&(s.uniform1i(this.addr,n),i[0]=n),t.setTextureCube(e||qu,n)}function x_(s,e,t){const i=this.cache,n=t.allocateTextureUnit();i[0]!==n&&(s.uniform1i(this.addr,n),i[0]=n),t.setTexture2DArray(e||ju,n)}function w_(s){switch(s){case 5126:return i_;case 35664:return n_;case 35665:return s_;case 35666:return r_;case 35674:return o_;case 35675:return a_;case 35676:return l_;case 5124:case 35670:return c_;case 35667:case 35671:return h_;case 35668:case 35672:return d_;case 35669:case 35673:return u_;case 5125:return p_;case 36294:return f_;case 36295:return m_;case 36296:return g_;case 35678:case 36198:case 36298:case 36306:case 35682:return v_;case 35679:case 36299:case 36307:return __;case 35680:case 36300:case 36308:case 36293:return b_;case 36289:case 36303:case 36311:case 36292:return x_}}function y_(s,e){s.uniform1fv(this.addr,e)}function S_(s,e){const t=Fs(e,this.size,2);s.uniform2fv(this.addr,t)}function E_(s,e){const t=Fs(e,this.size,3);s.uniform3fv(this.addr,t)}function M_(s,e){const t=Fs(e,this.size,4);s.uniform4fv(this.addr,t)}function C_(s,e){const t=Fs(e,this.size,4);s.uniformMatrix2fv(this.addr,!1,t)}function T_(s,e){const t=Fs(e,this.size,9);s.uniformMatrix3fv(this.addr,!1,t)}function A_(s,e){const t=Fs(e,this.size,16);s.uniformMatrix4fv(this.addr,!1,t)}function R_(s,e){s.uniform1iv(this.addr,e)}function P_(s,e){s.uniform2iv(this.addr,e)}function D_(s,e){s.uniform3iv(this.addr,e)}function L_(s,e){s.uniform4iv(this.addr,e)}function I_(s,e){s.uniform1uiv(this.addr,e)}function k_(s,e){s.uniform2uiv(this.addr,e)}function N_(s,e){s.uniform3uiv(this.addr,e)}function O_(s,e){s.uniform4uiv(this.addr,e)}function F_(s,e,t){const i=this.cache,n=e.length,r=ha(t,n);Tt(i,r)||(s.uniform1iv(this.addr,r),At(i,r));for(let o=0;o!==n;++o)t.setTexture2D(e[o]||Xu,r[o])}function U_(s,e,t){const i=this.cache,n=e.length,r=ha(t,n);Tt(i,r)||(s.uniform1iv(this.addr,r),At(i,r));for(let o=0;o!==n;++o)t.setTexture3D(e[o]||Yu,r[o])}function z_(s,e,t){const i=this.cache,n=e.length,r=ha(t,n);Tt(i,r)||(s.uniform1iv(this.addr,r),At(i,r));for(let o=0;o!==n;++o)t.setTextureCube(e[o]||qu,r[o])}function B_(s,e,t){const i=this.cache,n=e.length,r=ha(t,n);Tt(i,r)||(s.uniform1iv(this.addr,r),At(i,r));for(let o=0;o!==n;++o)t.setTexture2DArray(e[o]||ju,r[o])}function V_(s){switch(s){case 5126:return y_;case 35664:return S_;case 35665:return E_;case 35666:return M_;case 35674:return C_;case 35675:return T_;case 35676:return A_;case 5124:case 35670:return R_;case 35667:case 35671:return P_;case 35668:case 35672:return D_;case 35669:case 35673:return L_;case 5125:return I_;case 36294:return k_;case 36295:return N_;case 36296:return O_;case 35678:case 36198:case 36298:case 36306:case 35682:return F_;case 35679:case 36299:case 36307:return U_;case 35680:case 36300:case 36308:case 36293:return z_;case 36289:case 36303:case 36311:case 36292:return B_}}class H_{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=w_(t.type)}}class G_{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=V_(t.type)}}class $_{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const n=this.seq;for(let r=0,o=n.length;r!==o;++r){const a=n[r];a.setValue(e,t[a.id],i)}}}const qa=/(\w+)(\])?(\[|\.)?/g;function Qh(s,e){s.seq.push(e),s.map[e.id]=e}function W_(s,e,t){const i=s.name,n=i.length;for(qa.lastIndex=0;;){const r=qa.exec(i),o=qa.lastIndex;let a=r[1];const l=r[2]==="]",c=r[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===n){Qh(t,c===void 0?new H_(a,s,e):new G_(a,s,e));break}else{let d=t.map[a];d===void 0&&(d=new $_(a),Qh(t,d)),t=d}}}class Ho{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let n=0;n<i;++n){const r=e.getActiveUniform(t,n),o=e.getUniformLocation(t,r.name);W_(r,o,this)}}setValue(e,t,i,n){const r=this.map[t];r!==void 0&&r.setValue(e,i,n)}setOptional(e,t,i){const n=t[i];n!==void 0&&this.setValue(e,i,n)}static upload(e,t,i,n){for(let r=0,o=t.length;r!==o;++r){const a=t[r],l=i[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,n)}}static seqWithValue(e,t){const i=[];for(let n=0,r=e.length;n!==r;++n){const o=e[n];o.id in t&&i.push(o)}return i}}function ed(s,e,t){const i=s.createShader(e);return s.shaderSource(i,t),s.compileShader(i),i}const X_=37297;let j_=0;function Y_(s,e){const t=s.split(`
`),i=[],n=Math.max(e-6,0),r=Math.min(e+6,t.length);for(let o=n;o<r;o++){const a=o+1;i.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return i.join(`
`)}function q_(s){const e=Qe.getPrimaries(Qe.workingColorSpace),t=Qe.getPrimaries(s);let i;switch(e===t?i="":e===qo&&t===Yo?i="LinearDisplayP3ToLinearSRGB":e===Yo&&t===qo&&(i="LinearSRGBToLinearDisplayP3"),s){case vn:case ca:return[i,"LinearTransferOETF"];case Si:case Ec:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",s),[i,"LinearTransferOETF"]}}function td(s,e,t){const i=s.getShaderParameter(e,s.COMPILE_STATUS),n=s.getShaderInfoLog(e).trim();if(i&&n==="")return"";const r=/ERROR: 0:(\d+)/.exec(n);if(r){const o=parseInt(r[1]);return t.toUpperCase()+`

`+n+`

`+Y_(s.getShaderSource(e),o)}else return n}function K_(s,e){const t=q_(e);return`vec4 ${s}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function Z_(s,e){let t;switch(e){case qf:t="Linear";break;case Kf:t="Reinhard";break;case Zf:t="Cineon";break;case Jf:t="ACESFilmic";break;case em:t="AgX";break;case tm:t="Neutral";break;case Qf:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+s+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const xo=new k;function J_(){Qe.getLuminanceCoefficients(xo);const s=xo.x.toFixed(4),e=xo.y.toFixed(4),t=xo.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${s}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function Q_(s){return[s.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",s.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(sr).join(`
`)}function eb(s){const e=[];for(const t in s){const i=s[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function tb(s,e){const t={},i=s.getProgramParameter(e,s.ACTIVE_ATTRIBUTES);for(let n=0;n<i;n++){const r=s.getActiveAttrib(e,n),o=r.name;let a=1;r.type===s.FLOAT_MAT2&&(a=2),r.type===s.FLOAT_MAT3&&(a=3),r.type===s.FLOAT_MAT4&&(a=4),t[o]={type:r.type,location:s.getAttribLocation(e,o),locationSize:a}}return t}function sr(s){return s!==""}function id(s,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return s.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function nd(s,e){return s.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const ib=/^[ \t]*#include +<([\w\d./]+)>/gm;function ic(s){return s.replace(ib,sb)}const nb=new Map;function sb(s,e){let t=Oe[e];if(t===void 0){const i=nb.get(e);if(i!==void 0)t=Oe[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return ic(t)}const rb=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function sd(s){return s.replace(rb,ob)}function ob(s,e,t,i){let n="";for(let r=parseInt(e);r<parseInt(t);r++)n+=i.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return n}function rd(s){let e=`precision ${s.precision} float;
	precision ${s.precision} int;
	precision ${s.precision} sampler2D;
	precision ${s.precision} samplerCube;
	precision ${s.precision} sampler3D;
	precision ${s.precision} sampler2DArray;
	precision ${s.precision} sampler2DShadow;
	precision ${s.precision} samplerCubeShadow;
	precision ${s.precision} sampler2DArrayShadow;
	precision ${s.precision} isampler2D;
	precision ${s.precision} isampler3D;
	precision ${s.precision} isamplerCube;
	precision ${s.precision} isampler2DArray;
	precision ${s.precision} usampler2D;
	precision ${s.precision} usampler3D;
	precision ${s.precision} usamplerCube;
	precision ${s.precision} usampler2DArray;
	`;return s.precision==="highp"?e+=`
#define HIGH_PRECISION`:s.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:s.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function ab(s){let e="SHADOWMAP_TYPE_BASIC";return s.shadowMapType===xu?e="SHADOWMAP_TYPE_PCF":s.shadowMapType===Af?e="SHADOWMAP_TYPE_PCF_SOFT":s.shadowMapType===Fi&&(e="SHADOWMAP_TYPE_VSM"),e}function lb(s){let e="ENVMAP_TYPE_CUBE";if(s.envMap)switch(s.envMapMode){case Rs:case Ps:e="ENVMAP_TYPE_CUBE";break;case la:e="ENVMAP_TYPE_CUBE_UV";break}return e}function cb(s){let e="ENVMAP_MODE_REFLECTION";if(s.envMap)switch(s.envMapMode){case Ps:e="ENVMAP_MODE_REFRACTION";break}return e}function hb(s){let e="ENVMAP_BLENDING_NONE";if(s.envMap)switch(s.combine){case wu:e="ENVMAP_BLENDING_MULTIPLY";break;case jf:e="ENVMAP_BLENDING_MIX";break;case Yf:e="ENVMAP_BLENDING_ADD";break}return e}function db(s){const e=s.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}}function ub(s,e,t,i){const n=s.getContext(),r=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=ab(t),c=lb(t),h=cb(t),d=hb(t),u=db(t),m=Q_(t),f=eb(r),_=n.createProgram();let g,v,y=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(g=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,f].filter(sr).join(`
`),g.length>0&&(g+=`
`),v=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,f].filter(sr).join(`
`),v.length>0&&(v+=`
`)):(g=[rd(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,f,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(sr).join(`
`),v=[rd(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,f,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+h:"",t.envMap?"#define "+d:"",u?"#define CUBEUV_TEXEL_WIDTH "+u.texelWidth:"",u?"#define CUBEUV_TEXEL_HEIGHT "+u.texelHeight:"",u?"#define CUBEUV_MAX_MIP "+u.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==dn?"#define TONE_MAPPING":"",t.toneMapping!==dn?Oe.tonemapping_pars_fragment:"",t.toneMapping!==dn?Z_("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Oe.colorspace_pars_fragment,K_("linearToOutputTexel",t.outputColorSpace),J_(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(sr).join(`
`)),o=ic(o),o=id(o,t),o=nd(o,t),a=ic(a),a=id(a,t),a=nd(a,t),o=sd(o),a=sd(a),t.isRawShaderMaterial!==!0&&(y=`#version 300 es
`,g=[m,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,v=["#define varying in",t.glslVersion===wh?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===wh?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+v);const x=y+g+o,E=y+v+a,R=ed(n,n.VERTEX_SHADER,x),M=ed(n,n.FRAGMENT_SHADER,E);n.attachShader(_,R),n.attachShader(_,M),t.index0AttributeName!==void 0?n.bindAttribLocation(_,0,t.index0AttributeName):t.morphTargets===!0&&n.bindAttribLocation(_,0,"position"),n.linkProgram(_);function C(S){if(s.debug.checkShaderErrors){const D=n.getProgramInfoLog(_).trim(),I=n.getShaderInfoLog(R).trim(),V=n.getShaderInfoLog(M).trim();let q=!0,H=!0;if(n.getProgramParameter(_,n.LINK_STATUS)===!1)if(q=!1,typeof s.debug.onShaderError=="function")s.debug.onShaderError(n,_,R,M);else{const te=td(n,R,"vertex"),X=td(n,M,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(_,n.VALIDATE_STATUS)+`

Material Name: `+S.name+`
Material Type: `+S.type+`

Program Info Log: `+D+`
`+te+`
`+X)}else D!==""?console.warn("THREE.WebGLProgram: Program Info Log:",D):(I===""||V==="")&&(H=!1);H&&(S.diagnostics={runnable:q,programLog:D,vertexShader:{log:I,prefix:g},fragmentShader:{log:V,prefix:v}})}n.deleteShader(R),n.deleteShader(M),P=new Ho(n,_),N=tb(n,_)}let P;this.getUniforms=function(){return P===void 0&&C(this),P};let N;this.getAttributes=function(){return N===void 0&&C(this),N};let w=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return w===!1&&(w=n.getProgramParameter(_,X_)),w},this.destroy=function(){i.releaseStatesOfProgram(this),n.deleteProgram(_),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=j_++,this.cacheKey=e,this.usedTimes=1,this.program=_,this.vertexShader=R,this.fragmentShader=M,this}let pb=0;class fb{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,n=this._getShaderStage(t),r=this._getShaderStage(i),o=this._getShaderCacheForMaterial(e);return o.has(n)===!1&&(o.add(n),n.usedTimes++),o.has(r)===!1&&(o.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new mb(e),t.set(e,i)),i}}class mb{constructor(e){this.id=pb++,this.code=e,this.usedTimes=0}}function gb(s,e,t,i,n,r,o){const a=new Cc,l=new fb,c=new Set,h=[],d=n.logarithmicDepthBuffer,u=n.reverseDepthBuffer,m=n.vertexTextures;let f=n.precision;const _={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(w){return c.add(w),w===0?"uv":`uv${w}`}function v(w,S,D,I,V){const q=I.fog,H=V.geometry,te=w.isMeshStandardMaterial?I.environment:null,X=(w.isMeshStandardMaterial?t:e).get(w.envMap||te),oe=X&&X.mapping===la?X.image.height:null,ae=_[w.type];w.precision!==null&&(f=n.getMaxPrecision(w.precision),f!==w.precision&&console.warn("THREE.WebGLProgram.getParameters:",w.precision,"not supported, using",f,"instead."));const fe=H.morphAttributes.position||H.morphAttributes.normal||H.morphAttributes.color,ze=fe!==void 0?fe.length:0;let Se=0;H.morphAttributes.position!==void 0&&(Se=1),H.morphAttributes.normal!==void 0&&(Se=2),H.morphAttributes.color!==void 0&&(Se=3);let U,K,Y,Q;if(ae){const Wt=Ei[ae];U=Wt.vertexShader,K=Wt.fragmentShader}else U=w.vertexShader,K=w.fragmentShader,l.update(w),Y=l.getVertexShaderID(w),Q=l.getFragmentShaderID(w);const Me=s.getRenderTarget(),Ee=V.isInstancedMesh===!0,Fe=V.isBatchedMesh===!0,Be=!!w.map,Ge=!!w.matcap,O=!!X,Qt=!!w.aoMap,Ve=!!w.lightMap,je=!!w.bumpMap,Re=!!w.normalMap,lt=!!w.displacementMap,Le=!!w.emissiveMap,L=!!w.metalnessMap,T=!!w.roughnessMap,G=w.anisotropy>0,J=w.clearcoat>0,ie=w.dispersion>0,Z=w.iridescence>0,xe=w.sheen>0,ce=w.transmission>0,me=G&&!!w.anisotropyMap,Ye=J&&!!w.clearcoatMap,ne=J&&!!w.clearcoatNormalMap,ge=J&&!!w.clearcoatRoughnessMap,Pe=Z&&!!w.iridescenceMap,De=Z&&!!w.iridescenceThicknessMap,ve=xe&&!!w.sheenColorMap,He=xe&&!!w.sheenRoughnessMap,ke=!!w.specularMap,rt=!!w.specularColorMap,F=!!w.specularIntensityMap,ue=ce&&!!w.transmissionMap,j=ce&&!!w.thicknessMap,ee=!!w.gradientMap,he=!!w.alphaMap,pe=w.alphaTest>0,$e=!!w.alphaHash,yt=!!w.extensions;let $t=dn;w.toneMapped&&(Me===null||Me.isXRRenderTarget===!0)&&($t=s.toneMapping);const Ke={shaderID:ae,shaderType:w.type,shaderName:w.name,vertexShader:U,fragmentShader:K,defines:w.defines,customVertexShaderID:Y,customFragmentShaderID:Q,isRawShaderMaterial:w.isRawShaderMaterial===!0,glslVersion:w.glslVersion,precision:f,batching:Fe,batchingColor:Fe&&V._colorsTexture!==null,instancing:Ee,instancingColor:Ee&&V.instanceColor!==null,instancingMorph:Ee&&V.morphTexture!==null,supportsVertexTextures:m,outputColorSpace:Me===null?s.outputColorSpace:Me.isXRRenderTarget===!0?Me.texture.colorSpace:vn,alphaToCoverage:!!w.alphaToCoverage,map:Be,matcap:Ge,envMap:O,envMapMode:O&&X.mapping,envMapCubeUVHeight:oe,aoMap:Qt,lightMap:Ve,bumpMap:je,normalMap:Re,displacementMap:m&&lt,emissiveMap:Le,normalMapObjectSpace:Re&&w.normalMapType===om,normalMapTangentSpace:Re&&w.normalMapType===rm,metalnessMap:L,roughnessMap:T,anisotropy:G,anisotropyMap:me,clearcoat:J,clearcoatMap:Ye,clearcoatNormalMap:ne,clearcoatRoughnessMap:ge,dispersion:ie,iridescence:Z,iridescenceMap:Pe,iridescenceThicknessMap:De,sheen:xe,sheenColorMap:ve,sheenRoughnessMap:He,specularMap:ke,specularColorMap:rt,specularIntensityMap:F,transmission:ce,transmissionMap:ue,thicknessMap:j,gradientMap:ee,opaque:w.transparent===!1&&w.blending===ws&&w.alphaToCoverage===!1,alphaMap:he,alphaTest:pe,alphaHash:$e,combine:w.combine,mapUv:Be&&g(w.map.channel),aoMapUv:Qt&&g(w.aoMap.channel),lightMapUv:Ve&&g(w.lightMap.channel),bumpMapUv:je&&g(w.bumpMap.channel),normalMapUv:Re&&g(w.normalMap.channel),displacementMapUv:lt&&g(w.displacementMap.channel),emissiveMapUv:Le&&g(w.emissiveMap.channel),metalnessMapUv:L&&g(w.metalnessMap.channel),roughnessMapUv:T&&g(w.roughnessMap.channel),anisotropyMapUv:me&&g(w.anisotropyMap.channel),clearcoatMapUv:Ye&&g(w.clearcoatMap.channel),clearcoatNormalMapUv:ne&&g(w.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ge&&g(w.clearcoatRoughnessMap.channel),iridescenceMapUv:Pe&&g(w.iridescenceMap.channel),iridescenceThicknessMapUv:De&&g(w.iridescenceThicknessMap.channel),sheenColorMapUv:ve&&g(w.sheenColorMap.channel),sheenRoughnessMapUv:He&&g(w.sheenRoughnessMap.channel),specularMapUv:ke&&g(w.specularMap.channel),specularColorMapUv:rt&&g(w.specularColorMap.channel),specularIntensityMapUv:F&&g(w.specularIntensityMap.channel),transmissionMapUv:ue&&g(w.transmissionMap.channel),thicknessMapUv:j&&g(w.thicknessMap.channel),alphaMapUv:he&&g(w.alphaMap.channel),vertexTangents:!!H.attributes.tangent&&(Re||G),vertexColors:w.vertexColors,vertexAlphas:w.vertexColors===!0&&!!H.attributes.color&&H.attributes.color.itemSize===4,pointsUvs:V.isPoints===!0&&!!H.attributes.uv&&(Be||he),fog:!!q,useFog:w.fog===!0,fogExp2:!!q&&q.isFogExp2,flatShading:w.flatShading===!0,sizeAttenuation:w.sizeAttenuation===!0,logarithmicDepthBuffer:d,reverseDepthBuffer:u,skinning:V.isSkinnedMesh===!0,morphTargets:H.morphAttributes.position!==void 0,morphNormals:H.morphAttributes.normal!==void 0,morphColors:H.morphAttributes.color!==void 0,morphTargetsCount:ze,morphTextureStride:Se,numDirLights:S.directional.length,numPointLights:S.point.length,numSpotLights:S.spot.length,numSpotLightMaps:S.spotLightMap.length,numRectAreaLights:S.rectArea.length,numHemiLights:S.hemi.length,numDirLightShadows:S.directionalShadowMap.length,numPointLightShadows:S.pointShadowMap.length,numSpotLightShadows:S.spotShadowMap.length,numSpotLightShadowsWithMaps:S.numSpotLightShadowsWithMaps,numLightProbes:S.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:w.dithering,shadowMapEnabled:s.shadowMap.enabled&&D.length>0,shadowMapType:s.shadowMap.type,toneMapping:$t,decodeVideoTexture:Be&&w.map.isVideoTexture===!0&&Qe.getTransfer(w.map.colorSpace)===ht,premultipliedAlpha:w.premultipliedAlpha,doubleSided:w.side===qt,flipSided:w.side===Zt,useDepthPacking:w.depthPacking>=0,depthPacking:w.depthPacking||0,index0AttributeName:w.index0AttributeName,extensionClipCullDistance:yt&&w.extensions.clipCullDistance===!0&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(yt&&w.extensions.multiDraw===!0||Fe)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:w.customProgramCacheKey()};return Ke.vertexUv1s=c.has(1),Ke.vertexUv2s=c.has(2),Ke.vertexUv3s=c.has(3),c.clear(),Ke}function y(w){const S=[];if(w.shaderID?S.push(w.shaderID):(S.push(w.customVertexShaderID),S.push(w.customFragmentShaderID)),w.defines!==void 0)for(const D in w.defines)S.push(D),S.push(w.defines[D]);return w.isRawShaderMaterial===!1&&(x(S,w),E(S,w),S.push(s.outputColorSpace)),S.push(w.customProgramCacheKey),S.join()}function x(w,S){w.push(S.precision),w.push(S.outputColorSpace),w.push(S.envMapMode),w.push(S.envMapCubeUVHeight),w.push(S.mapUv),w.push(S.alphaMapUv),w.push(S.lightMapUv),w.push(S.aoMapUv),w.push(S.bumpMapUv),w.push(S.normalMapUv),w.push(S.displacementMapUv),w.push(S.emissiveMapUv),w.push(S.metalnessMapUv),w.push(S.roughnessMapUv),w.push(S.anisotropyMapUv),w.push(S.clearcoatMapUv),w.push(S.clearcoatNormalMapUv),w.push(S.clearcoatRoughnessMapUv),w.push(S.iridescenceMapUv),w.push(S.iridescenceThicknessMapUv),w.push(S.sheenColorMapUv),w.push(S.sheenRoughnessMapUv),w.push(S.specularMapUv),w.push(S.specularColorMapUv),w.push(S.specularIntensityMapUv),w.push(S.transmissionMapUv),w.push(S.thicknessMapUv),w.push(S.combine),w.push(S.fogExp2),w.push(S.sizeAttenuation),w.push(S.morphTargetsCount),w.push(S.morphAttributeCount),w.push(S.numDirLights),w.push(S.numPointLights),w.push(S.numSpotLights),w.push(S.numSpotLightMaps),w.push(S.numHemiLights),w.push(S.numRectAreaLights),w.push(S.numDirLightShadows),w.push(S.numPointLightShadows),w.push(S.numSpotLightShadows),w.push(S.numSpotLightShadowsWithMaps),w.push(S.numLightProbes),w.push(S.shadowMapType),w.push(S.toneMapping),w.push(S.numClippingPlanes),w.push(S.numClipIntersection),w.push(S.depthPacking)}function E(w,S){a.disableAll(),S.supportsVertexTextures&&a.enable(0),S.instancing&&a.enable(1),S.instancingColor&&a.enable(2),S.instancingMorph&&a.enable(3),S.matcap&&a.enable(4),S.envMap&&a.enable(5),S.normalMapObjectSpace&&a.enable(6),S.normalMapTangentSpace&&a.enable(7),S.clearcoat&&a.enable(8),S.iridescence&&a.enable(9),S.alphaTest&&a.enable(10),S.vertexColors&&a.enable(11),S.vertexAlphas&&a.enable(12),S.vertexUv1s&&a.enable(13),S.vertexUv2s&&a.enable(14),S.vertexUv3s&&a.enable(15),S.vertexTangents&&a.enable(16),S.anisotropy&&a.enable(17),S.alphaHash&&a.enable(18),S.batching&&a.enable(19),S.dispersion&&a.enable(20),S.batchingColor&&a.enable(21),w.push(a.mask),a.disableAll(),S.fog&&a.enable(0),S.useFog&&a.enable(1),S.flatShading&&a.enable(2),S.logarithmicDepthBuffer&&a.enable(3),S.reverseDepthBuffer&&a.enable(4),S.skinning&&a.enable(5),S.morphTargets&&a.enable(6),S.morphNormals&&a.enable(7),S.morphColors&&a.enable(8),S.premultipliedAlpha&&a.enable(9),S.shadowMapEnabled&&a.enable(10),S.doubleSided&&a.enable(11),S.flipSided&&a.enable(12),S.useDepthPacking&&a.enable(13),S.dithering&&a.enable(14),S.transmission&&a.enable(15),S.sheen&&a.enable(16),S.opaque&&a.enable(17),S.pointsUvs&&a.enable(18),S.decodeVideoTexture&&a.enable(19),S.alphaToCoverage&&a.enable(20),w.push(a.mask)}function R(w){const S=_[w.type];let D;if(S){const I=Ei[S];D=Jm.clone(I.uniforms)}else D=w.uniforms;return D}function M(w,S){let D;for(let I=0,V=h.length;I<V;I++){const q=h[I];if(q.cacheKey===S){D=q,++D.usedTimes;break}}return D===void 0&&(D=new ub(s,S,w,r),h.push(D)),D}function C(w){if(--w.usedTimes===0){const S=h.indexOf(w);h[S]=h[h.length-1],h.pop(),w.destroy()}}function P(w){l.remove(w)}function N(){l.dispose()}return{getParameters:v,getProgramCacheKey:y,getUniforms:R,acquireProgram:M,releaseProgram:C,releaseShaderCache:P,programs:h,dispose:N}}function vb(){let s=new WeakMap;function e(o){return s.has(o)}function t(o){let a=s.get(o);return a===void 0&&(a={},s.set(o,a)),a}function i(o){s.delete(o)}function n(o,a,l){s.get(o)[a]=l}function r(){s=new WeakMap}return{has:e,get:t,remove:i,update:n,dispose:r}}function _b(s,e){return s.groupOrder!==e.groupOrder?s.groupOrder-e.groupOrder:s.renderOrder!==e.renderOrder?s.renderOrder-e.renderOrder:s.material.id!==e.material.id?s.material.id-e.material.id:s.z!==e.z?s.z-e.z:s.id-e.id}function od(s,e){return s.groupOrder!==e.groupOrder?s.groupOrder-e.groupOrder:s.renderOrder!==e.renderOrder?s.renderOrder-e.renderOrder:s.z!==e.z?e.z-s.z:s.id-e.id}function ad(){const s=[];let e=0;const t=[],i=[],n=[];function r(){e=0,t.length=0,i.length=0,n.length=0}function o(d,u,m,f,_,g){let v=s[e];return v===void 0?(v={id:d.id,object:d,geometry:u,material:m,groupOrder:f,renderOrder:d.renderOrder,z:_,group:g},s[e]=v):(v.id=d.id,v.object=d,v.geometry=u,v.material=m,v.groupOrder=f,v.renderOrder=d.renderOrder,v.z=_,v.group=g),e++,v}function a(d,u,m,f,_,g){const v=o(d,u,m,f,_,g);m.transmission>0?i.push(v):m.transparent===!0?n.push(v):t.push(v)}function l(d,u,m,f,_,g){const v=o(d,u,m,f,_,g);m.transmission>0?i.unshift(v):m.transparent===!0?n.unshift(v):t.unshift(v)}function c(d,u){t.length>1&&t.sort(d||_b),i.length>1&&i.sort(u||od),n.length>1&&n.sort(u||od)}function h(){for(let d=e,u=s.length;d<u;d++){const m=s[d];if(m.id===null)break;m.id=null,m.object=null,m.geometry=null,m.material=null,m.group=null}}return{opaque:t,transmissive:i,transparent:n,init:r,push:a,unshift:l,finish:h,sort:c}}function bb(){let s=new WeakMap;function e(i,n){const r=s.get(i);let o;return r===void 0?(o=new ad,s.set(i,[o])):n>=r.length?(o=new ad,r.push(o)):o=r[n],o}function t(){s=new WeakMap}return{get:e,dispose:t}}function xb(){const s={};return{get:function(e){if(s[e.id]!==void 0)return s[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new k,color:new We};break;case"SpotLight":t={position:new k,direction:new k,color:new We,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new k,color:new We,distance:0,decay:0};break;case"HemisphereLight":t={direction:new k,skyColor:new We,groundColor:new We};break;case"RectAreaLight":t={color:new We,position:new k,halfWidth:new k,halfHeight:new k};break}return s[e.id]=t,t}}}function wb(){const s={};return{get:function(e){if(s[e.id]!==void 0)return s[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new le};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new le};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new le,shadowCameraNear:1,shadowCameraFar:1e3};break}return s[e.id]=t,t}}}let yb=0;function Sb(s,e){return(e.castShadow?2:0)-(s.castShadow?2:0)+(e.map?1:0)-(s.map?1:0)}function Eb(s){const e=new xb,t=wb(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let c=0;c<9;c++)i.probe.push(new k);const n=new k,r=new at,o=new at;function a(c){let h=0,d=0,u=0;for(let N=0;N<9;N++)i.probe[N].set(0,0,0);let m=0,f=0,_=0,g=0,v=0,y=0,x=0,E=0,R=0,M=0,C=0;c.sort(Sb);for(let N=0,w=c.length;N<w;N++){const S=c[N],D=S.color,I=S.intensity,V=S.distance,q=S.shadow&&S.shadow.map?S.shadow.map.texture:null;if(S.isAmbientLight)h+=D.r*I,d+=D.g*I,u+=D.b*I;else if(S.isLightProbe){for(let H=0;H<9;H++)i.probe[H].addScaledVector(S.sh.coefficients[H],I);C++}else if(S.isDirectionalLight){const H=e.get(S);if(H.color.copy(S.color).multiplyScalar(S.intensity),S.castShadow){const te=S.shadow,X=t.get(S);X.shadowIntensity=te.intensity,X.shadowBias=te.bias,X.shadowNormalBias=te.normalBias,X.shadowRadius=te.radius,X.shadowMapSize=te.mapSize,i.directionalShadow[m]=X,i.directionalShadowMap[m]=q,i.directionalShadowMatrix[m]=S.shadow.matrix,y++}i.directional[m]=H,m++}else if(S.isSpotLight){const H=e.get(S);H.position.setFromMatrixPosition(S.matrixWorld),H.color.copy(D).multiplyScalar(I),H.distance=V,H.coneCos=Math.cos(S.angle),H.penumbraCos=Math.cos(S.angle*(1-S.penumbra)),H.decay=S.decay,i.spot[_]=H;const te=S.shadow;if(S.map&&(i.spotLightMap[R]=S.map,R++,te.updateMatrices(S),S.castShadow&&M++),i.spotLightMatrix[_]=te.matrix,S.castShadow){const X=t.get(S);X.shadowIntensity=te.intensity,X.shadowBias=te.bias,X.shadowNormalBias=te.normalBias,X.shadowRadius=te.radius,X.shadowMapSize=te.mapSize,i.spotShadow[_]=X,i.spotShadowMap[_]=q,E++}_++}else if(S.isRectAreaLight){const H=e.get(S);H.color.copy(D).multiplyScalar(I),H.halfWidth.set(S.width*.5,0,0),H.halfHeight.set(0,S.height*.5,0),i.rectArea[g]=H,g++}else if(S.isPointLight){const H=e.get(S);if(H.color.copy(S.color).multiplyScalar(S.intensity),H.distance=S.distance,H.decay=S.decay,S.castShadow){const te=S.shadow,X=t.get(S);X.shadowIntensity=te.intensity,X.shadowBias=te.bias,X.shadowNormalBias=te.normalBias,X.shadowRadius=te.radius,X.shadowMapSize=te.mapSize,X.shadowCameraNear=te.camera.near,X.shadowCameraFar=te.camera.far,i.pointShadow[f]=X,i.pointShadowMap[f]=q,i.pointShadowMatrix[f]=S.shadow.matrix,x++}i.point[f]=H,f++}else if(S.isHemisphereLight){const H=e.get(S);H.skyColor.copy(S.color).multiplyScalar(I),H.groundColor.copy(S.groundColor).multiplyScalar(I),i.hemi[v]=H,v++}}g>0&&(s.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=re.LTC_FLOAT_1,i.rectAreaLTC2=re.LTC_FLOAT_2):(i.rectAreaLTC1=re.LTC_HALF_1,i.rectAreaLTC2=re.LTC_HALF_2)),i.ambient[0]=h,i.ambient[1]=d,i.ambient[2]=u;const P=i.hash;(P.directionalLength!==m||P.pointLength!==f||P.spotLength!==_||P.rectAreaLength!==g||P.hemiLength!==v||P.numDirectionalShadows!==y||P.numPointShadows!==x||P.numSpotShadows!==E||P.numSpotMaps!==R||P.numLightProbes!==C)&&(i.directional.length=m,i.spot.length=_,i.rectArea.length=g,i.point.length=f,i.hemi.length=v,i.directionalShadow.length=y,i.directionalShadowMap.length=y,i.pointShadow.length=x,i.pointShadowMap.length=x,i.spotShadow.length=E,i.spotShadowMap.length=E,i.directionalShadowMatrix.length=y,i.pointShadowMatrix.length=x,i.spotLightMatrix.length=E+R-M,i.spotLightMap.length=R,i.numSpotLightShadowsWithMaps=M,i.numLightProbes=C,P.directionalLength=m,P.pointLength=f,P.spotLength=_,P.rectAreaLength=g,P.hemiLength=v,P.numDirectionalShadows=y,P.numPointShadows=x,P.numSpotShadows=E,P.numSpotMaps=R,P.numLightProbes=C,i.version=yb++)}function l(c,h){let d=0,u=0,m=0,f=0,_=0;const g=h.matrixWorldInverse;for(let v=0,y=c.length;v<y;v++){const x=c[v];if(x.isDirectionalLight){const E=i.directional[d];E.direction.setFromMatrixPosition(x.matrixWorld),n.setFromMatrixPosition(x.target.matrixWorld),E.direction.sub(n),E.direction.transformDirection(g),d++}else if(x.isSpotLight){const E=i.spot[m];E.position.setFromMatrixPosition(x.matrixWorld),E.position.applyMatrix4(g),E.direction.setFromMatrixPosition(x.matrixWorld),n.setFromMatrixPosition(x.target.matrixWorld),E.direction.sub(n),E.direction.transformDirection(g),m++}else if(x.isRectAreaLight){const E=i.rectArea[f];E.position.setFromMatrixPosition(x.matrixWorld),E.position.applyMatrix4(g),o.identity(),r.copy(x.matrixWorld),r.premultiply(g),o.extractRotation(r),E.halfWidth.set(x.width*.5,0,0),E.halfHeight.set(0,x.height*.5,0),E.halfWidth.applyMatrix4(o),E.halfHeight.applyMatrix4(o),f++}else if(x.isPointLight){const E=i.point[u];E.position.setFromMatrixPosition(x.matrixWorld),E.position.applyMatrix4(g),u++}else if(x.isHemisphereLight){const E=i.hemi[_];E.direction.setFromMatrixPosition(x.matrixWorld),E.direction.transformDirection(g),_++}}}return{setup:a,setupView:l,state:i}}function ld(s){const e=new Eb(s),t=[],i=[];function n(h){c.camera=h,t.length=0,i.length=0}function r(h){t.push(h)}function o(h){i.push(h)}function a(){e.setup(t)}function l(h){e.setupView(t,h)}const c={lightsArray:t,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:n,state:c,setupLights:a,setupLightsView:l,pushLight:r,pushShadow:o}}function Mb(s){let e=new WeakMap;function t(n,r=0){const o=e.get(n);let a;return o===void 0?(a=new ld(s),e.set(n,[a])):r>=o.length?(a=new ld(s),o.push(a)):a=o[r],a}function i(){e=new WeakMap}return{get:t,dispose:i}}class Cb extends jn{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=nm,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Tb extends jn{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const Ab=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Rb=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Pb(s,e,t){let i=new Gu;const n=new le,r=new le,o=new wt,a=new Cb({depthPacking:sm}),l=new Tb,c={},h=t.maxTextureSize,d={[pn]:Zt,[Zt]:pn,[qt]:qt},u=new fn({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new le},radius:{value:4}},vertexShader:Ab,fragmentShader:Rb}),m=u.clone();m.defines.HORIZONTAL_PASS=1;const f=new mt;f.setAttribute("position",new yi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const _=new Ft(f,u),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=xu;let v=this.type;this.render=function(M,C,P){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||M.length===0)return;const N=s.getRenderTarget(),w=s.getActiveCubeFace(),S=s.getActiveMipmapLevel(),D=s.state;D.setBlending(hn),D.buffers.color.setClear(1,1,1,1),D.buffers.depth.setTest(!0),D.setScissorTest(!1);const I=v!==Fi&&this.type===Fi,V=v===Fi&&this.type!==Fi;for(let q=0,H=M.length;q<H;q++){const te=M[q],X=te.shadow;if(X===void 0){console.warn("THREE.WebGLShadowMap:",te,"has no shadow.");continue}if(X.autoUpdate===!1&&X.needsUpdate===!1)continue;n.copy(X.mapSize);const oe=X.getFrameExtents();if(n.multiply(oe),r.copy(X.mapSize),(n.x>h||n.y>h)&&(n.x>h&&(r.x=Math.floor(h/oe.x),n.x=r.x*oe.x,X.mapSize.x=r.x),n.y>h&&(r.y=Math.floor(h/oe.y),n.y=r.y*oe.y,X.mapSize.y=r.y)),X.map===null||I===!0||V===!0){const fe=this.type!==Fi?{minFilter:pi,magFilter:pi}:{};X.map!==null&&X.map.dispose(),X.map=new zn(n.x,n.y,fe),X.map.texture.name=te.name+".shadowMap",X.camera.updateProjectionMatrix()}s.setRenderTarget(X.map),s.clear();const ae=X.getViewportCount();for(let fe=0;fe<ae;fe++){const ze=X.getViewport(fe);o.set(r.x*ze.x,r.y*ze.y,r.x*ze.z,r.y*ze.w),D.viewport(o),X.updateMatrices(te,fe),i=X.getFrustum(),E(C,P,X.camera,te,this.type)}X.isPointLightShadow!==!0&&this.type===Fi&&y(X,P),X.needsUpdate=!1}v=this.type,g.needsUpdate=!1,s.setRenderTarget(N,w,S)};function y(M,C){const P=e.update(_);u.defines.VSM_SAMPLES!==M.blurSamples&&(u.defines.VSM_SAMPLES=M.blurSamples,m.defines.VSM_SAMPLES=M.blurSamples,u.needsUpdate=!0,m.needsUpdate=!0),M.mapPass===null&&(M.mapPass=new zn(n.x,n.y)),u.uniforms.shadow_pass.value=M.map.texture,u.uniforms.resolution.value=M.mapSize,u.uniforms.radius.value=M.radius,s.setRenderTarget(M.mapPass),s.clear(),s.renderBufferDirect(C,null,P,u,_,null),m.uniforms.shadow_pass.value=M.mapPass.texture,m.uniforms.resolution.value=M.mapSize,m.uniforms.radius.value=M.radius,s.setRenderTarget(M.map),s.clear(),s.renderBufferDirect(C,null,P,m,_,null)}function x(M,C,P,N){let w=null;const S=P.isPointLight===!0?M.customDistanceMaterial:M.customDepthMaterial;if(S!==void 0)w=S;else if(w=P.isPointLight===!0?l:a,s.localClippingEnabled&&C.clipShadows===!0&&Array.isArray(C.clippingPlanes)&&C.clippingPlanes.length!==0||C.displacementMap&&C.displacementScale!==0||C.alphaMap&&C.alphaTest>0||C.map&&C.alphaTest>0){const D=w.uuid,I=C.uuid;let V=c[D];V===void 0&&(V={},c[D]=V);let q=V[I];q===void 0&&(q=w.clone(),V[I]=q,C.addEventListener("dispose",R)),w=q}if(w.visible=C.visible,w.wireframe=C.wireframe,N===Fi?w.side=C.shadowSide!==null?C.shadowSide:C.side:w.side=C.shadowSide!==null?C.shadowSide:d[C.side],w.alphaMap=C.alphaMap,w.alphaTest=C.alphaTest,w.map=C.map,w.clipShadows=C.clipShadows,w.clippingPlanes=C.clippingPlanes,w.clipIntersection=C.clipIntersection,w.displacementMap=C.displacementMap,w.displacementScale=C.displacementScale,w.displacementBias=C.displacementBias,w.wireframeLinewidth=C.wireframeLinewidth,w.linewidth=C.linewidth,P.isPointLight===!0&&w.isMeshDistanceMaterial===!0){const D=s.properties.get(w);D.light=P}return w}function E(M,C,P,N,w){if(M.visible===!1)return;if(M.layers.test(C.layers)&&(M.isMesh||M.isLine||M.isPoints)&&(M.castShadow||M.receiveShadow&&w===Fi)&&(!M.frustumCulled||i.intersectsObject(M))){M.modelViewMatrix.multiplyMatrices(P.matrixWorldInverse,M.matrixWorld);const I=e.update(M),V=M.material;if(Array.isArray(V)){const q=I.groups;for(let H=0,te=q.length;H<te;H++){const X=q[H],oe=V[X.materialIndex];if(oe&&oe.visible){const ae=x(M,oe,N,w);M.onBeforeShadow(s,M,C,P,I,ae,X),s.renderBufferDirect(P,null,I,ae,M,X),M.onAfterShadow(s,M,C,P,I,ae,X)}}}else if(V.visible){const q=x(M,V,N,w);M.onBeforeShadow(s,M,C,P,I,q,null),s.renderBufferDirect(P,null,I,q,M,null),M.onAfterShadow(s,M,C,P,I,q,null)}}const D=M.children;for(let I=0,V=D.length;I<V;I++)E(D[I],C,P,N,w)}function R(M){M.target.removeEventListener("dispose",R);for(const P in c){const N=c[P],w=M.target.uuid;w in N&&(N[w].dispose(),delete N[w])}}}const Db={[_l]:bl,[xl]:Sl,[wl]:El,[As]:yl,[bl]:_l,[Sl]:xl,[El]:wl,[yl]:As};function Lb(s){function e(){let F=!1;const ue=new wt;let j=null;const ee=new wt(0,0,0,0);return{setMask:function(he){j!==he&&!F&&(s.colorMask(he,he,he,he),j=he)},setLocked:function(he){F=he},setClear:function(he,pe,$e,yt,$t){$t===!0&&(he*=yt,pe*=yt,$e*=yt),ue.set(he,pe,$e,yt),ee.equals(ue)===!1&&(s.clearColor(he,pe,$e,yt),ee.copy(ue))},reset:function(){F=!1,j=null,ee.set(-1,0,0,0)}}}function t(){let F=!1,ue=!1,j=null,ee=null,he=null;return{setReversed:function(pe){ue=pe},setTest:function(pe){pe?Y(s.DEPTH_TEST):Q(s.DEPTH_TEST)},setMask:function(pe){j!==pe&&!F&&(s.depthMask(pe),j=pe)},setFunc:function(pe){if(ue&&(pe=Db[pe]),ee!==pe){switch(pe){case _l:s.depthFunc(s.NEVER);break;case bl:s.depthFunc(s.ALWAYS);break;case xl:s.depthFunc(s.LESS);break;case As:s.depthFunc(s.LEQUAL);break;case wl:s.depthFunc(s.EQUAL);break;case yl:s.depthFunc(s.GEQUAL);break;case Sl:s.depthFunc(s.GREATER);break;case El:s.depthFunc(s.NOTEQUAL);break;default:s.depthFunc(s.LEQUAL)}ee=pe}},setLocked:function(pe){F=pe},setClear:function(pe){he!==pe&&(s.clearDepth(pe),he=pe)},reset:function(){F=!1,j=null,ee=null,he=null}}}function i(){let F=!1,ue=null,j=null,ee=null,he=null,pe=null,$e=null,yt=null,$t=null;return{setTest:function(Ke){F||(Ke?Y(s.STENCIL_TEST):Q(s.STENCIL_TEST))},setMask:function(Ke){ue!==Ke&&!F&&(s.stencilMask(Ke),ue=Ke)},setFunc:function(Ke,Wt,Pi){(j!==Ke||ee!==Wt||he!==Pi)&&(s.stencilFunc(Ke,Wt,Pi),j=Ke,ee=Wt,he=Pi)},setOp:function(Ke,Wt,Pi){(pe!==Ke||$e!==Wt||yt!==Pi)&&(s.stencilOp(Ke,Wt,Pi),pe=Ke,$e=Wt,yt=Pi)},setLocked:function(Ke){F=Ke},setClear:function(Ke){$t!==Ke&&(s.clearStencil(Ke),$t=Ke)},reset:function(){F=!1,ue=null,j=null,ee=null,he=null,pe=null,$e=null,yt=null,$t=null}}}const n=new e,r=new t,o=new i,a=new WeakMap,l=new WeakMap;let c={},h={},d=new WeakMap,u=[],m=null,f=!1,_=null,g=null,v=null,y=null,x=null,E=null,R=null,M=new We(0,0,0),C=0,P=!1,N=null,w=null,S=null,D=null,I=null;const V=s.getParameter(s.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let q=!1,H=0;const te=s.getParameter(s.VERSION);te.indexOf("WebGL")!==-1?(H=parseFloat(/^WebGL (\d)/.exec(te)[1]),q=H>=1):te.indexOf("OpenGL ES")!==-1&&(H=parseFloat(/^OpenGL ES (\d)/.exec(te)[1]),q=H>=2);let X=null,oe={};const ae=s.getParameter(s.SCISSOR_BOX),fe=s.getParameter(s.VIEWPORT),ze=new wt().fromArray(ae),Se=new wt().fromArray(fe);function U(F,ue,j,ee){const he=new Uint8Array(4),pe=s.createTexture();s.bindTexture(F,pe),s.texParameteri(F,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(F,s.TEXTURE_MAG_FILTER,s.NEAREST);for(let $e=0;$e<j;$e++)F===s.TEXTURE_3D||F===s.TEXTURE_2D_ARRAY?s.texImage3D(ue,0,s.RGBA,1,1,ee,0,s.RGBA,s.UNSIGNED_BYTE,he):s.texImage2D(ue+$e,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,he);return pe}const K={};K[s.TEXTURE_2D]=U(s.TEXTURE_2D,s.TEXTURE_2D,1),K[s.TEXTURE_CUBE_MAP]=U(s.TEXTURE_CUBE_MAP,s.TEXTURE_CUBE_MAP_POSITIVE_X,6),K[s.TEXTURE_2D_ARRAY]=U(s.TEXTURE_2D_ARRAY,s.TEXTURE_2D_ARRAY,1,1),K[s.TEXTURE_3D]=U(s.TEXTURE_3D,s.TEXTURE_3D,1,1),n.setClear(0,0,0,1),r.setClear(1),o.setClear(0),Y(s.DEPTH_TEST),r.setFunc(As),Ve(!1),je(gh),Y(s.CULL_FACE),O(hn);function Y(F){c[F]!==!0&&(s.enable(F),c[F]=!0)}function Q(F){c[F]!==!1&&(s.disable(F),c[F]=!1)}function Me(F,ue){return h[F]!==ue?(s.bindFramebuffer(F,ue),h[F]=ue,F===s.DRAW_FRAMEBUFFER&&(h[s.FRAMEBUFFER]=ue),F===s.FRAMEBUFFER&&(h[s.DRAW_FRAMEBUFFER]=ue),!0):!1}function Ee(F,ue){let j=u,ee=!1;if(F){j=d.get(ue),j===void 0&&(j=[],d.set(ue,j));const he=F.textures;if(j.length!==he.length||j[0]!==s.COLOR_ATTACHMENT0){for(let pe=0,$e=he.length;pe<$e;pe++)j[pe]=s.COLOR_ATTACHMENT0+pe;j.length=he.length,ee=!0}}else j[0]!==s.BACK&&(j[0]=s.BACK,ee=!0);ee&&s.drawBuffers(j)}function Fe(F){return m!==F?(s.useProgram(F),m=F,!0):!1}const Be={[Rn]:s.FUNC_ADD,[Pf]:s.FUNC_SUBTRACT,[Df]:s.FUNC_REVERSE_SUBTRACT};Be[Lf]=s.MIN,Be[If]=s.MAX;const Ge={[kf]:s.ZERO,[Nf]:s.ONE,[Of]:s.SRC_COLOR,[gl]:s.SRC_ALPHA,[Hf]:s.SRC_ALPHA_SATURATE,[Bf]:s.DST_COLOR,[Uf]:s.DST_ALPHA,[Ff]:s.ONE_MINUS_SRC_COLOR,[vl]:s.ONE_MINUS_SRC_ALPHA,[Vf]:s.ONE_MINUS_DST_COLOR,[zf]:s.ONE_MINUS_DST_ALPHA,[Gf]:s.CONSTANT_COLOR,[$f]:s.ONE_MINUS_CONSTANT_COLOR,[Wf]:s.CONSTANT_ALPHA,[Xf]:s.ONE_MINUS_CONSTANT_ALPHA};function O(F,ue,j,ee,he,pe,$e,yt,$t,Ke){if(F===hn){f===!0&&(Q(s.BLEND),f=!1);return}if(f===!1&&(Y(s.BLEND),f=!0),F!==Rf){if(F!==_||Ke!==P){if((g!==Rn||x!==Rn)&&(s.blendEquation(s.FUNC_ADD),g=Rn,x=Rn),Ke)switch(F){case ws:s.blendFuncSeparate(s.ONE,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA);break;case vh:s.blendFunc(s.ONE,s.ONE);break;case _h:s.blendFuncSeparate(s.ZERO,s.ONE_MINUS_SRC_COLOR,s.ZERO,s.ONE);break;case bh:s.blendFuncSeparate(s.ZERO,s.SRC_COLOR,s.ZERO,s.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",F);break}else switch(F){case ws:s.blendFuncSeparate(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA);break;case vh:s.blendFunc(s.SRC_ALPHA,s.ONE);break;case _h:s.blendFuncSeparate(s.ZERO,s.ONE_MINUS_SRC_COLOR,s.ZERO,s.ONE);break;case bh:s.blendFunc(s.ZERO,s.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",F);break}v=null,y=null,E=null,R=null,M.set(0,0,0),C=0,_=F,P=Ke}return}he=he||ue,pe=pe||j,$e=$e||ee,(ue!==g||he!==x)&&(s.blendEquationSeparate(Be[ue],Be[he]),g=ue,x=he),(j!==v||ee!==y||pe!==E||$e!==R)&&(s.blendFuncSeparate(Ge[j],Ge[ee],Ge[pe],Ge[$e]),v=j,y=ee,E=pe,R=$e),(yt.equals(M)===!1||$t!==C)&&(s.blendColor(yt.r,yt.g,yt.b,$t),M.copy(yt),C=$t),_=F,P=!1}function Qt(F,ue){F.side===qt?Q(s.CULL_FACE):Y(s.CULL_FACE);let j=F.side===Zt;ue&&(j=!j),Ve(j),F.blending===ws&&F.transparent===!1?O(hn):O(F.blending,F.blendEquation,F.blendSrc,F.blendDst,F.blendEquationAlpha,F.blendSrcAlpha,F.blendDstAlpha,F.blendColor,F.blendAlpha,F.premultipliedAlpha),r.setFunc(F.depthFunc),r.setTest(F.depthTest),r.setMask(F.depthWrite),n.setMask(F.colorWrite);const ee=F.stencilWrite;o.setTest(ee),ee&&(o.setMask(F.stencilWriteMask),o.setFunc(F.stencilFunc,F.stencilRef,F.stencilFuncMask),o.setOp(F.stencilFail,F.stencilZFail,F.stencilZPass)),lt(F.polygonOffset,F.polygonOffsetFactor,F.polygonOffsetUnits),F.alphaToCoverage===!0?Y(s.SAMPLE_ALPHA_TO_COVERAGE):Q(s.SAMPLE_ALPHA_TO_COVERAGE)}function Ve(F){N!==F&&(F?s.frontFace(s.CW):s.frontFace(s.CCW),N=F)}function je(F){F!==Cf?(Y(s.CULL_FACE),F!==w&&(F===gh?s.cullFace(s.BACK):F===Tf?s.cullFace(s.FRONT):s.cullFace(s.FRONT_AND_BACK))):Q(s.CULL_FACE),w=F}function Re(F){F!==S&&(q&&s.lineWidth(F),S=F)}function lt(F,ue,j){F?(Y(s.POLYGON_OFFSET_FILL),(D!==ue||I!==j)&&(s.polygonOffset(ue,j),D=ue,I=j)):Q(s.POLYGON_OFFSET_FILL)}function Le(F){F?Y(s.SCISSOR_TEST):Q(s.SCISSOR_TEST)}function L(F){F===void 0&&(F=s.TEXTURE0+V-1),X!==F&&(s.activeTexture(F),X=F)}function T(F,ue,j){j===void 0&&(X===null?j=s.TEXTURE0+V-1:j=X);let ee=oe[j];ee===void 0&&(ee={type:void 0,texture:void 0},oe[j]=ee),(ee.type!==F||ee.texture!==ue)&&(X!==j&&(s.activeTexture(j),X=j),s.bindTexture(F,ue||K[F]),ee.type=F,ee.texture=ue)}function G(){const F=oe[X];F!==void 0&&F.type!==void 0&&(s.bindTexture(F.type,null),F.type=void 0,F.texture=void 0)}function J(){try{s.compressedTexImage2D.apply(s,arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function ie(){try{s.compressedTexImage3D.apply(s,arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function Z(){try{s.texSubImage2D.apply(s,arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function xe(){try{s.texSubImage3D.apply(s,arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function ce(){try{s.compressedTexSubImage2D.apply(s,arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function me(){try{s.compressedTexSubImage3D.apply(s,arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function Ye(){try{s.texStorage2D.apply(s,arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function ne(){try{s.texStorage3D.apply(s,arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function ge(){try{s.texImage2D.apply(s,arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function Pe(){try{s.texImage3D.apply(s,arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function De(F){ze.equals(F)===!1&&(s.scissor(F.x,F.y,F.z,F.w),ze.copy(F))}function ve(F){Se.equals(F)===!1&&(s.viewport(F.x,F.y,F.z,F.w),Se.copy(F))}function He(F,ue){let j=l.get(ue);j===void 0&&(j=new WeakMap,l.set(ue,j));let ee=j.get(F);ee===void 0&&(ee=s.getUniformBlockIndex(ue,F.name),j.set(F,ee))}function ke(F,ue){const ee=l.get(ue).get(F);a.get(ue)!==ee&&(s.uniformBlockBinding(ue,ee,F.__bindingPointIndex),a.set(ue,ee))}function rt(){s.disable(s.BLEND),s.disable(s.CULL_FACE),s.disable(s.DEPTH_TEST),s.disable(s.POLYGON_OFFSET_FILL),s.disable(s.SCISSOR_TEST),s.disable(s.STENCIL_TEST),s.disable(s.SAMPLE_ALPHA_TO_COVERAGE),s.blendEquation(s.FUNC_ADD),s.blendFunc(s.ONE,s.ZERO),s.blendFuncSeparate(s.ONE,s.ZERO,s.ONE,s.ZERO),s.blendColor(0,0,0,0),s.colorMask(!0,!0,!0,!0),s.clearColor(0,0,0,0),s.depthMask(!0),s.depthFunc(s.LESS),s.clearDepth(1),s.stencilMask(4294967295),s.stencilFunc(s.ALWAYS,0,4294967295),s.stencilOp(s.KEEP,s.KEEP,s.KEEP),s.clearStencil(0),s.cullFace(s.BACK),s.frontFace(s.CCW),s.polygonOffset(0,0),s.activeTexture(s.TEXTURE0),s.bindFramebuffer(s.FRAMEBUFFER,null),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,null),s.bindFramebuffer(s.READ_FRAMEBUFFER,null),s.useProgram(null),s.lineWidth(1),s.scissor(0,0,s.canvas.width,s.canvas.height),s.viewport(0,0,s.canvas.width,s.canvas.height),c={},X=null,oe={},h={},d=new WeakMap,u=[],m=null,f=!1,_=null,g=null,v=null,y=null,x=null,E=null,R=null,M=new We(0,0,0),C=0,P=!1,N=null,w=null,S=null,D=null,I=null,ze.set(0,0,s.canvas.width,s.canvas.height),Se.set(0,0,s.canvas.width,s.canvas.height),n.reset(),r.reset(),o.reset()}return{buffers:{color:n,depth:r,stencil:o},enable:Y,disable:Q,bindFramebuffer:Me,drawBuffers:Ee,useProgram:Fe,setBlending:O,setMaterial:Qt,setFlipSided:Ve,setCullFace:je,setLineWidth:Re,setPolygonOffset:lt,setScissorTest:Le,activeTexture:L,bindTexture:T,unbindTexture:G,compressedTexImage2D:J,compressedTexImage3D:ie,texImage2D:ge,texImage3D:Pe,updateUBOMapping:He,uniformBlockBinding:ke,texStorage2D:Ye,texStorage3D:ne,texSubImage2D:Z,texSubImage3D:xe,compressedTexSubImage2D:ce,compressedTexSubImage3D:me,scissor:De,viewport:ve,reset:rt}}function cd(s,e,t,i){const n=Ib(i);switch(t){case Cu:return s*e;case Au:return s*e;case Ru:return s*e*2;case Pu:return s*e/n.components*n.byteLength;case wc:return s*e/n.components*n.byteLength;case Du:return s*e*2/n.components*n.byteLength;case yc:return s*e*2/n.components*n.byteLength;case Tu:return s*e*3/n.components*n.byteLength;case wi:return s*e*4/n.components*n.byteLength;case Sc:return s*e*4/n.components*n.byteLength;case Oo:case Fo:return Math.floor((s+3)/4)*Math.floor((e+3)/4)*8;case Uo:case zo:return Math.floor((s+3)/4)*Math.floor((e+3)/4)*16;case Pl:case Ll:return Math.max(s,16)*Math.max(e,8)/4;case Rl:case Dl:return Math.max(s,8)*Math.max(e,8)/2;case Il:case kl:return Math.floor((s+3)/4)*Math.floor((e+3)/4)*8;case Nl:return Math.floor((s+3)/4)*Math.floor((e+3)/4)*16;case Ol:return Math.floor((s+3)/4)*Math.floor((e+3)/4)*16;case Fl:return Math.floor((s+4)/5)*Math.floor((e+3)/4)*16;case Ul:return Math.floor((s+4)/5)*Math.floor((e+4)/5)*16;case zl:return Math.floor((s+5)/6)*Math.floor((e+4)/5)*16;case Bl:return Math.floor((s+5)/6)*Math.floor((e+5)/6)*16;case Vl:return Math.floor((s+7)/8)*Math.floor((e+4)/5)*16;case Hl:return Math.floor((s+7)/8)*Math.floor((e+5)/6)*16;case Gl:return Math.floor((s+7)/8)*Math.floor((e+7)/8)*16;case $l:return Math.floor((s+9)/10)*Math.floor((e+4)/5)*16;case Wl:return Math.floor((s+9)/10)*Math.floor((e+5)/6)*16;case Xl:return Math.floor((s+9)/10)*Math.floor((e+7)/8)*16;case jl:return Math.floor((s+9)/10)*Math.floor((e+9)/10)*16;case Yl:return Math.floor((s+11)/12)*Math.floor((e+9)/10)*16;case ql:return Math.floor((s+11)/12)*Math.floor((e+11)/12)*16;case Bo:case Kl:case Zl:return Math.ceil(s/4)*Math.ceil(e/4)*16;case Lu:case Jl:return Math.ceil(s/4)*Math.ceil(e/4)*8;case Ql:case ec:return Math.ceil(s/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function Ib(s){switch(s){case Gi:case Su:return{byteLength:1,components:1};case mr:case Eu:case Lr:return{byteLength:2,components:1};case bc:case xc:return{byteLength:2,components:4};case Un:case _c:case Ui:return{byteLength:4,components:1};case Mu:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${s}.`)}function kb(s,e,t,i,n,r,o){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),c=new le,h=new WeakMap;let d;const u=new WeakMap;let m=!1;try{m=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function f(L,T){return m?new OffscreenCanvas(L,T):Zo("canvas")}function _(L,T,G){let J=1;const ie=Le(L);if((ie.width>G||ie.height>G)&&(J=G/Math.max(ie.width,ie.height)),J<1)if(typeof HTMLImageElement<"u"&&L instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&L instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&L instanceof ImageBitmap||typeof VideoFrame<"u"&&L instanceof VideoFrame){const Z=Math.floor(J*ie.width),xe=Math.floor(J*ie.height);d===void 0&&(d=f(Z,xe));const ce=T?f(Z,xe):d;return ce.width=Z,ce.height=xe,ce.getContext("2d").drawImage(L,0,0,Z,xe),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+ie.width+"x"+ie.height+") to ("+Z+"x"+xe+")."),ce}else return"data"in L&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+ie.width+"x"+ie.height+")."),L;return L}function g(L){return L.generateMipmaps&&L.minFilter!==pi&&L.minFilter!==bi}function v(L){s.generateMipmap(L)}function y(L,T,G,J,ie=!1){if(L!==null){if(s[L]!==void 0)return s[L];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+L+"'")}let Z=T;if(T===s.RED&&(G===s.FLOAT&&(Z=s.R32F),G===s.HALF_FLOAT&&(Z=s.R16F),G===s.UNSIGNED_BYTE&&(Z=s.R8)),T===s.RED_INTEGER&&(G===s.UNSIGNED_BYTE&&(Z=s.R8UI),G===s.UNSIGNED_SHORT&&(Z=s.R16UI),G===s.UNSIGNED_INT&&(Z=s.R32UI),G===s.BYTE&&(Z=s.R8I),G===s.SHORT&&(Z=s.R16I),G===s.INT&&(Z=s.R32I)),T===s.RG&&(G===s.FLOAT&&(Z=s.RG32F),G===s.HALF_FLOAT&&(Z=s.RG16F),G===s.UNSIGNED_BYTE&&(Z=s.RG8)),T===s.RG_INTEGER&&(G===s.UNSIGNED_BYTE&&(Z=s.RG8UI),G===s.UNSIGNED_SHORT&&(Z=s.RG16UI),G===s.UNSIGNED_INT&&(Z=s.RG32UI),G===s.BYTE&&(Z=s.RG8I),G===s.SHORT&&(Z=s.RG16I),G===s.INT&&(Z=s.RG32I)),T===s.RGB_INTEGER&&(G===s.UNSIGNED_BYTE&&(Z=s.RGB8UI),G===s.UNSIGNED_SHORT&&(Z=s.RGB16UI),G===s.UNSIGNED_INT&&(Z=s.RGB32UI),G===s.BYTE&&(Z=s.RGB8I),G===s.SHORT&&(Z=s.RGB16I),G===s.INT&&(Z=s.RGB32I)),T===s.RGBA_INTEGER&&(G===s.UNSIGNED_BYTE&&(Z=s.RGBA8UI),G===s.UNSIGNED_SHORT&&(Z=s.RGBA16UI),G===s.UNSIGNED_INT&&(Z=s.RGBA32UI),G===s.BYTE&&(Z=s.RGBA8I),G===s.SHORT&&(Z=s.RGBA16I),G===s.INT&&(Z=s.RGBA32I)),T===s.RGB&&G===s.UNSIGNED_INT_5_9_9_9_REV&&(Z=s.RGB9_E5),T===s.RGBA){const xe=ie?jo:Qe.getTransfer(J);G===s.FLOAT&&(Z=s.RGBA32F),G===s.HALF_FLOAT&&(Z=s.RGBA16F),G===s.UNSIGNED_BYTE&&(Z=xe===ht?s.SRGB8_ALPHA8:s.RGBA8),G===s.UNSIGNED_SHORT_4_4_4_4&&(Z=s.RGBA4),G===s.UNSIGNED_SHORT_5_5_5_1&&(Z=s.RGB5_A1)}return(Z===s.R16F||Z===s.R32F||Z===s.RG16F||Z===s.RG32F||Z===s.RGBA16F||Z===s.RGBA32F)&&e.get("EXT_color_buffer_float"),Z}function x(L,T){let G;return L?T===null||T===Un||T===Ds?G=s.DEPTH24_STENCIL8:T===Ui?G=s.DEPTH32F_STENCIL8:T===mr&&(G=s.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):T===null||T===Un||T===Ds?G=s.DEPTH_COMPONENT24:T===Ui?G=s.DEPTH_COMPONENT32F:T===mr&&(G=s.DEPTH_COMPONENT16),G}function E(L,T){return g(L)===!0||L.isFramebufferTexture&&L.minFilter!==pi&&L.minFilter!==bi?Math.log2(Math.max(T.width,T.height))+1:L.mipmaps!==void 0&&L.mipmaps.length>0?L.mipmaps.length:L.isCompressedTexture&&Array.isArray(L.image)?T.mipmaps.length:1}function R(L){const T=L.target;T.removeEventListener("dispose",R),C(T),T.isVideoTexture&&h.delete(T)}function M(L){const T=L.target;T.removeEventListener("dispose",M),N(T)}function C(L){const T=i.get(L);if(T.__webglInit===void 0)return;const G=L.source,J=u.get(G);if(J){const ie=J[T.__cacheKey];ie.usedTimes--,ie.usedTimes===0&&P(L),Object.keys(J).length===0&&u.delete(G)}i.remove(L)}function P(L){const T=i.get(L);s.deleteTexture(T.__webglTexture);const G=L.source,J=u.get(G);delete J[T.__cacheKey],o.memory.textures--}function N(L){const T=i.get(L);if(L.depthTexture&&L.depthTexture.dispose(),L.isWebGLCubeRenderTarget)for(let J=0;J<6;J++){if(Array.isArray(T.__webglFramebuffer[J]))for(let ie=0;ie<T.__webglFramebuffer[J].length;ie++)s.deleteFramebuffer(T.__webglFramebuffer[J][ie]);else s.deleteFramebuffer(T.__webglFramebuffer[J]);T.__webglDepthbuffer&&s.deleteRenderbuffer(T.__webglDepthbuffer[J])}else{if(Array.isArray(T.__webglFramebuffer))for(let J=0;J<T.__webglFramebuffer.length;J++)s.deleteFramebuffer(T.__webglFramebuffer[J]);else s.deleteFramebuffer(T.__webglFramebuffer);if(T.__webglDepthbuffer&&s.deleteRenderbuffer(T.__webglDepthbuffer),T.__webglMultisampledFramebuffer&&s.deleteFramebuffer(T.__webglMultisampledFramebuffer),T.__webglColorRenderbuffer)for(let J=0;J<T.__webglColorRenderbuffer.length;J++)T.__webglColorRenderbuffer[J]&&s.deleteRenderbuffer(T.__webglColorRenderbuffer[J]);T.__webglDepthRenderbuffer&&s.deleteRenderbuffer(T.__webglDepthRenderbuffer)}const G=L.textures;for(let J=0,ie=G.length;J<ie;J++){const Z=i.get(G[J]);Z.__webglTexture&&(s.deleteTexture(Z.__webglTexture),o.memory.textures--),i.remove(G[J])}i.remove(L)}let w=0;function S(){w=0}function D(){const L=w;return L>=n.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+L+" texture units while this GPU supports only "+n.maxTextures),w+=1,L}function I(L){const T=[];return T.push(L.wrapS),T.push(L.wrapT),T.push(L.wrapR||0),T.push(L.magFilter),T.push(L.minFilter),T.push(L.anisotropy),T.push(L.internalFormat),T.push(L.format),T.push(L.type),T.push(L.generateMipmaps),T.push(L.premultiplyAlpha),T.push(L.flipY),T.push(L.unpackAlignment),T.push(L.colorSpace),T.join()}function V(L,T){const G=i.get(L);if(L.isVideoTexture&&Re(L),L.isRenderTargetTexture===!1&&L.version>0&&G.__version!==L.version){const J=L.image;if(J===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(J.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Se(G,L,T);return}}t.bindTexture(s.TEXTURE_2D,G.__webglTexture,s.TEXTURE0+T)}function q(L,T){const G=i.get(L);if(L.version>0&&G.__version!==L.version){Se(G,L,T);return}t.bindTexture(s.TEXTURE_2D_ARRAY,G.__webglTexture,s.TEXTURE0+T)}function H(L,T){const G=i.get(L);if(L.version>0&&G.__version!==L.version){Se(G,L,T);return}t.bindTexture(s.TEXTURE_3D,G.__webglTexture,s.TEXTURE0+T)}function te(L,T){const G=i.get(L);if(L.version>0&&G.__version!==L.version){U(G,L,T);return}t.bindTexture(s.TEXTURE_CUBE_MAP,G.__webglTexture,s.TEXTURE0+T)}const X={[Tl]:s.REPEAT,[Ln]:s.CLAMP_TO_EDGE,[Al]:s.MIRRORED_REPEAT},oe={[pi]:s.NEAREST,[im]:s.NEAREST_MIPMAP_NEAREST,[Qr]:s.NEAREST_MIPMAP_LINEAR,[bi]:s.LINEAR,[ya]:s.LINEAR_MIPMAP_NEAREST,[In]:s.LINEAR_MIPMAP_LINEAR},ae={[am]:s.NEVER,[pm]:s.ALWAYS,[lm]:s.LESS,[Iu]:s.LEQUAL,[cm]:s.EQUAL,[um]:s.GEQUAL,[hm]:s.GREATER,[dm]:s.NOTEQUAL};function fe(L,T){if(T.type===Ui&&e.has("OES_texture_float_linear")===!1&&(T.magFilter===bi||T.magFilter===ya||T.magFilter===Qr||T.magFilter===In||T.minFilter===bi||T.minFilter===ya||T.minFilter===Qr||T.minFilter===In)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),s.texParameteri(L,s.TEXTURE_WRAP_S,X[T.wrapS]),s.texParameteri(L,s.TEXTURE_WRAP_T,X[T.wrapT]),(L===s.TEXTURE_3D||L===s.TEXTURE_2D_ARRAY)&&s.texParameteri(L,s.TEXTURE_WRAP_R,X[T.wrapR]),s.texParameteri(L,s.TEXTURE_MAG_FILTER,oe[T.magFilter]),s.texParameteri(L,s.TEXTURE_MIN_FILTER,oe[T.minFilter]),T.compareFunction&&(s.texParameteri(L,s.TEXTURE_COMPARE_MODE,s.COMPARE_REF_TO_TEXTURE),s.texParameteri(L,s.TEXTURE_COMPARE_FUNC,ae[T.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(T.magFilter===pi||T.minFilter!==Qr&&T.minFilter!==In||T.type===Ui&&e.has("OES_texture_float_linear")===!1)return;if(T.anisotropy>1||i.get(T).__currentAnisotropy){const G=e.get("EXT_texture_filter_anisotropic");s.texParameterf(L,G.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(T.anisotropy,n.getMaxAnisotropy())),i.get(T).__currentAnisotropy=T.anisotropy}}}function ze(L,T){let G=!1;L.__webglInit===void 0&&(L.__webglInit=!0,T.addEventListener("dispose",R));const J=T.source;let ie=u.get(J);ie===void 0&&(ie={},u.set(J,ie));const Z=I(T);if(Z!==L.__cacheKey){ie[Z]===void 0&&(ie[Z]={texture:s.createTexture(),usedTimes:0},o.memory.textures++,G=!0),ie[Z].usedTimes++;const xe=ie[L.__cacheKey];xe!==void 0&&(ie[L.__cacheKey].usedTimes--,xe.usedTimes===0&&P(T)),L.__cacheKey=Z,L.__webglTexture=ie[Z].texture}return G}function Se(L,T,G){let J=s.TEXTURE_2D;(T.isDataArrayTexture||T.isCompressedArrayTexture)&&(J=s.TEXTURE_2D_ARRAY),T.isData3DTexture&&(J=s.TEXTURE_3D);const ie=ze(L,T),Z=T.source;t.bindTexture(J,L.__webglTexture,s.TEXTURE0+G);const xe=i.get(Z);if(Z.version!==xe.__version||ie===!0){t.activeTexture(s.TEXTURE0+G);const ce=Qe.getPrimaries(Qe.workingColorSpace),me=T.colorSpace===on?null:Qe.getPrimaries(T.colorSpace),Ye=T.colorSpace===on||ce===me?s.NONE:s.BROWSER_DEFAULT_WEBGL;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,T.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,T.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,T.unpackAlignment),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ye);let ne=_(T.image,!1,n.maxTextureSize);ne=lt(T,ne);const ge=r.convert(T.format,T.colorSpace),Pe=r.convert(T.type);let De=y(T.internalFormat,ge,Pe,T.colorSpace,T.isVideoTexture);fe(J,T);let ve;const He=T.mipmaps,ke=T.isVideoTexture!==!0,rt=xe.__version===void 0||ie===!0,F=Z.dataReady,ue=E(T,ne);if(T.isDepthTexture)De=x(T.format===Ls,T.type),rt&&(ke?t.texStorage2D(s.TEXTURE_2D,1,De,ne.width,ne.height):t.texImage2D(s.TEXTURE_2D,0,De,ne.width,ne.height,0,ge,Pe,null));else if(T.isDataTexture)if(He.length>0){ke&&rt&&t.texStorage2D(s.TEXTURE_2D,ue,De,He[0].width,He[0].height);for(let j=0,ee=He.length;j<ee;j++)ve=He[j],ke?F&&t.texSubImage2D(s.TEXTURE_2D,j,0,0,ve.width,ve.height,ge,Pe,ve.data):t.texImage2D(s.TEXTURE_2D,j,De,ve.width,ve.height,0,ge,Pe,ve.data);T.generateMipmaps=!1}else ke?(rt&&t.texStorage2D(s.TEXTURE_2D,ue,De,ne.width,ne.height),F&&t.texSubImage2D(s.TEXTURE_2D,0,0,0,ne.width,ne.height,ge,Pe,ne.data)):t.texImage2D(s.TEXTURE_2D,0,De,ne.width,ne.height,0,ge,Pe,ne.data);else if(T.isCompressedTexture)if(T.isCompressedArrayTexture){ke&&rt&&t.texStorage3D(s.TEXTURE_2D_ARRAY,ue,De,He[0].width,He[0].height,ne.depth);for(let j=0,ee=He.length;j<ee;j++)if(ve=He[j],T.format!==wi)if(ge!==null)if(ke){if(F)if(T.layerUpdates.size>0){const he=cd(ve.width,ve.height,T.format,T.type);for(const pe of T.layerUpdates){const $e=ve.data.subarray(pe*he/ve.data.BYTES_PER_ELEMENT,(pe+1)*he/ve.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(s.TEXTURE_2D_ARRAY,j,0,0,pe,ve.width,ve.height,1,ge,$e,0,0)}T.clearLayerUpdates()}else t.compressedTexSubImage3D(s.TEXTURE_2D_ARRAY,j,0,0,0,ve.width,ve.height,ne.depth,ge,ve.data,0,0)}else t.compressedTexImage3D(s.TEXTURE_2D_ARRAY,j,De,ve.width,ve.height,ne.depth,0,ve.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else ke?F&&t.texSubImage3D(s.TEXTURE_2D_ARRAY,j,0,0,0,ve.width,ve.height,ne.depth,ge,Pe,ve.data):t.texImage3D(s.TEXTURE_2D_ARRAY,j,De,ve.width,ve.height,ne.depth,0,ge,Pe,ve.data)}else{ke&&rt&&t.texStorage2D(s.TEXTURE_2D,ue,De,He[0].width,He[0].height);for(let j=0,ee=He.length;j<ee;j++)ve=He[j],T.format!==wi?ge!==null?ke?F&&t.compressedTexSubImage2D(s.TEXTURE_2D,j,0,0,ve.width,ve.height,ge,ve.data):t.compressedTexImage2D(s.TEXTURE_2D,j,De,ve.width,ve.height,0,ve.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ke?F&&t.texSubImage2D(s.TEXTURE_2D,j,0,0,ve.width,ve.height,ge,Pe,ve.data):t.texImage2D(s.TEXTURE_2D,j,De,ve.width,ve.height,0,ge,Pe,ve.data)}else if(T.isDataArrayTexture)if(ke){if(rt&&t.texStorage3D(s.TEXTURE_2D_ARRAY,ue,De,ne.width,ne.height,ne.depth),F)if(T.layerUpdates.size>0){const j=cd(ne.width,ne.height,T.format,T.type);for(const ee of T.layerUpdates){const he=ne.data.subarray(ee*j/ne.data.BYTES_PER_ELEMENT,(ee+1)*j/ne.data.BYTES_PER_ELEMENT);t.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,ee,ne.width,ne.height,1,ge,Pe,he)}T.clearLayerUpdates()}else t.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,0,ne.width,ne.height,ne.depth,ge,Pe,ne.data)}else t.texImage3D(s.TEXTURE_2D_ARRAY,0,De,ne.width,ne.height,ne.depth,0,ge,Pe,ne.data);else if(T.isData3DTexture)ke?(rt&&t.texStorage3D(s.TEXTURE_3D,ue,De,ne.width,ne.height,ne.depth),F&&t.texSubImage3D(s.TEXTURE_3D,0,0,0,0,ne.width,ne.height,ne.depth,ge,Pe,ne.data)):t.texImage3D(s.TEXTURE_3D,0,De,ne.width,ne.height,ne.depth,0,ge,Pe,ne.data);else if(T.isFramebufferTexture){if(rt)if(ke)t.texStorage2D(s.TEXTURE_2D,ue,De,ne.width,ne.height);else{let j=ne.width,ee=ne.height;for(let he=0;he<ue;he++)t.texImage2D(s.TEXTURE_2D,he,De,j,ee,0,ge,Pe,null),j>>=1,ee>>=1}}else if(He.length>0){if(ke&&rt){const j=Le(He[0]);t.texStorage2D(s.TEXTURE_2D,ue,De,j.width,j.height)}for(let j=0,ee=He.length;j<ee;j++)ve=He[j],ke?F&&t.texSubImage2D(s.TEXTURE_2D,j,0,0,ge,Pe,ve):t.texImage2D(s.TEXTURE_2D,j,De,ge,Pe,ve);T.generateMipmaps=!1}else if(ke){if(rt){const j=Le(ne);t.texStorage2D(s.TEXTURE_2D,ue,De,j.width,j.height)}F&&t.texSubImage2D(s.TEXTURE_2D,0,0,0,ge,Pe,ne)}else t.texImage2D(s.TEXTURE_2D,0,De,ge,Pe,ne);g(T)&&v(J),xe.__version=Z.version,T.onUpdate&&T.onUpdate(T)}L.__version=T.version}function U(L,T,G){if(T.image.length!==6)return;const J=ze(L,T),ie=T.source;t.bindTexture(s.TEXTURE_CUBE_MAP,L.__webglTexture,s.TEXTURE0+G);const Z=i.get(ie);if(ie.version!==Z.__version||J===!0){t.activeTexture(s.TEXTURE0+G);const xe=Qe.getPrimaries(Qe.workingColorSpace),ce=T.colorSpace===on?null:Qe.getPrimaries(T.colorSpace),me=T.colorSpace===on||xe===ce?s.NONE:s.BROWSER_DEFAULT_WEBGL;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,T.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,T.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,T.unpackAlignment),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,me);const Ye=T.isCompressedTexture||T.image[0].isCompressedTexture,ne=T.image[0]&&T.image[0].isDataTexture,ge=[];for(let ee=0;ee<6;ee++)!Ye&&!ne?ge[ee]=_(T.image[ee],!0,n.maxCubemapSize):ge[ee]=ne?T.image[ee].image:T.image[ee],ge[ee]=lt(T,ge[ee]);const Pe=ge[0],De=r.convert(T.format,T.colorSpace),ve=r.convert(T.type),He=y(T.internalFormat,De,ve,T.colorSpace),ke=T.isVideoTexture!==!0,rt=Z.__version===void 0||J===!0,F=ie.dataReady;let ue=E(T,Pe);fe(s.TEXTURE_CUBE_MAP,T);let j;if(Ye){ke&&rt&&t.texStorage2D(s.TEXTURE_CUBE_MAP,ue,He,Pe.width,Pe.height);for(let ee=0;ee<6;ee++){j=ge[ee].mipmaps;for(let he=0;he<j.length;he++){const pe=j[he];T.format!==wi?De!==null?ke?F&&t.compressedTexSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+ee,he,0,0,pe.width,pe.height,De,pe.data):t.compressedTexImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+ee,he,He,pe.width,pe.height,0,pe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):ke?F&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+ee,he,0,0,pe.width,pe.height,De,ve,pe.data):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+ee,he,He,pe.width,pe.height,0,De,ve,pe.data)}}}else{if(j=T.mipmaps,ke&&rt){j.length>0&&ue++;const ee=Le(ge[0]);t.texStorage2D(s.TEXTURE_CUBE_MAP,ue,He,ee.width,ee.height)}for(let ee=0;ee<6;ee++)if(ne){ke?F&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+ee,0,0,0,ge[ee].width,ge[ee].height,De,ve,ge[ee].data):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+ee,0,He,ge[ee].width,ge[ee].height,0,De,ve,ge[ee].data);for(let he=0;he<j.length;he++){const $e=j[he].image[ee].image;ke?F&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+ee,he+1,0,0,$e.width,$e.height,De,ve,$e.data):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+ee,he+1,He,$e.width,$e.height,0,De,ve,$e.data)}}else{ke?F&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+ee,0,0,0,De,ve,ge[ee]):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+ee,0,He,De,ve,ge[ee]);for(let he=0;he<j.length;he++){const pe=j[he];ke?F&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+ee,he+1,0,0,De,ve,pe.image[ee]):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+ee,he+1,He,De,ve,pe.image[ee])}}}g(T)&&v(s.TEXTURE_CUBE_MAP),Z.__version=ie.version,T.onUpdate&&T.onUpdate(T)}L.__version=T.version}function K(L,T,G,J,ie,Z){const xe=r.convert(G.format,G.colorSpace),ce=r.convert(G.type),me=y(G.internalFormat,xe,ce,G.colorSpace);if(!i.get(T).__hasExternalTextures){const ne=Math.max(1,T.width>>Z),ge=Math.max(1,T.height>>Z);ie===s.TEXTURE_3D||ie===s.TEXTURE_2D_ARRAY?t.texImage3D(ie,Z,me,ne,ge,T.depth,0,xe,ce,null):t.texImage2D(ie,Z,me,ne,ge,0,xe,ce,null)}t.bindFramebuffer(s.FRAMEBUFFER,L),je(T)?a.framebufferTexture2DMultisampleEXT(s.FRAMEBUFFER,J,ie,i.get(G).__webglTexture,0,Ve(T)):(ie===s.TEXTURE_2D||ie>=s.TEXTURE_CUBE_MAP_POSITIVE_X&&ie<=s.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&s.framebufferTexture2D(s.FRAMEBUFFER,J,ie,i.get(G).__webglTexture,Z),t.bindFramebuffer(s.FRAMEBUFFER,null)}function Y(L,T,G){if(s.bindRenderbuffer(s.RENDERBUFFER,L),T.depthBuffer){const J=T.depthTexture,ie=J&&J.isDepthTexture?J.type:null,Z=x(T.stencilBuffer,ie),xe=T.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT,ce=Ve(T);je(T)?a.renderbufferStorageMultisampleEXT(s.RENDERBUFFER,ce,Z,T.width,T.height):G?s.renderbufferStorageMultisample(s.RENDERBUFFER,ce,Z,T.width,T.height):s.renderbufferStorage(s.RENDERBUFFER,Z,T.width,T.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,xe,s.RENDERBUFFER,L)}else{const J=T.textures;for(let ie=0;ie<J.length;ie++){const Z=J[ie],xe=r.convert(Z.format,Z.colorSpace),ce=r.convert(Z.type),me=y(Z.internalFormat,xe,ce,Z.colorSpace),Ye=Ve(T);G&&je(T)===!1?s.renderbufferStorageMultisample(s.RENDERBUFFER,Ye,me,T.width,T.height):je(T)?a.renderbufferStorageMultisampleEXT(s.RENDERBUFFER,Ye,me,T.width,T.height):s.renderbufferStorage(s.RENDERBUFFER,me,T.width,T.height)}}s.bindRenderbuffer(s.RENDERBUFFER,null)}function Q(L,T){if(T&&T.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(s.FRAMEBUFFER,L),!(T.depthTexture&&T.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(T.depthTexture).__webglTexture||T.depthTexture.image.width!==T.width||T.depthTexture.image.height!==T.height)&&(T.depthTexture.image.width=T.width,T.depthTexture.image.height=T.height,T.depthTexture.needsUpdate=!0),V(T.depthTexture,0);const J=i.get(T.depthTexture).__webglTexture,ie=Ve(T);if(T.depthTexture.format===ys)je(T)?a.framebufferTexture2DMultisampleEXT(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,J,0,ie):s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,J,0);else if(T.depthTexture.format===Ls)je(T)?a.framebufferTexture2DMultisampleEXT(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.TEXTURE_2D,J,0,ie):s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.TEXTURE_2D,J,0);else throw new Error("Unknown depthTexture format")}function Me(L){const T=i.get(L),G=L.isWebGLCubeRenderTarget===!0;if(T.__boundDepthTexture!==L.depthTexture){const J=L.depthTexture;if(T.__depthDisposeCallback&&T.__depthDisposeCallback(),J){const ie=()=>{delete T.__boundDepthTexture,delete T.__depthDisposeCallback,J.removeEventListener("dispose",ie)};J.addEventListener("dispose",ie),T.__depthDisposeCallback=ie}T.__boundDepthTexture=J}if(L.depthTexture&&!T.__autoAllocateDepthBuffer){if(G)throw new Error("target.depthTexture not supported in Cube render targets");Q(T.__webglFramebuffer,L)}else if(G){T.__webglDepthbuffer=[];for(let J=0;J<6;J++)if(t.bindFramebuffer(s.FRAMEBUFFER,T.__webglFramebuffer[J]),T.__webglDepthbuffer[J]===void 0)T.__webglDepthbuffer[J]=s.createRenderbuffer(),Y(T.__webglDepthbuffer[J],L,!1);else{const ie=L.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT,Z=T.__webglDepthbuffer[J];s.bindRenderbuffer(s.RENDERBUFFER,Z),s.framebufferRenderbuffer(s.FRAMEBUFFER,ie,s.RENDERBUFFER,Z)}}else if(t.bindFramebuffer(s.FRAMEBUFFER,T.__webglFramebuffer),T.__webglDepthbuffer===void 0)T.__webglDepthbuffer=s.createRenderbuffer(),Y(T.__webglDepthbuffer,L,!1);else{const J=L.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT,ie=T.__webglDepthbuffer;s.bindRenderbuffer(s.RENDERBUFFER,ie),s.framebufferRenderbuffer(s.FRAMEBUFFER,J,s.RENDERBUFFER,ie)}t.bindFramebuffer(s.FRAMEBUFFER,null)}function Ee(L,T,G){const J=i.get(L);T!==void 0&&K(J.__webglFramebuffer,L,L.texture,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,0),G!==void 0&&Me(L)}function Fe(L){const T=L.texture,G=i.get(L),J=i.get(T);L.addEventListener("dispose",M);const ie=L.textures,Z=L.isWebGLCubeRenderTarget===!0,xe=ie.length>1;if(xe||(J.__webglTexture===void 0&&(J.__webglTexture=s.createTexture()),J.__version=T.version,o.memory.textures++),Z){G.__webglFramebuffer=[];for(let ce=0;ce<6;ce++)if(T.mipmaps&&T.mipmaps.length>0){G.__webglFramebuffer[ce]=[];for(let me=0;me<T.mipmaps.length;me++)G.__webglFramebuffer[ce][me]=s.createFramebuffer()}else G.__webglFramebuffer[ce]=s.createFramebuffer()}else{if(T.mipmaps&&T.mipmaps.length>0){G.__webglFramebuffer=[];for(let ce=0;ce<T.mipmaps.length;ce++)G.__webglFramebuffer[ce]=s.createFramebuffer()}else G.__webglFramebuffer=s.createFramebuffer();if(xe)for(let ce=0,me=ie.length;ce<me;ce++){const Ye=i.get(ie[ce]);Ye.__webglTexture===void 0&&(Ye.__webglTexture=s.createTexture(),o.memory.textures++)}if(L.samples>0&&je(L)===!1){G.__webglMultisampledFramebuffer=s.createFramebuffer(),G.__webglColorRenderbuffer=[],t.bindFramebuffer(s.FRAMEBUFFER,G.__webglMultisampledFramebuffer);for(let ce=0;ce<ie.length;ce++){const me=ie[ce];G.__webglColorRenderbuffer[ce]=s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,G.__webglColorRenderbuffer[ce]);const Ye=r.convert(me.format,me.colorSpace),ne=r.convert(me.type),ge=y(me.internalFormat,Ye,ne,me.colorSpace,L.isXRRenderTarget===!0),Pe=Ve(L);s.renderbufferStorageMultisample(s.RENDERBUFFER,Pe,ge,L.width,L.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+ce,s.RENDERBUFFER,G.__webglColorRenderbuffer[ce])}s.bindRenderbuffer(s.RENDERBUFFER,null),L.depthBuffer&&(G.__webglDepthRenderbuffer=s.createRenderbuffer(),Y(G.__webglDepthRenderbuffer,L,!0)),t.bindFramebuffer(s.FRAMEBUFFER,null)}}if(Z){t.bindTexture(s.TEXTURE_CUBE_MAP,J.__webglTexture),fe(s.TEXTURE_CUBE_MAP,T);for(let ce=0;ce<6;ce++)if(T.mipmaps&&T.mipmaps.length>0)for(let me=0;me<T.mipmaps.length;me++)K(G.__webglFramebuffer[ce][me],L,T,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+ce,me);else K(G.__webglFramebuffer[ce],L,T,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+ce,0);g(T)&&v(s.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(xe){for(let ce=0,me=ie.length;ce<me;ce++){const Ye=ie[ce],ne=i.get(Ye);t.bindTexture(s.TEXTURE_2D,ne.__webglTexture),fe(s.TEXTURE_2D,Ye),K(G.__webglFramebuffer,L,Ye,s.COLOR_ATTACHMENT0+ce,s.TEXTURE_2D,0),g(Ye)&&v(s.TEXTURE_2D)}t.unbindTexture()}else{let ce=s.TEXTURE_2D;if((L.isWebGL3DRenderTarget||L.isWebGLArrayRenderTarget)&&(ce=L.isWebGL3DRenderTarget?s.TEXTURE_3D:s.TEXTURE_2D_ARRAY),t.bindTexture(ce,J.__webglTexture),fe(ce,T),T.mipmaps&&T.mipmaps.length>0)for(let me=0;me<T.mipmaps.length;me++)K(G.__webglFramebuffer[me],L,T,s.COLOR_ATTACHMENT0,ce,me);else K(G.__webglFramebuffer,L,T,s.COLOR_ATTACHMENT0,ce,0);g(T)&&v(ce),t.unbindTexture()}L.depthBuffer&&Me(L)}function Be(L){const T=L.textures;for(let G=0,J=T.length;G<J;G++){const ie=T[G];if(g(ie)){const Z=L.isWebGLCubeRenderTarget?s.TEXTURE_CUBE_MAP:s.TEXTURE_2D,xe=i.get(ie).__webglTexture;t.bindTexture(Z,xe),v(Z),t.unbindTexture()}}}const Ge=[],O=[];function Qt(L){if(L.samples>0){if(je(L)===!1){const T=L.textures,G=L.width,J=L.height;let ie=s.COLOR_BUFFER_BIT;const Z=L.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT,xe=i.get(L),ce=T.length>1;if(ce)for(let me=0;me<T.length;me++)t.bindFramebuffer(s.FRAMEBUFFER,xe.__webglMultisampledFramebuffer),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+me,s.RENDERBUFFER,null),t.bindFramebuffer(s.FRAMEBUFFER,xe.__webglFramebuffer),s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0+me,s.TEXTURE_2D,null,0);t.bindFramebuffer(s.READ_FRAMEBUFFER,xe.__webglMultisampledFramebuffer),t.bindFramebuffer(s.DRAW_FRAMEBUFFER,xe.__webglFramebuffer);for(let me=0;me<T.length;me++){if(L.resolveDepthBuffer&&(L.depthBuffer&&(ie|=s.DEPTH_BUFFER_BIT),L.stencilBuffer&&L.resolveStencilBuffer&&(ie|=s.STENCIL_BUFFER_BIT)),ce){s.framebufferRenderbuffer(s.READ_FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.RENDERBUFFER,xe.__webglColorRenderbuffer[me]);const Ye=i.get(T[me]).__webglTexture;s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,Ye,0)}s.blitFramebuffer(0,0,G,J,0,0,G,J,ie,s.NEAREST),l===!0&&(Ge.length=0,O.length=0,Ge.push(s.COLOR_ATTACHMENT0+me),L.depthBuffer&&L.resolveDepthBuffer===!1&&(Ge.push(Z),O.push(Z),s.invalidateFramebuffer(s.DRAW_FRAMEBUFFER,O)),s.invalidateFramebuffer(s.READ_FRAMEBUFFER,Ge))}if(t.bindFramebuffer(s.READ_FRAMEBUFFER,null),t.bindFramebuffer(s.DRAW_FRAMEBUFFER,null),ce)for(let me=0;me<T.length;me++){t.bindFramebuffer(s.FRAMEBUFFER,xe.__webglMultisampledFramebuffer),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+me,s.RENDERBUFFER,xe.__webglColorRenderbuffer[me]);const Ye=i.get(T[me]).__webglTexture;t.bindFramebuffer(s.FRAMEBUFFER,xe.__webglFramebuffer),s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0+me,s.TEXTURE_2D,Ye,0)}t.bindFramebuffer(s.DRAW_FRAMEBUFFER,xe.__webglMultisampledFramebuffer)}else if(L.depthBuffer&&L.resolveDepthBuffer===!1&&l){const T=L.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT;s.invalidateFramebuffer(s.DRAW_FRAMEBUFFER,[T])}}}function Ve(L){return Math.min(n.maxSamples,L.samples)}function je(L){const T=i.get(L);return L.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&T.__useRenderToTexture!==!1}function Re(L){const T=o.render.frame;h.get(L)!==T&&(h.set(L,T),L.update())}function lt(L,T){const G=L.colorSpace,J=L.format,ie=L.type;return L.isCompressedTexture===!0||L.isVideoTexture===!0||G!==vn&&G!==on&&(Qe.getTransfer(G)===ht?(J!==wi||ie!==Gi)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",G)),T}function Le(L){return typeof HTMLImageElement<"u"&&L instanceof HTMLImageElement?(c.width=L.naturalWidth||L.width,c.height=L.naturalHeight||L.height):typeof VideoFrame<"u"&&L instanceof VideoFrame?(c.width=L.displayWidth,c.height=L.displayHeight):(c.width=L.width,c.height=L.height),c}this.allocateTextureUnit=D,this.resetTextureUnits=S,this.setTexture2D=V,this.setTexture2DArray=q,this.setTexture3D=H,this.setTextureCube=te,this.rebindTextures=Ee,this.setupRenderTarget=Fe,this.updateRenderTargetMipmap=Be,this.updateMultisampleRenderTarget=Qt,this.setupDepthRenderbuffer=Me,this.setupFrameBufferTexture=K,this.useMultisampledRTT=je}function Nb(s,e){function t(i,n=on){let r;const o=Qe.getTransfer(n);if(i===Gi)return s.UNSIGNED_BYTE;if(i===bc)return s.UNSIGNED_SHORT_4_4_4_4;if(i===xc)return s.UNSIGNED_SHORT_5_5_5_1;if(i===Mu)return s.UNSIGNED_INT_5_9_9_9_REV;if(i===Su)return s.BYTE;if(i===Eu)return s.SHORT;if(i===mr)return s.UNSIGNED_SHORT;if(i===_c)return s.INT;if(i===Un)return s.UNSIGNED_INT;if(i===Ui)return s.FLOAT;if(i===Lr)return s.HALF_FLOAT;if(i===Cu)return s.ALPHA;if(i===Tu)return s.RGB;if(i===wi)return s.RGBA;if(i===Au)return s.LUMINANCE;if(i===Ru)return s.LUMINANCE_ALPHA;if(i===ys)return s.DEPTH_COMPONENT;if(i===Ls)return s.DEPTH_STENCIL;if(i===Pu)return s.RED;if(i===wc)return s.RED_INTEGER;if(i===Du)return s.RG;if(i===yc)return s.RG_INTEGER;if(i===Sc)return s.RGBA_INTEGER;if(i===Oo||i===Fo||i===Uo||i===zo)if(o===ht)if(r=e.get("WEBGL_compressed_texture_s3tc_srgb"),r!==null){if(i===Oo)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===Fo)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===Uo)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===zo)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(r=e.get("WEBGL_compressed_texture_s3tc"),r!==null){if(i===Oo)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===Fo)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===Uo)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===zo)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===Rl||i===Pl||i===Dl||i===Ll)if(r=e.get("WEBGL_compressed_texture_pvrtc"),r!==null){if(i===Rl)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===Pl)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===Dl)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===Ll)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===Il||i===kl||i===Nl)if(r=e.get("WEBGL_compressed_texture_etc"),r!==null){if(i===Il||i===kl)return o===ht?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(i===Nl)return o===ht?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(i===Ol||i===Fl||i===Ul||i===zl||i===Bl||i===Vl||i===Hl||i===Gl||i===$l||i===Wl||i===Xl||i===jl||i===Yl||i===ql)if(r=e.get("WEBGL_compressed_texture_astc"),r!==null){if(i===Ol)return o===ht?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===Fl)return o===ht?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===Ul)return o===ht?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===zl)return o===ht?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===Bl)return o===ht?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===Vl)return o===ht?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===Hl)return o===ht?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===Gl)return o===ht?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===$l)return o===ht?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===Wl)return o===ht?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===Xl)return o===ht?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===jl)return o===ht?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===Yl)return o===ht?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===ql)return o===ht?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===Bo||i===Kl||i===Zl)if(r=e.get("EXT_texture_compression_bptc"),r!==null){if(i===Bo)return o===ht?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===Kl)return r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===Zl)return r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(i===Lu||i===Jl||i===Ql||i===ec)if(r=e.get("EXT_texture_compression_rgtc"),r!==null){if(i===Bo)return r.COMPRESSED_RED_RGTC1_EXT;if(i===Jl)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===Ql)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===ec)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return i===Ds?s.UNSIGNED_INT_24_8:s[i]!==void 0?s[i]:null}return{convert:t}}class Ob extends di{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Bt extends Lt{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Fb={type:"move"};class Ka{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Bt,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Bt,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new k,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new k),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Bt,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new k,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new k),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let n=null,r=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){o=!0;for(const _ of e.hand.values()){const g=t.getJointPose(_,i),v=this._getHandJoint(c,_);g!==null&&(v.matrix.fromArray(g.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.matrixWorldNeedsUpdate=!0,v.jointRadius=g.radius),v.visible=g!==null}const h=c.joints["index-finger-tip"],d=c.joints["thumb-tip"],u=h.position.distanceTo(d.position),m=.02,f=.005;c.inputState.pinching&&u>m+f?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&u<=m-f&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,i),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(n=t.getPose(e.targetRaySpace,i),n===null&&r!==null&&(n=r),n!==null&&(a.matrix.fromArray(n.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,n.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(n.linearVelocity)):a.hasLinearVelocity=!1,n.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(n.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Fb)))}return a!==null&&(a.visible=n!==null),l!==null&&(l.visible=r!==null),c!==null&&(c.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const i=new Bt;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}const Ub=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,zb=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class Bb{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,i){if(this.texture===null){const n=new Vt,r=e.properties.get(n);r.__webglTexture=t.texture,(t.depthNear!=i.depthNear||t.depthFar!=i.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=n}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,i=new fn({vertexShader:Ub,fragmentShader:zb,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new Ft(new Or(20,20),i)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class Vb extends Xn{constructor(e,t){super();const i=this;let n=null,r=1,o=null,a="local-floor",l=1,c=null,h=null,d=null,u=null,m=null,f=null;const _=new Bb,g=t.getContextAttributes();let v=null,y=null;const x=[],E=[],R=new le;let M=null;const C=new di;C.layers.enable(1),C.viewport=new wt;const P=new di;P.layers.enable(2),P.viewport=new wt;const N=[C,P],w=new Ob;w.layers.enable(1),w.layers.enable(2);let S=null,D=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(U){let K=x[U];return K===void 0&&(K=new Ka,x[U]=K),K.getTargetRaySpace()},this.getControllerGrip=function(U){let K=x[U];return K===void 0&&(K=new Ka,x[U]=K),K.getGripSpace()},this.getHand=function(U){let K=x[U];return K===void 0&&(K=new Ka,x[U]=K),K.getHandSpace()};function I(U){const K=E.indexOf(U.inputSource);if(K===-1)return;const Y=x[K];Y!==void 0&&(Y.update(U.inputSource,U.frame,c||o),Y.dispatchEvent({type:U.type,data:U.inputSource}))}function V(){n.removeEventListener("select",I),n.removeEventListener("selectstart",I),n.removeEventListener("selectend",I),n.removeEventListener("squeeze",I),n.removeEventListener("squeezestart",I),n.removeEventListener("squeezeend",I),n.removeEventListener("end",V),n.removeEventListener("inputsourceschange",q);for(let U=0;U<x.length;U++){const K=E[U];K!==null&&(E[U]=null,x[U].disconnect(K))}S=null,D=null,_.reset(),e.setRenderTarget(v),m=null,u=null,d=null,n=null,y=null,Se.stop(),i.isPresenting=!1,e.setPixelRatio(M),e.setSize(R.width,R.height,!1),i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(U){r=U,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(U){a=U,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||o},this.setReferenceSpace=function(U){c=U},this.getBaseLayer=function(){return u!==null?u:m},this.getBinding=function(){return d},this.getFrame=function(){return f},this.getSession=function(){return n},this.setSession=async function(U){if(n=U,n!==null){if(v=e.getRenderTarget(),n.addEventListener("select",I),n.addEventListener("selectstart",I),n.addEventListener("selectend",I),n.addEventListener("squeeze",I),n.addEventListener("squeezestart",I),n.addEventListener("squeezeend",I),n.addEventListener("end",V),n.addEventListener("inputsourceschange",q),g.xrCompatible!==!0&&await t.makeXRCompatible(),M=e.getPixelRatio(),e.getSize(R),n.renderState.layers===void 0){const K={antialias:g.antialias,alpha:!0,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:r};m=new XRWebGLLayer(n,t,K),n.updateRenderState({baseLayer:m}),e.setPixelRatio(1),e.setSize(m.framebufferWidth,m.framebufferHeight,!1),y=new zn(m.framebufferWidth,m.framebufferHeight,{format:wi,type:Gi,colorSpace:e.outputColorSpace,stencilBuffer:g.stencil})}else{let K=null,Y=null,Q=null;g.depth&&(Q=g.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,K=g.stencil?Ls:ys,Y=g.stencil?Ds:Un);const Me={colorFormat:t.RGBA8,depthFormat:Q,scaleFactor:r};d=new XRWebGLBinding(n,t),u=d.createProjectionLayer(Me),n.updateRenderState({layers:[u]}),e.setPixelRatio(1),e.setSize(u.textureWidth,u.textureHeight,!1),y=new zn(u.textureWidth,u.textureHeight,{format:wi,type:Gi,depthTexture:new Wu(u.textureWidth,u.textureHeight,Y,void 0,void 0,void 0,void 0,void 0,void 0,K),stencilBuffer:g.stencil,colorSpace:e.outputColorSpace,samples:g.antialias?4:0,resolveDepthBuffer:u.ignoreDepthValues===!1})}y.isXRRenderTarget=!0,this.setFoveation(l),c=null,o=await n.requestReferenceSpace(a),Se.setContext(n),Se.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(n!==null)return n.environmentBlendMode},this.getDepthTexture=function(){return _.getDepthTexture()};function q(U){for(let K=0;K<U.removed.length;K++){const Y=U.removed[K],Q=E.indexOf(Y);Q>=0&&(E[Q]=null,x[Q].disconnect(Y))}for(let K=0;K<U.added.length;K++){const Y=U.added[K];let Q=E.indexOf(Y);if(Q===-1){for(let Ee=0;Ee<x.length;Ee++)if(Ee>=E.length){E.push(Y),Q=Ee;break}else if(E[Ee]===null){E[Ee]=Y,Q=Ee;break}if(Q===-1)break}const Me=x[Q];Me&&Me.connect(Y)}}const H=new k,te=new k;function X(U,K,Y){H.setFromMatrixPosition(K.matrixWorld),te.setFromMatrixPosition(Y.matrixWorld);const Q=H.distanceTo(te),Me=K.projectionMatrix.elements,Ee=Y.projectionMatrix.elements,Fe=Me[14]/(Me[10]-1),Be=Me[14]/(Me[10]+1),Ge=(Me[9]+1)/Me[5],O=(Me[9]-1)/Me[5],Qt=(Me[8]-1)/Me[0],Ve=(Ee[8]+1)/Ee[0],je=Fe*Qt,Re=Fe*Ve,lt=Q/(-Qt+Ve),Le=lt*-Qt;if(K.matrixWorld.decompose(U.position,U.quaternion,U.scale),U.translateX(Le),U.translateZ(lt),U.matrixWorld.compose(U.position,U.quaternion,U.scale),U.matrixWorldInverse.copy(U.matrixWorld).invert(),Me[10]===-1)U.projectionMatrix.copy(K.projectionMatrix),U.projectionMatrixInverse.copy(K.projectionMatrixInverse);else{const L=Fe+lt,T=Be+lt,G=je-Le,J=Re+(Q-Le),ie=Ge*Be/T*L,Z=O*Be/T*L;U.projectionMatrix.makePerspective(G,J,ie,Z,L,T),U.projectionMatrixInverse.copy(U.projectionMatrix).invert()}}function oe(U,K){K===null?U.matrixWorld.copy(U.matrix):U.matrixWorld.multiplyMatrices(K.matrixWorld,U.matrix),U.matrixWorldInverse.copy(U.matrixWorld).invert()}this.updateCamera=function(U){if(n===null)return;let K=U.near,Y=U.far;_.texture!==null&&(_.depthNear>0&&(K=_.depthNear),_.depthFar>0&&(Y=_.depthFar)),w.near=P.near=C.near=K,w.far=P.far=C.far=Y,(S!==w.near||D!==w.far)&&(n.updateRenderState({depthNear:w.near,depthFar:w.far}),S=w.near,D=w.far);const Q=U.parent,Me=w.cameras;oe(w,Q);for(let Ee=0;Ee<Me.length;Ee++)oe(Me[Ee],Q);Me.length===2?X(w,C,P):w.projectionMatrix.copy(C.projectionMatrix),ae(U,w,Q)};function ae(U,K,Y){Y===null?U.matrix.copy(K.matrixWorld):(U.matrix.copy(Y.matrixWorld),U.matrix.invert(),U.matrix.multiply(K.matrixWorld)),U.matrix.decompose(U.position,U.quaternion,U.scale),U.updateMatrixWorld(!0),U.projectionMatrix.copy(K.projectionMatrix),U.projectionMatrixInverse.copy(K.projectionMatrixInverse),U.isPerspectiveCamera&&(U.fov=gr*2*Math.atan(1/U.projectionMatrix.elements[5]),U.zoom=1)}this.getCamera=function(){return w},this.getFoveation=function(){if(!(u===null&&m===null))return l},this.setFoveation=function(U){l=U,u!==null&&(u.fixedFoveation=U),m!==null&&m.fixedFoveation!==void 0&&(m.fixedFoveation=U)},this.hasDepthSensing=function(){return _.texture!==null},this.getDepthSensingMesh=function(){return _.getMesh(w)};let fe=null;function ze(U,K){if(h=K.getViewerPose(c||o),f=K,h!==null){const Y=h.views;m!==null&&(e.setRenderTargetFramebuffer(y,m.framebuffer),e.setRenderTarget(y));let Q=!1;Y.length!==w.cameras.length&&(w.cameras.length=0,Q=!0);for(let Ee=0;Ee<Y.length;Ee++){const Fe=Y[Ee];let Be=null;if(m!==null)Be=m.getViewport(Fe);else{const O=d.getViewSubImage(u,Fe);Be=O.viewport,Ee===0&&(e.setRenderTargetTextures(y,O.colorTexture,u.ignoreDepthValues?void 0:O.depthStencilTexture),e.setRenderTarget(y))}let Ge=N[Ee];Ge===void 0&&(Ge=new di,Ge.layers.enable(Ee),Ge.viewport=new wt,N[Ee]=Ge),Ge.matrix.fromArray(Fe.transform.matrix),Ge.matrix.decompose(Ge.position,Ge.quaternion,Ge.scale),Ge.projectionMatrix.fromArray(Fe.projectionMatrix),Ge.projectionMatrixInverse.copy(Ge.projectionMatrix).invert(),Ge.viewport.set(Be.x,Be.y,Be.width,Be.height),Ee===0&&(w.matrix.copy(Ge.matrix),w.matrix.decompose(w.position,w.quaternion,w.scale)),Q===!0&&w.cameras.push(Ge)}const Me=n.enabledFeatures;if(Me&&Me.includes("depth-sensing")){const Ee=d.getDepthInformation(Y[0]);Ee&&Ee.isValid&&Ee.texture&&_.init(e,Ee,n.renderState)}}for(let Y=0;Y<x.length;Y++){const Q=E[Y],Me=x[Y];Q!==null&&Me!==void 0&&Me.update(Q,K,c||o)}fe&&fe(U,K),K.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:K}),f=null}const Se=new $u;Se.setAnimationLoop(ze),this.setAnimationLoop=function(U){fe=U},this.dispose=function(){}}}const Mn=new $i,Hb=new at;function Gb(s,e){function t(g,v){g.matrixAutoUpdate===!0&&g.updateMatrix(),v.value.copy(g.matrix)}function i(g,v){v.color.getRGB(g.fogColor.value,Bu(s)),v.isFog?(g.fogNear.value=v.near,g.fogFar.value=v.far):v.isFogExp2&&(g.fogDensity.value=v.density)}function n(g,v,y,x,E){v.isMeshBasicMaterial||v.isMeshLambertMaterial?r(g,v):v.isMeshToonMaterial?(r(g,v),d(g,v)):v.isMeshPhongMaterial?(r(g,v),h(g,v)):v.isMeshStandardMaterial?(r(g,v),u(g,v),v.isMeshPhysicalMaterial&&m(g,v,E)):v.isMeshMatcapMaterial?(r(g,v),f(g,v)):v.isMeshDepthMaterial?r(g,v):v.isMeshDistanceMaterial?(r(g,v),_(g,v)):v.isMeshNormalMaterial?r(g,v):v.isLineBasicMaterial?(o(g,v),v.isLineDashedMaterial&&a(g,v)):v.isPointsMaterial?l(g,v,y,x):v.isSpriteMaterial?c(g,v):v.isShadowMaterial?(g.color.value.copy(v.color),g.opacity.value=v.opacity):v.isShaderMaterial&&(v.uniformsNeedUpdate=!1)}function r(g,v){g.opacity.value=v.opacity,v.color&&g.diffuse.value.copy(v.color),v.emissive&&g.emissive.value.copy(v.emissive).multiplyScalar(v.emissiveIntensity),v.map&&(g.map.value=v.map,t(v.map,g.mapTransform)),v.alphaMap&&(g.alphaMap.value=v.alphaMap,t(v.alphaMap,g.alphaMapTransform)),v.bumpMap&&(g.bumpMap.value=v.bumpMap,t(v.bumpMap,g.bumpMapTransform),g.bumpScale.value=v.bumpScale,v.side===Zt&&(g.bumpScale.value*=-1)),v.normalMap&&(g.normalMap.value=v.normalMap,t(v.normalMap,g.normalMapTransform),g.normalScale.value.copy(v.normalScale),v.side===Zt&&g.normalScale.value.negate()),v.displacementMap&&(g.displacementMap.value=v.displacementMap,t(v.displacementMap,g.displacementMapTransform),g.displacementScale.value=v.displacementScale,g.displacementBias.value=v.displacementBias),v.emissiveMap&&(g.emissiveMap.value=v.emissiveMap,t(v.emissiveMap,g.emissiveMapTransform)),v.specularMap&&(g.specularMap.value=v.specularMap,t(v.specularMap,g.specularMapTransform)),v.alphaTest>0&&(g.alphaTest.value=v.alphaTest);const y=e.get(v),x=y.envMap,E=y.envMapRotation;x&&(g.envMap.value=x,Mn.copy(E),Mn.x*=-1,Mn.y*=-1,Mn.z*=-1,x.isCubeTexture&&x.isRenderTargetTexture===!1&&(Mn.y*=-1,Mn.z*=-1),g.envMapRotation.value.setFromMatrix4(Hb.makeRotationFromEuler(Mn)),g.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,g.reflectivity.value=v.reflectivity,g.ior.value=v.ior,g.refractionRatio.value=v.refractionRatio),v.lightMap&&(g.lightMap.value=v.lightMap,g.lightMapIntensity.value=v.lightMapIntensity,t(v.lightMap,g.lightMapTransform)),v.aoMap&&(g.aoMap.value=v.aoMap,g.aoMapIntensity.value=v.aoMapIntensity,t(v.aoMap,g.aoMapTransform))}function o(g,v){g.diffuse.value.copy(v.color),g.opacity.value=v.opacity,v.map&&(g.map.value=v.map,t(v.map,g.mapTransform))}function a(g,v){g.dashSize.value=v.dashSize,g.totalSize.value=v.dashSize+v.gapSize,g.scale.value=v.scale}function l(g,v,y,x){g.diffuse.value.copy(v.color),g.opacity.value=v.opacity,g.size.value=v.size*y,g.scale.value=x*.5,v.map&&(g.map.value=v.map,t(v.map,g.uvTransform)),v.alphaMap&&(g.alphaMap.value=v.alphaMap,t(v.alphaMap,g.alphaMapTransform)),v.alphaTest>0&&(g.alphaTest.value=v.alphaTest)}function c(g,v){g.diffuse.value.copy(v.color),g.opacity.value=v.opacity,g.rotation.value=v.rotation,v.map&&(g.map.value=v.map,t(v.map,g.mapTransform)),v.alphaMap&&(g.alphaMap.value=v.alphaMap,t(v.alphaMap,g.alphaMapTransform)),v.alphaTest>0&&(g.alphaTest.value=v.alphaTest)}function h(g,v){g.specular.value.copy(v.specular),g.shininess.value=Math.max(v.shininess,1e-4)}function d(g,v){v.gradientMap&&(g.gradientMap.value=v.gradientMap)}function u(g,v){g.metalness.value=v.metalness,v.metalnessMap&&(g.metalnessMap.value=v.metalnessMap,t(v.metalnessMap,g.metalnessMapTransform)),g.roughness.value=v.roughness,v.roughnessMap&&(g.roughnessMap.value=v.roughnessMap,t(v.roughnessMap,g.roughnessMapTransform)),v.envMap&&(g.envMapIntensity.value=v.envMapIntensity)}function m(g,v,y){g.ior.value=v.ior,v.sheen>0&&(g.sheenColor.value.copy(v.sheenColor).multiplyScalar(v.sheen),g.sheenRoughness.value=v.sheenRoughness,v.sheenColorMap&&(g.sheenColorMap.value=v.sheenColorMap,t(v.sheenColorMap,g.sheenColorMapTransform)),v.sheenRoughnessMap&&(g.sheenRoughnessMap.value=v.sheenRoughnessMap,t(v.sheenRoughnessMap,g.sheenRoughnessMapTransform))),v.clearcoat>0&&(g.clearcoat.value=v.clearcoat,g.clearcoatRoughness.value=v.clearcoatRoughness,v.clearcoatMap&&(g.clearcoatMap.value=v.clearcoatMap,t(v.clearcoatMap,g.clearcoatMapTransform)),v.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=v.clearcoatRoughnessMap,t(v.clearcoatRoughnessMap,g.clearcoatRoughnessMapTransform)),v.clearcoatNormalMap&&(g.clearcoatNormalMap.value=v.clearcoatNormalMap,t(v.clearcoatNormalMap,g.clearcoatNormalMapTransform),g.clearcoatNormalScale.value.copy(v.clearcoatNormalScale),v.side===Zt&&g.clearcoatNormalScale.value.negate())),v.dispersion>0&&(g.dispersion.value=v.dispersion),v.iridescence>0&&(g.iridescence.value=v.iridescence,g.iridescenceIOR.value=v.iridescenceIOR,g.iridescenceThicknessMinimum.value=v.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=v.iridescenceThicknessRange[1],v.iridescenceMap&&(g.iridescenceMap.value=v.iridescenceMap,t(v.iridescenceMap,g.iridescenceMapTransform)),v.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=v.iridescenceThicknessMap,t(v.iridescenceThicknessMap,g.iridescenceThicknessMapTransform))),v.transmission>0&&(g.transmission.value=v.transmission,g.transmissionSamplerMap.value=y.texture,g.transmissionSamplerSize.value.set(y.width,y.height),v.transmissionMap&&(g.transmissionMap.value=v.transmissionMap,t(v.transmissionMap,g.transmissionMapTransform)),g.thickness.value=v.thickness,v.thicknessMap&&(g.thicknessMap.value=v.thicknessMap,t(v.thicknessMap,g.thicknessMapTransform)),g.attenuationDistance.value=v.attenuationDistance,g.attenuationColor.value.copy(v.attenuationColor)),v.anisotropy>0&&(g.anisotropyVector.value.set(v.anisotropy*Math.cos(v.anisotropyRotation),v.anisotropy*Math.sin(v.anisotropyRotation)),v.anisotropyMap&&(g.anisotropyMap.value=v.anisotropyMap,t(v.anisotropyMap,g.anisotropyMapTransform))),g.specularIntensity.value=v.specularIntensity,g.specularColor.value.copy(v.specularColor),v.specularColorMap&&(g.specularColorMap.value=v.specularColorMap,t(v.specularColorMap,g.specularColorMapTransform)),v.specularIntensityMap&&(g.specularIntensityMap.value=v.specularIntensityMap,t(v.specularIntensityMap,g.specularIntensityMapTransform))}function f(g,v){v.matcap&&(g.matcap.value=v.matcap)}function _(g,v){const y=e.get(v).light;g.referencePosition.value.setFromMatrixPosition(y.matrixWorld),g.nearDistance.value=y.shadow.camera.near,g.farDistance.value=y.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:n}}function $b(s,e,t,i){let n={},r={},o=[];const a=s.getParameter(s.MAX_UNIFORM_BUFFER_BINDINGS);function l(y,x){const E=x.program;i.uniformBlockBinding(y,E)}function c(y,x){let E=n[y.id];E===void 0&&(f(y),E=h(y),n[y.id]=E,y.addEventListener("dispose",g));const R=x.program;i.updateUBOMapping(y,R);const M=e.render.frame;r[y.id]!==M&&(u(y),r[y.id]=M)}function h(y){const x=d();y.__bindingPointIndex=x;const E=s.createBuffer(),R=y.__size,M=y.usage;return s.bindBuffer(s.UNIFORM_BUFFER,E),s.bufferData(s.UNIFORM_BUFFER,R,M),s.bindBuffer(s.UNIFORM_BUFFER,null),s.bindBufferBase(s.UNIFORM_BUFFER,x,E),E}function d(){for(let y=0;y<a;y++)if(o.indexOf(y)===-1)return o.push(y),y;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function u(y){const x=n[y.id],E=y.uniforms,R=y.__cache;s.bindBuffer(s.UNIFORM_BUFFER,x);for(let M=0,C=E.length;M<C;M++){const P=Array.isArray(E[M])?E[M]:[E[M]];for(let N=0,w=P.length;N<w;N++){const S=P[N];if(m(S,M,N,R)===!0){const D=S.__offset,I=Array.isArray(S.value)?S.value:[S.value];let V=0;for(let q=0;q<I.length;q++){const H=I[q],te=_(H);typeof H=="number"||typeof H=="boolean"?(S.__data[0]=H,s.bufferSubData(s.UNIFORM_BUFFER,D+V,S.__data)):H.isMatrix3?(S.__data[0]=H.elements[0],S.__data[1]=H.elements[1],S.__data[2]=H.elements[2],S.__data[3]=0,S.__data[4]=H.elements[3],S.__data[5]=H.elements[4],S.__data[6]=H.elements[5],S.__data[7]=0,S.__data[8]=H.elements[6],S.__data[9]=H.elements[7],S.__data[10]=H.elements[8],S.__data[11]=0):(H.toArray(S.__data,V),V+=te.storage/Float32Array.BYTES_PER_ELEMENT)}s.bufferSubData(s.UNIFORM_BUFFER,D,S.__data)}}}s.bindBuffer(s.UNIFORM_BUFFER,null)}function m(y,x,E,R){const M=y.value,C=x+"_"+E;if(R[C]===void 0)return typeof M=="number"||typeof M=="boolean"?R[C]=M:R[C]=M.clone(),!0;{const P=R[C];if(typeof M=="number"||typeof M=="boolean"){if(P!==M)return R[C]=M,!0}else if(P.equals(M)===!1)return P.copy(M),!0}return!1}function f(y){const x=y.uniforms;let E=0;const R=16;for(let C=0,P=x.length;C<P;C++){const N=Array.isArray(x[C])?x[C]:[x[C]];for(let w=0,S=N.length;w<S;w++){const D=N[w],I=Array.isArray(D.value)?D.value:[D.value];for(let V=0,q=I.length;V<q;V++){const H=I[V],te=_(H),X=E%R,oe=X%te.boundary,ae=X+oe;E+=oe,ae!==0&&R-ae<te.storage&&(E+=R-ae),D.__data=new Float32Array(te.storage/Float32Array.BYTES_PER_ELEMENT),D.__offset=E,E+=te.storage}}}const M=E%R;return M>0&&(E+=R-M),y.__size=E,y.__cache={},this}function _(y){const x={boundary:0,storage:0};return typeof y=="number"||typeof y=="boolean"?(x.boundary=4,x.storage=4):y.isVector2?(x.boundary=8,x.storage=8):y.isVector3||y.isColor?(x.boundary=16,x.storage=12):y.isVector4?(x.boundary=16,x.storage=16):y.isMatrix3?(x.boundary=48,x.storage=48):y.isMatrix4?(x.boundary=64,x.storage=64):y.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",y),x}function g(y){const x=y.target;x.removeEventListener("dispose",g);const E=o.indexOf(x.__bindingPointIndex);o.splice(E,1),s.deleteBuffer(n[x.id]),delete n[x.id],delete r[x.id]}function v(){for(const y in n)s.deleteBuffer(n[y]);o=[],n={},r={}}return{bind:l,update:c,dispose:v}}class Wb{constructor(e={}){const{canvas:t=Dm(),context:i=null,depth:n=!0,stencil:r=!1,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:h="default",failIfMajorPerformanceCaveat:d=!1}=e;this.isWebGLRenderer=!0;let u;if(i!==null){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");u=i.getContextAttributes().alpha}else u=o;const m=new Uint32Array(4),f=new Int32Array(4);let _=null,g=null;const v=[],y=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Si,this.toneMapping=dn,this.toneMappingExposure=1;const x=this;let E=!1,R=0,M=0,C=null,P=-1,N=null;const w=new wt,S=new wt;let D=null;const I=new We(0);let V=0,q=t.width,H=t.height,te=1,X=null,oe=null;const ae=new wt(0,0,q,H),fe=new wt(0,0,q,H);let ze=!1;const Se=new Gu;let U=!1,K=!1;const Y=new at,Q=new at,Me=new k,Ee=new wt,Fe={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Be=!1;function Ge(){return C===null?te:1}let O=i;function Qt(A,z){return t.getContext(A,z)}try{const A={alpha:!0,depth:n,stencil:r,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:h,failIfMajorPerformanceCaveat:d};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${vc}`),t.addEventListener("webglcontextlost",ee,!1),t.addEventListener("webglcontextrestored",he,!1),t.addEventListener("webglcontextcreationerror",pe,!1),O===null){const z="webgl2";if(O=Qt(z,A),O===null)throw Qt(z)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(A){throw console.error("THREE.WebGLRenderer: "+A.message),A}let Ve,je,Re,lt,Le,L,T,G,J,ie,Z,xe,ce,me,Ye,ne,ge,Pe,De,ve,He,ke,rt,F;function ue(){Ve=new K0(O),Ve.init(),ke=new Nb(O,Ve),je=new G0(O,Ve,e,ke),Re=new Lb(O),je.reverseDepthBuffer&&Re.buffers.depth.setReversed(!0),lt=new Q0(O),Le=new vb,L=new kb(O,Ve,Re,Le,je,ke,lt),T=new W0(x),G=new q0(x),J=new rg(O),rt=new V0(O,J),ie=new Z0(O,J,lt,rt),Z=new t_(O,ie,J,lt),De=new e_(O,je,L),ne=new $0(Le),xe=new gb(x,T,G,Ve,je,rt,ne),ce=new Gb(x,Le),me=new bb,Ye=new Mb(Ve),Pe=new B0(x,T,G,Re,Z,u,l),ge=new Pb(x,Z,je),F=new $b(O,lt,je,Re),ve=new H0(O,Ve,lt),He=new J0(O,Ve,lt),lt.programs=xe.programs,x.capabilities=je,x.extensions=Ve,x.properties=Le,x.renderLists=me,x.shadowMap=ge,x.state=Re,x.info=lt}ue();const j=new Vb(x,O);this.xr=j,this.getContext=function(){return O},this.getContextAttributes=function(){return O.getContextAttributes()},this.forceContextLoss=function(){const A=Ve.get("WEBGL_lose_context");A&&A.loseContext()},this.forceContextRestore=function(){const A=Ve.get("WEBGL_lose_context");A&&A.restoreContext()},this.getPixelRatio=function(){return te},this.setPixelRatio=function(A){A!==void 0&&(te=A,this.setSize(q,H,!1))},this.getSize=function(A){return A.set(q,H)},this.setSize=function(A,z,$=!0){if(j.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}q=A,H=z,t.width=Math.floor(A*te),t.height=Math.floor(z*te),$===!0&&(t.style.width=A+"px",t.style.height=z+"px"),this.setViewport(0,0,A,z)},this.getDrawingBufferSize=function(A){return A.set(q*te,H*te).floor()},this.setDrawingBufferSize=function(A,z,$){q=A,H=z,te=$,t.width=Math.floor(A*$),t.height=Math.floor(z*$),this.setViewport(0,0,A,z)},this.getCurrentViewport=function(A){return A.copy(w)},this.getViewport=function(A){return A.copy(ae)},this.setViewport=function(A,z,$,W){A.isVector4?ae.set(A.x,A.y,A.z,A.w):ae.set(A,z,$,W),Re.viewport(w.copy(ae).multiplyScalar(te).round())},this.getScissor=function(A){return A.copy(fe)},this.setScissor=function(A,z,$,W){A.isVector4?fe.set(A.x,A.y,A.z,A.w):fe.set(A,z,$,W),Re.scissor(S.copy(fe).multiplyScalar(te).round())},this.getScissorTest=function(){return ze},this.setScissorTest=function(A){Re.setScissorTest(ze=A)},this.setOpaqueSort=function(A){X=A},this.setTransparentSort=function(A){oe=A},this.getClearColor=function(A){return A.copy(Pe.getClearColor())},this.setClearColor=function(){Pe.setClearColor.apply(Pe,arguments)},this.getClearAlpha=function(){return Pe.getClearAlpha()},this.setClearAlpha=function(){Pe.setClearAlpha.apply(Pe,arguments)},this.clear=function(A=!0,z=!0,$=!0){let W=0;if(A){let B=!1;if(C!==null){const se=C.texture.format;B=se===Sc||se===yc||se===wc}if(B){const se=C.texture.type,de=se===Gi||se===Un||se===mr||se===Ds||se===bc||se===xc,_e=Pe.getClearColor(),be=Pe.getClearAlpha(),Ce=_e.r,Te=_e.g,we=_e.b;de?(m[0]=Ce,m[1]=Te,m[2]=we,m[3]=be,O.clearBufferuiv(O.COLOR,0,m)):(f[0]=Ce,f[1]=Te,f[2]=we,f[3]=be,O.clearBufferiv(O.COLOR,0,f))}else W|=O.COLOR_BUFFER_BIT}z&&(W|=O.DEPTH_BUFFER_BIT,O.clearDepth(this.capabilities.reverseDepthBuffer?0:1)),$&&(W|=O.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),O.clear(W)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ee,!1),t.removeEventListener("webglcontextrestored",he,!1),t.removeEventListener("webglcontextcreationerror",pe,!1),me.dispose(),Ye.dispose(),Le.dispose(),T.dispose(),G.dispose(),Z.dispose(),rt.dispose(),F.dispose(),xe.dispose(),j.dispose(),j.removeEventListener("sessionstart",ah),j.removeEventListener("sessionend",lh),bn.stop()};function ee(A){A.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),E=!0}function he(){console.log("THREE.WebGLRenderer: Context Restored."),E=!1;const A=lt.autoReset,z=ge.enabled,$=ge.autoUpdate,W=ge.needsUpdate,B=ge.type;ue(),lt.autoReset=A,ge.enabled=z,ge.autoUpdate=$,ge.needsUpdate=W,ge.type=B}function pe(A){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",A.statusMessage)}function $e(A){const z=A.target;z.removeEventListener("dispose",$e),yt(z)}function yt(A){$t(A),Le.remove(A)}function $t(A){const z=Le.get(A).programs;z!==void 0&&(z.forEach(function($){xe.releaseProgram($)}),A.isShaderMaterial&&xe.releaseShaderCache(A))}this.renderBufferDirect=function(A,z,$,W,B,se){z===null&&(z=Fe);const de=B.isMesh&&B.matrixWorld.determinant()<0,_e=vf(A,z,$,W,B);Re.setMaterial(W,de);let be=$.index,Ce=1;if(W.wireframe===!0){if(be=ie.getWireframeAttribute($),be===void 0)return;Ce=2}const Te=$.drawRange,we=$.attributes.position;let tt=Te.start*Ce,ct=(Te.start+Te.count)*Ce;se!==null&&(tt=Math.max(tt,se.start*Ce),ct=Math.min(ct,(se.start+se.count)*Ce)),be!==null?(tt=Math.max(tt,0),ct=Math.min(ct,be.count)):we!=null&&(tt=Math.max(tt,0),ct=Math.min(ct,we.count));const vt=ct-tt;if(vt<0||vt===1/0)return;rt.setup(B,W,_e,$,be);let ei,Ze=ve;if(be!==null&&(ei=J.get(be),Ze=He,Ze.setIndex(ei)),B.isMesh)W.wireframe===!0?(Re.setLineWidth(W.wireframeLinewidth*Ge()),Ze.setMode(O.LINES)):Ze.setMode(O.TRIANGLES);else if(B.isLine){let ye=W.linewidth;ye===void 0&&(ye=1),Re.setLineWidth(ye*Ge()),B.isLineSegments?Ze.setMode(O.LINES):B.isLineLoop?Ze.setMode(O.LINE_LOOP):Ze.setMode(O.LINE_STRIP)}else B.isPoints?Ze.setMode(O.POINTS):B.isSprite&&Ze.setMode(O.TRIANGLES);if(B.isBatchedMesh)if(B._multiDrawInstances!==null)Ze.renderMultiDrawInstances(B._multiDrawStarts,B._multiDrawCounts,B._multiDrawCount,B._multiDrawInstances);else if(Ve.get("WEBGL_multi_draw"))Ze.renderMultiDraw(B._multiDrawStarts,B._multiDrawCounts,B._multiDrawCount);else{const ye=B._multiDrawStarts,It=B._multiDrawCounts,Je=B._multiDrawCount,mi=be?J.get(be).bytesPerElement:1,Kn=Le.get(W).currentProgram.getUniforms();for(let ti=0;ti<Je;ti++)Kn.setValue(O,"_gl_DrawID",ti),Ze.render(ye[ti]/mi,It[ti])}else if(B.isInstancedMesh)Ze.renderInstances(tt,vt,B.count);else if($.isInstancedBufferGeometry){const ye=$._maxInstanceCount!==void 0?$._maxInstanceCount:1/0,It=Math.min($.instanceCount,ye);Ze.renderInstances(tt,vt,It)}else Ze.render(tt,vt)};function Ke(A,z,$){A.transparent===!0&&A.side===qt&&A.forceSinglePass===!1?(A.side=Zt,A.needsUpdate=!0,Kr(A,z,$),A.side=pn,A.needsUpdate=!0,Kr(A,z,$),A.side=qt):Kr(A,z,$)}this.compile=function(A,z,$=null){$===null&&($=A),g=Ye.get($),g.init(z),y.push(g),$.traverseVisible(function(B){B.isLight&&B.layers.test(z.layers)&&(g.pushLight(B),B.castShadow&&g.pushShadow(B))}),A!==$&&A.traverseVisible(function(B){B.isLight&&B.layers.test(z.layers)&&(g.pushLight(B),B.castShadow&&g.pushShadow(B))}),g.setupLights();const W=new Set;return A.traverse(function(B){if(!(B.isMesh||B.isPoints||B.isLine||B.isSprite))return;const se=B.material;if(se)if(Array.isArray(se))for(let de=0;de<se.length;de++){const _e=se[de];Ke(_e,$,B),W.add(_e)}else Ke(se,$,B),W.add(se)}),y.pop(),g=null,W},this.compileAsync=function(A,z,$=null){const W=this.compile(A,z,$);return new Promise(B=>{function se(){if(W.forEach(function(de){Le.get(de).currentProgram.isReady()&&W.delete(de)}),W.size===0){B(A);return}setTimeout(se,10)}Ve.get("KHR_parallel_shader_compile")!==null?se():setTimeout(se,10)})};let Wt=null;function Pi(A){Wt&&Wt(A)}function ah(){bn.stop()}function lh(){bn.start()}const bn=new $u;bn.setAnimationLoop(Pi),typeof self<"u"&&bn.setContext(self),this.setAnimationLoop=function(A){Wt=A,j.setAnimationLoop(A),A===null?bn.stop():bn.start()},j.addEventListener("sessionstart",ah),j.addEventListener("sessionend",lh),this.render=function(A,z){if(z!==void 0&&z.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(E===!0)return;if(A.matrixWorldAutoUpdate===!0&&A.updateMatrixWorld(),z.parent===null&&z.matrixWorldAutoUpdate===!0&&z.updateMatrixWorld(),j.enabled===!0&&j.isPresenting===!0&&(j.cameraAutoUpdate===!0&&j.updateCamera(z),z=j.getCamera()),A.isScene===!0&&A.onBeforeRender(x,A,z,C),g=Ye.get(A,y.length),g.init(z),y.push(g),Q.multiplyMatrices(z.projectionMatrix,z.matrixWorldInverse),Se.setFromProjectionMatrix(Q),K=this.localClippingEnabled,U=ne.init(this.clippingPlanes,K),_=me.get(A,v.length),_.init(),v.push(_),j.enabled===!0&&j.isPresenting===!0){const se=x.xr.getDepthSensingMesh();se!==null&&va(se,z,-1/0,x.sortObjects)}va(A,z,0,x.sortObjects),_.finish(),x.sortObjects===!0&&_.sort(X,oe),Be=j.enabled===!1||j.isPresenting===!1||j.hasDepthSensing()===!1,Be&&Pe.addToRenderList(_,A),this.info.render.frame++,U===!0&&ne.beginShadows();const $=g.state.shadowsArray;ge.render($,A,z),U===!0&&ne.endShadows(),this.info.autoReset===!0&&this.info.reset();const W=_.opaque,B=_.transmissive;if(g.setupLights(),z.isArrayCamera){const se=z.cameras;if(B.length>0)for(let de=0,_e=se.length;de<_e;de++){const be=se[de];hh(W,B,A,be)}Be&&Pe.render(A);for(let de=0,_e=se.length;de<_e;de++){const be=se[de];ch(_,A,be,be.viewport)}}else B.length>0&&hh(W,B,A,z),Be&&Pe.render(A),ch(_,A,z);C!==null&&(L.updateMultisampleRenderTarget(C),L.updateRenderTargetMipmap(C)),A.isScene===!0&&A.onAfterRender(x,A,z),rt.resetDefaultState(),P=-1,N=null,y.pop(),y.length>0?(g=y[y.length-1],U===!0&&ne.setGlobalState(x.clippingPlanes,g.state.camera)):g=null,v.pop(),v.length>0?_=v[v.length-1]:_=null};function va(A,z,$,W){if(A.visible===!1)return;if(A.layers.test(z.layers)){if(A.isGroup)$=A.renderOrder;else if(A.isLOD)A.autoUpdate===!0&&A.update(z);else if(A.isLight)g.pushLight(A),A.castShadow&&g.pushShadow(A);else if(A.isSprite){if(!A.frustumCulled||Se.intersectsSprite(A)){W&&Ee.setFromMatrixPosition(A.matrixWorld).applyMatrix4(Q);const de=Z.update(A),_e=A.material;_e.visible&&_.push(A,de,_e,$,Ee.z,null)}}else if((A.isMesh||A.isLine||A.isPoints)&&(!A.frustumCulled||Se.intersectsObject(A))){const de=Z.update(A),_e=A.material;if(W&&(A.boundingSphere!==void 0?(A.boundingSphere===null&&A.computeBoundingSphere(),Ee.copy(A.boundingSphere.center)):(de.boundingSphere===null&&de.computeBoundingSphere(),Ee.copy(de.boundingSphere.center)),Ee.applyMatrix4(A.matrixWorld).applyMatrix4(Q)),Array.isArray(_e)){const be=de.groups;for(let Ce=0,Te=be.length;Ce<Te;Ce++){const we=be[Ce],tt=_e[we.materialIndex];tt&&tt.visible&&_.push(A,de,tt,$,Ee.z,we)}}else _e.visible&&_.push(A,de,_e,$,Ee.z,null)}}const se=A.children;for(let de=0,_e=se.length;de<_e;de++)va(se[de],z,$,W)}function ch(A,z,$,W){const B=A.opaque,se=A.transmissive,de=A.transparent;g.setupLightsView($),U===!0&&ne.setGlobalState(x.clippingPlanes,$),W&&Re.viewport(w.copy(W)),B.length>0&&qr(B,z,$),se.length>0&&qr(se,z,$),de.length>0&&qr(de,z,$),Re.buffers.depth.setTest(!0),Re.buffers.depth.setMask(!0),Re.buffers.color.setMask(!0),Re.setPolygonOffset(!1)}function hh(A,z,$,W){if(($.isScene===!0?$.overrideMaterial:null)!==null)return;g.state.transmissionRenderTarget[W.id]===void 0&&(g.state.transmissionRenderTarget[W.id]=new zn(1,1,{generateMipmaps:!0,type:Ve.has("EXT_color_buffer_half_float")||Ve.has("EXT_color_buffer_float")?Lr:Gi,minFilter:In,samples:4,stencilBuffer:r,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Qe.workingColorSpace}));const se=g.state.transmissionRenderTarget[W.id],de=W.viewport||w;se.setSize(de.z,de.w);const _e=x.getRenderTarget();x.setRenderTarget(se),x.getClearColor(I),V=x.getClearAlpha(),V<1&&x.setClearColor(16777215,.5),x.clear(),Be&&Pe.render($);const be=x.toneMapping;x.toneMapping=dn;const Ce=W.viewport;if(W.viewport!==void 0&&(W.viewport=void 0),g.setupLightsView(W),U===!0&&ne.setGlobalState(x.clippingPlanes,W),qr(A,$,W),L.updateMultisampleRenderTarget(se),L.updateRenderTargetMipmap(se),Ve.has("WEBGL_multisampled_render_to_texture")===!1){let Te=!1;for(let we=0,tt=z.length;we<tt;we++){const ct=z[we],vt=ct.object,ei=ct.geometry,Ze=ct.material,ye=ct.group;if(Ze.side===qt&&vt.layers.test(W.layers)){const It=Ze.side;Ze.side=Zt,Ze.needsUpdate=!0,dh(vt,$,W,ei,Ze,ye),Ze.side=It,Ze.needsUpdate=!0,Te=!0}}Te===!0&&(L.updateMultisampleRenderTarget(se),L.updateRenderTargetMipmap(se))}x.setRenderTarget(_e),x.setClearColor(I,V),Ce!==void 0&&(W.viewport=Ce),x.toneMapping=be}function qr(A,z,$){const W=z.isScene===!0?z.overrideMaterial:null;for(let B=0,se=A.length;B<se;B++){const de=A[B],_e=de.object,be=de.geometry,Ce=W===null?de.material:W,Te=de.group;_e.layers.test($.layers)&&dh(_e,z,$,be,Ce,Te)}}function dh(A,z,$,W,B,se){A.onBeforeRender(x,z,$,W,B,se),A.modelViewMatrix.multiplyMatrices($.matrixWorldInverse,A.matrixWorld),A.normalMatrix.getNormalMatrix(A.modelViewMatrix),B.onBeforeRender(x,z,$,W,A,se),B.transparent===!0&&B.side===qt&&B.forceSinglePass===!1?(B.side=Zt,B.needsUpdate=!0,x.renderBufferDirect($,z,W,B,A,se),B.side=pn,B.needsUpdate=!0,x.renderBufferDirect($,z,W,B,A,se),B.side=qt):x.renderBufferDirect($,z,W,B,A,se),A.onAfterRender(x,z,$,W,B,se)}function Kr(A,z,$){z.isScene!==!0&&(z=Fe);const W=Le.get(A),B=g.state.lights,se=g.state.shadowsArray,de=B.state.version,_e=xe.getParameters(A,B.state,se,z,$),be=xe.getProgramCacheKey(_e);let Ce=W.programs;W.environment=A.isMeshStandardMaterial?z.environment:null,W.fog=z.fog,W.envMap=(A.isMeshStandardMaterial?G:T).get(A.envMap||W.environment),W.envMapRotation=W.environment!==null&&A.envMap===null?z.environmentRotation:A.envMapRotation,Ce===void 0&&(A.addEventListener("dispose",$e),Ce=new Map,W.programs=Ce);let Te=Ce.get(be);if(Te!==void 0){if(W.currentProgram===Te&&W.lightsStateVersion===de)return ph(A,_e),Te}else _e.uniforms=xe.getUniforms(A),A.onBeforeCompile(_e,x),Te=xe.acquireProgram(_e,be),Ce.set(be,Te),W.uniforms=_e.uniforms;const we=W.uniforms;return(!A.isShaderMaterial&&!A.isRawShaderMaterial||A.clipping===!0)&&(we.clippingPlanes=ne.uniform),ph(A,_e),W.needsLights=bf(A),W.lightsStateVersion=de,W.needsLights&&(we.ambientLightColor.value=B.state.ambient,we.lightProbe.value=B.state.probe,we.directionalLights.value=B.state.directional,we.directionalLightShadows.value=B.state.directionalShadow,we.spotLights.value=B.state.spot,we.spotLightShadows.value=B.state.spotShadow,we.rectAreaLights.value=B.state.rectArea,we.ltc_1.value=B.state.rectAreaLTC1,we.ltc_2.value=B.state.rectAreaLTC2,we.pointLights.value=B.state.point,we.pointLightShadows.value=B.state.pointShadow,we.hemisphereLights.value=B.state.hemi,we.directionalShadowMap.value=B.state.directionalShadowMap,we.directionalShadowMatrix.value=B.state.directionalShadowMatrix,we.spotShadowMap.value=B.state.spotShadowMap,we.spotLightMatrix.value=B.state.spotLightMatrix,we.spotLightMap.value=B.state.spotLightMap,we.pointShadowMap.value=B.state.pointShadowMap,we.pointShadowMatrix.value=B.state.pointShadowMatrix),W.currentProgram=Te,W.uniformsList=null,Te}function uh(A){if(A.uniformsList===null){const z=A.currentProgram.getUniforms();A.uniformsList=Ho.seqWithValue(z.seq,A.uniforms)}return A.uniformsList}function ph(A,z){const $=Le.get(A);$.outputColorSpace=z.outputColorSpace,$.batching=z.batching,$.batchingColor=z.batchingColor,$.instancing=z.instancing,$.instancingColor=z.instancingColor,$.instancingMorph=z.instancingMorph,$.skinning=z.skinning,$.morphTargets=z.morphTargets,$.morphNormals=z.morphNormals,$.morphColors=z.morphColors,$.morphTargetsCount=z.morphTargetsCount,$.numClippingPlanes=z.numClippingPlanes,$.numIntersection=z.numClipIntersection,$.vertexAlphas=z.vertexAlphas,$.vertexTangents=z.vertexTangents,$.toneMapping=z.toneMapping}function vf(A,z,$,W,B){z.isScene!==!0&&(z=Fe),L.resetTextureUnits();const se=z.fog,de=W.isMeshStandardMaterial?z.environment:null,_e=C===null?x.outputColorSpace:C.isXRRenderTarget===!0?C.texture.colorSpace:vn,be=(W.isMeshStandardMaterial?G:T).get(W.envMap||de),Ce=W.vertexColors===!0&&!!$.attributes.color&&$.attributes.color.itemSize===4,Te=!!$.attributes.tangent&&(!!W.normalMap||W.anisotropy>0),we=!!$.morphAttributes.position,tt=!!$.morphAttributes.normal,ct=!!$.morphAttributes.color;let vt=dn;W.toneMapped&&(C===null||C.isXRRenderTarget===!0)&&(vt=x.toneMapping);const ei=$.morphAttributes.position||$.morphAttributes.normal||$.morphAttributes.color,Ze=ei!==void 0?ei.length:0,ye=Le.get(W),It=g.state.lights;if(U===!0&&(K===!0||A!==N)){const oi=A===N&&W.id===P;ne.setState(W,A,oi)}let Je=!1;W.version===ye.__version?(ye.needsLights&&ye.lightsStateVersion!==It.state.version||ye.outputColorSpace!==_e||B.isBatchedMesh&&ye.batching===!1||!B.isBatchedMesh&&ye.batching===!0||B.isBatchedMesh&&ye.batchingColor===!0&&B.colorTexture===null||B.isBatchedMesh&&ye.batchingColor===!1&&B.colorTexture!==null||B.isInstancedMesh&&ye.instancing===!1||!B.isInstancedMesh&&ye.instancing===!0||B.isSkinnedMesh&&ye.skinning===!1||!B.isSkinnedMesh&&ye.skinning===!0||B.isInstancedMesh&&ye.instancingColor===!0&&B.instanceColor===null||B.isInstancedMesh&&ye.instancingColor===!1&&B.instanceColor!==null||B.isInstancedMesh&&ye.instancingMorph===!0&&B.morphTexture===null||B.isInstancedMesh&&ye.instancingMorph===!1&&B.morphTexture!==null||ye.envMap!==be||W.fog===!0&&ye.fog!==se||ye.numClippingPlanes!==void 0&&(ye.numClippingPlanes!==ne.numPlanes||ye.numIntersection!==ne.numIntersection)||ye.vertexAlphas!==Ce||ye.vertexTangents!==Te||ye.morphTargets!==we||ye.morphNormals!==tt||ye.morphColors!==ct||ye.toneMapping!==vt||ye.morphTargetsCount!==Ze)&&(Je=!0):(Je=!0,ye.__version=W.version);let mi=ye.currentProgram;Je===!0&&(mi=Kr(W,z,B));let Kn=!1,ti=!1,_a=!1;const bt=mi.getUniforms(),Yi=ye.uniforms;if(Re.useProgram(mi.program)&&(Kn=!0,ti=!0,_a=!0),W.id!==P&&(P=W.id,ti=!0),Kn||N!==A){je.reverseDepthBuffer?(Y.copy(A.projectionMatrix),Im(Y),km(Y),bt.setValue(O,"projectionMatrix",Y)):bt.setValue(O,"projectionMatrix",A.projectionMatrix),bt.setValue(O,"viewMatrix",A.matrixWorldInverse);const oi=bt.map.cameraPosition;oi!==void 0&&oi.setValue(O,Me.setFromMatrixPosition(A.matrixWorld)),je.logarithmicDepthBuffer&&bt.setValue(O,"logDepthBufFC",2/(Math.log(A.far+1)/Math.LN2)),(W.isMeshPhongMaterial||W.isMeshToonMaterial||W.isMeshLambertMaterial||W.isMeshBasicMaterial||W.isMeshStandardMaterial||W.isShaderMaterial)&&bt.setValue(O,"isOrthographic",A.isOrthographicCamera===!0),N!==A&&(N=A,ti=!0,_a=!0)}if(B.isSkinnedMesh){bt.setOptional(O,B,"bindMatrix"),bt.setOptional(O,B,"bindMatrixInverse");const oi=B.skeleton;oi&&(oi.boneTexture===null&&oi.computeBoneTexture(),bt.setValue(O,"boneTexture",oi.boneTexture,L))}B.isBatchedMesh&&(bt.setOptional(O,B,"batchingTexture"),bt.setValue(O,"batchingTexture",B._matricesTexture,L),bt.setOptional(O,B,"batchingIdTexture"),bt.setValue(O,"batchingIdTexture",B._indirectTexture,L),bt.setOptional(O,B,"batchingColorTexture"),B._colorsTexture!==null&&bt.setValue(O,"batchingColorTexture",B._colorsTexture,L));const ba=$.morphAttributes;if((ba.position!==void 0||ba.normal!==void 0||ba.color!==void 0)&&De.update(B,$,mi),(ti||ye.receiveShadow!==B.receiveShadow)&&(ye.receiveShadow=B.receiveShadow,bt.setValue(O,"receiveShadow",B.receiveShadow)),W.isMeshGouraudMaterial&&W.envMap!==null&&(Yi.envMap.value=be,Yi.flipEnvMap.value=be.isCubeTexture&&be.isRenderTargetTexture===!1?-1:1),W.isMeshStandardMaterial&&W.envMap===null&&z.environment!==null&&(Yi.envMapIntensity.value=z.environmentIntensity),ti&&(bt.setValue(O,"toneMappingExposure",x.toneMappingExposure),ye.needsLights&&_f(Yi,_a),se&&W.fog===!0&&ce.refreshFogUniforms(Yi,se),ce.refreshMaterialUniforms(Yi,W,te,H,g.state.transmissionRenderTarget[A.id]),Ho.upload(O,uh(ye),Yi,L)),W.isShaderMaterial&&W.uniformsNeedUpdate===!0&&(Ho.upload(O,uh(ye),Yi,L),W.uniformsNeedUpdate=!1),W.isSpriteMaterial&&bt.setValue(O,"center",B.center),bt.setValue(O,"modelViewMatrix",B.modelViewMatrix),bt.setValue(O,"normalMatrix",B.normalMatrix),bt.setValue(O,"modelMatrix",B.matrixWorld),W.isShaderMaterial||W.isRawShaderMaterial){const oi=W.uniformsGroups;for(let xa=0,xf=oi.length;xa<xf;xa++){const fh=oi[xa];F.update(fh,mi),F.bind(fh,mi)}}return mi}function _f(A,z){A.ambientLightColor.needsUpdate=z,A.lightProbe.needsUpdate=z,A.directionalLights.needsUpdate=z,A.directionalLightShadows.needsUpdate=z,A.pointLights.needsUpdate=z,A.pointLightShadows.needsUpdate=z,A.spotLights.needsUpdate=z,A.spotLightShadows.needsUpdate=z,A.rectAreaLights.needsUpdate=z,A.hemisphereLights.needsUpdate=z}function bf(A){return A.isMeshLambertMaterial||A.isMeshToonMaterial||A.isMeshPhongMaterial||A.isMeshStandardMaterial||A.isShadowMaterial||A.isShaderMaterial&&A.lights===!0}this.getActiveCubeFace=function(){return R},this.getActiveMipmapLevel=function(){return M},this.getRenderTarget=function(){return C},this.setRenderTargetTextures=function(A,z,$){Le.get(A.texture).__webglTexture=z,Le.get(A.depthTexture).__webglTexture=$;const W=Le.get(A);W.__hasExternalTextures=!0,W.__autoAllocateDepthBuffer=$===void 0,W.__autoAllocateDepthBuffer||Ve.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),W.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(A,z){const $=Le.get(A);$.__webglFramebuffer=z,$.__useDefaultFramebuffer=z===void 0},this.setRenderTarget=function(A,z=0,$=0){C=A,R=z,M=$;let W=!0,B=null,se=!1,de=!1;if(A){const be=Le.get(A);if(be.__useDefaultFramebuffer!==void 0)Re.bindFramebuffer(O.FRAMEBUFFER,null),W=!1;else if(be.__webglFramebuffer===void 0)L.setupRenderTarget(A);else if(be.__hasExternalTextures)L.rebindTextures(A,Le.get(A.texture).__webglTexture,Le.get(A.depthTexture).__webglTexture);else if(A.depthBuffer){const we=A.depthTexture;if(be.__boundDepthTexture!==we){if(we!==null&&Le.has(we)&&(A.width!==we.image.width||A.height!==we.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");L.setupDepthRenderbuffer(A)}}const Ce=A.texture;(Ce.isData3DTexture||Ce.isDataArrayTexture||Ce.isCompressedArrayTexture)&&(de=!0);const Te=Le.get(A).__webglFramebuffer;A.isWebGLCubeRenderTarget?(Array.isArray(Te[z])?B=Te[z][$]:B=Te[z],se=!0):A.samples>0&&L.useMultisampledRTT(A)===!1?B=Le.get(A).__webglMultisampledFramebuffer:Array.isArray(Te)?B=Te[$]:B=Te,w.copy(A.viewport),S.copy(A.scissor),D=A.scissorTest}else w.copy(ae).multiplyScalar(te).floor(),S.copy(fe).multiplyScalar(te).floor(),D=ze;if(Re.bindFramebuffer(O.FRAMEBUFFER,B)&&W&&Re.drawBuffers(A,B),Re.viewport(w),Re.scissor(S),Re.setScissorTest(D),se){const be=Le.get(A.texture);O.framebufferTexture2D(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,O.TEXTURE_CUBE_MAP_POSITIVE_X+z,be.__webglTexture,$)}else if(de){const be=Le.get(A.texture),Ce=z||0;O.framebufferTextureLayer(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,be.__webglTexture,$||0,Ce)}P=-1},this.readRenderTargetPixels=function(A,z,$,W,B,se,de){if(!(A&&A.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let _e=Le.get(A).__webglFramebuffer;if(A.isWebGLCubeRenderTarget&&de!==void 0&&(_e=_e[de]),_e){Re.bindFramebuffer(O.FRAMEBUFFER,_e);try{const be=A.texture,Ce=be.format,Te=be.type;if(!je.textureFormatReadable(Ce)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!je.textureTypeReadable(Te)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}z>=0&&z<=A.width-W&&$>=0&&$<=A.height-B&&O.readPixels(z,$,W,B,ke.convert(Ce),ke.convert(Te),se)}finally{const be=C!==null?Le.get(C).__webglFramebuffer:null;Re.bindFramebuffer(O.FRAMEBUFFER,be)}}},this.readRenderTargetPixelsAsync=async function(A,z,$,W,B,se,de){if(!(A&&A.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let _e=Le.get(A).__webglFramebuffer;if(A.isWebGLCubeRenderTarget&&de!==void 0&&(_e=_e[de]),_e){const be=A.texture,Ce=be.format,Te=be.type;if(!je.textureFormatReadable(Ce))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!je.textureTypeReadable(Te))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(z>=0&&z<=A.width-W&&$>=0&&$<=A.height-B){Re.bindFramebuffer(O.FRAMEBUFFER,_e);const we=O.createBuffer();O.bindBuffer(O.PIXEL_PACK_BUFFER,we),O.bufferData(O.PIXEL_PACK_BUFFER,se.byteLength,O.STREAM_READ),O.readPixels(z,$,W,B,ke.convert(Ce),ke.convert(Te),0);const tt=C!==null?Le.get(C).__webglFramebuffer:null;Re.bindFramebuffer(O.FRAMEBUFFER,tt);const ct=O.fenceSync(O.SYNC_GPU_COMMANDS_COMPLETE,0);return O.flush(),await Lm(O,ct,4),O.bindBuffer(O.PIXEL_PACK_BUFFER,we),O.getBufferSubData(O.PIXEL_PACK_BUFFER,0,se),O.deleteBuffer(we),O.deleteSync(ct),se}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(A,z=null,$=0){A.isTexture!==!0&&(Vo("WebGLRenderer: copyFramebufferToTexture function signature has changed."),z=arguments[0]||null,A=arguments[1]);const W=Math.pow(2,-$),B=Math.floor(A.image.width*W),se=Math.floor(A.image.height*W),de=z!==null?z.x:0,_e=z!==null?z.y:0;L.setTexture2D(A,0),O.copyTexSubImage2D(O.TEXTURE_2D,$,0,0,de,_e,B,se),Re.unbindTexture()},this.copyTextureToTexture=function(A,z,$=null,W=null,B=0){A.isTexture!==!0&&(Vo("WebGLRenderer: copyTextureToTexture function signature has changed."),W=arguments[0]||null,A=arguments[1],z=arguments[2],B=arguments[3]||0,$=null);let se,de,_e,be,Ce,Te;$!==null?(se=$.max.x-$.min.x,de=$.max.y-$.min.y,_e=$.min.x,be=$.min.y):(se=A.image.width,de=A.image.height,_e=0,be=0),W!==null?(Ce=W.x,Te=W.y):(Ce=0,Te=0);const we=ke.convert(z.format),tt=ke.convert(z.type);L.setTexture2D(z,0),O.pixelStorei(O.UNPACK_FLIP_Y_WEBGL,z.flipY),O.pixelStorei(O.UNPACK_PREMULTIPLY_ALPHA_WEBGL,z.premultiplyAlpha),O.pixelStorei(O.UNPACK_ALIGNMENT,z.unpackAlignment);const ct=O.getParameter(O.UNPACK_ROW_LENGTH),vt=O.getParameter(O.UNPACK_IMAGE_HEIGHT),ei=O.getParameter(O.UNPACK_SKIP_PIXELS),Ze=O.getParameter(O.UNPACK_SKIP_ROWS),ye=O.getParameter(O.UNPACK_SKIP_IMAGES),It=A.isCompressedTexture?A.mipmaps[B]:A.image;O.pixelStorei(O.UNPACK_ROW_LENGTH,It.width),O.pixelStorei(O.UNPACK_IMAGE_HEIGHT,It.height),O.pixelStorei(O.UNPACK_SKIP_PIXELS,_e),O.pixelStorei(O.UNPACK_SKIP_ROWS,be),A.isDataTexture?O.texSubImage2D(O.TEXTURE_2D,B,Ce,Te,se,de,we,tt,It.data):A.isCompressedTexture?O.compressedTexSubImage2D(O.TEXTURE_2D,B,Ce,Te,It.width,It.height,we,It.data):O.texSubImage2D(O.TEXTURE_2D,B,Ce,Te,se,de,we,tt,It),O.pixelStorei(O.UNPACK_ROW_LENGTH,ct),O.pixelStorei(O.UNPACK_IMAGE_HEIGHT,vt),O.pixelStorei(O.UNPACK_SKIP_PIXELS,ei),O.pixelStorei(O.UNPACK_SKIP_ROWS,Ze),O.pixelStorei(O.UNPACK_SKIP_IMAGES,ye),B===0&&z.generateMipmaps&&O.generateMipmap(O.TEXTURE_2D),Re.unbindTexture()},this.copyTextureToTexture3D=function(A,z,$=null,W=null,B=0){A.isTexture!==!0&&(Vo("WebGLRenderer: copyTextureToTexture3D function signature has changed."),$=arguments[0]||null,W=arguments[1]||null,A=arguments[2],z=arguments[3],B=arguments[4]||0);let se,de,_e,be,Ce,Te,we,tt,ct;const vt=A.isCompressedTexture?A.mipmaps[B]:A.image;$!==null?(se=$.max.x-$.min.x,de=$.max.y-$.min.y,_e=$.max.z-$.min.z,be=$.min.x,Ce=$.min.y,Te=$.min.z):(se=vt.width,de=vt.height,_e=vt.depth,be=0,Ce=0,Te=0),W!==null?(we=W.x,tt=W.y,ct=W.z):(we=0,tt=0,ct=0);const ei=ke.convert(z.format),Ze=ke.convert(z.type);let ye;if(z.isData3DTexture)L.setTexture3D(z,0),ye=O.TEXTURE_3D;else if(z.isDataArrayTexture||z.isCompressedArrayTexture)L.setTexture2DArray(z,0),ye=O.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}O.pixelStorei(O.UNPACK_FLIP_Y_WEBGL,z.flipY),O.pixelStorei(O.UNPACK_PREMULTIPLY_ALPHA_WEBGL,z.premultiplyAlpha),O.pixelStorei(O.UNPACK_ALIGNMENT,z.unpackAlignment);const It=O.getParameter(O.UNPACK_ROW_LENGTH),Je=O.getParameter(O.UNPACK_IMAGE_HEIGHT),mi=O.getParameter(O.UNPACK_SKIP_PIXELS),Kn=O.getParameter(O.UNPACK_SKIP_ROWS),ti=O.getParameter(O.UNPACK_SKIP_IMAGES);O.pixelStorei(O.UNPACK_ROW_LENGTH,vt.width),O.pixelStorei(O.UNPACK_IMAGE_HEIGHT,vt.height),O.pixelStorei(O.UNPACK_SKIP_PIXELS,be),O.pixelStorei(O.UNPACK_SKIP_ROWS,Ce),O.pixelStorei(O.UNPACK_SKIP_IMAGES,Te),A.isDataTexture||A.isData3DTexture?O.texSubImage3D(ye,B,we,tt,ct,se,de,_e,ei,Ze,vt.data):z.isCompressedArrayTexture?O.compressedTexSubImage3D(ye,B,we,tt,ct,se,de,_e,ei,vt.data):O.texSubImage3D(ye,B,we,tt,ct,se,de,_e,ei,Ze,vt),O.pixelStorei(O.UNPACK_ROW_LENGTH,It),O.pixelStorei(O.UNPACK_IMAGE_HEIGHT,Je),O.pixelStorei(O.UNPACK_SKIP_PIXELS,mi),O.pixelStorei(O.UNPACK_SKIP_ROWS,Kn),O.pixelStorei(O.UNPACK_SKIP_IMAGES,ti),B===0&&z.generateMipmaps&&O.generateMipmap(ye),Re.unbindTexture()},this.initRenderTarget=function(A){Le.get(A).__webglFramebuffer===void 0&&L.setupRenderTarget(A)},this.initTexture=function(A){A.isCubeTexture?L.setTextureCube(A,0):A.isData3DTexture?L.setTexture3D(A,0):A.isDataArrayTexture||A.isCompressedArrayTexture?L.setTexture2DArray(A,0):L.setTexture2D(A,0),Re.unbindTexture()},this.resetState=function(){R=0,M=0,C=null,Re.reset(),rt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return zi}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===Ec?"display-p3":"srgb",t.unpackColorSpace=Qe.workingColorSpace===ca?"display-p3":"srgb"}}class Xb extends Lt{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new $i,this.environmentIntensity=1,this.environmentRotation=new $i,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class jb{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=tc,this.updateRanges=[],this.version=0,this.uuid=Ci()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let n=0,r=this.stride;n<r;n++)this.array[e+n]=t.array[i+n];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ci()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ci()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Ut=new k;class Jo{constructor(e,t,i,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)Ut.fromBufferAttribute(this,t),Ut.applyMatrix4(e),this.setXYZ(t,Ut.x,Ut.y,Ut.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Ut.fromBufferAttribute(this,t),Ut.applyNormalMatrix(e),this.setXYZ(t,Ut.x,Ut.y,Ut.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Ut.fromBufferAttribute(this,t),Ut.transformDirection(e),this.setXYZ(t,Ut.x,Ut.y,Ut.z);return this}getComponent(e,t){let i=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(i=xi(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=it(i,this.array)),this.data.array[e*this.data.stride+this.offset+t]=i,this}setX(e,t){return this.normalized&&(t=it(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=it(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=it(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=it(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=xi(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=xi(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=xi(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=xi(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=it(t,this.array),i=it(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=it(t,this.array),i=it(i,this.array),n=it(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=it(t,this.array),i=it(i,this.array),n=it(n,this.array),r=it(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this.data.array[e+3]=r,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const n=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[n+r])}return new yi(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Jo(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const n=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[n+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Yb extends jn{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new We(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let ds;const js=new k,us=new k,ps=new k,fs=new le,Ys=new le,Ku=new at,wo=new k,qs=new k,yo=new k,hd=new le,Za=new le,dd=new le;class qb extends Lt{constructor(e=new Yb){if(super(),this.isSprite=!0,this.type="Sprite",ds===void 0){ds=new mt;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new jb(t,5);ds.setIndex([0,1,2,0,2,3]),ds.setAttribute("position",new Jo(i,3,0,!1)),ds.setAttribute("uv",new Jo(i,2,3,!1))}this.geometry=ds,this.material=e,this.center=new le(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),us.setFromMatrixScale(this.matrixWorld),Ku.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),ps.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&us.multiplyScalar(-ps.z);const i=this.material.rotation;let n,r;i!==0&&(r=Math.cos(i),n=Math.sin(i));const o=this.center;So(wo.set(-.5,-.5,0),ps,o,us,n,r),So(qs.set(.5,-.5,0),ps,o,us,n,r),So(yo.set(.5,.5,0),ps,o,us,n,r),hd.set(0,0),Za.set(1,0),dd.set(1,1);let a=e.ray.intersectTriangle(wo,qs,yo,!1,js);if(a===null&&(So(qs.set(-.5,.5,0),ps,o,us,n,r),Za.set(0,1),a=e.ray.intersectTriangle(wo,yo,qs,!1,js),a===null))return;const l=e.ray.origin.distanceTo(js);l<e.near||l>e.far||t.push({distance:l,point:js.clone(),uv:ui.getInterpolation(js,wo,qs,yo,hd,Za,dd,new le),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function So(s,e,t,i,n,r){fs.subVectors(s,t).addScalar(.5).multiply(i),n!==void 0?(Ys.x=r*fs.x-n*fs.y,Ys.y=n*fs.x+r*fs.y):Ys.copy(fs),s.copy(e),s.x+=Ys.x,s.y+=Ys.y,s.applyMatrix4(Ku)}class mn extends jn{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new We(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Qo=new k,ea=new k,ud=new at,Ks=new Nr,Eo=new kr,Ja=new k,pd=new k;class Es extends Lt{constructor(e=new mt,t=new mn){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let n=1,r=t.count;n<r;n++)Qo.fromBufferAttribute(t,n-1),ea.fromBufferAttribute(t,n),i[n]=i[n-1],i[n]+=Qo.distanceTo(ea);e.setAttribute("lineDistance",new dt(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,r=e.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Eo.copy(i.boundingSphere),Eo.applyMatrix4(n),Eo.radius+=r,e.ray.intersectsSphere(Eo)===!1)return;ud.copy(n).invert(),Ks.copy(e.ray).applyMatrix4(ud);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=this.isLineSegments?2:1,h=i.index,u=i.attributes.position;if(h!==null){const m=Math.max(0,o.start),f=Math.min(h.count,o.start+o.count);for(let _=m,g=f-1;_<g;_+=c){const v=h.getX(_),y=h.getX(_+1),x=Mo(this,e,Ks,l,v,y);x&&t.push(x)}if(this.isLineLoop){const _=h.getX(f-1),g=h.getX(m),v=Mo(this,e,Ks,l,_,g);v&&t.push(v)}}else{const m=Math.max(0,o.start),f=Math.min(u.count,o.start+o.count);for(let _=m,g=f-1;_<g;_+=c){const v=Mo(this,e,Ks,l,_,_+1);v&&t.push(v)}if(this.isLineLoop){const _=Mo(this,e,Ks,l,f-1,m);_&&t.push(_)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const n=t[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=n.length;r<o;r++){const a=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}function Mo(s,e,t,i,n,r){const o=s.geometry.attributes.position;if(Qo.fromBufferAttribute(o,n),ea.fromBufferAttribute(o,r),t.distanceSqToSegment(Qo,ea,Ja,pd)>i)return;Ja.applyMatrix4(s.matrixWorld);const l=e.ray.origin.distanceTo(Ja);if(!(l<e.near||l>e.far))return{distance:l,point:pd.clone().applyMatrix4(s.matrixWorld),index:n,face:null,faceIndex:null,barycoord:null,object:s}}const fd=new k,md=new k;class Ac extends Es{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[];for(let n=0,r=t.count;n<r;n+=2)fd.fromBufferAttribute(t,n),md.fromBufferAttribute(t,n+1),i[n]=n===0?0:i[n-1],i[n+1]=i[n]+fd.distanceTo(md);e.setAttribute("lineDistance",new dt(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class ta extends jn{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new We(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const gd=new at,nc=new Nr,Co=new kr,To=new k;class sc extends Lt{constructor(e=new mt,t=new ta){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,r=e.params.Points.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Co.copy(i.boundingSphere),Co.applyMatrix4(n),Co.radius+=r,e.ray.intersectsSphere(Co)===!1)return;gd.copy(n).invert(),nc.copy(e.ray).applyMatrix4(gd);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=i.index,d=i.attributes.position;if(c!==null){const u=Math.max(0,o.start),m=Math.min(c.count,o.start+o.count);for(let f=u,_=m;f<_;f++){const g=c.getX(f);To.fromBufferAttribute(d,g),vd(To,g,l,n,e,t,this)}}else{const u=Math.max(0,o.start),m=Math.min(d.count,o.start+o.count);for(let f=u,_=m;f<_;f++)To.fromBufferAttribute(d,f),vd(To,f,l,n,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const n=t[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=n.length;r<o;r++){const a=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}function vd(s,e,t,i,n,r,o){const a=nc.distanceSqToPoint(s);if(a<t){const l=new k;nc.closestPointToPoint(s,l),l.applyMatrix4(i);const c=n.ray.origin.distanceTo(l);if(c<n.near||c>n.far)return;r.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,faceIndex:null,barycoord:null,object:o})}}class Ri{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,n=this.getPoint(0),r=0;t.push(0);for(let o=1;o<=e;o++)i=this.getPoint(o/e),r+=i.distanceTo(n),t.push(r),n=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let n=0;const r=i.length;let o;t?o=t:o=e*i[r-1];let a=0,l=r-1,c;for(;a<=l;)if(n=Math.floor(a+(l-a)/2),c=i[n]-o,c<0)a=n+1;else if(c>0)l=n-1;else{l=n;break}if(n=l,i[n]===o)return n/(r-1);const h=i[n],u=i[n+1]-h,m=(o-h)/u;return(n+m)/(r-1)}getTangent(e,t){let n=e-1e-4,r=e+1e-4;n<0&&(n=0),r>1&&(r=1);const o=this.getPoint(n),a=this.getPoint(r),l=t||(o.isVector2?new le:new k);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new k,n=[],r=[],o=[],a=new k,l=new at;for(let m=0;m<=e;m++){const f=m/e;n[m]=this.getTangentAt(f,new k)}r[0]=new k,o[0]=new k;let c=Number.MAX_VALUE;const h=Math.abs(n[0].x),d=Math.abs(n[0].y),u=Math.abs(n[0].z);h<=c&&(c=h,i.set(1,0,0)),d<=c&&(c=d,i.set(0,1,0)),u<=c&&i.set(0,0,1),a.crossVectors(n[0],i).normalize(),r[0].crossVectors(n[0],a),o[0].crossVectors(n[0],r[0]);for(let m=1;m<=e;m++){if(r[m]=r[m-1].clone(),o[m]=o[m-1].clone(),a.crossVectors(n[m-1],n[m]),a.length()>Number.EPSILON){a.normalize();const f=Math.acos(Pt(n[m-1].dot(n[m]),-1,1));r[m].applyMatrix4(l.makeRotationAxis(a,f))}o[m].crossVectors(n[m],r[m])}if(t===!0){let m=Math.acos(Pt(r[0].dot(r[e]),-1,1));m/=e,n[0].dot(a.crossVectors(r[0],r[e]))>0&&(m=-m);for(let f=1;f<=e;f++)r[f].applyMatrix4(l.makeRotationAxis(n[f],m*f)),o[f].crossVectors(n[f],r[f])}return{tangents:n,normals:r,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Rc extends Ri{constructor(e=0,t=0,i=1,n=1,r=0,o=Math.PI*2,a=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=a,this.aRotation=l}getPoint(e,t=new le){const i=t,n=Math.PI*2;let r=this.aEndAngle-this.aStartAngle;const o=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(o?r=0:r=n),this.aClockwise===!0&&!o&&(r===n?r=-n:r=r-n);const a=this.aStartAngle+e*r;let l=this.aX+this.xRadius*Math.cos(a),c=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const h=Math.cos(this.aRotation),d=Math.sin(this.aRotation),u=l-this.aX,m=c-this.aY;l=u*h-m*d+this.aX,c=u*d+m*h+this.aY}return i.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class Kb extends Rc{constructor(e,t,i,n,r,o){super(e,t,i,i,n,r,o),this.isArcCurve=!0,this.type="ArcCurve"}}function Pc(){let s=0,e=0,t=0,i=0;function n(r,o,a,l){s=r,e=a,t=-3*r+3*o-2*a-l,i=2*r-2*o+a+l}return{initCatmullRom:function(r,o,a,l,c){n(o,a,c*(a-r),c*(l-o))},initNonuniformCatmullRom:function(r,o,a,l,c,h,d){let u=(o-r)/c-(a-r)/(c+h)+(a-o)/h,m=(a-o)/h-(l-o)/(h+d)+(l-a)/d;u*=h,m*=h,n(o,a,u,m)},calc:function(r){const o=r*r,a=o*r;return s+e*r+t*o+i*a}}}const Ao=new k,Qa=new Pc,el=new Pc,tl=new Pc;class Zb extends Ri{constructor(e=[],t=!1,i="centripetal",n=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=n}getPoint(e,t=new k){const i=t,n=this.points,r=n.length,o=(r-(this.closed?0:1))*e;let a=Math.floor(o),l=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/r)+1)*r:l===0&&a===r-1&&(a=r-2,l=1);let c,h;this.closed||a>0?c=n[(a-1)%r]:(Ao.subVectors(n[0],n[1]).add(n[0]),c=Ao);const d=n[a%r],u=n[(a+1)%r];if(this.closed||a+2<r?h=n[(a+2)%r]:(Ao.subVectors(n[r-1],n[r-2]).add(n[r-1]),h=Ao),this.curveType==="centripetal"||this.curveType==="chordal"){const m=this.curveType==="chordal"?.5:.25;let f=Math.pow(c.distanceToSquared(d),m),_=Math.pow(d.distanceToSquared(u),m),g=Math.pow(u.distanceToSquared(h),m);_<1e-4&&(_=1),f<1e-4&&(f=_),g<1e-4&&(g=_),Qa.initNonuniformCatmullRom(c.x,d.x,u.x,h.x,f,_,g),el.initNonuniformCatmullRom(c.y,d.y,u.y,h.y,f,_,g),tl.initNonuniformCatmullRom(c.z,d.z,u.z,h.z,f,_,g)}else this.curveType==="catmullrom"&&(Qa.initCatmullRom(c.x,d.x,u.x,h.x,this.tension),el.initCatmullRom(c.y,d.y,u.y,h.y,this.tension),tl.initCatmullRom(c.z,d.z,u.z,h.z,this.tension));return i.set(Qa.calc(l),el.calc(l),tl.calc(l)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const n=e.points[t];this.points.push(new k().fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function _d(s,e,t,i,n){const r=(i-e)*.5,o=(n-t)*.5,a=s*s,l=s*a;return(2*t-2*i+r+o)*l+(-3*t+3*i-2*r-o)*a+r*s+t}function Jb(s,e){const t=1-s;return t*t*e}function Qb(s,e){return 2*(1-s)*s*e}function ex(s,e){return s*s*e}function cr(s,e,t,i){return Jb(s,e)+Qb(s,t)+ex(s,i)}function tx(s,e){const t=1-s;return t*t*t*e}function ix(s,e){const t=1-s;return 3*t*t*s*e}function nx(s,e){return 3*(1-s)*s*s*e}function sx(s,e){return s*s*s*e}function hr(s,e,t,i,n){return tx(s,e)+ix(s,t)+nx(s,i)+sx(s,n)}class Zu extends Ri{constructor(e=new le,t=new le,i=new le,n=new le){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new le){const i=t,n=this.v0,r=this.v1,o=this.v2,a=this.v3;return i.set(hr(e,n.x,r.x,o.x,a.x),hr(e,n.y,r.y,o.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class rx extends Ri{constructor(e=new k,t=new k,i=new k,n=new k){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new k){const i=t,n=this.v0,r=this.v1,o=this.v2,a=this.v3;return i.set(hr(e,n.x,r.x,o.x,a.x),hr(e,n.y,r.y,o.y,a.y),hr(e,n.z,r.z,o.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Ju extends Ri{constructor(e=new le,t=new le){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new le){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new le){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class ox extends Ri{constructor(e=new k,t=new k){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new k){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new k){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Qu extends Ri{constructor(e=new le,t=new le,i=new le){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new le){const i=t,n=this.v0,r=this.v1,o=this.v2;return i.set(cr(e,n.x,r.x,o.x),cr(e,n.y,r.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class ax extends Ri{constructor(e=new k,t=new k,i=new k){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new k){const i=t,n=this.v0,r=this.v1,o=this.v2;return i.set(cr(e,n.x,r.x,o.x),cr(e,n.y,r.y,o.y),cr(e,n.z,r.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class ep extends Ri{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new le){const i=t,n=this.points,r=(n.length-1)*e,o=Math.floor(r),a=r-o,l=n[o===0?o:o-1],c=n[o],h=n[o>n.length-2?n.length-1:o+1],d=n[o>n.length-3?n.length-1:o+2];return i.set(_d(a,l.x,c.x,h.x,d.x),_d(a,l.y,c.y,h.y,d.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const n=e.points[t];this.points.push(new le().fromArray(n))}return this}}var bd=Object.freeze({__proto__:null,ArcCurve:Kb,CatmullRomCurve3:Zb,CubicBezierCurve:Zu,CubicBezierCurve3:rx,EllipseCurve:Rc,LineCurve:Ju,LineCurve3:ox,QuadraticBezierCurve:Qu,QuadraticBezierCurve3:ax,SplineCurve:ep});class lx extends Ri{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const i=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new bd[i](t,e))}return this}getPoint(e,t){const i=e*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=i){const o=n[r]-i,a=this.curves[r],l=a.getLength(),c=l===0?0:1-o/l;return a.getPointAt(c,t)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,n=this.curves.length;i<n;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let n=0,r=this.curves;n<r.length;n++){const o=r[n],a=o.isEllipseCurve?e*2:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,l=o.getPoints(a);for(let c=0;c<l.length;c++){const h=l[c];i&&i.equals(h)||(t.push(h),i=h)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const n=e.curves[t];this.curves.push(new bd[n.type]().fromJSON(n))}return this}}class xd extends lx{constructor(e){super(),this.type="Path",this.currentPoint=new le,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new Ju(this.currentPoint.clone(),new le(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,n){const r=new Qu(this.currentPoint.clone(),new le(e,t),new le(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this}bezierCurveTo(e,t,i,n,r,o){const a=new Zu(this.currentPoint.clone(),new le(e,t),new le(i,n),new le(r,o));return this.curves.push(a),this.currentPoint.set(r,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new ep(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,n,r,o){const a=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+a,t+l,i,n,r,o),this}absarc(e,t,i,n,r,o){return this.absellipse(e,t,i,i,n,r,o),this}ellipse(e,t,i,n,r,o,a,l){const c=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(e+c,t+h,i,n,r,o,a,l),this}absellipse(e,t,i,n,r,o,a,l){const c=new Rc(e,t,i,n,r,o,a,l);if(this.curves.length>0){const d=c.getPoint(0);d.equals(this.currentPoint)||this.lineTo(d.x,d.y)}this.curves.push(c);const h=c.getPoint(1);return this.currentPoint.copy(h),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Dc extends mt{constructor(e=1,t=1,i=1,n=32,r=1,o=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:n,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:l};const c=this;n=Math.floor(n),r=Math.floor(r);const h=[],d=[],u=[],m=[];let f=0;const _=[],g=i/2;let v=0;y(),o===!1&&(e>0&&x(!0),t>0&&x(!1)),this.setIndex(h),this.setAttribute("position",new dt(d,3)),this.setAttribute("normal",new dt(u,3)),this.setAttribute("uv",new dt(m,2));function y(){const E=new k,R=new k;let M=0;const C=(t-e)/i;for(let P=0;P<=r;P++){const N=[],w=P/r,S=w*(t-e)+e;for(let D=0;D<=n;D++){const I=D/n,V=I*l+a,q=Math.sin(V),H=Math.cos(V);R.x=S*q,R.y=-w*i+g,R.z=S*H,d.push(R.x,R.y,R.z),E.set(q,C,H).normalize(),u.push(E.x,E.y,E.z),m.push(I,1-w),N.push(f++)}_.push(N)}for(let P=0;P<n;P++)for(let N=0;N<r;N++){const w=_[N][P],S=_[N+1][P],D=_[N+1][P+1],I=_[N][P+1];e>0&&(h.push(w,S,I),M+=3),t>0&&(h.push(S,D,I),M+=3)}c.addGroup(v,M,0),v+=M}function x(E){const R=f,M=new le,C=new k;let P=0;const N=E===!0?e:t,w=E===!0?1:-1;for(let D=1;D<=n;D++)d.push(0,g*w,0),u.push(0,w,0),m.push(.5,.5),f++;const S=f;for(let D=0;D<=n;D++){const V=D/n*l+a,q=Math.cos(V),H=Math.sin(V);C.x=N*H,C.y=g*w,C.z=N*q,d.push(C.x,C.y,C.z),u.push(0,w,0),M.x=q*.5+.5,M.y=H*.5*w+.5,m.push(M.x,M.y),f++}for(let D=0;D<n;D++){const I=R+D,V=S+D;E===!0?h.push(V,V+1,I):h.push(V+1,V,I),P+=3}c.addGroup(v,P,E===!0?1:2),v+=P}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Dc(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class dr extends xd{constructor(e){super(e),this.uuid=Ci(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,n=this.holes.length;i<n;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const n=e.holes[t];this.holes.push(new xd().fromJSON(n))}return this}}const cx={triangulate:function(s,e,t=2){const i=e&&e.length,n=i?e[0]*t:s.length;let r=tp(s,0,n,t,!0);const o=[];if(!r||r.next===r.prev)return o;let a,l,c,h,d,u,m;if(i&&(r=fx(s,e,r,t)),s.length>80*t){a=c=s[0],l=h=s[1];for(let f=t;f<n;f+=t)d=s[f],u=s[f+1],d<a&&(a=d),u<l&&(l=u),d>c&&(c=d),u>h&&(h=u);m=Math.max(c-a,h-l),m=m!==0?32767/m:0}return vr(r,o,t,a,l,m,0),o}};function tp(s,e,t,i,n){let r,o;if(n===Mx(s,e,t,i)>0)for(r=e;r<t;r+=i)o=wd(r,s[r],s[r+1],o);else for(r=t-i;r>=e;r-=i)o=wd(r,s[r],s[r+1],o);return o&&da(o,o.next)&&(br(o),o=o.next),o}function Vn(s,e){if(!s)return s;e||(e=s);let t=s,i;do if(i=!1,!t.steiner&&(da(t,t.next)||ft(t.prev,t,t.next)===0)){if(br(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function vr(s,e,t,i,n,r,o){if(!s)return;!o&&r&&bx(s,i,n,r);let a=s,l,c;for(;s.prev!==s.next;){if(l=s.prev,c=s.next,r?dx(s,i,n,r):hx(s)){e.push(l.i/t|0),e.push(s.i/t|0),e.push(c.i/t|0),br(s),s=c.next,a=c.next;continue}if(s=c,s===a){o?o===1?(s=ux(Vn(s),e,t),vr(s,e,t,i,n,r,2)):o===2&&px(s,e,t,i,n,r):vr(Vn(s),e,t,i,n,r,1);break}}}function hx(s){const e=s.prev,t=s,i=s.next;if(ft(e,t,i)>=0)return!1;const n=e.x,r=t.x,o=i.x,a=e.y,l=t.y,c=i.y,h=n<r?n<o?n:o:r<o?r:o,d=a<l?a<c?a:c:l<c?l:c,u=n>r?n>o?n:o:r>o?r:o,m=a>l?a>c?a:c:l>c?l:c;let f=i.next;for(;f!==e;){if(f.x>=h&&f.x<=u&&f.y>=d&&f.y<=m&&bs(n,a,r,l,o,c,f.x,f.y)&&ft(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function dx(s,e,t,i){const n=s.prev,r=s,o=s.next;if(ft(n,r,o)>=0)return!1;const a=n.x,l=r.x,c=o.x,h=n.y,d=r.y,u=o.y,m=a<l?a<c?a:c:l<c?l:c,f=h<d?h<u?h:u:d<u?d:u,_=a>l?a>c?a:c:l>c?l:c,g=h>d?h>u?h:u:d>u?d:u,v=rc(m,f,e,t,i),y=rc(_,g,e,t,i);let x=s.prevZ,E=s.nextZ;for(;x&&x.z>=v&&E&&E.z<=y;){if(x.x>=m&&x.x<=_&&x.y>=f&&x.y<=g&&x!==n&&x!==o&&bs(a,h,l,d,c,u,x.x,x.y)&&ft(x.prev,x,x.next)>=0||(x=x.prevZ,E.x>=m&&E.x<=_&&E.y>=f&&E.y<=g&&E!==n&&E!==o&&bs(a,h,l,d,c,u,E.x,E.y)&&ft(E.prev,E,E.next)>=0))return!1;E=E.nextZ}for(;x&&x.z>=v;){if(x.x>=m&&x.x<=_&&x.y>=f&&x.y<=g&&x!==n&&x!==o&&bs(a,h,l,d,c,u,x.x,x.y)&&ft(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;E&&E.z<=y;){if(E.x>=m&&E.x<=_&&E.y>=f&&E.y<=g&&E!==n&&E!==o&&bs(a,h,l,d,c,u,E.x,E.y)&&ft(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function ux(s,e,t){let i=s;do{const n=i.prev,r=i.next.next;!da(n,r)&&ip(n,i,i.next,r)&&_r(n,r)&&_r(r,n)&&(e.push(n.i/t|0),e.push(i.i/t|0),e.push(r.i/t|0),br(i),br(i.next),i=s=r),i=i.next}while(i!==s);return Vn(i)}function px(s,e,t,i,n,r){let o=s;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&yx(o,a)){let l=np(o,a);o=Vn(o,o.next),l=Vn(l,l.next),vr(o,e,t,i,n,r,0),vr(l,e,t,i,n,r,0);return}a=a.next}o=o.next}while(o!==s)}function fx(s,e,t,i){const n=[];let r,o,a,l,c;for(r=0,o=e.length;r<o;r++)a=e[r]*i,l=r<o-1?e[r+1]*i:s.length,c=tp(s,a,l,i,!1),c===c.next&&(c.steiner=!0),n.push(wx(c));for(n.sort(mx),r=0;r<n.length;r++)t=gx(n[r],t);return t}function mx(s,e){return s.x-e.x}function gx(s,e){const t=vx(s,e);if(!t)return e;const i=np(t,s);return Vn(i,i.next),Vn(t,t.next)}function vx(s,e){let t=e,i=-1/0,n;const r=s.x,o=s.y;do{if(o<=t.y&&o>=t.next.y&&t.next.y!==t.y){const u=t.x+(o-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(u<=r&&u>i&&(i=u,n=t.x<t.next.x?t:t.next,u===r))return n}t=t.next}while(t!==e);if(!n)return null;const a=n,l=n.x,c=n.y;let h=1/0,d;t=n;do r>=t.x&&t.x>=l&&r!==t.x&&bs(o<c?r:i,o,l,c,o<c?i:r,o,t.x,t.y)&&(d=Math.abs(o-t.y)/(r-t.x),_r(t,s)&&(d<h||d===h&&(t.x>n.x||t.x===n.x&&_x(n,t)))&&(n=t,h=d)),t=t.next;while(t!==a);return n}function _x(s,e){return ft(s.prev,s,e.prev)<0&&ft(e.next,s,s.next)<0}function bx(s,e,t,i){let n=s;do n.z===0&&(n.z=rc(n.x,n.y,e,t,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==s);n.prevZ.nextZ=null,n.prevZ=null,xx(n)}function xx(s){let e,t,i,n,r,o,a,l,c=1;do{for(t=s,s=null,r=null,o=0;t;){for(o++,i=t,a=0,e=0;e<c&&(a++,i=i.nextZ,!!i);e++);for(l=c;a>0||l>0&&i;)a!==0&&(l===0||!i||t.z<=i.z)?(n=t,t=t.nextZ,a--):(n=i,i=i.nextZ,l--),r?r.nextZ=n:s=n,n.prevZ=r,r=n;t=i}r.nextZ=null,c*=2}while(o>1);return s}function rc(s,e,t,i,n){return s=(s-t)*n|0,e=(e-i)*n|0,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,s|e<<1}function wx(s){let e=s,t=s;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==s);return t}function bs(s,e,t,i,n,r,o,a){return(n-o)*(e-a)>=(s-o)*(r-a)&&(s-o)*(i-a)>=(t-o)*(e-a)&&(t-o)*(r-a)>=(n-o)*(i-a)}function yx(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!Sx(s,e)&&(_r(s,e)&&_r(e,s)&&Ex(s,e)&&(ft(s.prev,s,e.prev)||ft(s,e.prev,e))||da(s,e)&&ft(s.prev,s,s.next)>0&&ft(e.prev,e,e.next)>0)}function ft(s,e,t){return(e.y-s.y)*(t.x-e.x)-(e.x-s.x)*(t.y-e.y)}function da(s,e){return s.x===e.x&&s.y===e.y}function ip(s,e,t,i){const n=Po(ft(s,e,t)),r=Po(ft(s,e,i)),o=Po(ft(t,i,s)),a=Po(ft(t,i,e));return!!(n!==r&&o!==a||n===0&&Ro(s,t,e)||r===0&&Ro(s,i,e)||o===0&&Ro(t,s,i)||a===0&&Ro(t,e,i))}function Ro(s,e,t){return e.x<=Math.max(s.x,t.x)&&e.x>=Math.min(s.x,t.x)&&e.y<=Math.max(s.y,t.y)&&e.y>=Math.min(s.y,t.y)}function Po(s){return s>0?1:s<0?-1:0}function Sx(s,e){let t=s;do{if(t.i!==s.i&&t.next.i!==s.i&&t.i!==e.i&&t.next.i!==e.i&&ip(t,t.next,s,e))return!0;t=t.next}while(t!==s);return!1}function _r(s,e){return ft(s.prev,s,s.next)<0?ft(s,e,s.next)>=0&&ft(s,s.prev,e)>=0:ft(s,e,s.prev)<0||ft(s,s.next,e)<0}function Ex(s,e){let t=s,i=!1;const n=(s.x+e.x)/2,r=(s.y+e.y)/2;do t.y>r!=t.next.y>r&&t.next.y!==t.y&&n<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==s);return i}function np(s,e){const t=new oc(s.i,s.x,s.y),i=new oc(e.i,e.x,e.y),n=s.next,r=e.prev;return s.next=e,e.prev=s,t.next=n,n.prev=t,i.next=t,t.prev=i,r.next=i,i.prev=r,i}function wd(s,e,t,i){const n=new oc(s,e,t);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function br(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function oc(s,e,t){this.i=s,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Mx(s,e,t,i){let n=0;for(let r=e,o=t-i;r<t;r+=i)n+=(s[o]-s[r])*(s[r+1]+s[o+1]),o=r;return n}class ur{static area(e){const t=e.length;let i=0;for(let n=t-1,r=0;r<t;n=r++)i+=e[n].x*e[r].y-e[r].x*e[n].y;return i*.5}static isClockWise(e){return ur.area(e)<0}static triangulateShape(e,t){const i=[],n=[],r=[];yd(e),Sd(i,e);let o=e.length;t.forEach(yd);for(let l=0;l<t.length;l++)n.push(o),o+=t[l].length,Sd(i,t[l]);const a=cx.triangulate(i,n);for(let l=0;l<a.length;l+=3)r.push(a.slice(l,l+3));return r}}function yd(s){const e=s.length;e>2&&s[e-1].equals(s[0])&&s.pop()}function Sd(s,e){for(let t=0;t<e.length;t++)s.push(e[t].x),s.push(e[t].y)}class Ms extends mt{constructor(e=new dr([new le(0,.5),new le(-.5,-.5),new le(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],n=[],r=[],o=[];let a=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let h=0;h<e.length;h++)c(e[h]),this.addGroup(a,l,h),a+=l,l=0;this.setIndex(i),this.setAttribute("position",new dt(n,3)),this.setAttribute("normal",new dt(r,3)),this.setAttribute("uv",new dt(o,2));function c(h){const d=n.length/3,u=h.extractPoints(t);let m=u.shape;const f=u.holes;ur.isClockWise(m)===!1&&(m=m.reverse());for(let g=0,v=f.length;g<v;g++){const y=f[g];ur.isClockWise(y)===!0&&(f[g]=y.reverse())}const _=ur.triangulateShape(m,f);for(let g=0,v=f.length;g<v;g++){const y=f[g];m=m.concat(y)}for(let g=0,v=m.length;g<v;g++){const y=m[g];n.push(y.x,y.y,0),r.push(0,0,1),o.push(y.x,y.y)}for(let g=0,v=_.length;g<v;g++){const y=_[g],x=y[0]+d,E=y[1]+d,R=y[2]+d;i.push(x,E,R),l+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return Cx(t,e)}static fromJSON(e,t){const i=[];for(let n=0,r=e.shapes.length;n<r;n++){const o=t[e.shapes[n]];i.push(o)}return new Ms(i,e.curveSegments)}}function Cx(s,e){if(e.shapes=[],Array.isArray(s))for(let t=0,i=s.length;t<i;t++){const n=s[t];e.shapes.push(n.uuid)}else e.shapes.push(s.uuid);return e}const Ed=new at;class Tx{constructor(e,t,i=0,n=1/0){this.ray=new Nr(e,t),this.near=i,this.far=n,this.camera=null,this.layers=new Cc,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return Ed.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(Ed),this}intersectObject(e,t=!0,i=[]){return ac(e,this,i,t),i.sort(Md),i}intersectObjects(e,t=!0,i=[]){for(let n=0,r=e.length;n<r;n++)ac(e[n],this,i,t);return i.sort(Md),i}}function Md(s,e){return s.distance-e.distance}function ac(s,e,t,i){let n=!0;if(s.layers.test(e.layers)&&s.raycast(e,t)===!1&&(n=!1),n===!0&&i===!0){const r=s.children;for(let o=0,a=r.length;o<a;o++)ac(r[o],e,t,!0)}}class Cd{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Pt(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Ax extends Ac{constructor(e=10,t=10,i=4473924,n=8947848){i=new We(i),n=new We(n);const r=t/2,o=e/t,a=e/2,l=[],c=[];for(let u=0,m=0,f=-a;u<=t;u++,f+=o){l.push(-a,0,f,a,0,f),l.push(f,0,-a,f,0,a);const _=u===r?i:n;_.toArray(c,m),m+=3,_.toArray(c,m),m+=3,_.toArray(c,m),m+=3,_.toArray(c,m),m+=3}const h=new mt;h.setAttribute("position",new dt(l,3)),h.setAttribute("color",new dt(c,3));const d=new mn({vertexColors:!0,toneMapped:!1});super(h,d),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const Td=new k;let Do,il;class On extends Lt{constructor(e=new k(0,0,1),t=new k(0,0,0),i=1,n=16776960,r=i*.2,o=r*.2){super(),this.type="ArrowHelper",Do===void 0&&(Do=new mt,Do.setAttribute("position",new dt([0,0,0,0,1,0],3)),il=new Dc(0,.5,1,5,1),il.translate(0,-.5,0)),this.position.copy(t),this.line=new Es(Do,new mn({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ft(il,new Vi({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,r,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Td.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Td,t)}}setLength(e,t=e*.2,i=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class Rx extends Xn{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:vc}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=vc);const Ad={type:"change"},Lc={type:"start"},sp={type:"end"},Lo=new Nr,Rd=new rn,Px=Math.cos(70*Pm.DEG2RAD),Mt=new k,Xt=2*Math.PI,nt={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},nl=1e-6;class Dx extends Rx{constructor(e,t=null){super(e,t),this.state=nt.NONE,this.enabled=!0,this.target=new k,this.cursor=new k,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:xs.ROTATE,MIDDLE:xs.DOLLY,RIGHT:xs.PAN},this.touches={ONE:vs.ROTATE,TWO:vs.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new k,this._lastQuaternion=new Bn,this._lastTargetPosition=new k,this._quat=new Bn().setFromUnitVectors(e.up,new k(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new Cd,this._sphericalDelta=new Cd,this._scale=1,this._panOffset=new k,this._rotateStart=new le,this._rotateEnd=new le,this._rotateDelta=new le,this._panStart=new le,this._panEnd=new le,this._panDelta=new le,this._dollyStart=new le,this._dollyEnd=new le,this._dollyDelta=new le,this._dollyDirection=new k,this._mouse=new le,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=Ix.bind(this),this._onPointerDown=Lx.bind(this),this._onPointerUp=kx.bind(this),this._onContextMenu=Vx.bind(this),this._onMouseWheel=Fx.bind(this),this._onKeyDown=Ux.bind(this),this._onTouchStart=zx.bind(this),this._onTouchMove=Bx.bind(this),this._onMouseDown=Nx.bind(this),this._onMouseMove=Ox.bind(this),this._interceptControlDown=Hx.bind(this),this._interceptControlUp=Gx.bind(this),this.domElement!==null&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(Ad),this.update(),this.state=nt.NONE}update(e=null){const t=this.object.position;Mt.copy(t).sub(this.target),Mt.applyQuaternion(this._quat),this._spherical.setFromVector3(Mt),this.autoRotate&&this.state===nt.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let i=this.minAzimuthAngle,n=this.maxAzimuthAngle;isFinite(i)&&isFinite(n)&&(i<-Math.PI?i+=Xt:i>Math.PI&&(i-=Xt),n<-Math.PI?n+=Xt:n>Math.PI&&(n-=Xt),i<=n?this._spherical.theta=Math.max(i,Math.min(n,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(i+n)/2?Math.max(i,this._spherical.theta):Math.min(n,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let r=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const o=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),r=o!=this._spherical.radius}if(Mt.setFromSpherical(this._spherical),Mt.applyQuaternion(this._quatInverse),t.copy(this.target).add(Mt),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let o=null;if(this.object.isPerspectiveCamera){const a=Mt.length();o=this._clampDistance(a*this._scale);const l=a-o;this.object.position.addScaledVector(this._dollyDirection,l),this.object.updateMatrixWorld(),r=!!l}else if(this.object.isOrthographicCamera){const a=new k(this._mouse.x,this._mouse.y,0);a.unproject(this.object);const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),r=l!==this.object.zoom;const c=new k(this._mouse.x,this._mouse.y,0);c.unproject(this.object),this.object.position.sub(c).add(a),this.object.updateMatrixWorld(),o=Mt.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;o!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(o).add(this.object.position):(Lo.origin.copy(this.object.position),Lo.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(Lo.direction))<Px?this.object.lookAt(this.target):(Rd.setFromNormalAndCoplanarPoint(this.object.up,this.target),Lo.intersectPlane(Rd,this.target))))}else if(this.object.isOrthographicCamera){const o=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),o!==this.object.zoom&&(this.object.updateProjectionMatrix(),r=!0)}return this._scale=1,this._performCursorZoom=!1,r||this._lastPosition.distanceToSquared(this.object.position)>nl||8*(1-this._lastQuaternion.dot(this.object.quaternion))>nl||this._lastTargetPosition.distanceToSquared(this.target)>nl?(this.dispatchEvent(Ad),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?Xt/60*this.autoRotateSpeed*e:Xt/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){Mt.setFromMatrixColumn(t,0),Mt.multiplyScalar(-e),this._panOffset.add(Mt)}_panUp(e,t){this.screenSpacePanning===!0?Mt.setFromMatrixColumn(t,1):(Mt.setFromMatrixColumn(t,0),Mt.crossVectors(this.object.up,Mt)),Mt.multiplyScalar(e),this._panOffset.add(Mt)}_pan(e,t){const i=this.domElement;if(this.object.isPerspectiveCamera){const n=this.object.position;Mt.copy(n).sub(this.target);let r=Mt.length();r*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*r/i.clientHeight,this.object.matrix),this._panUp(2*t*r/i.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const i=this.domElement.getBoundingClientRect(),n=e-i.left,r=t-i.top,o=i.width,a=i.height;this._mouse.x=n/o*2-1,this._mouse.y=-(r/a)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Xt*this._rotateDelta.x/t.clientHeight),this._rotateUp(Xt*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateUp(Xt*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateUp(-Xt*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateLeft(Xt*this.rotateSpeed/this.domElement.clientHeight):this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateLeft(-Xt*this.rotateSpeed/this.domElement.clientHeight):this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._rotateStart.set(i,n)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._panStart.set(i,n)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),i=e.pageX-t.x,n=e.pageY-t.y,r=Math.sqrt(i*i+n*n);this._dollyStart.set(0,r)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const i=this._getSecondPointerPosition(e),n=.5*(e.pageX+i.x),r=.5*(e.pageY+i.y);this._rotateEnd.set(n,r)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Xt*this._rotateDelta.x/t.clientHeight),this._rotateUp(Xt*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._panEnd.set(i,n)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),i=e.pageX-t.x,n=e.pageY-t.y,r=Math.sqrt(i*i+n*n);this._dollyEnd.set(0,r),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const o=(e.pageX+t.x)*.5,a=(e.pageY+t.y)*.5;this._updateZoomParameters(o,a)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new le,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,i={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:i.deltaY*=16;break;case 2:i.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(i.deltaY*=10),i}}function Lx(s){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(s.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(s)&&(this._addPointer(s),s.pointerType==="touch"?this._onTouchStart(s):this._onMouseDown(s)))}function Ix(s){this.enabled!==!1&&(s.pointerType==="touch"?this._onTouchMove(s):this._onMouseMove(s))}function kx(s){switch(this._removePointer(s),this._pointers.length){case 0:this.domElement.releasePointerCapture(s.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(sp),this.state=nt.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function Nx(s){let e;switch(s.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case xs.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(s),this.state=nt.DOLLY;break;case xs.ROTATE:if(s.ctrlKey||s.metaKey||s.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(s),this.state=nt.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(s),this.state=nt.ROTATE}break;case xs.PAN:if(s.ctrlKey||s.metaKey||s.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(s),this.state=nt.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(s),this.state=nt.PAN}break;default:this.state=nt.NONE}this.state!==nt.NONE&&this.dispatchEvent(Lc)}function Ox(s){switch(this.state){case nt.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(s);break;case nt.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(s);break;case nt.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(s);break}}function Fx(s){this.enabled===!1||this.enableZoom===!1||this.state!==nt.NONE||(s.preventDefault(),this.dispatchEvent(Lc),this._handleMouseWheel(this._customWheelEvent(s)),this.dispatchEvent(sp))}function Ux(s){this.enabled===!1||this.enablePan===!1||this._handleKeyDown(s)}function zx(s){switch(this._trackPointer(s),this._pointers.length){case 1:switch(this.touches.ONE){case vs.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(s),this.state=nt.TOUCH_ROTATE;break;case vs.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(s),this.state=nt.TOUCH_PAN;break;default:this.state=nt.NONE}break;case 2:switch(this.touches.TWO){case vs.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(s),this.state=nt.TOUCH_DOLLY_PAN;break;case vs.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(s),this.state=nt.TOUCH_DOLLY_ROTATE;break;default:this.state=nt.NONE}break;default:this.state=nt.NONE}this.state!==nt.NONE&&this.dispatchEvent(Lc)}function Bx(s){switch(this._trackPointer(s),this.state){case nt.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(s),this.update();break;case nt.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(s),this.update();break;case nt.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(s),this.update();break;case nt.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(s),this.update();break;default:this.state=nt.NONE}}function Vx(s){this.enabled!==!1&&s.preventDefault()}function Hx(s){s.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function Gx(s){s.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}/*! Tweakpane 4.0.4 (c) 2016 cocopon, licensed under the MIT license. */function ot(s){return s==null}function Ic(s){return s!==null&&typeof s=="object"}function lc(s){return s!==null&&typeof s=="object"}function $x(s,e){if(s.length!==e.length)return!1;for(let t=0;t<s.length;t++)if(s[t]!==e[t])return!1;return!0}function Hn(s,e){return Array.from(new Set([...Object.keys(s),...Object.keys(e)])).reduce((i,n)=>{const r=s[n],o=e[n];return lc(r)&&lc(o)?Object.assign(Object.assign({},i),{[n]:Hn(r,o)}):Object.assign(Object.assign({},i),{[n]:n in e?o:r})},{})}function kc(s){return Ic(s)?"target"in s:!1}const Wx={alreadydisposed:()=>"View has been already disposed",invalidparams:s=>`Invalid parameters for '${s.name}'`,nomatchingcontroller:s=>`No matching controller for '${s.key}'`,nomatchingview:s=>`No matching view for '${JSON.stringify(s.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:s=>`Not compatible with  plugin '${s.id}'`,propertynotfound:s=>`Property '${s.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class _t{static alreadyDisposed(){return new _t({type:"alreadydisposed"})}static notBindable(){return new _t({type:"notbindable"})}static notCompatible(e,t){return new _t({type:"notcompatible",context:{id:`${e}.${t}`}})}static propertyNotFound(e){return new _t({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new _t({type:"shouldneverhappen"})}constructor(e){var t;this.message=(t=Wx[e.type](e.context))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}}class ia{constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return!(e===null||typeof e!="object"&&typeof e!="function")}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const i=this.read();if(!ia.isBindable(i))throw _t.notBindable();if(!(e in i))throw _t.propertyNotFound(e);i[e]=t}}class Et{constructor(){this.observers_={}}on(e,t,i){var n;let r=this.observers_[e];return r||(r=this.observers_[e]=[]),r.push({handler:t,key:(n=i==null?void 0:i.key)!==null&&n!==void 0?n:t}),this}off(e,t){const i=this.observers_[e];return i&&(this.observers_[e]=i.filter(n=>n.key!==t)),this}emit(e,t){const i=this.observers_[e];i&&i.forEach(n=>{n.handler(t)})}}class Xx{constructor(e,t){var i;this.constraint_=t==null?void 0:t.constraint,this.equals_=(i=t==null?void 0:t.equals)!==null&&i!==void 0?i:(n,r)=>n===r,this.emitter=new Et,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},n=this.constraint_?this.constraint_.constrain(e):e,r=this.rawValue_;this.equals_(r,n)&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=n,this.emitter.emit("change",{options:i,previousRawValue:r,rawValue:n,sender:this}))}}class jx{constructor(e){this.emitter=new Et,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},n=this.value_;n===e&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:i,previousRawValue:n,rawValue:this.value_,sender:this}))}}class Yx{constructor(e){this.emitter=new Et,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}}function pt(s,e){const t=e==null?void 0:e.constraint,i=e==null?void 0:e.equals;return!t&&!i?new jx(s):new Xx(s,e)}function qx(s){return[new Yx(s),(e,t)=>{s.setRawValue(e,t)}]}class Ue{constructor(e){this.emitter=new Et,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((i,n)=>Object.assign(i,{[n]:pt(e[n])}),{})}static fromObject(e){const t=this.createCore(e);return new Ue(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}}class Fr{constructor(e){this.values=Ue.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");return Math.min(Math.max(e,i),t)}}class Kx{constructor(e){this.values=Ue.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");let n=e;return ot(i)||(n=Math.max(n,i)),ot(t)||(n=Math.min(n,t)),n}}class Zx{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step,i=Math.round((e-t)/this.step);return t+i*this.step}}class Jx{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}}const Qx={"**":(s,e)=>Math.pow(s,e),"*":(s,e)=>s*e,"/":(s,e)=>s/e,"%":(s,e)=>s%e,"+":(s,e)=>s+e,"-":(s,e)=>s-e,"<<":(s,e)=>s<<e,">>":(s,e)=>s>>e,">>>":(s,e)=>s>>>e,"&":(s,e)=>s&e,"^":(s,e)=>s^e,"|":(s,e)=>s|e};class ew{constructor(e,t,i){this.left=t,this.operator=e,this.right=i}evaluate(){const e=Qx[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const tw={"+":s=>s,"-":s=>-s,"~":s=>~s};class iw{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=tw[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function Nc(s){return(e,t)=>{for(let i=0;i<s.length;i++){const n=s[i](e,t);if(n!=="")return n}return""}}function xr(s,e){var t;const i=s.substr(e).match(/^\s+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function nw(s,e){const t=s.substr(e,1);return t.match(/^[1-9]$/)?t:""}function wr(s,e){var t;const i=s.substr(e).match(/^[0-9]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function sw(s,e){const t=wr(s,e);if(t!=="")return t;const i=s.substr(e,1);if(e+=1,i!=="-"&&i!=="+")return"";const n=wr(s,e);return n===""?"":i+n}function Oc(s,e){const t=s.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const i=sw(s,e);return i===""?"":t+i}function rp(s,e){const t=s.substr(e,1);if(t==="0")return t;const i=nw(s,e);return e+=i.length,i===""?"":i+wr(s,e)}function rw(s,e){const t=rp(s,e);if(e+=t.length,t==="")return"";const i=s.substr(e,1);if(e+=i.length,i!==".")return"";const n=wr(s,e);return e+=n.length,t+i+n+Oc(s,e)}function ow(s,e){const t=s.substr(e,1);if(e+=t.length,t!==".")return"";const i=wr(s,e);return e+=i.length,i===""?"":t+i+Oc(s,e)}function aw(s,e){const t=rp(s,e);return e+=t.length,t===""?"":t+Oc(s,e)}const lw=Nc([rw,ow,aw]);function cw(s,e){var t;const i=s.substr(e).match(/^[01]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function hw(s,e){const t=s.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const i=cw(s,e);return i===""?"":t+i}function dw(s,e){var t;const i=s.substr(e).match(/^[0-7]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function uw(s,e){const t=s.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const i=dw(s,e);return i===""?"":t+i}function pw(s,e){var t;const i=s.substr(e).match(/^[0-9a-f]+/i);return(t=i&&i[0])!==null&&t!==void 0?t:""}function fw(s,e){const t=s.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const i=pw(s,e);return i===""?"":t+i}const mw=Nc([hw,uw,fw]),gw=Nc([mw,lw]);function vw(s,e){const t=gw(s,e);return e+=t.length,t===""?null:{evaluable:new Jx(t),cursor:e}}function _w(s,e){const t=s.substr(e,1);if(e+=t.length,t!=="(")return null;const i=ap(s,e);if(!i)return null;e=i.cursor,e+=xr(s,e).length;const n=s.substr(e,1);return e+=n.length,n!==")"?null:{evaluable:i.evaluable,cursor:e}}function bw(s,e){var t;return(t=vw(s,e))!==null&&t!==void 0?t:_w(s,e)}function op(s,e){const t=bw(s,e);if(t)return t;const i=s.substr(e,1);if(e+=i.length,i!=="+"&&i!=="-"&&i!=="~")return null;const n=op(s,e);return n?(e=n.cursor,{cursor:e,evaluable:new iw(i,n.evaluable)}):null}function xw(s,e,t){t+=xr(e,t).length;const i=s.filter(n=>e.startsWith(n,t))[0];return i?(t+=i.length,t+=xr(e,t).length,{cursor:t,operator:i}):null}function ww(s,e){return(t,i)=>{const n=s(t,i);if(!n)return null;i=n.cursor;let r=n.evaluable;for(;;){const o=xw(e,t,i);if(!o)break;i=o.cursor;const a=s(t,i);if(!a)return null;i=a.cursor,r=new ew(o.operator,r,a.evaluable)}return r?{cursor:i,evaluable:r}:null}}const yw=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((s,e)=>ww(s,e),op);function ap(s,e){return e+=xr(s,e).length,yw(s,e)}function Sw(s){const e=ap(s,0);return!e||e.cursor+xr(s,e.cursor).length!==s.length?null:e.evaluable}function Wi(s){var e;const t=Sw(s);return(e=t==null?void 0:t.evaluate())!==null&&e!==void 0?e:null}function lp(s){if(typeof s=="number")return s;if(typeof s=="string"){const e=Wi(s);if(!ot(e))return e}return 0}function Ew(s){return String(s)}function Jt(s){return e=>e.toFixed(Math.max(Math.min(s,20),0))}function et(s,e,t,i,n){const r=(s-e)/(t-e);return i+r*(n-i)}function Pd(s){return String(s.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Ct(s,e,t){return Math.min(Math.max(s,e),t)}function cp(s,e){return(s%e+e)%e}function Mw(s,e){return ot(s.step)?Math.max(Pd(e),2):Pd(s.step)}function hp(s){var e;return(e=s.step)!==null&&e!==void 0?e:1}function dp(s,e){var t;const i=Math.abs((t=s.step)!==null&&t!==void 0?t:e);return i===0?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}function up(s,e){return ot(s.step)?null:new Zx(s.step,e)}function pp(s){return!ot(s.max)&&!ot(s.min)?new Fr({max:s.max,min:s.min}):!ot(s.max)||!ot(s.min)?new Kx({max:s.max,min:s.min}):null}function fp(s,e){var t,i,n;return{formatter:(t=s.format)!==null&&t!==void 0?t:Jt(Mw(s,e)),keyScale:(i=s.keyScale)!==null&&i!==void 0?i:hp(s),pointerScale:(n=s.pointerScale)!==null&&n!==void 0?n:dp(s,e)}}function mp(s){return{format:s.optional.function,keyScale:s.optional.number,max:s.optional.number,min:s.optional.number,pointerScale:s.optional.number,step:s.optional.number}}function Fc(s){return{constraint:s.constraint,textProps:Ue.fromObject(fp(s.params,s.initialValue))}}class Yn{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}}class ua{constructor(e){this.target=e}}class Ur extends ua{constructor(e,t,i){super(e),this.value=t,this.last=i??!0}}class Cw extends ua{constructor(e,t){super(e),this.expanded=t}}class Tw extends ua{constructor(e,t){super(e),this.index=t}}class Aw extends ua{constructor(e,t){super(e),this.native=t}}class yr extends Yn{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new Et,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,n=>{i(n)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new Ur(this,t.binding.target.read(),e.options.last))}}class Rw{constructor(e,t){this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=t,this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.emitter=new Et}get rawValue(){return this.value_.rawValue}set rawValue(e){this.value_.rawValue=e}setRawValue(e,t){this.value_.setRawValue(e,t)}fetch(){this.value_.rawValue=this.binding.read()}push(){this.binding.write(this.value_.rawValue)}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.push(),this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}}function Pw(s){if(!("binding"in s))return!1;const e=s.binding;return kc(e)&&"read"in e&&"write"in e}function Dw(s,e){const i=Object.keys(e).reduce((n,r)=>{if(n===void 0)return;const o=e[r],a=o(s[r]);return a.succeeded?Object.assign(Object.assign({},n),{[r]:a.value}):void 0},{});return i}function Lw(s,e){return s.reduce((t,i)=>{if(t===void 0)return;const n=e(i);if(!(!n.succeeded||n.value===void 0))return[...t,n.value]},[])}function Iw(s){return s===null?!1:typeof s=="object"}function Oi(s){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const i=s(t);return i!==void 0?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function Dd(s){return{custom:e=>Oi(e)(s),boolean:Oi(e=>typeof e=="boolean"?e:void 0)(s),number:Oi(e=>typeof e=="number"?e:void 0)(s),string:Oi(e=>typeof e=="string"?e:void 0)(s),function:Oi(e=>typeof e=="function"?e:void 0)(s),constant:e=>Oi(t=>t===e?e:void 0)(s),raw:Oi(e=>e)(s),object:e=>Oi(t=>{if(Iw(t))return Dw(t,e)})(s),array:e=>Oi(t=>{if(Array.isArray(t))return Lw(t,e)})(s)}}const cc={optional:Dd(!0),required:Dd(!1)};function gt(s,e){const t=e(cc),i=cc.required.object(t)(s);return i.succeeded?i.value:void 0}function si(s,e,t,i){if(e&&!e(s))return!1;const n=gt(s,t);return n?i(n):!1}function ri(s,e){var t;return Hn((t=s==null?void 0:s())!==null&&t!==void 0?t:{},e)}function Fn(s){return"value"in s}function gp(s){if(!Ic(s)||!("binding"in s))return!1;const e=s.binding;return kc(e)}const Mi="http://www.w3.org/2000/svg";function na(s){s.offsetHeight}function kw(s,e){const t=s.style.transition;s.style.transition="none",e(),s.style.transition=t}function Uc(s){return s.ontouchstart!==void 0}function Nw(){return globalThis}function Ow(){return Nw().document}function Fw(s){const e=s.ownerDocument.defaultView;return e&&"document"in e?s.getContext("2d",{willReadFrequently:!0}):null}const Uw={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function pa(s,e){const t=s.createElementNS(Mi,"svg");return t.innerHTML=Uw[e],t}function vp(s,e,t){s.insertBefore(e,s.children[t])}function zc(s){s.parentElement&&s.parentElement.removeChild(s)}function _p(s){for(;s.children.length>0;)s.removeChild(s.children[0])}function zw(s){for(;s.childNodes.length>0;)s.removeChild(s.childNodes[0])}function bp(s){return s.relatedTarget?s.relatedTarget:"explicitOriginalTarget"in s?s.explicitOriginalTarget:null}function Hi(s,e){s.emitter.on("change",t=>{e(t.rawValue)}),e(s.rawValue)}function Ti(s,e,t){Hi(s.value(e),t)}const Bw="tp";function Xe(s){return(t,i)=>[Bw,"-",s,"v",t?`_${t}`:"",i?`-${i}`:""].join("")}const Zs=Xe("lbl");function Vw(s,e){const t=s.createDocumentFragment();return e.split(`
`).map(n=>s.createTextNode(n)).forEach((n,r)=>{r>0&&t.appendChild(s.createElement("br")),t.appendChild(n)}),t}class xp{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Zs()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Zs("l")),Ti(t.props,"label",r=>{ot(r)?this.element.classList.add(Zs(void 0,"nol")):(this.element.classList.remove(Zs(void 0,"nol")),zw(i),i.appendChild(Vw(e,r)))}),this.element.appendChild(i),this.labelElement=i;const n=e.createElement("div");n.classList.add(Zs("v")),this.element.appendChild(n),this.valueElement=n}}class wp{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new xp(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return si(e,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return ri(null,{label:this.props.get("label")})}}function Hw(){return["veryfirst","first","last","verylast"]}const Ld=Xe(""),Id={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class fa{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{Hw().forEach(i=>{t.classList.remove(Ld(void 0,Id[i]))}),this.blade.get("positions").forEach(i=>{t.classList.add(Ld(void 0,Id[i]))})}),this.viewProps.handleDispose(()=>{zc(t)})}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return si(e,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return ri(null,Object.assign({},this.viewProps.exportState()))}}class Gn extends fa{constructor(e,t){if(t.value!==t.valueController.value)throw _t.shouldNeverHappen();const i=t.valueController.viewProps,n=new wp(e,{blade:t.blade,props:t.props,valueController:t.valueController});super(Object.assign(Object.assign({},t),{view:new xp(e,{props:t.props,viewProps:i}),viewProps:i})),this.labelController=n,this.value=t.value,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}importState(e){return si(e,t=>{var i,n,r;return super.importState(t)&&this.labelController.importProps(t)&&((r=(n=(i=this.valueController).importProps)===null||n===void 0?void 0:n.call(i,e))!==null&&r!==void 0?r:!0)},t=>({value:t.optional.raw}),t=>(t.value&&(this.value.rawValue=t.value),!0))}exportState(){var e,t,i;return ri(()=>super.exportState(),Object.assign(Object.assign({value:this.value.rawValue},this.labelController.exportProps()),(i=(t=(e=this.valueController).exportProps)===null||t===void 0?void 0:t.call(e))!==null&&i!==void 0?i:{}))}}function kd(s){const e=Object.assign({},s);return delete e.value,e}class yp extends Gn{constructor(e,t){super(e,t),this.tag=t.tag}importState(e){return si(e,t=>super.importState(kd(e)),t=>({tag:t.optional.string}),t=>(this.tag=t.tag,!0))}exportState(){return ri(()=>kd(super.exportState()),{binding:{key:this.value.binding.target.key,value:this.value.binding.target.read()},tag:this.tag})}}function Gw(s){return Fn(s)&&gp(s.value)}class $w extends yp{importState(e){return si(e,t=>super.importState(t),t=>({binding:t.required.object({value:t.required.raw})}),t=>(this.value.binding.inject(t.binding.value),this.value.fetch(),!0))}}function Ww(s){return Fn(s)&&Pw(s.value)}function Sp(s,e){for(;s.length<e;)s.push(void 0)}function Xw(s){const e=[];return Sp(e,s),e}function jw(s){const e=s.indexOf(void 0);return e<0?s:s.slice(0,e)}function Yw(s,e){const t=[...jw(s),e];return t.length>s.length?t.splice(0,t.length-s.length):Sp(t,s.length),t}class qw{constructor(e){this.emitter=new Et,this.onTick_=this.onTick_.bind(this),this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=e.binding,this.value_=pt(Xw(e.bufferSize)),this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.ticker=e.ticker,this.ticker.emitter.on("tick",this.onTick_),this.fetch()}get rawValue(){return this.value_.rawValue}set rawValue(e){this.value_.rawValue=e}setRawValue(e,t){this.value_.setRawValue(e,t)}fetch(){this.value_.rawValue=Yw(this.value_.rawValue,this.binding.read())}onTick_(){this.fetch()}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}}function Kw(s){if(!("binding"in s))return!1;const e=s.binding;return kc(e)&&"read"in e&&!("write"in e)}class Zw extends yp{exportState(){return ri(()=>super.exportState(),{binding:{readonly:!0}})}}function Jw(s){return Fn(s)&&Kw(s.value)}class Qw extends Yn{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return(e=this.controller.buttonController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const i=t.bind(this);return this.controller.buttonController.emitter.on(e,r=>{i(new Aw(this,r.nativeEvent))}),this}off(e,t){return this.controller.buttonController.emitter.off(e,t),this}}function ey(s,e,t){t?s.classList.add(e):s.classList.remove(e)}function Us(s,e){return t=>{ey(s,e,t)}}function Bc(s,e){Hi(s,t=>{e.textContent=t??""})}const sl=Xe("btn");class ty{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(sl()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("button");i.classList.add(sl("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const n=e.createElement("div");n.classList.add(sl("t")),Bc(t.props.value("title"),n),this.buttonElement.appendChild(n)}}class iy{constructor(e,t){this.emitter=new Et,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new ty(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return si(e,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return ri(null,{title:this.props.get("title")})}onClick_(e){this.emitter.emit("click",{nativeEvent:e,sender:this})}}class Nd extends fa{constructor(e,t){const i=new iy(e,{props:t.buttonProps,viewProps:t.viewProps}),n=new wp(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:n.view,viewProps:t.viewProps}),this.buttonController=i,this.labelController=n}importState(e){return si(e,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return ri(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}}class Ep{constructor(e){const[t,i]=e.split("-"),n=t.split(".");this.major=parseInt(n[0],10),this.minor=parseInt(n[1],10),this.patch=parseInt(n[2],10),this.prerelease=i??null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}}const zs=new Ep("2.0.4");function Gt(s){return Object.assign({core:zs},s)}const ny=Gt({id:"button",type:"blade",accept(s){const e=gt(s,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller(s){return new Nd(s.document,{blade:s.blade,buttonProps:Ue.fromObject({title:s.params.title}),labelProps:Ue.fromObject({label:s.params.label}),viewProps:s.viewProps})},api(s){return s.controller instanceof Nd?new Qw(s.controller):null}});function sy(s,e){return s.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function ry(s,e){return s.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function oy(s,e){return s.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}function ay(s){return Ic(s)?"refresh"in s&&typeof s.refresh=="function":!1}function ly(s,e){if(!ia.isBindable(s))throw _t.notBindable();return new ia(s,e)}class cy{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new Et,this.pool_=t,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(e=>this.pool_.createApi(e))}addBinding(e,t,i){const n=i??{},r=this.controller_.element.ownerDocument,o=this.pool_.createBinding(r,ly(e,t),n),a=this.pool_.createBindingApi(o);return this.add(a,n.index)}addFolder(e){return ry(this,e)}addButton(e){return sy(this,e)}addTab(e){return oy(this,e)}add(e,t){const i=e.controller;return this.controller_.rack.add(i,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,i=this.pool_.createBlade(t,e),n=this.pool_.createApi(i);return this.add(n,e.index)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,n=>{i(n)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}refresh(){this.children.forEach(e=>{ay(e)&&e.refresh()})}onRackValueChange_(e){const t=e.bladeController,i=this.pool_.createApi(t),n=gp(t.value)?t.value.binding:null;this.emitter_.emit("change",new Ur(i,n?n.target.read():t.value.rawValue,e.options.last))}}class Vc extends Yn{constructor(e,t){super(e),this.rackApi_=new cy(e.rackController,t)}refresh(){this.rackApi_.refresh()}}class Hc extends fa{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return si(e,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((i,n)=>i.importState(t.children[n])))}exportState(){return ri(()=>super.exportState(),{children:this.rackController.rack.children.map(e=>e.exportState())})}}function hc(s){return"rackController"in s}class hy{constructor(e){this.emitter=new Et,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw _t.shouldNeverHappen();const i=t!==void 0?t:this.items_.length;this.items_.splice(i,0,e),this.cache_.add(e);const n=this.extract_(e);n&&(n.emitter.on("add",this.onSubListAdd_),n.emitter.on("remove",this.onSubListRemove_),n.allItems().forEach(r=>{this.cache_.add(r)})),this.emitter.emit("add",{index:i,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const i=this.extract_(e);i&&(i.allItems().forEach(n=>{this.cache_.delete(n)}),i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}}function dy(s,e){for(let t=0;t<s.length;t++){const i=s[t];if(Fn(i)&&i.value===e)return i}return null}function uy(s){return hc(s)?s.rackController.rack.bcSet_:null}class py{constructor(e){var t,i;this.emitter=new Et,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(t=e.blade)!==null&&t!==void 0?t:null,(i=this.blade_)===null||i===void 0||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new hy(uy),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var i;(i=e.parent)===null||i===void 0||i.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const i=e.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),Fn(i))i.value.emitter.on("change",this.onChildValueChange_);else if(hc(i)){const n=i.rackController.rack;if(n){const r=n.emitter;r.on("layout",this.onRackLayout_),r.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const i=e.item;if(Fn(i))i.value.emitter.off("change",this.onChildValueChange_);else if(hc(i)){const n=i.rackController.rack;if(n){const r=n.emitter;r.off("layout",this.onRackLayout_),r.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter(n=>!n.viewProps.get("hidden")),t=e[0],i=e[e.length-1];this.bcSet_.items.forEach(n=>{const r=[];n===t&&(r.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&r.push("veryfirst")),n===i&&(r.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&r.push("verylast")),n.blade.set("positions",r)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(e){const t=dy(this.find(Fn),e.sender);if(!t)throw _t.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class Gc{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new py({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose(()=>{for(let i=this.rack.children.length-1;i>=0;i--)this.rack.children[i].viewProps.set("disposed",!0)})}onRackAdd_(e){e.root&&vp(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&zc(e.bladeController.view.element)}}function Bs(){return new Ue({positions:pt([],{equals:$x})})}class zr extends Ue{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=Ue.createCore(t);return new zr(i)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!ot(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const i=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};Ti(this,"expanded",i),Ti(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function fy(s,e){let t=0;return kw(e,()=>{s.set("expandedHeight",null),s.set("temporaryExpanded",!0),na(e),t=e.clientHeight,s.set("temporaryExpanded",null),na(e)}),t}function Od(s,e){e.style.height=s.styleHeight}function $c(s,e){s.value("expanded").emitter.on("beforechange",()=>{if(s.set("completed",!1),ot(s.get("expandedHeight"))){const t=fy(s,e);t>0&&s.set("expandedHeight",t)}s.set("shouldFixHeight",!0),na(e)}),s.emitter.on("change",()=>{Od(s,e)}),Od(s,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&s.cleanUpTransition()})}class Mp extends Vc{constructor(e,t){super(e,t),this.emitter_=new Et,this.controller.foldable.value("expanded").emitter.on("change",i=>{this.emitter_.emit("fold",new Cw(this,i.sender.rawValue))}),this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,n=>{i(n)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}}const Cp=Xe("cnt");class my{constructor(e,t){var i;this.className_=Xe((i=t.viewName)!==null&&i!==void 0?i:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),Cp()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),Ti(this.foldable_,"completed",Us(this.element,this.className_(void 0,"cpl")));const n=e.createElement("button");n.classList.add(this.className_("b")),Ti(t.props,"title",c=>{ot(c)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const r=e.createElement("div");r.classList.add(this.className_("i")),this.element.appendChild(r);const o=e.createElement("div");o.classList.add(this.className_("t")),Bc(t.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o;const a=e.createElement("div");a.classList.add(this.className_("m")),this.buttonElement.appendChild(a);const l=e.createElement("div");l.classList.add(this.className_("c")),this.element.appendChild(l),this.containerElement=l}}class dc extends Hc{constructor(e,t){var i;const n=zr.create((i=t.expanded)!==null&&i!==void 0?i:!0),r=new my(e,{foldable:n,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new Gc({blade:t.blade,element:r.containerElement,root:t.root,viewProps:t.viewProps}),view:r})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=n,$c(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return si(e,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return ri(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const gy=Gt({id:"folder",type:"blade",accept(s){const e=gt(s,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller(s){return new dc(s.document,{blade:s.blade,expanded:s.params.expanded,props:Ue.fromObject({title:s.params.title}),viewProps:s.viewProps})},api(s){return s.controller instanceof dc?new Mp(s.controller,s.pool):null}}),vy=Xe("");function Fd(s,e){return Us(s,vy(void 0,e))}class ji extends Ue{constructor(e){var t;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=qx(pt(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,i,n;const r=e??{};return new ji(Ue.createCore({disabled:(t=r.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(i=r.hidden)!==null&&i!==void 0?i:!1,parent:(n=r.parent)!==null&&n!==void 0?n:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){Hi(this.globalDisabled_,Fd(e,"disabled")),Ti(this,"hidden",Fd(e,"hidden"))}bindDisabled(e){Hi(this.globalDisabled_,t=>{e.disabled=t})}bindTabIndex(e){Hi(this.globalDisabled_,t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return(e?e.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const i=e.previousRawValue;i==null||i.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const Ud=Xe("tbp");class _y{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ud()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Ud("c")),this.element.appendChild(i),this.containerElement=i}}const Js=Xe("tbi");class by{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Js()),t.viewProps.bindClassModifiers(this.element),Ti(t.props,"selected",r=>{r?this.element.classList.add(Js(void 0,"sel")):this.element.classList.remove(Js(void 0,"sel"))});const i=e.createElement("button");i.classList.add(Js("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const n=e.createElement("div");n.classList.add(Js("t")),Bc(t.props.value("title"),n),this.buttonElement.appendChild(n),this.titleElement=n}}class xy{constructor(e,t){this.emitter=new Et,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new by(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class uc extends Hc{constructor(e,t){const i=new _y(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new Gc({blade:t.blade,element:i.containerElement,viewProps:t.viewProps}),view:i})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new xy(e,{props:t.itemProps,viewProps:ji.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,Ti(this.props,"selected",n=>{this.itemController.props.set("selected",n),this.viewProps.set("hidden",!n)})}get itemController(){return this.ic_}importState(e){return si(e,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return ri(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}}class wy extends Vc{constructor(e,t){super(e,t),this.emitter_=new Et,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,i=new uc(t,{blade:Bs(),itemProps:Ue.fromObject({selected:!1,title:e.title}),props:Ue.fromObject({selected:!1}),viewProps:ji.create()}),n=this.pool_.createApi(i);return this.rackApi_.add(n,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const i=t.bind(this);return this.emitter_.on(e,n=>{i(n)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}onSelect_(e){this.emitter_.emit("select",new Tw(this,e.rawValue))}}class yy extends Vc{get title(){var e;return(e=this.controller.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addBlade(e){return this.rackApi_.addBlade(e)}}const zd=-1;class Sy{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=pt(!0),this.selectedIndex=pt(zd),this.items_=[]}add(e,t){const i=t??this.items_.length;this.items_.splice(i,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=zd,this.empty.rawValue=!0;return}const e=this.items_.findIndex(t=>t.rawValue);e<0?(this.items_.forEach((t,i)=>{t.rawValue=i===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,i)=>{t.rawValue=i===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(i=>i===e.sender);this.items_.forEach((i,n)=>{i.rawValue=n===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}}const Qs=Xe("tab");class Ey{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Qs(),Cp()),t.viewProps.bindClassModifiers(this.element),Hi(t.empty,Us(this.element,Qs(void 0,"nop")));const i=e.createElement("div");i.classList.add(Qs("t")),this.element.appendChild(i),this.itemsElement=i;const n=e.createElement("div");n.classList.add(Qs("i")),this.element.appendChild(n);const r=e.createElement("div");r.classList.add(Qs("c")),this.element.appendChild(r),this.contentsElement=r}}class Bd extends Hc{constructor(e,t){const i=new Sy,n=new Ey(e,{empty:i.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new Gc({blade:t.blade,element:n.contentsElement,viewProps:t.viewProps}),view:n}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const r=this.rackController.rack;r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),this.tab=i}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;vp(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;zc(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}}const Tp=Gt({id:"tab",type:"blade",accept(s){const e=gt(s,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return!e||e.pages.length===0?null:{params:e}},controller(s){const e=new Bd(s.document,{blade:s.blade,viewProps:s.viewProps});return s.params.pages.forEach(t=>{const i=new uc(s.document,{blade:Bs(),itemProps:Ue.fromObject({selected:!1,title:t.title}),props:Ue.fromObject({selected:!1}),viewProps:ji.create()});e.add(i)}),e},api(s){return s.controller instanceof Bd?new wy(s.controller,s.pool):s.controller instanceof uc?new yy(s.controller,s.pool):null}});function My(s,e){const t=s.accept(e.params);if(!t)return null;const i=gt(e.params,n=>({disabled:n.optional.boolean,hidden:n.optional.boolean}));return s.controller({blade:Bs(),document:e.document,params:Object.assign(Object.assign({},t.params),{disabled:i==null?void 0:i.disabled,hidden:i==null?void 0:i.hidden}),viewProps:ji.create({disabled:i==null?void 0:i.disabled,hidden:i==null?void 0:i.hidden})})}class Wc extends yr{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}}class Cy{constructor(){this.disabled=!1,this.emitter=new Et}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class Ty{constructor(e,t){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=e,this.emitter=new Et,this.interval_=t,this.setTimer_()}get disabled(){return this.disabled_}set disabled(e){this.disabled_=e,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const e=this.doc_.defaultView;e&&e.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const e=this.doc_.defaultView;e&&(this.timerId_=e.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Br{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,i)=>i.constrain(t),e)}}function sa(s,e){if(s instanceof e)return s;if(s instanceof Br){const t=s.constraints.reduce((i,n)=>i||(n instanceof e?n:null),null);if(t)return t}return null}class Vr{constructor(e){this.values=Ue.fromObject({options:e})}constrain(e){const t=this.values.get("options");return t.length===0||t.filter(n=>n.value===e).length>0?e:t[0].value}}function Hr(s){var e;const t=cc;if(Array.isArray(s))return(e=gt({items:s},i=>({items:i.required.array(i.required.object({text:i.required.string,value:i.required.raw}))})))===null||e===void 0?void 0:e.items;if(typeof s=="object")return t.required.raw(s).value}function Xc(s){if(Array.isArray(s))return s;const e=[];return Object.keys(s).forEach(t=>{e.push({text:t,value:s[t]})}),e}function jc(s){return ot(s)?null:new Vr(Xc(s))}const rl=Xe("lst");class Ay{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(rl()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("select");i.classList.add(rl("s")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;const n=e.createElement("div");n.classList.add(rl("m")),n.appendChild(pa(e,"dropdown")),this.element.appendChild(n),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,Ti(this.props_,"options",r=>{_p(this.selectElement),r.forEach(o=>{const a=e.createElement("option");a.textContent=o.text,this.selectElement.appendChild(a)}),this.update_()})}update_(){const e=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}}class gn{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new Ay(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return si(e,null,t=>({options:t.required.custom(Hr)}),t=>(this.props.set("options",Xc(t.options)),!0))}exportProps(){return ri(null,{options:this.props.get("options")})}}const Vd=Xe("pop");class Ry{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Vd()),t.viewProps.bindClassModifiers(this.element),Hi(t.shows,Us(this.element,Vd(void 0,"v")))}}class Ap{constructor(e,t){this.shows=pt(!1),this.viewProps=t.viewProps,this.view=new Ry(e,{shows:this.shows,viewProps:this.viewProps})}}const Hd=Xe("txt");class Py{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Hd()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const i=e.createElement("input");i.classList.add(Hd("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}}class Sr{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new Py(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const i=e.currentTarget.value,n=this.parser_(i);ot(n)||(this.value.rawValue=n),this.view.refresh()}}function Dy(s){return String(s)}function Rp(s){return s==="false"?!1:!!s}function Gd(s){return Dy(s)}function Ly(s){return e=>s.reduce((t,i)=>t!==null?t:i(e),null)}const Iy=Jt(0);function ra(s){return Iy(s)+"%"}function Pp(s){return String(s)}function pc(s){return s}function Vs({primary:s,secondary:e,forward:t,backward:i}){let n=!1;function r(o){n||(n=!0,o(),n=!1)}s.emitter.on("change",o=>{r(()=>{e.setRawValue(t(s.rawValue,e.rawValue),o.options)})}),e.emitter.on("change",o=>{r(()=>{s.setRawValue(i(s.rawValue,e.rawValue),o.options)}),r(()=>{e.setRawValue(t(s.rawValue,e.rawValue),o.options)})}),r(()=>{e.setRawValue(t(s.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function Kt(s,e){const t=s*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function Er(s){return{altKey:s.altKey,downKey:s.key==="ArrowDown",shiftKey:s.shiftKey,upKey:s.key==="ArrowUp"}}function Xi(s){return{altKey:s.altKey,downKey:s.key==="ArrowLeft",shiftKey:s.shiftKey,upKey:s.key==="ArrowRight"}}function ky(s){return s==="ArrowUp"||s==="ArrowDown"}function Dp(s){return ky(s)||s==="ArrowLeft"||s==="ArrowRight"}function ol(s,e){var t,i;const n=e.ownerDocument.defaultView,r=e.getBoundingClientRect();return{x:s.pageX-(((t=n&&n.scrollX)!==null&&t!==void 0?t:0)+r.left),y:s.pageY-(((i=n&&n.scrollY)!==null&&i!==void 0?i:0)+r.top)}}class qn{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new Et,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(ol(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(ol(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(ol(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const i=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,n=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(i?{x:i.clientX-n.left,y:i.clientY-n.top}:void 0),sender:this,shiftKey:e.shiftKey})}}const li=Xe("txt");class Ny{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(li(),li(void 0,"num")),t.arrayPosition&&this.element.classList.add(li(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(li("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(li()),this.inputElement.classList.add(li("i"));const n=e.createElement("div");n.classList.add(li("k")),this.element.appendChild(n),this.knobElement=n;const r=e.createElementNS(Mi,"svg");r.classList.add(li("g")),this.knobElement.appendChild(r);const o=e.createElementNS(Mi,"path");o.classList.add(li("gb")),r.appendChild(o),this.guideBodyElem_=o;const a=e.createElementNS(Mi,"path");a.classList.add(li("gh")),r.appendChild(a),this.guideHeadElem_=a;const l=e.createElement("div");l.classList.add(Xe("tt")()),this.knobElement.appendChild(l),this.tooltipElem_=l,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(li(void 0,"drg"));return}this.element.classList.add(li(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),i=t+(t>0?-1:t<0?1:0),n=Ct(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+n},0 L${i},4 L${i+n},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const r=this.props_.get("formatter");this.tooltipElem_.textContent=r(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}}class Gr{constructor(e,t){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=(i=t.sliderProps)!==null&&i!==void 0?i:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=pt(null),this.view=new Ny(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const n=new qn(this.view.knobElement);n.emitter.on("down",this.onPointerDown_),n.emitter.on("move",this.onPointerMove_),n.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,i;const n=(t=this.sliderProps_)===null||t===void 0?void 0:t.get("min"),r=(i=this.sliderProps_)===null||i===void 0?void 0:i.get("max");let o=e;return n!==void 0&&(o=Math.max(o,n)),r!==void 0&&(o=Math.min(o,r)),o}onInputChange_(e){const i=e.currentTarget.value,n=this.parser_(i);ot(n)||(this.value.rawValue=this.constrainValue_(n)),this.view.refresh()}onInputKeyDown_(e){const t=Kt(this.props.get("keyScale"),Er(e));t!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){Kt(this.props.get("keyScale"),Er(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const al=Xe("sld");class Oy{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(al()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(al("t")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;const n=e.createElement("div");n.classList.add(al("k")),this.trackElement.appendChild(n),this.knobElement=n,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=Ct(et(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}}class Fy{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new Oy(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new qn(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(et(Ct(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Kt(this.props.get("keyScale"),Xi(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){Kt(this.props.get("keyScale"),Xi(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const ll=Xe("sldtxt");class Uy{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ll());const i=e.createElement("div");i.classList.add(ll("s")),this.sliderView_=t.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);const n=e.createElement("div");n.classList.add(ll("t")),this.textView_=t.textView,n.appendChild(this.textView_.element),this.element.appendChild(n)}}class oa{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new Fy(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new Gr(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new Uy(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return si(e,null,t=>({max:t.required.number,min:t.required.number}),t=>{const i=this.sliderC_.props;return i.set("max",t.max),i.set("min",t.min),!0})}exportProps(){const e=this.sliderC_.props;return ri(null,{max:e.get("max"),min:e.get("min")})}}function Lp(s){return{sliderProps:new Ue({keyScale:s.keyScale,max:s.max,min:s.min}),textProps:new Ue({formatter:pt(s.formatter),keyScale:s.keyScale,pointerScale:pt(s.pointerScale)})}}const zy={containerUnitSize:"cnt-usz"};function Ip(s){return`--${zy[s]}`}function Mr(s){return mp(s)}function cn(s){if(lc(s))return gt(s,Mr)}function Bi(s,e){if(!s)return;const t=[],i=up(s,e);i&&t.push(i);const n=pp(s);return n&&t.push(n),new Br(t)}function By(s){return s?s.major===zs.major:!1}function kp(s){if(s==="inline"||s==="popup")return s}function $r(s,e){s.write(e)}const Io=Xe("ckb");class Vy{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Io()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("label");i.classList.add(Io("l")),this.element.appendChild(i),this.labelElement=i;const n=e.createElement("input");n.classList.add(Io("i")),n.type="checkbox",this.labelElement.appendChild(n),this.inputElement=n,t.viewProps.bindDisabled(this.inputElement);const r=e.createElement("div");r.classList.add(Io("w")),this.labelElement.appendChild(r);const o=pa(e,"check");r.appendChild(o),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class Hy{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.onLabelMouseDown_=this.onLabelMouseDown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Vy(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.labelElement.addEventListener("mousedown",this.onLabelMouseDown_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked,e.preventDefault(),e.stopPropagation()}onLabelMouseDown_(e){e.preventDefault()}}function Gy(s){const e=[],t=jc(s.options);return t&&e.push(t),new Br(e)}const $y=Gt({id:"input-bool",type:"input",accept:(s,e)=>{if(typeof s!="boolean")return null;const t=gt(e,i=>({options:i.optional.custom(Hr),readonly:i.optional.constant(!1)}));return t?{initialValue:s,params:t}:null},binding:{reader:s=>Rp,constraint:s=>Gy(s.params),writer:s=>$r},controller:s=>{const e=s.document,t=s.value,i=s.constraint,n=i&&sa(i,Vr);return n?new gn(e,{props:new Ue({options:n.values.value("options")}),value:t,viewProps:s.viewProps}):new Hy(e,{value:t,viewProps:s.viewProps})},api(s){return typeof s.controller.value.rawValue!="boolean"?null:s.controller.valueController instanceof gn?new Wc(s.controller):null}}),Cn=Xe("col");class Wy{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Cn()),t.foldable.bindExpandedClass(this.element,Cn(void 0,"expanded")),Ti(t.foldable,"completed",Us(this.element,Cn(void 0,"cpl")));const i=e.createElement("div");i.classList.add(Cn("h")),this.element.appendChild(i);const n=e.createElement("div");n.classList.add(Cn("s")),i.appendChild(n),this.swatchElement=n;const r=e.createElement("div");if(r.classList.add(Cn("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(Cn("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}}function Xy(s,e,t){const i=Ct(s/255,0,1),n=Ct(e/255,0,1),r=Ct(t/255,0,1),o=Math.max(i,n,r),a=Math.min(i,n,r),l=o-a;let c=0,h=0;const d=(a+o)/2;return l!==0&&(h=l/(1-Math.abs(o+a-1)),i===o?c=(n-r)/l:n===o?c=2+(r-i)/l:c=4+(i-n)/l,c=c/6+(c<0?1:0)),[c*360,h*100,d*100]}function jy(s,e,t){const i=(s%360+360)%360,n=Ct(e/100,0,1),r=Ct(t/100,0,1),o=(1-Math.abs(2*r-1))*n,a=o*(1-Math.abs(i/60%2-1)),l=r-o/2;let c,h,d;return i>=0&&i<60?[c,h,d]=[o,a,0]:i>=60&&i<120?[c,h,d]=[a,o,0]:i>=120&&i<180?[c,h,d]=[0,o,a]:i>=180&&i<240?[c,h,d]=[0,a,o]:i>=240&&i<300?[c,h,d]=[a,0,o]:[c,h,d]=[o,0,a],[(c+l)*255,(h+l)*255,(d+l)*255]}function Yy(s,e,t){const i=Ct(s/255,0,1),n=Ct(e/255,0,1),r=Ct(t/255,0,1),o=Math.max(i,n,r),a=Math.min(i,n,r),l=o-a;let c;l===0?c=0:o===i?c=60*(((n-r)/l%6+6)%6):o===n?c=60*((r-i)/l+2):c=60*((i-n)/l+4);const h=o===0?0:l/o,d=o;return[c,h*100,d*100]}function Np(s,e,t){const i=cp(s,360),n=Ct(e/100,0,1),r=Ct(t/100,0,1),o=r*n,a=o*(1-Math.abs(i/60%2-1)),l=r-o;let c,h,d;return i>=0&&i<60?[c,h,d]=[o,a,0]:i>=60&&i<120?[c,h,d]=[a,o,0]:i>=120&&i<180?[c,h,d]=[0,o,a]:i>=180&&i<240?[c,h,d]=[0,a,o]:i>=240&&i<300?[c,h,d]=[a,0,o]:[c,h,d]=[o,0,a],[(c+l)*255,(h+l)*255,(d+l)*255]}function qy(s,e,t){const i=t+e*(100-Math.abs(2*t-100))/200;return[s,i!==0?e*(100-Math.abs(2*t-100))/i:0,t+e*(100-Math.abs(2*t-100))/(2*100)]}function Ky(s,e,t){const i=100-Math.abs(t*(200-e)/100-100);return[s,i!==0?e*t/i:0,t*(200-e)/(2*100)]}function Ai(s){return[s[0],s[1],s[2]]}function ma(s,e){return[s[0],s[1],s[2],e]}const Zy={hsl:{hsl:(s,e,t)=>[s,e,t],hsv:qy,rgb:jy},hsv:{hsl:Ky,hsv:(s,e,t)=>[s,e,t],rgb:Np},rgb:{hsl:Xy,hsv:Yy,rgb:(s,e,t)=>[s,e,t]}};function ks(s,e){return[e==="float"?1:s==="rgb"?255:360,e==="float"?1:s==="rgb"?255:100,e==="float"?1:s==="rgb"?255:100]}function Jy(s,e){return s===e?e:cp(s,e)}function Op(s,e,t){var i;const n=ks(e,t);return[e==="rgb"?Ct(s[0],0,n[0]):Jy(s[0],n[0]),Ct(s[1],0,n[1]),Ct(s[2],0,n[2]),Ct((i=s[3])!==null&&i!==void 0?i:1,0,1)]}function $d(s,e,t,i){const n=ks(e,t),r=ks(e,i);return s.map((o,a)=>o/n[a]*r[a])}function Fp(s,e,t){const i=$d(s,e.mode,e.type,"int"),n=Zy[e.mode][t.mode](...i);return $d(n,t.mode,"int",t.type)}class qe{static black(){return new qe([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=Op(e,t,this.type)}getComponents(e){return ma(Fp(Ai(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}}const tn=Xe("colp");class Qy{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(tn()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(tn("hsv"));const n=e.createElement("div");n.classList.add(tn("sv")),this.svPaletteView_=t.svPaletteView,n.appendChild(this.svPaletteView_.element),i.appendChild(n);const r=e.createElement("div");r.classList.add(tn("h")),this.hPaletteView_=t.hPaletteView,r.appendChild(this.hPaletteView_.element),i.appendChild(r),this.element.appendChild(i);const o=e.createElement("div");if(o.classList.add(tn("rgb")),this.textsView_=t.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const a=e.createElement("div");a.classList.add(tn("a"));const l=e.createElement("div");l.classList.add(tn("ap")),l.appendChild(this.alphaViews_.palette.element),a.appendChild(l);const c=e.createElement("div");c.classList.add(tn("at")),c.appendChild(this.alphaViews_.text.element),a.appendChild(c),this.element.appendChild(a)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}}function eS(s){return s==="int"?"int":s==="float"?"float":void 0}function Yc(s){return gt(s,e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(eS)}),expanded:e.optional.boolean,picker:e.optional.custom(kp),readonly:e.optional.constant(!1)}))}function $n(s){return s?.1:1}function Up(s){var e;return(e=s.color)===null||e===void 0?void 0:e.type}class qc{constructor(e,t){this.type="float",this.mode=t,this.comps_=Op(e,t,this.type)}getComponents(e){return ma(Fp(Ai(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}}const tS={int:(s,e)=>new qe(s,e),float:(s,e)=>new qc(s,e)};function Kc(s,e,t){return tS[t](s,e)}function iS(s){return s.type==="float"}function nS(s){return s.type==="int"}function sS(s){const e=s.getComponents(),t=ks(s.mode,"int");return new qe([Math.round(et(e[0],0,1,0,t[0])),Math.round(et(e[1],0,1,0,t[1])),Math.round(et(e[2],0,1,0,t[2])),e[3]],s.mode)}function rS(s){const e=s.getComponents(),t=ks(s.mode,"int");return new qc([et(e[0],0,t[0],0,1),et(e[1],0,t[1],0,1),et(e[2],0,t[2],0,1),e[3]],s.mode)}function Ht(s,e){if(s.type===e)return s;if(nS(s)&&e==="float")return rS(s);if(iS(s)&&e==="int")return sS(s);throw _t.shouldNeverHappen()}function oS(s,e){return s.alpha===e.alpha&&s.mode===e.mode&&s.notation===e.notation&&s.type===e.type}function fi(s,e){const t=s.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(s),e)}const aS={deg:s=>s,grad:s=>s*360/400,rad:s=>s*360/(2*Math.PI),turn:s=>s*360};function zp(s){const e=s.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(s);const t=parseFloat(e[1]),i=e[2];return aS[i](t)}function Bp(s){const e=s.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[fi(e[1],255),fi(e[2],255),fi(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function lS(s){const e=Bp(s);return e?new qe(e,"rgb"):null}function Vp(s){const e=s.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[fi(e[1],255),fi(e[2],255),fi(e[3],255),fi(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function cS(s){const e=Vp(s);return e?new qe(e,"rgb"):null}function Hp(s){const e=s.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[zp(e[1]),fi(e[2],100),fi(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function hS(s){const e=Hp(s);return e?new qe(e,"hsl"):null}function Gp(s){const e=s.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[zp(e[1]),fi(e[2],100),fi(e[3],100),fi(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function dS(s){const e=Gp(s);return e?new qe(e,"hsl"):null}function $p(s){const e=s.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const t=s.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function uS(s){const e=$p(s);return e?new qe(e,"rgb"):null}function Wp(s){const e=s.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),et(parseInt(e[4]+e[4],16),0,255,0,1)];const t=s.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),et(parseInt(t[4],16),0,255,0,1)]:null}function pS(s){const e=Wp(s);return e?new qe(e,"rgb"):null}function Xp(s){const e=s.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function fS(s){return e=>{const t=Xp(e);return t?Kc(t,"rgb",s):null}}function jp(s){const e=s.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function mS(s){return e=>{const t=jp(e);return t?Kc(t,"rgb",s):null}}const gS=[{parser:$p,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:Wp,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:Bp,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:Vp,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:Hp,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:Gp,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:Xp,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:jp,result:{alpha:!0,mode:"rgb",notation:"object"}}];function vS(s){return gS.reduce((e,{parser:t,result:i})=>e||(t(s)?i:null),null)}function _S(s,e="int"){const t=vS(s);return t?t.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},t),{type:"int"}):t.notation==="func"?Object.assign(Object.assign({},t),{type:e}):null:null}function Wr(s){const e=[uS,pS,lS,cS,hS,dS];e.push(fS("int"),mS("int"));const t=Ly(e);return i=>{const n=t(i);return n?Ht(n,s):null}}function bS(s){const e=Wr("int");if(typeof s!="string")return qe.black();const t=e(s);return t??qe.black()}function Yp(s){const e=Ct(Math.floor(s),0,255).toString(16);return e.length===1?`0${e}`:e}function Zc(s,e="#"){const t=Ai(s.getComponents("rgb")).map(Yp).join("");return`${e}${t}`}function Jc(s,e="#"){const t=s.getComponents("rgb"),i=[t[0],t[1],t[2],t[3]*255].map(Yp).join("");return`${e}${i}`}function qp(s){const e=Jt(0),t=Ht(s,"int");return`rgb(${Ai(t.getComponents("rgb")).map(n=>e(n)).join(", ")})`}function Go(s){const e=Jt(2),t=Jt(0);return`rgba(${Ht(s,"int").getComponents("rgb").map((r,o)=>(o===3?e:t)(r)).join(", ")})`}function xS(s){const e=[Jt(0),ra,ra],t=Ht(s,"int");return`hsl(${Ai(t.getComponents("hsl")).map((n,r)=>e[r](n)).join(", ")})`}function wS(s){const e=[Jt(0),ra,ra,Jt(2)];return`hsla(${Ht(s,"int").getComponents("hsl").map((n,r)=>e[r](n)).join(", ")})`}function Kp(s,e){const t=Jt(e==="float"?2:0),i=["r","g","b"],n=Ht(s,e);return`{${Ai(n.getComponents("rgb")).map((o,a)=>`${i[a]}: ${t(o)}`).join(", ")}}`}function yS(s){return e=>Kp(e,s)}function Zp(s,e){const t=Jt(2),i=Jt(e==="float"?2:0),n=["r","g","b","a"];return`{${Ht(s,e).getComponents("rgb").map((a,l)=>{const c=l===3?t:i;return`${n[l]}: ${c(a)}`}).join(", ")}}`}function SS(s){return e=>Zp(e,s)}const ES=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:Zc},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:Jc},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:qp},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:Go},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:xS},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:wS},...["int","float"].reduce((s,e)=>[...s,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:yS(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:SS(e)}],[])];function Jp(s){return ES.reduce((e,t)=>e||(oS(t.format,s)?t.stringifier:null),null)}const er=Xe("apl");class MS{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(er()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(er("b")),this.element.appendChild(i);const n=e.createElement("div");n.classList.add(er("c")),i.appendChild(n),this.colorElem_=n;const r=e.createElement("div");r.classList.add(er("m")),this.element.appendChild(r),this.markerElem_=r;const o=e.createElement("div");o.classList.add(er("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),i=new qe([t[0],t[1],t[2],0],"rgb"),n=new qe([t[0],t[1],t[2],255],"rgb"),r=["to right",Go(i),Go(n)];this.colorElem_.style.background=`linear-gradient(${r.join(",")})`,this.previewElem_.style.backgroundColor=Go(e);const o=et(t[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}}class CS{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new MS(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new qn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=e.point.x/e.bounds.width,n=this.value.rawValue,[r,o,a]=n.getComponents("hsv");this.value.setRawValue(new qe([r,o,a,i],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Kt($n(!0),Xi(e));if(t===0)return;const i=this.value.rawValue,[n,r,o,a]=i.getComponents("hsv");this.value.setRawValue(new qe([n,r,o,a+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Kt($n(!0),Xi(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const ms=Xe("coltxt");function TS(s){const e=s.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return e.appendChild(t.reduce((i,n)=>{const r=s.createElement("option");return r.textContent=n.text,r.value=n.value,i.appendChild(r),i},s.createDocumentFragment())),e}class AS{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ms()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(ms("m")),this.modeElem_=TS(e),this.modeElem_.classList.add(ms("ms")),i.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const n=e.createElement("div");n.classList.add(ms("mm")),n.appendChild(pa(e,"dropdown")),i.appendChild(n),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(ms("w")),this.element.appendChild(r),this.inputsElem_=r,this.inputViews_=t.inputViews,this.applyInputViews_(),Hi(t.mode,o=>{this.modeElem_.value=o})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){_p(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach(t=>{const i=e.createElement("div");i.classList.add(ms("c")),i.appendChild(t.element),this.inputsElem_.appendChild(i)})}}function RS(s){return Jt(s==="float"?2:0)}function PS(s,e,t){const i=ks(s,e)[t];return new Fr({min:0,max:i})}function DS(s,e,t){return new Gr(s,{arrayPosition:t===0?"fst":t===2?"lst":"mid",parser:e.parser,props:Ue.fromObject({formatter:RS(e.colorType),keyScale:$n(!1),pointerScale:e.colorType==="float"?.01:1}),value:pt(0,{constraint:PS(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}function LS(s,e){const t={colorMode:e.colorMode,colorType:e.colorType,parser:Wi,viewProps:e.viewProps};return[0,1,2].map(i=>{const n=DS(s,t,i);return Vs({primary:e.value,secondary:n.value,forward(r){return Ht(r,e.colorType).getComponents(e.colorMode)[i]},backward(r,o){const a=e.colorMode,c=Ht(r,e.colorType).getComponents(a);c[i]=o;const h=Kc(ma(Ai(c),c[3]),a,e.colorType);return Ht(h,"int")}}),n})}function IS(s,e){const t=new Sr(s,{parser:Wr("int"),props:Ue.fromObject({formatter:Zc}),value:pt(qe.black()),viewProps:e.viewProps});return Vs({primary:e.value,secondary:t.value,forward:i=>new qe(Ai(i.getComponents()),i.mode),backward:(i,n)=>new qe(ma(Ai(n.getComponents(i.mode)),i.getComponents()[3]),i.mode)}),[t]}function kS(s){return s!=="hex"}class NS{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=pt(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new AS(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return kS(t)?LS(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):IS(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(i=>i.view)}}const cl=Xe("hpl");class OS{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(cl()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(cl("c")),this.element.appendChild(i);const n=e.createElement("div");n.classList.add(cl("m")),this.element.appendChild(n),this.markerElem_=n,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=qp(new qe([t,100,100],"hsv"));const i=et(t,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}}class FS{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new OS(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new qn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=et(Ct(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),n=this.value.rawValue,[,r,o,a]=n.getComponents("hsv");this.value.setRawValue(new qe([i,r,o,a],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Kt($n(!1),Xi(e));if(t===0)return;const i=this.value.rawValue,[n,r,o,a]=i.getComponents("hsv");this.value.setRawValue(new qe([n+t,r,o,a],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Kt($n(!1),Xi(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const hl=Xe("svp"),Wd=64;class US{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(hl()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("canvas");i.height=Wd,i.width=Wd,i.classList.add(hl("c")),this.element.appendChild(i),this.canvasElement=i;const n=e.createElement("div");n.classList.add(hl("m")),this.element.appendChild(n),this.markerElem_=n,this.update_()}update_(){const e=Fw(this.canvasElement);if(!e)return;const i=this.value.rawValue.getComponents("hsv"),n=this.canvasElement.width,r=this.canvasElement.height,o=e.getImageData(0,0,n,r),a=o.data;for(let h=0;h<r;h++)for(let d=0;d<n;d++){const u=et(d,0,n,0,100),m=et(h,0,r,100,0),f=Np(i[0],u,m),_=(h*n+d)*4;a[_]=f[0],a[_+1]=f[1],a[_+2]=f[2],a[_+3]=255}e.putImageData(o,0,0);const l=et(i[1],0,100,0,100);this.markerElem_.style.left=`${l}%`;const c=et(i[2],0,100,100,0);this.markerElem_.style.top=`${c}%`}onValueChange_(){this.update_()}}class zS{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new US(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new qn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=et(e.point.x,0,e.bounds.width,0,100),n=et(e.point.y,0,e.bounds.height,100,0),[r,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new qe([r,i,n,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){Dp(e.key)&&e.preventDefault();const[t,i,n,r]=this.value.rawValue.getComponents("hsv"),o=$n(!1),a=Kt(o,Xi(e)),l=Kt(o,Er(e));a===0&&l===0||this.value.setRawValue(new qe([t,i+a,n+l,r],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=$n(!1),i=Kt(t,Xi(e)),n=Kt(t,Er(e));i===0&&n===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class BS{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new FS(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new zS(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new CS(e,{value:this.value,viewProps:this.viewProps}),text:new Gr(e,{parser:Wi,props:Ue.fromObject({pointerScale:.01,keyScale:.1,formatter:Jt(2)}),value:pt(0,{constraint:new Fr({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Vs({primary:this.value,secondary:this.alphaIcs_.text.value,forward:i=>i.getComponents()[3],backward:(i,n)=>{const r=i.getComponents();return r[3]=n,new qe(r,i.mode)}}),this.textsC_=new NS(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new Qy(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}}const dl=Xe("colsw");class VS{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(dl()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(dl("sw")),this.element.appendChild(i),this.swatchElem_=i;const n=e.createElement("button");n.classList.add(dl("b")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=Jc(e)}onValueChange_(){this.update_()}}class HS{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new VS(e,{value:this.value,viewProps:this.viewProps})}}class Qc{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=zr.create(t.expanded),this.swatchC_=new HS(e,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new Sr(e,{parser:t.parser,props:Ue.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new Wy(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new Ap(e,{viewProps:this.viewProps}):null;const n=new BS(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});n.view.allFocusableElements.forEach(r=>{r.addEventListener("blur",this.onPopupChildBlur_),r.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=n,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(n.view.element),Vs({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:r=>r,backward:(r,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),$c(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=bp(e);i&&t.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!Uc(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function GS(s){return Ai(s.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function $S(s){return s.getComponents("rgb").reduce((e,t,i)=>{const n=Math.floor(i===3?t*255:t)&255;return e<<8|n},0)>>>0}function WS(s){return new qe([s>>16&255,s>>8&255,s&255],"rgb")}function XS(s){return new qe([s>>24&255,s>>16&255,s>>8&255,et(s&255,0,255,0,1)],"rgb")}function jS(s){return typeof s!="number"?qe.black():WS(s)}function YS(s){return typeof s!="number"?qe.black():XS(s)}function $o(s,e){return typeof s!="object"||ot(s)?!1:e in s&&typeof s[e]=="number"}function Qp(s){return $o(s,"r")&&$o(s,"g")&&$o(s,"b")}function ef(s){return Qp(s)&&$o(s,"a")}function tf(s){return Qp(s)}function eh(s,e){if(s.mode!==e.mode||s.type!==e.type)return!1;const t=s.getComponents(),i=e.getComponents();for(let n=0;n<t.length;n++)if(t[n]!==i[n])return!1;return!0}function Xd(s){return"a"in s?[s.r,s.g,s.b,s.a]:[s.r,s.g,s.b]}function qS(s){const e=Jp(s);return e?(t,i)=>{$r(t,e(i))}:null}function KS(s){const e=s?$S:GS;return(t,i)=>{$r(t,e(i))}}function ZS(s,e,t){const n=Ht(e,t).toRgbaObject();s.writeProperty("r",n.r),s.writeProperty("g",n.g),s.writeProperty("b",n.b),s.writeProperty("a",n.a)}function JS(s,e,t){const n=Ht(e,t).toRgbaObject();s.writeProperty("r",n.r),s.writeProperty("g",n.g),s.writeProperty("b",n.b)}function QS(s,e){return(t,i)=>{s?ZS(t,i,e):JS(t,i,e)}}function eE(s){var e;return!!(!((e=s==null?void 0:s.color)===null||e===void 0)&&e.alpha)}function tE(s){return s?e=>Jc(e,"0x"):e=>Zc(e,"0x")}function iE(s){return"color"in s||s.view==="color"}const nE=Gt({id:"input-color-number",type:"input",accept:(s,e)=>{if(typeof s!="number"||!iE(e))return null;const t=Yc(e);return t?{initialValue:s,params:Object.assign(Object.assign({},t),{supportsAlpha:eE(e)})}:null},binding:{reader:s=>s.params.supportsAlpha?YS:jS,equals:eh,writer:s=>KS(s.params.supportsAlpha)},controller:s=>{var e,t;return new Qc(s.document,{colorType:"int",expanded:(e=s.params.expanded)!==null&&e!==void 0?e:!1,formatter:tE(s.params.supportsAlpha),parser:Wr("int"),pickerLayout:(t=s.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:s.params.supportsAlpha,value:s.value,viewProps:s.viewProps})}});function sE(s,e){if(!tf(s))return Ht(qe.black(),e);if(e==="int"){const t=Xd(s);return new qe(t,"rgb")}if(e==="float"){const t=Xd(s);return new qc(t,"rgb")}return Ht(qe.black(),"int")}function rE(s){return ef(s)}function oE(s){return e=>{const t=sE(e,s);return Ht(t,"int")}}function aE(s,e){return t=>s?Zp(t,e):Kp(t,e)}const lE=Gt({id:"input-color-object",type:"input",accept:(s,e)=>{var t;if(!tf(s))return null;const i=Yc(e);return i?{initialValue:s,params:Object.assign(Object.assign({},i),{colorType:(t=Up(e))!==null&&t!==void 0?t:"int"})}:null},binding:{reader:s=>oE(s.params.colorType),equals:eh,writer:s=>QS(rE(s.initialValue),s.params.colorType)},controller:s=>{var e,t;const i=ef(s.initialValue);return new Qc(s.document,{colorType:s.params.colorType,expanded:(e=s.params.expanded)!==null&&e!==void 0?e:!1,formatter:aE(i,s.params.colorType),parser:Wr("int"),pickerLayout:(t=s.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:i,value:s.value,viewProps:s.viewProps})}}),cE=Gt({id:"input-color-string",type:"input",accept:(s,e)=>{if(typeof s!="string"||e.view==="text")return null;const t=_S(s,Up(e));if(!t)return null;const i=Jp(t);if(!i)return null;const n=Yc(e);return n?{initialValue:s,params:Object.assign(Object.assign({},n),{format:t,stringifier:i})}:null},binding:{reader:()=>bS,equals:eh,writer:s=>{const e=qS(s.params.format);if(!e)throw _t.notBindable();return e}},controller:s=>{var e,t;return new Qc(s.document,{colorType:s.params.format.type,expanded:(e=s.params.expanded)!==null&&e!==void 0?e:!1,formatter:s.params.stringifier,parser:Wr("int"),pickerLayout:(t=s.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:s.params.format.alpha,value:s.value,viewProps:s.viewProps})}});class th{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((i,n)=>{var r,o;return(o=(r=this.components[n])===null||r===void 0?void 0:r.constrain(i))!==null&&o!==void 0?o:i});return this.asm_.fromComponents(t)}}const jd=Xe("pndtxt");class hE{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(jd()),this.textViews.forEach(i=>{const n=e.createElement("div");n.classList.add(jd("a")),n.appendChild(i.element),this.element.appendChild(n)})}}function dE(s,e,t){return new Gr(s,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[t].textProps,value:pt(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}class ih{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((i,n)=>dE(e,t,n)),this.acs_.forEach((i,n)=>{Vs({primary:this.value,secondary:i.value,forward:r=>t.assembly.toComponents(r)[n],backward:(r,o)=>{const a=t.assembly.toComponents(r);return a[n]=o,t.assembly.fromComponents(a)}})}),this.view=new hE(e,{textViews:this.acs_.map(i=>i.view)})}get textControllers(){return this.acs_}}class uE extends yr{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}}function pE(s,e){const t=[],i=up(s,e);i&&t.push(i);const n=pp(s);n&&t.push(n);const r=jc(s.options);return r&&t.push(r),new Br(t)}const fE=Gt({id:"input-number",type:"input",accept:(s,e)=>{if(typeof s!="number")return null;const t=gt(e,i=>Object.assign(Object.assign({},mp(i)),{options:i.optional.custom(Hr),readonly:i.optional.constant(!1)}));return t?{initialValue:s,params:t}:null},binding:{reader:s=>lp,constraint:s=>pE(s.params,s.initialValue),writer:s=>$r},controller:s=>{const e=s.value,t=s.constraint,i=t&&sa(t,Vr);if(i)return new gn(s.document,{props:new Ue({options:i.values.value("options")}),value:e,viewProps:s.viewProps});const n=fp(s.params,e.rawValue),r=t&&sa(t,Fr);return r?new oa(s.document,Object.assign(Object.assign({},Lp(Object.assign(Object.assign({},n),{keyScale:pt(n.keyScale),max:r.values.value("max"),min:r.values.value("min")}))),{parser:Wi,value:e,viewProps:s.viewProps})):new Gr(s.document,{parser:Wi,props:Ue.fromObject(n),value:e,viewProps:s.viewProps})},api(s){return typeof s.controller.value.rawValue!="number"?null:s.controller.valueController instanceof oa?new uE(s.controller):s.controller.valueController instanceof gn?new Wc(s.controller):null}});class un{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(ot(e))return!1;const t=e.x,i=e.y;return!(typeof t!="number"||typeof i!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}}const nf={toComponents:s=>s.getComponents(),fromComponents:s=>new un(...s)},gs=Xe("p2d");class mE{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(gs()),t.viewProps.bindClassModifiers(this.element),Hi(t.expanded,Us(this.element,gs(void 0,"expanded")));const i=e.createElement("div");i.classList.add(gs("h")),this.element.appendChild(i);const n=e.createElement("button");n.classList.add(gs("b")),n.appendChild(pa(e,"p2dpad")),t.viewProps.bindDisabled(n),i.appendChild(n),this.buttonElement=n;const r=e.createElement("div");if(r.classList.add(gs("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(gs("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}}const nn=Xe("p2dp");class gE{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(nn()),t.layout==="popup"&&this.element.classList.add(nn(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(nn("p")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const n=e.createElementNS(Mi,"svg");n.classList.add(nn("g")),this.padElement.appendChild(n),this.svgElem_=n;const r=e.createElementNS(Mi,"line");r.classList.add(nn("ax")),r.setAttributeNS(null,"x1","0"),r.setAttributeNS(null,"y1","50%"),r.setAttributeNS(null,"x2","100%"),r.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(r);const o=e.createElementNS(Mi,"line");o.classList.add(nn("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const a=e.createElementNS(Mi,"line");a.classList.add(nn("l")),a.setAttributeNS(null,"x1","50%"),a.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(a),this.lineElem_=a;const l=e.createElement("div");l.classList.add(nn("m")),this.padElement.appendChild(l),this.markerElem_=l,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),i=this.props_.get("max"),n=et(e,-i,+i,0,100),r=et(t,-i,+i,0,100),o=this.props_.get("invertsY")?100-r:r;this.lineElem_.setAttributeNS(null,"x2",`${n}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${n}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Yd(s,e,t){return[Kt(e[0],Xi(s)),Kt(e[1],Er(s))*(t?1:-1)]}class vE{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new gE(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new qn(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=this.props.get("max"),n=et(e.point.x,0,e.bounds.width,-i,+i),r=et(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-i,+i);this.value.setRawValue(new un(n,r),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){Dp(e.key)&&e.preventDefault();const[t,i]=Yd(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(new un(this.value.rawValue.x+t,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,i]=Yd(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class _E{constructor(e,t){var i,n;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=zr.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new Ap(e,{viewProps:this.viewProps}):null;const r=new vE(e,{layout:t.pickerLayout,props:new Ue({invertsY:pt(t.invertsY),max:pt(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach(o=>{o.addEventListener("blur",this.onPopupChildBlur_),o.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=r,this.textC_=new ih(e,{assembly:nf,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new mE(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(i=this.view.buttonElement)===null||i===void 0||i.addEventListener("blur",this.onPadButtonBlur_),(n=this.view.buttonElement)===null||n===void 0||n.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Vs({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:o=>o,backward:(o,a)=>a})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),$c(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=bp(e);i&&t.contains(i)||i&&i===this.view.buttonElement&&!Uc(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}}function bE(s){return un.isObject(s)?new un(s.x,s.y):new un}function xE(s,e){s.writeProperty("x",e.x),s.writeProperty("y",e.y)}function wE(s,e){return new th({assembly:nf,components:[Bi(Object.assign(Object.assign({},s),s.x),e.x),Bi(Object.assign(Object.assign({},s),s.y),e.y)]})}function qd(s,e){var t,i;if(!ot(s.min)||!ot(s.max))return Math.max(Math.abs((t=s.min)!==null&&t!==void 0?t:0),Math.abs((i=s.max)!==null&&i!==void 0?i:0));const n=hp(s);return Math.max(Math.abs(n)*10,Math.abs(e)*10)}function yE(s,e){var t,i;const n=qd(Hn(s,(t=s.x)!==null&&t!==void 0?t:{}),e.x),r=qd(Hn(s,(i=s.y)!==null&&i!==void 0?i:{}),e.y);return Math.max(n,r)}function SE(s){if(!("y"in s))return!1;const e=s.y;return e&&"inverted"in e?!!e.inverted:!1}const EE=Gt({id:"input-point2d",type:"input",accept:(s,e)=>{if(!un.isObject(s))return null;const t=gt(e,i=>Object.assign(Object.assign({},Mr(i)),{expanded:i.optional.boolean,picker:i.optional.custom(kp),readonly:i.optional.constant(!1),x:i.optional.custom(cn),y:i.optional.object(Object.assign(Object.assign({},Mr(i)),{inverted:i.optional.boolean}))}));return t?{initialValue:s,params:t}:null},binding:{reader:()=>bE,constraint:s=>wE(s.params,s.initialValue),equals:un.equals,writer:()=>xE},controller:s=>{var e,t;const i=s.document,n=s.value,r=s.constraint,o=[s.params.x,s.params.y];return new _E(i,{axes:n.rawValue.getComponents().map((a,l)=>{var c;return Fc({constraint:r.components[l],initialValue:a,params:Hn(s.params,(c=o[l])!==null&&c!==void 0?c:{})})}),expanded:(e=s.params.expanded)!==null&&e!==void 0?e:!1,invertsY:SE(s.params),max:yE(s.params,n.rawValue),parser:Wi,pickerLayout:(t=s.params.picker)!==null&&t!==void 0?t:"popup",value:n,viewProps:s.viewProps})}});class Cs{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(ot(e))return!1;const t=e.x,i=e.y,n=e.z;return!(typeof t!="number"||typeof i!="number"||typeof n!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const sf={toComponents:s=>s.getComponents(),fromComponents:s=>new Cs(...s)};function ME(s){return Cs.isObject(s)?new Cs(s.x,s.y,s.z):new Cs}function CE(s,e){s.writeProperty("x",e.x),s.writeProperty("y",e.y),s.writeProperty("z",e.z)}function TE(s,e){return new th({assembly:sf,components:[Bi(Object.assign(Object.assign({},s),s.x),e.x),Bi(Object.assign(Object.assign({},s),s.y),e.y),Bi(Object.assign(Object.assign({},s),s.z),e.z)]})}const AE=Gt({id:"input-point3d",type:"input",accept:(s,e)=>{if(!Cs.isObject(s))return null;const t=gt(e,i=>Object.assign(Object.assign({},Mr(i)),{readonly:i.optional.constant(!1),x:i.optional.custom(cn),y:i.optional.custom(cn),z:i.optional.custom(cn)}));return t?{initialValue:s,params:t}:null},binding:{reader:s=>ME,constraint:s=>TE(s.params,s.initialValue),equals:Cs.equals,writer:s=>CE},controller:s=>{const e=s.value,t=s.constraint,i=[s.params.x,s.params.y,s.params.z];return new ih(s.document,{assembly:sf,axes:e.rawValue.getComponents().map((n,r)=>{var o;return Fc({constraint:t.components[r],initialValue:n,params:Hn(s.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:Wi,value:e,viewProps:s.viewProps})}});class Ts{constructor(e=0,t=0,i=0,n=0){this.x=e,this.y=t,this.z=i,this.w=n}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(ot(e))return!1;const t=e.x,i=e.y,n=e.z,r=e.w;return!(typeof t!="number"||typeof i!="number"||typeof n!="number"||typeof r!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const rf={toComponents:s=>s.getComponents(),fromComponents:s=>new Ts(...s)};function RE(s){return Ts.isObject(s)?new Ts(s.x,s.y,s.z,s.w):new Ts}function PE(s,e){s.writeProperty("x",e.x),s.writeProperty("y",e.y),s.writeProperty("z",e.z),s.writeProperty("w",e.w)}function DE(s,e){return new th({assembly:rf,components:[Bi(Object.assign(Object.assign({},s),s.x),e.x),Bi(Object.assign(Object.assign({},s),s.y),e.y),Bi(Object.assign(Object.assign({},s),s.z),e.z),Bi(Object.assign(Object.assign({},s),s.w),e.w)]})}const LE=Gt({id:"input-point4d",type:"input",accept:(s,e)=>{if(!Ts.isObject(s))return null;const t=gt(e,i=>Object.assign(Object.assign({},Mr(i)),{readonly:i.optional.constant(!1),w:i.optional.custom(cn),x:i.optional.custom(cn),y:i.optional.custom(cn),z:i.optional.custom(cn)}));return t?{initialValue:s,params:t}:null},binding:{reader:s=>RE,constraint:s=>DE(s.params,s.initialValue),equals:Ts.equals,writer:s=>PE},controller:s=>{const e=s.value,t=s.constraint,i=[s.params.x,s.params.y,s.params.z,s.params.w];return new ih(s.document,{assembly:rf,axes:e.rawValue.getComponents().map((n,r)=>{var o;return Fc({constraint:t.components[r],initialValue:n,params:Hn(s.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:Wi,value:e,viewProps:s.viewProps})}});function IE(s){const e=[],t=jc(s.options);return t&&e.push(t),new Br(e)}const kE=Gt({id:"input-string",type:"input",accept:(s,e)=>{if(typeof s!="string")return null;const t=gt(e,i=>({readonly:i.optional.constant(!1),options:i.optional.custom(Hr)}));return t?{initialValue:s,params:t}:null},binding:{reader:s=>Pp,constraint:s=>IE(s.params),writer:s=>$r},controller:s=>{const e=s.document,t=s.value,i=s.constraint,n=i&&sa(i,Vr);return n?new gn(e,{props:new Ue({options:n.values.value("options")}),value:t,viewProps:s.viewProps}):new Sr(e,{parser:r=>r,props:Ue.fromObject({formatter:pc}),value:t,viewProps:s.viewProps})},api(s){return typeof s.controller.value.rawValue!="string"?null:s.controller.valueController instanceof gn?new Wc(s.controller):null}}),Xr={monitor:{defaultInterval:200,defaultRows:3}},Kd=Xe("mll");class NE{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(Kd()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("textarea");i.classList.add(Kd("i")),i.style.height=`calc(var(${Ip("containerUnitSize")}) * ${t.rows})`,i.readOnly=!0,t.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,i=[];this.value.rawValue.forEach(n=>{n!==void 0&&i.push(this.formatter_(n))}),e.textContent=i.join(`
`),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}}class nh{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new NE(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}}const Zd=Xe("sgl");class OE{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(Zd()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(Zd("i")),i.readOnly=!0,i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}}class sh{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new OE(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}}const FE=Gt({id:"monitor-bool",type:"monitor",accept:(s,e)=>{if(typeof s!="boolean")return null;const t=gt(e,i=>({readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:s,params:t}:null},binding:{reader:s=>Rp},controller:s=>{var e;return s.value.rawValue.length===1?new sh(s.document,{formatter:Gd,value:s.value,viewProps:s.viewProps}):new nh(s.document,{formatter:Gd,rows:(e=s.params.rows)!==null&&e!==void 0?e:Xr.monitor.defaultRows,value:s.value,viewProps:s.viewProps})}});class UE extends yr{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}}const sn=Xe("grl");class zE{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(sn()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const i=e.createElementNS(Mi,"svg");i.classList.add(sn("g")),i.style.height=`calc(var(${Ip("containerUnitSize")}) * ${t.rows})`,this.element.appendChild(i),this.svgElem_=i;const n=e.createElementNS(Mi,"polyline");this.svgElem_.appendChild(n),this.lineElem_=n;const r=e.createElement("div");r.classList.add(sn("t"),Xe("tt")()),this.element.appendChild(r),this.tooltipElem_=r,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const{clientWidth:e,clientHeight:t}=this.element,i=this.value.rawValue.length-1,n=this.props_.get("min"),r=this.props_.get("max"),o=[];this.value.rawValue.forEach((d,u)=>{if(d===void 0)return;const m=et(u,0,i,0,e),f=et(d,n,r,t,0);o.push([m,f].join(","))}),this.lineElem_.setAttributeNS(null,"points",o.join(" "));const a=this.tooltipElem_,l=this.value.rawValue[this.cursor_.rawValue];if(l===void 0){a.classList.remove(sn("t","a"));return}const c=et(this.cursor_.rawValue,0,i,0,e),h=et(l,n,r,t,0);a.style.left=`${c}px`,a.style.top=`${h}px`,a.textContent=`${this.formatter_(l)}`,a.classList.contains(sn("t","a"))||(a.classList.add(sn("t","a"),sn("t","in")),na(a),a.classList.remove(sn("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class of{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=pt(-1),this.view=new zE(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!Uc(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const i=new qn(this.view.element);i.emitter.on("down",this.onGraphPointerDown_),i.emitter.on("move",this.onGraphPointerMove_),i.emitter.on("up",this.onGraphPointerUp_)}}importProps(e){return si(e,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return ri(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const{clientWidth:t}=this.view.element;this.cursor_.rawValue=Math.floor(et(e.offsetX,0,t,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(et(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function fc(s){return ot(s.format)?Jt(2):s.format}function BE(s){var e;return s.value.rawValue.length===1?new sh(s.document,{formatter:fc(s.params),value:s.value,viewProps:s.viewProps}):new nh(s.document,{formatter:fc(s.params),rows:(e=s.params.rows)!==null&&e!==void 0?e:Xr.monitor.defaultRows,value:s.value,viewProps:s.viewProps})}function VE(s){var e,t,i;return new of(s.document,{formatter:fc(s.params),rows:(e=s.params.rows)!==null&&e!==void 0?e:Xr.monitor.defaultRows,props:Ue.fromObject({max:(t=s.params.max)!==null&&t!==void 0?t:100,min:(i=s.params.min)!==null&&i!==void 0?i:0}),value:s.value,viewProps:s.viewProps})}function Jd(s){return s.view==="graph"}const HE=Gt({id:"monitor-number",type:"monitor",accept:(s,e)=>{if(typeof s!="number")return null;const t=gt(e,i=>({format:i.optional.function,max:i.optional.number,min:i.optional.number,readonly:i.required.constant(!0),rows:i.optional.number,view:i.optional.string}));return t?{initialValue:s,params:t}:null},binding:{defaultBufferSize:s=>Jd(s)?64:1,reader:s=>lp},controller:s=>Jd(s.params)?VE(s):BE(s),api:s=>s.controller.valueController instanceof of?new UE(s.controller):null}),GE=Gt({id:"monitor-string",type:"monitor",accept:(s,e)=>{if(typeof s!="string")return null;const t=gt(e,i=>({multiline:i.optional.boolean,readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:s,params:t}:null},binding:{reader:s=>Pp},controller:s=>{var e;const t=s.value;return t.rawValue.length>1||s.params.multiline?new nh(s.document,{formatter:pc,rows:(e=s.params.rows)!==null&&e!==void 0?e:Xr.monitor.defaultRows,value:t,viewProps:s.viewProps}):new sh(s.document,{formatter:pc,value:t,viewProps:s.viewProps})}});class $E{constructor(){this.map_=new Map}get(e){var t;return(t=this.map_.get(e))!==null&&t!==void 0?t:null}has(e){return this.map_.has(e)}add(e,t){return this.map_.set(e,t),e.viewProps.handleDispose(()=>{this.map_.delete(e)}),t}}class WE{constructor(e){this.target=e.target,this.reader_=e.reader,this.writer_=e.writer}read(){return this.reader_(this.target.read())}write(e){this.writer_(this.target,e)}inject(e){this.write(this.reader_(e))}}function XE(s,e){var t;const i=s.accept(e.target.read(),e.params);if(ot(i))return null;const n={target:e.target,initialValue:i.initialValue,params:i.params},r=gt(e.params,d=>({disabled:d.optional.boolean,hidden:d.optional.boolean,label:d.optional.string,tag:d.optional.string})),o=s.binding.reader(n),a=s.binding.constraint?s.binding.constraint(n):void 0,l=new WE({reader:o,target:e.target,writer:s.binding.writer(n)}),c=new Rw(pt(o(i.initialValue),{constraint:a,equals:s.binding.equals}),l),h=s.controller({constraint:a,document:e.document,initialValue:i.initialValue,params:i.params,value:c,viewProps:ji.create({disabled:r==null?void 0:r.disabled,hidden:r==null?void 0:r.hidden})});return new $w(e.document,{blade:Bs(),props:Ue.fromObject({label:"label"in e.params?(t=r==null?void 0:r.label)!==null&&t!==void 0?t:null:e.target.key}),tag:r==null?void 0:r.tag,value:c,valueController:h})}class jE{constructor(e){this.target=e.target,this.reader_=e.reader}read(){return this.reader_(this.target.read())}}function YE(s,e){return e===0?new Cy:new Ty(s,e??Xr.monitor.defaultInterval)}function qE(s,e){var t,i,n;const r=s.accept(e.target.read(),e.params);if(ot(r))return null;const o={target:e.target,initialValue:r.initialValue,params:r.params},a=gt(e.params,u=>({bufferSize:u.optional.number,disabled:u.optional.boolean,hidden:u.optional.boolean,interval:u.optional.number,label:u.optional.string})),l=s.binding.reader(o),c=(i=(t=a==null?void 0:a.bufferSize)!==null&&t!==void 0?t:s.binding.defaultBufferSize&&s.binding.defaultBufferSize(r.params))!==null&&i!==void 0?i:1,h=new qw({binding:new jE({reader:l,target:e.target}),bufferSize:c,ticker:YE(e.document,a==null?void 0:a.interval)}),d=s.controller({document:e.document,params:r.params,value:h,viewProps:ji.create({disabled:a==null?void 0:a.disabled,hidden:a==null?void 0:a.hidden})});return d.viewProps.bindDisabled(h.ticker),d.viewProps.handleDispose(()=>{h.ticker.dispose()}),new Zw(e.document,{blade:Bs(),props:Ue.fromObject({label:"label"in e.params?(n=a==null?void 0:a.label)!==null&&n!==void 0?n:null:e.target.key}),value:h,valueController:d})}class KE{constructor(e){this.pluginsMap_={blades:[],inputs:[],monitors:[]},this.apiCache_=e}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(e,t){if(!By(t.core))throw _t.notCompatible(e,t.id);t.type==="blade"?this.pluginsMap_.blades.unshift(t):t.type==="input"?this.pluginsMap_.inputs.unshift(t):t.type==="monitor"&&this.pluginsMap_.monitors.unshift(t)}createInput_(e,t,i){return this.pluginsMap_.inputs.reduce((n,r)=>n??XE(r,{document:e,target:t,params:i}),null)}createMonitor_(e,t,i){return this.pluginsMap_.monitors.reduce((n,r)=>n??qE(r,{document:e,params:i,target:t}),null)}createBinding(e,t,i){const n=t.read();if(ot(n))throw new _t({context:{key:t.key},type:"nomatchingcontroller"});const r=this.createInput_(e,t,i);if(r)return r;const o=this.createMonitor_(e,t,i);if(o)return o;throw new _t({context:{key:t.key},type:"nomatchingcontroller"})}createBlade(e,t){const i=this.pluginsMap_.blades.reduce((n,r)=>n??My(r,{document:e,params:t}),null);if(!i)throw new _t({type:"nomatchingview",context:{params:t}});return i}createInputBindingApi_(e){const t=this.pluginsMap_.inputs.reduce((i,n)=>{var r,o;return i||((o=(r=n.api)===null||r===void 0?void 0:r.call(n,{controller:e}))!==null&&o!==void 0?o:null)},null);return this.apiCache_.add(e,t??new yr(e))}createMonitorBindingApi_(e){const t=this.pluginsMap_.monitors.reduce((i,n)=>{var r,o;return i||((o=(r=n.api)===null||r===void 0?void 0:r.call(n,{controller:e}))!==null&&o!==void 0?o:null)},null);return this.apiCache_.add(e,t??new yr(e))}createBindingApi(e){if(this.apiCache_.has(e))return this.apiCache_.get(e);if(Ww(e))return this.createInputBindingApi_(e);if(Jw(e))return this.createMonitorBindingApi_(e);throw _t.shouldNeverHappen()}createApi(e){if(this.apiCache_.has(e))return this.apiCache_.get(e);if(Gw(e))return this.createBindingApi(e);const t=this.pluginsMap_.blades.reduce((i,n)=>i??n.api({controller:e,pool:this}),null);if(!t)throw _t.shouldNeverHappen();return this.apiCache_.add(e,t)}}const ZE=new $E;function JE(){const s=new KE(ZE);return[EE,AE,LE,kE,fE,cE,lE,nE,$y,FE,GE,HE,ny,gy,Tp].forEach(e=>{s.register("core",e)}),s}class QE extends Yn{constructor(e){super(e),this.emitter_=new Et,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new Ur(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}get value(){return this.controller.value.rawValue}set value(e){this.controller.value.rawValue=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,n=>{i(n)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}}class e1 extends Yn{}class t1 extends Yn{constructor(e){super(e),this.emitter_=new Et,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new Ur(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}get value(){return this.controller.value.rawValue}set value(e){this.controller.value.rawValue=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,n=>{i(n)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}}class i1 extends Yn{constructor(e){super(e),this.emitter_=new Et,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new Ur(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get formatter(){return this.controller.valueController.props.get("formatter")}set formatter(e){this.controller.valueController.props.set("formatter",e)}get value(){return this.controller.value.rawValue}set value(e){this.controller.value.rawValue=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,n=>{i(n)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}}const n1=function(){return{id:"list",type:"blade",core:zs,accept(s){const e=gt(s,t=>({options:t.required.custom(Hr),value:t.required.raw,view:t.required.constant("list"),label:t.optional.string}));return e?{params:e}:null},controller(s){const e=new Vr(Xc(s.params.options)),t=pt(s.params.value,{constraint:e}),i=new gn(s.document,{props:new Ue({options:e.values.value("options")}),value:t,viewProps:s.viewProps});return new Gn(s.document,{blade:s.blade,props:Ue.fromObject({label:s.params.label}),value:t,valueController:i})},api(s){return!(s.controller instanceof Gn)||!(s.controller.valueController instanceof gn)?null:new QE(s.controller)}}}();class s1 extends Mp{constructor(e,t){super(e,t)}get element(){return this.controller.view.element}}class r1 extends dc{constructor(e,t){super(e,{expanded:t.expanded,blade:t.blade,props:t.props,root:!0,viewProps:t.viewProps})}}const Qd=Xe("spr");class o1{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Qd()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("hr");i.classList.add(Qd("r")),this.element.appendChild(i)}}class eu extends fa{constructor(e,t){super(Object.assign(Object.assign({},t),{view:new o1(e,{viewProps:t.viewProps})}))}}const a1={id:"separator",type:"blade",core:zs,accept(s){const e=gt(s,t=>({view:t.required.constant("separator")}));return e?{params:e}:null},controller(s){return new eu(s.document,{blade:s.blade,viewProps:s.viewProps})},api(s){return s.controller instanceof eu?new e1(s.controller):null}},l1={id:"slider",type:"blade",core:zs,accept(s){const e=gt(s,t=>({max:t.required.number,min:t.required.number,view:t.required.constant("slider"),format:t.optional.function,label:t.optional.string,value:t.optional.number}));return e?{params:e}:null},controller(s){var e,t;const i=(e=s.params.value)!==null&&e!==void 0?e:0,n=new Fr({max:s.params.max,min:s.params.min}),r=pt(i,{constraint:n}),o=new oa(s.document,Object.assign(Object.assign({},Lp({formatter:(t=s.params.format)!==null&&t!==void 0?t:Ew,keyScale:pt(1),max:n.values.value("max"),min:n.values.value("min"),pointerScale:dp(s.params,i)})),{parser:Wi,value:r,viewProps:s.viewProps}));return new Gn(s.document,{blade:s.blade,props:Ue.fromObject({label:s.params.label}),value:r,valueController:o})},api(s){return!(s.controller instanceof Gn)||!(s.controller.valueController instanceof oa)?null:new t1(s.controller)}},c1=function(){return{id:"text",type:"blade",core:zs,accept(s){const e=gt(s,t=>({parse:t.required.function,value:t.required.raw,view:t.required.constant("text"),format:t.optional.function,label:t.optional.string}));return e?{params:e}:null},controller(s){var e;const t=pt(s.params.value),i=new Sr(s.document,{parser:s.params.parse,props:Ue.fromObject({formatter:(e=s.params.format)!==null&&e!==void 0?e:n=>String(n)}),value:t,viewProps:s.viewProps});return new Gn(s.document,{blade:s.blade,props:Ue.fromObject({label:s.params.label}),value:t,valueController:i})},api(s){return!(s.controller instanceof Gn)||!(s.controller.valueController instanceof Sr)?null:new i1(s.controller)}}}();function h1(s){const e=s.createElement("div");return e.classList.add(Xe("dfw")()),s.body&&s.body.appendChild(e),e}function d1(s,e,t){if(s.querySelector(`style[data-tp-style=${e}]`))return;const i=s.createElement("style");i.dataset.tpStyle=e,i.textContent=t,s.head.appendChild(i)}class u1 extends s1{constructor(e){var t,i;const n=e??{},r=(t=n.document)!==null&&t!==void 0?t:Ow(),o=JE(),a=new r1(r,{expanded:n.expanded,blade:Bs(),props:Ue.fromObject({title:n.title}),viewProps:ji.create()});super(a,o),this.pool_=o,this.containerElem_=(i=n.container)!==null&&i!==void 0?i:h1(r),this.containerElem_.appendChild(this.element),this.doc_=r,this.usesDefaultWrapper_=!n.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw _t.alreadyDisposed();return this.doc_}dispose(){const e=this.containerElem_;if(!e)throw _t.alreadyDisposed();if(this.usesDefaultWrapper_){const t=e.parentElement;t&&t.removeChild(e)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(e){e.css&&d1(this.document,`plugin-${e.id}`,e.css),("plugin"in e?[e.plugin]:"plugins"in e?e.plugins:[]).forEach(i=>{this.pool_.register(e.id,i)})}setUpDefaultPlugins_(){this.registerPlugin({id:"default",css:'.tp-tbiv_b,.tp-coltxtv_ms,.tp-colswv_b,.tp-ckbv_i,.tp-sglv_i,.tp-mllv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-rotv_b,.tp-fldv_b,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--bld-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--cnt-usz);line-height:var(--cnt-usz);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tbpv_c>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-vp))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tbpv_c>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--cnt-usp)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tbpv_c>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tbpv_c>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tbpv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tbpv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tbpv_c>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tbpv_c>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--bld-br);border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tbpv_c .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tbpv_c>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tbpv_c>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--bld-br)}.tp-tbpv_c .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--bld-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);overflow:hidden;padding-left:var(--cnt-hp);padding-right:calc(4px + var(--cnt-usz) + var(--cnt-hp));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-hp) + (var(--cnt-usz) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-vp);padding-top:var(--cnt-vp);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--cnt-usz);line-height:var(--cnt-usz);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-sglv_i,.tp-mllv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--mo-fg);height:var(--cnt-usz);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-sglv_i::-webkit-scrollbar,.tp-mllv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-sglv_i::-webkit-scrollbar-corner,.tp-mllv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-sglv_i::-webkit-scrollbar-thumb,.tp-mllv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-rotv{--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-br: var(--tp-base-border-radius, 6px);--bs-ff: var(--tp-base-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--bld-br: var(--tp-blade-border-radius, 2px);--bld-hp: var(--tp-blade-horizontal-padding, 4px);--bld-vw: var(--tp-blade-value-width, 160px);--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--cnt-hp: var(--tp-container-horizontal-padding, 4px);--cnt-vp: var(--tp-container-vertical-padding, 4px);--cnt-usp: var(--tp-container-unit-spacing, 4px);--cnt-usz: var(--tp-container-unit-size, 20px);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--bld-br);cursor:pointer;display:block;height:var(--cnt-usz);position:relative;width:var(--cnt-usz)}.tp-ckbv_w svg{display:block;height:16px;inset:0;margin:auto;opacity:0;position:absolute;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--cnt-usz)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--cnt-usp);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--cnt-usp)}.tp-colpv_rgb{display:flex;margin-top:var(--cnt-usp);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-vp);padding-top:calc(var(--cnt-vp) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-hp));position:absolute;right:calc(-1*var(--cnt-hp));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--bld-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--cnt-usz)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{inset:0;position:absolute}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--bld-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;inset:0;position:absolute}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--bld-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{cursor:pointer;display:block;height:var(--cnt-usz);left:0;position:absolute;top:0;width:var(--cnt-usz)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--bld-br);content:"";display:block;inset:0;position:absolute}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--bld-br);color:var(--lbl-fg);cursor:pointer;height:var(--cnt-usz);line-height:var(--cnt-usz);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--cnt-usz)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-hp);padding-right:var(--cnt-hp)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:var(--bld-vw)}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 var(--bld-hp);width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--cnt-usz)*3);line-height:var(--cnt-usz);padding-left:var(--bld-hp);padding-right:var(--bld-hp);resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--cnt-usz);margin-right:4px;position:relative;width:var(--cnt-usz)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--cnt-usp);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-p2dpv{padding-left:calc(var(--cnt-usz) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:var(--bld-vw);padding:var(--cnt-vp) var(--cnt-hp);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--cnt-usz);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";display:block;height:2px;inset:0;margin:auto;position:absolute}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;content:"";display:block;height:2px;inset:0;margin-bottom:auto;margin-top:auto;position:absolute}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--bld-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--cnt-usz) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-hp) + 4px);padding-right:calc(var(--cnt-hp) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);content:"";inset:0 0 2px;pointer-events:none;position:absolute}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);opacity:.5;overflow:hidden;position:relative;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-tbpv_c{padding-bottom:var(--cnt-vp);padding-left:4px;padding-top:var(--cnt-vp)}.tp-txtv{position:relative}.tp-txtv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:calc(var(--bld-hp) - 5px);position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--cnt-usz) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--bld-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--bs-ff);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--cnt-usz) + var(--cnt-hp));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0;transition-delay:0s;transition-duration:0s}.tp-rotv.tp-rotv-not>.tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst.tp-fldv-expanded>.tp-fldv_b{transition-delay:0s;transition-duration:0s}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}',plugins:[n1,a1,l1,Tp,c1]})}}new Ep("4.0.4");function p1(s,e){const t=document.createElement("div"),i=new u1({title:"Settings",expanded:!1,container:t});if(t.setAttribute("id","settings"),s.nodes&&(i.addBinding(e.displayScale,"val",{label:"Display scale",min:-10,max:10,step:1}),i.addBinding(e.nodes,"val",{label:"Nodes"}),i.addBinding(e.elements,"val",{label:"Elements"}),i.addBinding(e.nodesIndexes,"val",{label:"Nodes indexes"}),i.addBinding(e.elementsIndexes,"val",{label:"Elements indexes"}),i.addBinding(e.orientations,"val",{label:"Orientations"})),s.analysisInputs){const n=i.addFolder({title:"Analysis Inputs"});n.addBinding(e.supports,"val",{label:"Supports"}),n.addBinding(e.loads,"val",{label:"Loads"})}if(s.analysisOutputs){const n=i.addFolder({title:"Analysis Outputs"});n.addBinding(e.elementResults,"val",{options:{none:"none",normal:"normal",shearY:"shearY",shearZ:"shearZ",torsion:"torsion",bendingY:"bendingY",bendingZ:"bendingZ"},label:"Element results"}),n.addBinding(e.nodeResults,"val",{options:{none:"none",deformation:"deformation",reaction:"reaction"},label:"Node results"}),n.addBinding(e.deformedShape,"val",{label:"Deformed shape"})}return t}function f1(s,e,t){const i=new sc(new mt,new ta),n=.05*s.gridSize.rawVal*.5;return i.frustumCulled=!1,Ae.derive(()=>{s.nodes.val&&i.geometry.setAttribute("position",new dt(e.val.flat(),3))}),Ae.derive(()=>{t.val,s.nodes.rawVal&&(i.material.size=n*t.rawVal)}),Ae.derive(()=>{i.visible=s.nodes.val}),i}function m1(s,e,t){const i=new Ac(new mt,new mn);return i.frustumCulled=!1,i.material.depthTest=!1,Ae.derive(()=>{var r;if(e.deformedShape.val,!e.elements.val)return;const n=(r=s.elements)==null?void 0:r.val.map(o=>g1(o).map(a=>[...t.val[a[0]],...t.val[a[1]]]).flat()).flat();i.geometry.setAttribute("position",new dt(n,3))}),Ae.derive(()=>{i.visible=e.elements.val}),i}function g1(s){if(s.length===2)return[s];const e=[];for(let t=0;t<s.length;t++)e.push([s[t],s[(t+1)%s.length]]);return e}function v1(s){const e=new Ax(s,20,4210752,4210752);return e.position.set(.5*s,.5*s,0),e.rotateX(Math.PI/2),e}function _1(s,e,t,i){const n=new Bt,r=new Os(.5,.5,.5),o=new Vi({color:10166822}),a=.05*e.gridSize.rawVal*.6;return Ae.derive(()=>{var l,c;e.deformedShape.val,e.supports.val&&(n.clear(),(c=(l=s.analysisInputs)==null?void 0:l.val.pointSupports)==null||c.forEach((h,d)=>{const u=new Ft(r,o);u.position.set(...t.rawVal[d]);const m=a*i.rawVal;u.scale.set(m,m,m),n.add(u)}))}),Ae.derive(()=>{if(i.val,!e.supports.rawVal)return;const l=a*i.rawVal;n.children.forEach(c=>c.scale.set(l,l,l))}),Ae.derive(()=>{n.visible=e.supports.val}),n}function b1(s,e,t,i){const n=new Bt,r=.05*e.gridSize.rawVal;return Ae.derive(()=>{var o,a;e.deformedShape.val,e.loads.val&&(n.children.forEach(l=>l.dispose()),n.clear(),(a=(o=s.analysisInputs)==null?void 0:o.val.pointLoads)==null||a.forEach((l,c)=>{const h=new On(new k(...l.slice(0,3)).normalize(),new k(...t.rawVal[c]),1,15637248,.3,.3),d=r*i.rawVal;h.scale.set(d,d,d),n.add(h)}))}),Ae.derive(()=>{if(i.val,!e.loads.rawVal)return;const o=r*i.rawVal;n.children.forEach(a=>a.scale.set(o,o,o))}),Ae.derive(()=>{n.visible=e.loads.val}),n}let Yt=class extends qb{constructor(e,t,i){super();const n=30;this.fontHeightPx=n*devicePixelRatio,this.material.map=x1(e,this.fontHeightPx,t,i),this.material.depthTest=!1,this.renderOrder=99,this.scale.set(this.material.map.image.width/this.fontHeightPx,1,1)}updateScale(e){var t,i;this.scale.set(((i=(t=this.material)==null?void 0:t.map)==null?void 0:i.image.width)/this.fontHeightPx*e,e,1)}dispose(){var e;this.geometry.dispose(),(e=this.material.map)==null||e.dispose(),this.material.dispose()}};function x1(s,e,t,i){const n=document.createElement("canvas"),r=n.getContext("2d");if(r){r.font=`${e}px Arial`,n.width=r.measureText(s).width,n.height=e,i!="transparent"&&(r.fillStyle=i??"#0d0d0d"),r.fillRect(0,0,n.width,n.height),r.textAlign="center",r.textBaseline="middle",r.fillStyle=t??"#bbbcc4";const a=.9;r.font=`${e*a}px Arial`;const l=.08*n.height;r.fillText(s,n.width/2,n.height/2+l)}const o=new Vt(n);return o.needsUpdate=!0,o}function w1(s,e,t){const i=new Bt,n=.05*s.gridSize.rawVal*.6;return Ae.derive(()=>{s.nodesIndexes.val&&(i.children.forEach(r=>r.dispose()),i.clear(),e.val.forEach((r,o)=>{const a=new Yt(`${o}`);a.position.set(...r),a.updateScale(n*t.rawVal),i.add(a)}))}),Ae.derive(()=>{t.val,s.nodesIndexes.rawVal&&i.children.forEach(r=>r.updateScale(n*t.rawVal))}),Ae.derive(()=>{i.visible=s.nodesIndexes.val}),i}function y1(s,e,t,i){const n=new Bt,r=.05*e.gridSize.rawVal*.6;return Ae.derive(()=>{var o;e.deformedShape.val,e.elementsIndexes.val&&(n.children.forEach(a=>a.dispose()),n.clear(),(o=s.elements)==null||o.val.forEach((a,l)=>{const c=new Yt(`${l}`,void 0,"#001219");c.position.set(...S1(a.map(h=>t.rawVal[h]))),c.updateScale(r*i.rawVal),n.add(c)}))}),Ae.derive(()=>{i.val,e.elementsIndexes.rawVal&&n.children.forEach(o=>o.updateScale(r*i.rawVal))}),Ae.derive(()=>{n.visible=e.elementsIndexes.val}),n}function S1(s){const e=s.reduce((i,n)=>[i[0]+n[0],i[1]+n[1],i[2]+n[2]],[0,0,0]),t=s.length;return[e[0]/t,e[1]/t,e[2]/t]}function E1(s,e){const t=new Bt,i=.05*s*1,n=new Yt("X","red","transparent"),r=new Yt(e?"Z":"Y","green","transparent"),o=new Yt(e?"Y":"Z","blue","transparent"),a=new On(new k(1,0,0),new k(0,0,0),1,6710886,.2,.2),l=new On(new k(0,1,0),new k(0,0,0),1,6710886,.2,.2),c=new On(new k(0,0,1),new k(0,0,0),1,6710886,.2,.2);return n.position.set(1.3*i,0,0),r.position.set(0,1.3*i,0),o.position.set(0,0,1.3*i),n.updateScale(.4*i),r.updateScale(.4*i),o.updateScale(.4*i),a.scale.set(i,i,i),l.scale.set(i,i,i),c.scale.set(i,i,i),t.add(a,l,c,n,r,o),t}function af(s,e){const t=new k(...s),n=new k(...e).clone().sub(t),r=n.length(),o=n.dot(new k(1,0,0))/r,a=n.dot(new k(0,1,0))/r,l=n.dot(new k(0,0,1))/r,c=Math.sqrt(o**2+a**2);let h=new Ie().fromArray([[o,a,l],[-a/c,o/c,0],[-o*l/c,-a*l/c,c]].flat());return l===1&&(h=new Ie().fromArray([[0,0,1],[0,1,0],[-1,0,0]].flat())),l===-1&&(h=new Ie().fromArray([[0,0,-1],[0,1,0],[1,0,0]].flat())),new at().setFromMatrix3(h)}function mc(s,e){return s==null?void 0:s.map((t,i)=>(9*t+e[i])/10)}function M1(s,e,t,i){const n=new Bt,r=new mt,o=new mn({vertexColors:!0}),a=.05*e.gridSize.rawVal*.75,l=[0,0,0],c=[1,0,0],h=[0,1,0],d=[0,0,1];r.setAttribute("position",new dt([...l,...c,...l,...h,...l,...d],3));const u=[255,0,0],m=[0,255,0],f=[0,0,255];return r.setAttribute("color",new dt([...u,...u,...m,...m,...f,...f],3)),Ae.derive(()=>{var _;e.deformedShape.val,e.orientations.val&&(n.clear(),(_=s.elements)==null||_.val.forEach(g=>{const v=new Ac(r,o),y=t.rawVal[g[0]],x=t.rawVal[g[1]];v.position.set(...mc(y,x)),v.rotation.setFromRotationMatrix(af(y,x));const E=a*i.rawVal;v.scale.set(E,E,E),n.add(v)}))}),Ae.derive(()=>{if(i.val,!e.orientations.rawVal)return;const _=a*i.rawVal;n.children.forEach(g=>g.scale.set(_,_,_))}),Ae.derive(()=>{n.visible=e.orientations.val}),n}function C1(s,e){return s==null?void 0:s.map((t,i)=>(t+e[i])*.5)}class ko extends Bt{constructor(e,t,i,n,r,o,a){super();const l=new dr().moveTo(0,0).lineTo(0,o[1]).lineTo(i,o[1]).lineTo(i,0).lineTo(0,0),c=l.getPoints(),h=new mt().setFromPoints(c);this.lines=new Es(h,new mn({color:"white"})),this.lines.position.set(...e),this.lines.rotation.setFromRotationMatrix(n),a&&this.lines.rotateX(Math.PI/2),this.add(this.lines);const d=new Ms(l),u=new Vi({color:o[1]>0?24435:11411474,side:qt});this.mesh=new Ft(d,u),this.mesh.position.set(...e),this.mesh.rotation.setFromRotationMatrix(n),a&&this.mesh.rotateX(Math.PI/2),this.add(this.mesh),this.text=new Yt(`${r[1].toFixed(4)}`),this.normalizedResult=o,this.textPosition=C1(e,t),this.text.position.set(...this.textPosition),this.text.rotation.setFromRotationMatrix(n),this.add(this.text)}updateScale(e){this.lines.scale.set(1,e*2,1),this.mesh.scale.set(1,e*2,1),this.text.updateScale(e*.6),this.text.position.set(...this.textPosition),this.text.translateZ(this.normalizedResult[1]*2.5*e)}dispose(){this.lines.geometry.dispose(),this.lines.material.dispose(),this.mesh.geometry.dispose(),this.mesh.material.dispose(),this.text.dispose()}}class tu extends Bt{constructor(e,t,i,n,r,o,a){super();const l=r[0]*i/(r[0]+r[1]),c=r[0]*r[1]>0;if(this.text=new Yt(`${r[0].toFixed(4)}`),this.text2=new Yt(`${(r[1]*-1).toFixed(4)}`),this.normalizedResult=o,this.textPosition=mc(e,t),this.text2Position=mc(t,e),this.text.position.set(...this.textPosition),this.text2.position.set(...this.text2Position),this.text.rotation.setFromRotationMatrix(n),this.text2.rotation.setFromRotationMatrix(n),this.add(this.text,this.text2),c){const h=new dr().moveTo(0,0).lineTo(0,o[0]).lineTo(l,0).lineTo(0,0),d=new dr().moveTo(l,0).lineTo(i,-o[1]).lineTo(i,0).lineTo(l,0),u=h.getPoints(),m=d.getPoints(),f=new mt().setFromPoints(u),_=new mt().setFromPoints(m),g=new mn({color:"white"});this.lines=new Es(f,g),this.lines2=new Es(_,g),this.lines.position.set(...e),this.lines2.position.set(...e),this.lines.rotation.setFromRotationMatrix(n),this.lines2.rotation.setFromRotationMatrix(n),a&&this.lines.rotateX(Math.PI/2),a&&this.lines2.rotateX(Math.PI/2),this.add(this.lines,this.lines2);const v=new Ms(h),y=new Ms(d),x=new Vi({color:o[0]>0?24435:11411474,side:qt}),E=new Vi({color:-o[1]>0?24435:11411474,side:qt});this.mesh=new Ft(v,x),this.mesh2=new Ft(y,E),this.mesh.position.set(...e),this.mesh2.position.set(...e),this.mesh.rotation.setFromRotationMatrix(n),this.mesh2.rotation.setFromRotationMatrix(n),a&&this.mesh.rotateX(Math.PI/2),a&&this.mesh2.rotateX(Math.PI/2),this.add(this.mesh,this.mesh2)}else{const h=new dr().moveTo(0,0).lineTo(0,o[0]).lineTo(i,-o[1]).lineTo(i,0).lineTo(0,0),d=h.getPoints(),u=new mt().setFromPoints(d);this.lines=new Es(u,new mn({color:"white"})),this.lines.position.set(...e),this.lines.rotation.setFromRotationMatrix(n),a&&this.lines.rotateX(Math.PI/2),this.add(this.lines);const m=new Ms(h),f=new Vi({color:o[0]>0?24435:11411474,side:qt});this.mesh=new Ft(m,f),this.mesh.position.set(...e),this.mesh.rotation.setFromRotationMatrix(n),a&&this.mesh.rotateX(Math.PI/2),this.add(this.mesh)}}updateScale(e){var t,i;this.lines.scale.set(1,e*2,1),(t=this.lines2)==null||t.scale.set(1,e*2,1),this.mesh.scale.set(1,e*2,1),(i=this.mesh2)==null||i.scale.set(1,e*2,1),this.text.updateScale(e*.6),this.text2.updateScale(e*.6),this.text.position.set(...this.textPosition),this.text2.position.set(...this.text2Position),this.text.translateZ(this.normalizedResult[0]*2.5*e),this.text2.translateZ(-this.normalizedResult[1]*2.5*e)}dispose(){var e,t,i,n,r,o;this.lines.geometry.dispose(),(e=this.lines2)==null||e.geometry.dispose(),this.lines.material.dispose(),(i=(t=this.lines2)==null?void 0:t.material)==null||i.dispose(),this.mesh.geometry.dispose(),(n=this.mesh2)==null||n.geometry.dispose(),this.mesh.material.dispose(),(o=(r=this.mesh2)==null?void 0:r.material)==null||o.dispose(),this.text.dispose(),this.text2.dispose()}}var lf=(s=>(s.normal="normal",s.shearY="shearY",s.shearZ="shearZ",s.torsion="torsion",s.bendingY="bendingY",s.bendingZ="bendingZ",s))(lf||{});function T1(s,e,t,i){const n=new Bt,r=.05*e.gridSize.rawVal,o={normal:ko,shearY:ko,shearZ:ko,torsion:ko,bendingY:tu,bendingZ:tu};return Ae.derive(()=>{var l,c;if(e.deformedShape.val,e.elementResults.val=="none")return;n.children.forEach(h=>h.dispose()),n.clear();const a=lf[e.elementResults.rawVal];(c=(l=s.analysisOutputs)==null?void 0:l.val.elements)==null||c.forEach((h,d)=>{var E,R,M;const u=((E=s.elements)==null?void 0:E.rawVal[d])??[0,1],m=t.rawVal[u[0]],f=t.rawVal[u[1]],_=new k(...f).distanceTo(new k(...m)),g=A1((R=s.analysisOutputs)==null?void 0:R.rawVal.elements,a),v=(M=h[a])==null?void 0:M.map(C=>C/(g===0?1:g)),y=af(m,f),x=new o[a](m,f,_,y,h[a]??[0,0],v??[0,0],!!["normal","shearZ","torsion","bendingY"].includes(a));x.updateScale(r*i.rawVal),n.add(x)})}),Ae.derive(()=>{i.val,e.elementResults.rawVal!="none"&&n.children.forEach(a=>a.updateScale(r*i.rawVal))}),Ae.derive(()=>{n.visible=e.elementResults.val!="none"}),n}function A1(s,e){let t=0;return s==null||s.forEach(i=>{const n=Math.max(...i[e]??[0,0]);n>t&&(t=n)}),t}class R1 extends Bt{constructor(e,t,i){super();const n=t===rh.reaction;i[0]&&(this.xText1=new Yt(`${n?"Fx":"Dx"}: `+i[0].toFixed(4))),i[3]&&(this.xText2=new Yt(`${n?"Mx":"Rx"}: `+i[3].toFixed(4))),i[1]&&(this.yText1=new Yt(`${n?"Fy":"Dy"}: `+i[1].toFixed(4))),i[4]&&(this.yText2=new Yt(`${n?"My":"Ry"}: `+i[4].toFixed(4))),i[2]&&(this.zText1=new Yt(`${n?"Fz":"Dz"}: `+i[2].toFixed(4))),i[5]&&(this.zText2=new Yt(`${n?"Mz":"Rz"}: `+i[5].toFixed(4))),(i[0]||i[3])&&(this.xArrow=new On(new k(1,0,0),new k(0,0,0),1,15637248,.3,.3)),(i[1]||i[4])&&(this.yArrow=new On(new k(0,1,0),new k(0,0,0),1,15637248,.3,.3)),(i[2]||i[5])&&(this.zArrow=new On(new k(0,0,1),new k(0,0,0),1,15637248,.3,.3)),this.position.set(...e),this.xArrow&&this.add(this.xArrow),this.yArrow&&this.add(this.yArrow),this.zArrow&&this.add(this.zArrow),this.xText1&&this.add(this.xText1),this.xText2&&this.add(this.xText2),this.yText1&&this.add(this.yText1),this.yText2&&this.add(this.yText2),this.zText1&&this.add(this.zText1),this.zText2&&this.add(this.zText2)}updateScale(e){var t,i,n,r,o,a,l,c,h,d,u,m,f,_,g;(t=this.xArrow)==null||t.scale.set(e,e,e),(i=this.yArrow)==null||i.scale.set(e,e,e),(n=this.zArrow)==null||n.scale.set(e,e,e),(r=this.xText1)==null||r.position.set(1.3*e,0,0),(o=this.xText2)==null||o.position.set(1.3*e,0,.5*e),(a=this.yText1)==null||a.position.set(0,1.3*e,0),(l=this.yText2)==null||l.position.set(0,1.3*e,.5*e),(c=this.zText1)==null||c.position.set(0,0,1.3*e),(h=this.zText2)==null||h.position.set(0,0,1.3*e+.5*e),(d=this.xText1)==null||d.updateScale(.4*e),(u=this.xText2)==null||u.updateScale(.4*e),(m=this.yText1)==null||m.updateScale(.4*e),(f=this.yText2)==null||f.updateScale(.4*e),(_=this.zText1)==null||_.updateScale(.4*e),(g=this.zText2)==null||g.updateScale(.4*e)}dispose(){var e,t,i,n,r,o,a,l,c;(e=this.xArrow)==null||e.dispose(),(t=this.yArrow)==null||t.dispose(),(i=this.zArrow)==null||i.dispose(),(n=this.xText1)==null||n.dispose(),(r=this.xText2)==null||r.dispose(),(o=this.yText1)==null||o.dispose(),(a=this.yText2)==null||a.dispose(),(l=this.zText1)==null||l.dispose(),(c=this.zText2)==null||c.dispose()}}var rh=(s=>(s.deformation="deformation",s.reaction="reaction",s))(rh||{});function P1(s,e,t,i){const n=new Bt,r=.05*e.gridSize.rawVal;return Ae.derive(()=>{var a,l;if(e.deformedShape.val,e.nodeResults.val=="none")return;n.children.forEach(c=>c.dispose()),n.clear();const o=rh[e.nodeResults.rawVal];(l=(a=s.analysisOutputs)==null?void 0:a.val.nodes)==null||l.forEach((c,h)=>{const d=new R1(t.rawVal[h],o,c[o]??[0,0,0,0,0,0]);d.updateScale(r*i.rawVal),n.add(d)})}),Ae.derive(()=>{i.val,e.nodeResults.rawVal!="none"&&n.children.forEach(o=>o.updateScale(r*i.rawVal))}),Ae.derive(()=>{n.visible=e.nodeResults.val!="none"}),n}function D1({drawingObj:s,gridSize:e,derivedDisplayScale:t,scene:i,camera:n,renderer:r,controls:o}){const a=new Tx,l=new le,c=new Ft(new Or(e,e),new Vi({side:qt})),h=new sc(new mt,new ta),d=new sc(new mt,new ta({color:"gray"}));let u=!1,m=0;c.position.set(.5*e,.5*e,0),c.updateMatrixWorld(),h.geometry.setAttribute("position",new dt(s.points.rawVal.flat(),3)),h.geometry.computeBoundingSphere(),h.frustumCulled=!1,d.frustumCulled=!1,i.add(d),window.addEventListener("pointerdown",()=>{u=!0}),window.addEventListener("pointerup",()=>{u=!1}),window.addEventListener("pointermove",()=>{u&&m++}),window.addEventListener("pointerup",g=>{if(m>5){m=0;return}m=0,l.x=g.clientX/window.innerWidth*2-1,l.y=-(g.clientY/window.innerHeight)*2+1,a.setFromCamera(l,n);const v=a.intersectObject(c);v.length&&(s.points.val=[...s.points.rawVal,v[0].point.toArray()])}),window.addEventListener("pointermove",g=>{l.x=g.clientX/window.innerWidth*2-1,l.y=-(g.clientY/window.innerHeight)*2+1,a.setFromCamera(l,n);const v=a.intersectObject(c);console.log("delete"),d.geometry.deleteAttribute("position"),v.length&&d.geometry.setAttribute("position",new dt(v[0].point.toArray(),3)),r.render(i,n)});let f=!1,_;window.addEventListener("pointermove",g=>{if(!m)return;l.x=g.clientX/window.innerWidth*2-1,l.y=-(g.clientY/window.innerHeight)*2+1,a.setFromCamera(l,n);const v=a.intersectObject(h);if(v.length&&m<5&&(f=!0,o.enabled=!1,_=v[0].index),f){const y=a.intersectObject(c);if(!y.length||m%2!==0)return;const x=[...s.points.rawVal];_!==void 0&&(x[_]=y[0].point.toArray()),s.points.val=x}}),window.addEventListener("pointerup",()=>{o.enabled=!0,f=!1}),window.addEventListener("pointermove",g=>{l.x=g.clientX/window.innerWidth*2-1,l.y=-(g.clientY/window.innerHeight)*2+1,a.setFromCamera(l,n);const v=a.intersectObject(h);d.visible=!v.length}),Ae.derive(()=>{h.geometry.setAttribute("position",new dt(s.points.val.flat(),3)),h.geometry.computeBoundingSphere()}),Ae.derive(()=>{const g=.05*e*.5*t.val;d.material.size=g,a.params.Points.threshold=.4*g})}function iM({structure:s,settingsObj:e,objects3D:t,drawingObj:i}){Lt.DEFAULT_UP=new k(0,0,1);const n=document.createElement("div"),r=new Xb,o=new di(45,1,.1,2*1e6),a=new Wb({antialias:!0}),l=new Dx(o,a.domElement),c=L1(e),h=Ae.derive(()=>c.displayScale.val===0?1:c.displayScale.val>0?c.displayScale.val:-1/c.displayScale.val),d=Ae.derive(()=>{var _,g;return c.deformedShape.val?((g=s==null?void 0:s.nodes)==null?void 0:g.val.map((v,y)=>{var E,R,M,C;const x=((C=(M=(R=(E=s==null?void 0:s.analysisOutputs)==null?void 0:E.val.nodes)==null?void 0:R.get(y))==null?void 0:M.deformation)==null?void 0:C.slice(0,3))??[0,0,0];return v.map((P,N)=>P+x[N])}))??[]:((_=s==null?void 0:s.nodes)==null?void 0:_.val)??[]});i&&D1({drawingObj:i,scene:r,camera:o,renderer:a,gridSize:c.gridSize.rawVal,controls:l,derivedDisplayScale:h}),n.setAttribute("id","viewer"),n.appendChild(a.domElement),s&&n.appendChild(p1(s,c)),r.add(v1(c.gridSize.rawVal),E1(c.gridSize.rawVal,c.flipAxes.rawVal)),s&&r.add(f1(c,d,h),m1(s,c,d),w1(c,d,h),y1(s,c,d,h),_1(s,c,d,h),b1(s,c,d,h),M1(s,c,d,h),T1(s,c,d,h),P1(s,c,d,h)),a.setPixelRatio(window.devicePixelRatio),a.setClearColor(0,1);const u=c.gridSize.rawVal,m=u*.5+u*.5/Math.tan(45*.5);return o.position.set(.5*u,.8*-m,.5*u),l.target.set(.5*u,.5*u,0),l.minDistance=1,l.maxDistance=m*1.5,l.zoomSpeed=10,l.update(),new ResizeObserver(_=>{var g,v;for(const y of _){const x=(g=y.target)==null?void 0:g.clientWidth,E=(v=y.target)==null?void 0:v.clientHeight;o.aspect=x/E,o.updateProjectionMatrix(),a.setSize(x,E),a.render(r,o)}}).observe(n),l.addEventListener("change",()=>{a.render(r,o)}),Ae.derive(()=>{var _,g,v,y;(_=s==null?void 0:s.nodes)==null||_.val,(g=s==null?void 0:s.elements)==null||g.val,(v=s==null?void 0:s.analysisInputs)==null||v.val,(y=s==null?void 0:s.analysisInputs)==null||y.val,c.displayScale.val,c.nodes.val,c.elements.val,c.nodesIndexes.val,c.elementsIndexes.val,c.orientations.val,c.supports.val,c.loads.val,c.deformedShape.val,c.elementResults.val,c.nodeResults.val,t==null||t.val,setTimeout(()=>a.render(r,o))}),Ae.derive(()=>{t!=null&&t.val.length&&(r.remove(...t.oldVal),r.add(...t.rawVal))}),n}function L1(s){return{gridSize:Ae.state((s==null?void 0:s.gridSize)??20),displayScale:Ae.state((s==null?void 0:s.displayScale)??1),nodes:Ae.state((s==null?void 0:s.nodes)??!0),elements:Ae.state((s==null?void 0:s.elements)??!0),nodesIndexes:Ae.state((s==null?void 0:s.nodesIndexes)??!1),elementsIndexes:Ae.state((s==null?void 0:s.elementsIndexes)??!1),orientations:Ae.state((s==null?void 0:s.orientations)??!1),supports:Ae.state((s==null?void 0:s.supports)??!0),loads:Ae.state((s==null?void 0:s.loads)??!0),deformedShape:Ae.state((s==null?void 0:s.deformedShape)??!1),elementResults:Ae.state((s==null?void 0:s.elementResults)??"none"),nodeResults:Ae.state((s==null?void 0:s.nodeResults)??"none"),flipAxes:Ae.state((s==null?void 0:s.flipAxes)??!1)}}class iu{constructor(e,t){Object.assign(this,{type:t.type??null,detail:t,owner:e,target:t.target??null,phase:t.phase??"before",object:t.object??null,execute:null,isStopped:!1,isCancelled:!1,onComplete:null,listeners:[]}),delete t.type,delete t.target,delete t.object,this.complete=new Promise((i,n)=>{this._resolve=i,this._reject=n}),this.complete.catch(()=>{})}finish(e){e&&b.extend(this.detail,e),this.phase="after",this.owner.trigger.call(this.owner,this)}done(e){this.listeners.push(e)}preventDefault(){this._reject(),this.isCancelled=!0}stopPropagation(){this.isStopped=!0}}class _n{constructor(e){if(this.activeEvents=[],this.listeners=[],e!==void 0){if(!b.checkName(e))return;xt[e]=this}this.debug=!1}on(e,t){return(e=typeof e=="string"?e.split(/[,\s]+/):[e]).forEach(i=>{var n,r,o,a=typeof i=="string"?i:i.type+":"+i.execute+"."+i.scope;typeof i=="string"&&([r,n]=i.split("."),[r,o]=r.replace(":complete",":after").replace(":done",":after").split(":"),i={type:r,execute:o??"before",scope:n}),(i=b.extend({type:null,execute:"before",onComplete:null},i)).type?t?(Array.isArray(this.listeners)||(this.listeners=[]),this.listeners.push({name:a,edata:i,handler:t}),this.debug&&console.log("w2base: add event",{name:a,edata:i,handler:t})):console.log("ERROR: You must specify event handler function when calling .on() method of "+this.name):console.log("ERROR: You must specify event type when calling .on() method of "+this.name)}),this}off(e,t){return(e=typeof e=="string"?e.split(/[,\s]+/):[e]).forEach(i=>{var n,r,o,a=typeof i=="string"?i:i.type+":"+i.execute+"."+i.scope;if(typeof i=="string"&&([r,n]=i.split("."),[r,o]=r.replace(":complete",":after").replace(":done",":after").split(":"),i={type:r||"*",execute:o||"",scope:n||""}),(i=b.extend({type:null,execute:null,onComplete:null},i)).type||i.scope){t=t||null;let l=0;this.listeners=this.listeners.filter(c=>i.type!=="*"&&i.type!==c.edata.type||i.execute!==""&&i.execute!==c.edata.execute||i.scope!==""&&i.scope!==c.edata.scope||i.handler!=null&&i.handler!==c.edata.handler||(l++,!1)),this.debug&&console.log(`w2base: remove event (${l})`,{name:a,edata:i,handler:t})}else console.log("ERROR: You must specify event type when calling .off() method of "+this.name)}),this}trigger(e,t){if(arguments.length==1?t=e:(t.type=e,t.target=t.target??this),b.isPlainObject(t)&&t.phase=="after"){if(!(t=this.activeEvents.find(o=>o.type==t.type&&o.target==t.target)))return void console.log(`ERROR: Cannot find even handler for "${t.type}" on "${t.target}".`);console.log(`NOTICE: This syntax "edata.trigger({ phase: 'after' })" is outdated. Use edata.finish() instead.`)}else t instanceof iu||(t=new iu(this,t),this.activeEvents.push(t));let i,n,r;Array.isArray(this.listeners)||(this.listeners=[]),this.debug&&console.log(`w2base: trigger "${t.type}:${t.phase}"`,t);for(let o=this.listeners.length-1;0<=o;o--){let a=this.listeners[o];if(!(a==null||a.edata.type!==t.type&&a.edata.type!=="*"||a.edata.target!==t.target&&a.edata.target!=null||a.edata.execute!==t.phase&&a.edata.execute!=="*"&&a.edata.phase!=="*")&&(Object.keys(a.edata).forEach(l=>{t[l]==null&&a.edata[l]!=null&&(t[l]=a.edata[l])}),i=[],r=new RegExp(/\((.*?)\)/).exec(String(a.handler).split("=>")[0]),(i=r?r[1].split(/\s*,\s*/):i).length===2?(a.handler.call(this,t.target,t),this.debug&&console.log(" - call (old)",a.handler)):(a.handler.call(this,t),this.debug&&console.log(" - call",a.handler)),t.isStopped===!0||t.stop===!0))return t}if(e="on"+t.type.substr(0,1).toUpperCase()+t.type.substr(1),!(t.phase==="before"&&typeof this[e]=="function"&&(n=this[e],i=[],r=new RegExp(/\((.*?)\)/).exec(String(n).split("=>")[0]),(i=r?r[1].split(/\s*,\s*/):i).length===2?(n.call(this,t.target,t),this.debug&&console.log(" - call: on[Event] (old)",n)):(n.call(this,t),this.debug&&console.log(" - call: on[Event]",n)),t.isStopped===!0||t.stop===!0)||t.object!=null&&t.phase==="before"&&typeof t.object[e]=="function"&&(n=t.object[e],i=[],r=new RegExp(/\((.*?)\)/).exec(String(n).split("=>")[0]),(i=r?r[1].split(/\s*,\s*/):i).length===2?(n.call(this,t.target,t),this.debug&&console.log(" - call: edata.object (old)",n)):(n.call(this,t),this.debug&&console.log(" - call: edata.object",n)),t.isStopped===!0||t.stop===!0)||t.phase!=="after")){typeof t.onComplete=="function"&&t.onComplete.call(this,t);for(let o=0;o<t.listeners.length;o++)typeof t.listeners[o]=="function"&&(t.listeners[o].call(this,t),this.debug)&&console.log(" - call: done",n);t._resolve(t),this.debug&&console.log(`w2base: trigger "${t.type}:${t.phase}"`,t)}return t}}const ul={locale:"en-US",dateFormat:"m/d/yyyy",timeFormat:"hh:mi pm",datetimeFormat:"m/d/yyyy|hh:mi pm",currencyPrefix:"$",currencySuffix:"",currencyPrecision:2,groupSymbol:",",decimalSymbol:".",shortmonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],fullmonths:["January","February","March","April","May","June","July","August","September","October","November","December"],shortdays:["M","T","W","T","F","S","S"],fulldays:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],weekStarts:"S",phrases:{"${count} letters or more...":"---","Add new record":"---","Add New":"---","Advanced Search":"---",after:"---","AJAX error. See console for more details.":"---","All Fields":"---",All:"---",Any:"---","Are you sure you want to delete ${count} ${records}?":"---","Attach files by dragging and dropping or Click to Select":"---",before:"---","begins with":"---",begins:"---",between:"---",buffered:"---",Cancel:"---",Close:"---",Column:"---",Confirmation:"---",contains:"---",Copied:"---","Copy to clipboard":"---","Current Date & Time":"---","Delete selected records":"---",Delete:"---",'Do you want to delete search item "${item}"?':"---","Edit selected record":"---",Edit:"---","Empty list":"---","ends with":"---",ends:"---","Field should be at least ${count} characters.":"---",Hide:"---",in:"---","is not":"---",is:"---","less than":"---","Line #":"---","Load ${count} more...":"---","Loading...":"---","Maximum number of files is ${count}":"---","Maximum total size is ${count}":"---",Modified:"---","more than":"---","Multiple Fields":"---",Name:"---","No items found":"---","No matches":"---",No:"---",none:"---","Not a float":"---","Not a hex number":"---","Not a valid date":"---","Not a valid email":"---","Not alpha-numeric":"---","Not an integer":"---","Not in money format":"---","not in":"---",Notification:"---",of:"---",Ok:"---",Opacity:"---","Record ID":"---",record:"---",records:"---","Refreshing...":"---","Reload data in the list":"---",Remove:"---","Remove This Field":"---","Request aborted.":"---","Required field":"---",Reset:"---","Restore Default State":"---","Returned data is not in valid JSON format.":"---","Save changed records":"---","Save Grid State":"---",Save:"---","Saved Searches":"---","Saving...":"---","Search took ${count} seconds":"---",Search:"---","Select Hour":"---","Select Minute":"---",selected:"---","Server Response ${count} seconds":"---","Show/hide columns":"---",Show:"---",Size:"---",Skip:"---","Sorting took ${count} seconds":"---","Type to search...":"---",Type:"---",Yes:"---",Yesterday:"---","Your remote data source record count has changed, reloading from the first record.":"---"}},ut=class ut{constructor(e,t,i){this.context=t??document,this.previous=i??null;let n=[];if(Array.isArray(e))n=e;else if(e instanceof Node||e instanceof Window)n=[e];else if(e instanceof ut)n=e.nodes;else if(typeof e=="string"){if(typeof this.context.querySelector!="function")throw new Error("Invalid context");n=Array.from(this.context.querySelectorAll(e))}else if(e==null)n=[];else{if(t=Array.from(e??[]),typeof e!="object"||!Array.isArray(t))throw new Error(`Invalid selector "${e}"`);n=t}this.nodes=n,this.length=n.length,this.each((r,o)=>{this[o]=r})}static _fragment(e){let t=document.createElement("template");return t.innerHTML=e,t.content.childNodes.forEach(i=>{var n=ut._scriptConvert(i);n!=i&&t.content.replaceChild(n,i)}),t.content}static _scriptConvert(e){let t=i=>{var n=i.ownerDocument.createElement("script"),r=(n.text=i.text,i.attributes);for(let o=0;o<r.length;o++)n.setAttribute(r[o].name,r[o].value);return n};return(e=e.tagName=="SCRIPT"?t(e):e).querySelectorAll&&e.querySelectorAll("script").forEach(i=>{i.parentNode.replaceChild(t(i),i)}),e}static _fixProp(e){var t={cellpadding:"cellPadding",cellspacing:"cellSpacing",class:"className",colspan:"colSpan",contenteditable:"contentEditable",for:"htmlFor",frameborder:"frameBorder",maxlength:"maxLength",readonly:"readOnly",rowspan:"rowSpan",tabindex:"tabIndex",usemap:"useMap"};return t[e]||e}_insert(e,t){let i=[],n=this.length;if(!(n<1)){let r=this;if(typeof t=="string")this.each(o=>{var a=ut._fragment(t);i.push(...a.childNodes),o[e](a)});else if(t instanceof ut){let o=n==1;t.each(a=>{this.each(l=>{var c=o?a:a.cloneNode(!0);i.push(c),l[e](c),ut._scriptConvert(c)})}),o||t.remove()}else{if(!(t instanceof Node))throw new Error(`Incorrect argument for "${e}(html)". It expects one string argument.`);this.each(o=>{var a=n===1?t:ut._fragment(t.outerHTML);i.push(...n===1?[t]:a.childNodes),o[e](a)}),1<n&&t.remove()}return r=e=="replaceWith"?new ut(i,this.context,this):r}}_save(e,t,i){e._mQuery=e._mQuery??{},Array.isArray(i)?(e._mQuery[t]=e._mQuery[t]??[],e._mQuery[t].push(...i)):i!=null?e._mQuery[t]=i:delete e._mQuery[t]}get(e){var t=this[e=e<0?this.length+e:e];return t||(e!=null?null:this.nodes)}eq(e){let t=[this[e=e<0?this.length+e:e]];return t[0]==null&&(t=[]),new ut(t,this.context,this)}then(e){return e=e(this),e??this}find(e){let t=[];return this.each(i=>{i=Array.from(i.querySelectorAll(e)),0<i.length&&t.push(...i)}),new ut(t,this.context,this)}filter(e){let t=[];return this.each(i=>{(i===e||typeof e=="string"&&i.matches&&i.matches(e)||typeof e=="function"&&e(i))&&t.push(i)}),new ut(t,this.context,this)}next(){let e=[];return this.each(t=>{t=t.nextElementSibling,t&&e.push(t)}),new ut(e,this.context,this)}prev(){let e=[];return this.each(t=>{t=t.previousElementSibling,t&&e.push(t)}),new ut(e,this.context,this)}shadow(e){let t=[];this.each(n=>{n.shadowRoot&&t.push(n.shadowRoot)});var i=new ut(t,this.context,this);return e?i.find(e):i}closest(e){let t=[];return this.each(i=>{i=i.closest(e),i&&t.push(i)}),new ut(t,this.context,this)}host(e){let t=[],i=r=>r.parentNode?i(r.parentNode):r,n=r=>{r=i(r),t.push(r.host||r),r.host&&e&&n(r.host)};return this.each(r=>{n(r)}),new ut(t,this.context,this)}parent(e){return this.parents(e,!0)}parents(e,t){let i=[],n=o=>{if(i.indexOf(o)==-1&&i.push(o),!t&&o.parentNode)return n(o.parentNode)};this.each(o=>{o.parentNode&&n(o.parentNode)});var r=new ut(i,this.context,this);return e?r.filter(e):r}add(e){return e=e instanceof ut?e.nodes:Array.isArray(e)?e:[e],new ut(this.nodes.concat(e),this.context,this)}each(e){return this.nodes.forEach((t,i)=>{e(t,i,this)}),this}append(e){return this._insert("append",e)}prepend(e){return this._insert("prepend",e)}after(e){return this._insert("after",e)}before(e){return this._insert("before",e)}replace(e){return this._insert("replaceWith",e)}remove(){return this.each(e=>{e.remove()}),this}css(e,t){let i=e;var n,r=arguments.length;return r===0||r===1&&typeof e=="string"?this[0]?(r=this[0].style,typeof e=="string"?(n=r.getPropertyPriority(e),r.getPropertyValue(e)+(n?"!"+n:"")):Object.fromEntries(this[0].style.cssText.split(";").filter(o=>!!o).map(o=>o.split(":").map(a=>a.trim())))):void 0:(typeof e!="object"&&((i={})[e]=t),this.each((o,a)=>{Object.keys(i).forEach(l=>{var c=String(i[l]).toLowerCase().includes("!important")?"important":"";o.style.setProperty(l,String(i[l]).replace(/\!important/i,""),c)})}),this)}addClass(e){return this.toggleClass(e,!0),this}removeClass(e){return this.toggleClass(e,!1),this}toggleClass(e,t){return typeof e=="string"&&(e=e.split(/[,\s]+/)),this.each(i=>{let n=e;(n=n==null&&t===!1?Array.from(i.classList):n).forEach(r=>{if(r!==""){let o=t!=null?t?"add":"remove":"toggle";i.classList[o](r)}})}),this}hasClass(e){if((e=typeof e=="string"?e.split(/[,\s]+/):e)==null&&0<this.length)return Array.from(this[0].classList);let t=!1;return this.each(i=>{t=t||e.every(n=>Array.from(i.classList??[]).includes(n))}),t}on(e,t,i){typeof t=="function"&&(i=t,t=void 0);let n;return t!=null&&t.delegate&&(n=t.delegate,delete t.delegate),(e=e.split(/[,\s]+/)).forEach(r=>{let[o,a]=String(r).toLowerCase().split(".");if(n){let l=i;i=c=>{var h=p(c.target).parents(n);0<h.length?c.delegate=h[0]:c.delegate=c.target,(c.target.matches(n)||0<h.length)&&l(c)}}this.each(l=>{this._save(l,"events",[{event:o,scope:a,callback:i,options:t}]),l.addEventListener(o,i,t)})}),this}off(e,t,i){return typeof t=="function"&&(i=t,t=void 0),(e=(e??"").split(/[,\s]+/)).forEach(n=>{let[r,o]=String(n).toLowerCase().split(".");this.each(a=>{var c;if(Array.isArray((c=a._mQuery)==null?void 0:c.events))for(let h=a._mQuery.events.length-1;0<=h;h--){var l=a._mQuery.events[h];o==null||o===""?l.event!=r&&r!==""||l.callback!=i&&i!=null||(a.removeEventListener(l.event,l.callback,l.options),a._mQuery.events.splice(h,1)):l.event!=r&&r!==""||l.scope!=o||(a.removeEventListener(l.event,l.callback,l.options),a._mQuery.events.splice(h,1))}})}),this}trigger(e,t){let i;return i=e instanceof Event||e instanceof CustomEvent?e:new(["click","dblclick","mousedown","mouseup","mousemove"].includes(e)?MouseEvent:["keydown","keyup","keypress"].includes(e)?KeyboardEvent:Event)(e,t),this.each(n=>{n.dispatchEvent(i)}),this}attr(e,t){if(t===void 0&&typeof e=="string")return this[0]?this[0].getAttribute(e):void 0;{let i={};return typeof e=="object"?i=e:i[e]=t,this.each(n=>{Object.entries(i).forEach(([r,o])=>{n.setAttribute(r,o)})}),this}}removeAttr(){return this.each(e=>{Array.from(arguments).forEach(t=>{e.removeAttribute(t)})}),this}prop(e,t){if(t===void 0&&typeof e=="string")return this[0]?this[0][e]:void 0;{let i={};return typeof e=="object"?i=e:i[e]=t,this.each(n=>{Object.entries(i).forEach(([r,o])=>{r=ut._fixProp(r),n[r]=o,r=="innerHTML"&&ut._scriptConvert(n)})}),this}}removeProp(){return this.each(e=>{Array.from(arguments).forEach(t=>{delete e[ut._fixProp(t)]})}),this}data(e,t){if(e instanceof Object)Object.entries(e).forEach(i=>{this.data(i[0],i[1])});else{if(e&&e.indexOf("-")!=-1&&console.error(`Key "${e}" contains "-" (dash). Dashes are not allowed in property names. Use camelCase instead.`),!(arguments.length<2))return this.each(i=>{t!=null?i.dataset[e]=t instanceof Object?JSON.stringify(t):t:delete i.dataset[e]}),this;if(this[0]){let i=Object.assign({},this[0].dataset);return Object.keys(i).forEach(n=>{if(i[n].startsWith("[")||i[n].startsWith("{"))try{i[n]=JSON.parse(i[n])}catch{}}),e?i[e]:i}}}removeData(e){return typeof e=="string"&&(e=e.split(/[,\s]+/)),this.each(t=>{e.forEach(i=>{delete t.dataset[i]})}),this}show(){return this.toggle(!0)}hide(){return this.toggle(!1)}toggle(e){return this.each(t=>{var a;var i,n=t.style.display,r=getComputedStyle(t).display,o=n=="none"||r=="none";!o||e!=null&&e!==!0||(i=t instanceof HTMLTableRowElement?"table-row":t instanceof HTMLTableCellElement?"table-cell":"block",t.style.display=((a=t._mQuery)==null?void 0:a.prevDisplay)??(n==r&&r!="none"?"":i),this._save(t,"prevDisplay",null)),o||e!=null&&e!==!1||(r!="none"&&this._save(t,"prevDisplay",r),t.style.setProperty("display","none"))})}empty(){return this.html("")}html(e){return this.prop("innerHTML",e)}text(e){return this.prop("textContent",e)}val(e){return this.prop("value",e)}change(){return this.trigger("change")}click(){return this.trigger("click")}};Zr(ut,"version",.7);let Cr=ut,p=function(s,e){if(typeof s!="function")return new Cr(s,e);document.readyState=="complete"?s():window.addEventListener("load",s)},xt=(p.html=s=>(s=Cr._fragment(s),p(s.children,s)),p.version=Cr.version,{});class I1{constructor(){this.version="2.0.x",this.tmp={},this.settings=this.extend({},{dataType:"HTTPJSON",dateStartYear:1950,dateEndYear:2030,macButtonOrder:!1,warnNoPhrase:!1},ul,{phrases:null}),this.i18nCompare=Intl.Collator().compare,this.hasLocalStorage=function(){var e="w2ui_test";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch{return!1}}(),this.isMac=/Mac/i.test(navigator.platform),this.isMobile=/(iphone|ipod|ipad|mobile|android)/i.test(navigator.userAgent),this.isIOS=/(iphone|ipod|ipad)/i.test(navigator.platform),this.isAndroid=/(android)/i.test(navigator.userAgent),this.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this.formatters={number(e,t){return 20<parseInt(t)&&(t=20),parseInt(t)<0&&(t=0),e==null||e===""?"":b.formatNumber(parseFloat(e),t,!0)},float(e,t){return b.formatters.number(e,t)},int(e,t){return b.formatters.number(e,0)},money(e,t){return e==null||e===""?"":(e=b.formatNumber(Number(e),b.settings.currencyPrecision),(b.settings.currencyPrefix||"")+e+(b.settings.currencySuffix||""))},currency(e,t){return b.formatters.money(e,t)},percent(e,t){return e==null||e===""?"":b.formatNumber(e,t||1)+"%"},size(e,t){return e==null||e===""?"":b.formatSize(parseInt(e))},date(e,t){if(t===""&&(t=b.settings.dateFormat),e==null||e===0||e==="")return"";let i=b.isDateTime(e,t,!0);return'<span title="'+(i=i===!1?b.isDate(e,t,!0):i)+'">'+b.formatDate(i,t)+"</span>"},datetime(e,t){if(t===""&&(t=b.settings.datetimeFormat),e==null||e===0||e==="")return"";let i=b.isDateTime(e,t,!0);return'<span title="'+(i=i===!1?b.isDate(e,t,!0):i)+'">'+b.formatDateTime(i,t)+"</span>"},time(e,t){if(t===""&&(t=b.settings.timeFormat),e==null||e===0||e==="")return"";let i=b.isDateTime(e,t=(t=t==="h12"?"hh:mi pm":t)==="h24"?"h24:mi":t,!0);return'<span title="'+(i=i===!1?b.isDate(e,t,!0):i)+'">'+b.formatTime(e,t)+"</span>"},timestamp(e,t){if(t===""&&(t=b.settings.datetimeFormat),e==null||e===0||e==="")return"";let i=b.isDateTime(e,t,!0);return(i=i===!1?b.isDate(e,t,!0):i).toString?i.toString():""},gmt(e,t){if(t===""&&(t=b.settings.datetimeFormat),e==null||e===0||e==="")return"";let i=b.isDateTime(e,t,!0);return(i=i===!1?b.isDate(e,t,!0):i).toUTCString?i.toUTCString():""},age(e,t){if(e==null||e===0||e==="")return"";let i=b.isDateTime(e,null,!0);return'<span title="'+(i=i===!1?b.isDate(e,null,!0):i)+'">'+b.age(e)+(t?" "+t:"")+"</span>"},interval(e,t){return e==null||e===0||e===""?"":b.interval(e)+(t?" "+t:"")},toggle(e,t){return e?"Yes":""},password(e,t){let i="";for(let n=0;n<e.length;n++)i+="*";return i}}}isBin(e){return/^[0-1]+$/.test(e)}isInt(e){return/^[-+]?[0-9]+$/.test(e)}isFloat(e){return(typeof(e=typeof e=="string"?e.replace(this.settings.groupSymbol,"").replace(this.settings.decimalSymbol,"."):e)=="number"||typeof e=="string"&&e!=="")&&!isNaN(Number(e))}isMoney(e){var t,i;return typeof e!="object"&&e!==""&&(!!this.isFloat(e)||(t=this.settings,i=new RegExp("^"+(t.currencyPrefix?"\\"+t.currencyPrefix+"?":"")+"[-+]?"+(t.currencyPrefix?"\\"+t.currencyPrefix+"?":"")+"[0-9]*[\\"+t.decimalSymbol+"]?[0-9]+"+(t.currencySuffix?"\\"+t.currencySuffix+"?":"")+"$","i"),typeof e=="string"&&(e=e.replace(new RegExp(t.groupSymbol,"g"),"")),i.test(e)))}isHex(e){return/^(0x)?[0-9a-fA-F]+$/.test(e)}isAlphaNumeric(e){return/^[a-zA-Z0-9_-]+$/.test(e)}isEmail(e){return/^[a-zA-Z0-9._%\-+]+@[--a-zA-Z0-9.-]+\.[--a-zA-Z]+$/.test(e)}isIpAddress(e){return new RegExp("^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$").test(e)}isDate(e,t,i){if(!e)return!1;var n="Invalid Date";let r,o,a;if(t==null&&(t=this.settings.dateFormat),typeof e.getFullYear=="function")a=e.getFullYear(),r=e.getMonth()+1,o=e.getDate();else if(parseInt(e)==e&&0<parseInt(e))e=new Date(parseInt(e)),a=e.getFullYear(),r=e.getMonth()+1,o=e.getDate();else{if(e=String(e),new RegExp("mon","ig").test(t)){t=t.replace(/month/gi,"m").replace(/mon/gi,"m").replace(/dd/gi,"d").replace(/[, ]/gi,"/").replace(/\/\//g,"/").toLowerCase(),e=e.replace(/[, ]/gi,"/").replace(/\/\//g,"/").toLowerCase();for(let d=0,u=this.settings.fullmonths.length;d<u;d++){var l=this.settings.fullmonths[d];e=e.replace(new RegExp(l,"ig"),parseInt(d)+1).replace(new RegExp(l.substr(0,3),"ig"),parseInt(d)+1)}}var c=e.replace(/-/g,"/").replace(/\./g,"/").toLowerCase().split("/"),t=t.replace(/-/g,"/").replace(/\./g,"/").toLowerCase();t==="mm/dd/yyyy"&&(r=c[0],o=c[1],a=c[2]),t==="m/d/yyyy"&&(r=c[0],o=c[1],a=c[2]),t==="dd/mm/yyyy"&&(r=c[1],o=c[0],a=c[2]),t==="d/m/yyyy"&&(r=c[1],o=c[0],a=c[2]),t==="yyyy/dd/mm"&&(r=c[2],o=c[1],a=c[0]),t==="yyyy/d/m"&&(r=c[2],o=c[1],a=c[0]),t==="yyyy/mm/dd"&&(r=c[1],o=c[2],a=c[0]),t==="yyyy/m/d"&&(r=c[1],o=c[2],a=c[0]),t==="mm/dd/yy"&&(r=c[0],o=c[1],a=c[2]),t==="m/d/yy"&&(r=c[0],o=c[1],a=parseInt(c[2])+1900),t==="dd/mm/yy"&&(r=c[1],o=c[0],a=parseInt(c[2])+1900),t==="d/m/yy"&&(r=c[1],o=c[0],a=parseInt(c[2])+1900),t==="yy/dd/mm"&&(r=c[2],o=c[1],a=parseInt(c[0])+1900),t==="yy/d/m"&&(r=c[2],o=c[1],a=parseInt(c[0])+1900),t==="yy/mm/dd"&&(r=c[1],o=c[2],a=parseInt(c[0])+1900),t==="yy/m/d"&&(r=c[1],o=c[2],a=parseInt(c[0])+1900)}return!!this.isInt(a)&&!!this.isInt(r)&&!!this.isInt(o)&&(a=+a,r=+r,o=+o,(n=new Date(a,r-1,o)).setFullYear(a),r!=null)&&String(n)!=="Invalid Date"&&n.getMonth()+1===r&&n.getDate()===o&&n.getFullYear()===a&&(i!==!0||n)}isTime(a,t){if(a==null)return!1;let i,n,r;n=0<=(a=(a=String(a)).toUpperCase()).indexOf("AM");var o=(r=0<=a.indexOf("PM"))||n,a=(i=o?12:24,(a=a.replace("AM","").replace("PM","").trim()).split(":"));let l=parseInt(a[0]||0),c=parseInt(a[1]||0),h=parseInt(a[2]||0);return(o&&a.length===1||a.length===2||a.length===3)&&!(a[0]===""||l<0||l>i||!this.isInt(a[0])||2<a[0].length||1<a.length&&(a[1]===""||c<0||59<c||!this.isInt(a[1])||a[1].length!==2)||2<a.length&&(a[2]===""||h<0||59<h||!this.isInt(a[2])||a[2].length!==2)||!(o||i!==l||c===0&&h===0)||o&&a.length===1&&l===0)&&(t!==!0||(r&&l!==12&&(l+=12),n&&l===12&&(l+=12),{hours:l,minutes:c,seconds:h}))}isDateTime(e,t,i){var n;return typeof e.getFullYear=="function"?i!==!0||e:(n=parseInt(e))===e?!(n<0)&&(i!==!0||new Date(n)):(n=String(e).indexOf(" "))<0?!(String(e).indexOf("T")<0||String(new Date(e))=="Invalid Date")&&(i!==!0||new Date(e)):(t=(t=t??this.settings.datetimeFormat).split("|"),e=[e.substr(0,n),e.substr(n).trim()],t[0]=t[0].trim(),t[1]&&(t[1]=t[1].trim()),n=this.isDate(e[0],t[0],!0),t=this.isTime(e[1],!0),n!==!1&&t!==!1&&(i!==!0||(n.setHours(t.hours),n.setMinutes(t.minutes),n.setSeconds(t.seconds),n)))}age(e){let t;if(e===""||e==null||(t=typeof e.getFullYear=="function"?e:parseInt(e)==e&&0<parseInt(e)?new Date(parseInt(e)):new Date(e),String(t)==="Invalid Date"))return"";e=(new Date().getTime()-t.getTime())/1e3;let i="",n="";return e<0?(i=0,n="sec"):e<60?(i=Math.floor(e),n="sec",e<0&&(i=0,n="sec")):e<3600?(i=Math.floor(e/60),n="min"):e<86400?(i=Math.floor(e/60/60),n="hour"):e<2592e3?(i=Math.floor(e/24/60/60),n="day"):e<31536e3?(i=Math.floor(e/30/24/60/60*10)/10,n="month"):e<126144e3?(i=Math.floor(e/365/24/60/60*10)/10,n="year"):126144e3<=e&&(i=Math.floor(e/365.25/24/60/60*10)/10,n="year"),i+" "+n+(1<i?"s":"")}interval(e){return e<100?"< 0.01 sec":e<1e3?Math.floor(e/10)/100+" sec":e<1e4?Math.floor(e/100)/10+" sec":e<6e4?Math.floor(e/1e3)+" secs":e<36e5?Math.floor(e/6e4)+" mins":e<864e5?Math.floor(e/36e5*10)/10+" hours":e<2628e6?Math.floor(e/864e5*10)/10+" days":e<31536e6?Math.floor(e/2628e6*10)/10+" months":Math.floor(e/31536e5)/10+" years"}date(r){if(r===""||r==null||typeof r=="object"&&!r.getMonth)return"";let t=new Date(r);if(this.isInt(r)&&(t=new Date(Number(r))),String(t)==="Invalid Date")return"";var r=this.settings.shortmonths,n=new Date,o=new Date,i=(o.setTime(o.getTime()-864e5),r[t.getMonth()]+" "+t.getDate()+", "+t.getFullYear()),n=r[n.getMonth()]+" "+n.getDate()+", "+n.getFullYear(),r=r[o.getMonth()]+" "+o.getDate()+", "+o.getFullYear(),o=t.getHours()-(12<t.getHours()?12:0)+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+" "+(12<=t.getHours()?"pm":"am");let a=i==n?o:i;return'<span title="'+i+" "+(t.getHours()-(12<t.getHours()?12:0)+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+":"+(t.getSeconds()<10?"0":"")+t.getSeconds()+" "+(12<=t.getHours()?"pm":"am"))+'">'+(a=i==r?this.lang("Yesterday"):a)+"</span>"}formatSize(e){var t;return this.isFloat(e)&&e!==""?(e=parseFloat(e))===0?0:(t=parseInt(Math.floor(Math.log(e)/Math.log(1024))),(Math.floor(e/Math.pow(1024,t)*10)/10).toFixed(t===0?0:1)+" "+(["Bt","KB","MB","GB","TB","PB","EB","ZB"][t]||"??")):""}formatNumber(e,t,i){return e==null||e===""||typeof e=="object"?"":(i={minimumFractionDigits:parseInt(t),maximumFractionDigits:parseInt(t),useGrouping:!!i},(t==null||t<0)&&(i.minimumFractionDigits=0,i.maximumFractionDigits=20),parseFloat(e).toLocaleString(this.settings.locale,i))}formatDate(e,t){if(t=t||this.settings.dateFormat,e===""||e==null||typeof e=="object"&&!e.getMonth)return"";let i=new Date(e);var n,r;return this.isInt(e)&&(i=new Date(Number(e))),String(i)==="Invalid Date"?"":(e=i.getFullYear(),n=i.getMonth(),r=i.getDate(),t.toLowerCase().replace("month",this.settings.fullmonths[n]).replace("mon",this.settings.shortmonths[n]).replace(/yyyy/g,("000"+e).slice(-4)).replace(/yyy/g,("000"+e).slice(-4)).replace(/yy/g,("0"+e).slice(-2)).replace(/(^|[^a-z$])y/g,"$1"+e).replace(/mm/g,("0"+(n+1)).slice(-2)).replace(/dd/g,("0"+r).slice(-2)).replace(/th/g,r==1?"st":"th").replace(/th/g,r==2?"nd":"th").replace(/th/g,r==3?"rd":"th").replace(/(^|[^a-z$])m/g,"$1"+(n+1)).replace(/(^|[^a-z$])d/g,"$1"+r))}formatTime(e,t){if(t=t||this.settings.timeFormat,e===""||e==null||typeof e=="object"&&!e.getMonth)return"";let i=new Date(e);if(this.isInt(e)&&(i=new Date(Number(e))),this.isTime(e)&&(e=this.isTime(e,!0),(i=new Date).setHours(e.hours),i.setMinutes(e.minutes)),String(i)==="Invalid Date")return"";let n="am",r=i.getHours();e=i.getHours();let o=i.getMinutes(),a=i.getSeconds();return o<10&&(o="0"+o),a<10&&(a="0"+a),t.indexOf("am")===-1&&t.indexOf("pm")===-1||(12<=r&&(n="pm"),12<r&&(r-=12),r===0&&(r=12)),t.toLowerCase().replace("am",n).replace("pm",n).replace("hhh",r<10?"0"+r:r).replace("hh24",e<10?"0"+e:e).replace("h24",e).replace("hh",r).replace("mm",o).replace("mi",o).replace("ss",a).replace(/(^|[^a-z$])h/g,"$1"+r).replace(/(^|[^a-z$])m/g,"$1"+o).replace(/(^|[^a-z$])s/g,"$1"+a)}formatDateTime(e,t){let i;return e===""||e==null||typeof e=="object"&&!e.getMonth?"":(typeof t!="string"?i=[this.settings.dateFormat,this.settings.timeFormat]:((i=t.split("|"))[0]=i[0].trim(),i[1]=1<i.length?i[1].trim():this.settings.timeFormat),i[1]==="h12"&&(i[1]="h:m pm"),i[1]==="h24"&&(i[1]="h24:m"),this.formatDate(e,i[0])+" "+this.formatTime(e,i[1]))}stripSpaces(e){if(e!=null)switch(typeof e){case"number":break;case"string":e=String(e).replace(/(?:\r\n|\r|\n)/g," ").replace(/\s\s+/g," ").trim();break;case"object":Array.isArray(e)?(e=this.extend([],e)).forEach((t,i)=>{e[i]=this.stripSpaces(t)}):(e=this.extend({},e),Object.keys(e).forEach(t=>{e[t]=this.stripSpaces(e[t])}))}return e}stripTags(e){if(e!=null)switch(typeof e){case"number":break;case"string":e=String(e).replace(/<(?:[^>=]|='[^']*'|="[^"]*"|=[^'"][^\s>]*)*>/gi,"");break;case"object":Array.isArray(e)?(e=this.extend([],e)).forEach((t,i)=>{e[i]=this.stripTags(t)}):(e=this.extend({},e),Object.keys(e).forEach(t=>{e[t]=this.stripTags(e[t])}))}return e}encodeTags(e){if(e!=null)switch(typeof e){case"number":break;case"string":e=String(e).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;");break;case"object":Array.isArray(e)?(e=this.extend([],e)).forEach((t,i)=>{e[i]=this.encodeTags(t)}):(e=this.extend({},e),Object.keys(e).forEach(t=>{e[t]=this.encodeTags(e[t])}))}return e}decodeTags(e){if(e!=null)switch(typeof e){case"number":break;case"string":e=String(e).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&");break;case"object":Array.isArray(e)?(e=this.extend([],e)).forEach((t,i)=>{e[i]=this.decodeTags(t)}):(e=this.extend({},e),Object.keys(e).forEach(t=>{e[t]=this.decodeTags(e[t])}))}return e}escapeId(e){return e===""||e==null?"":(e+"").replace(/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,(t,i)=>i?t==="\0"?"":t.slice(0,-1)+"\\"+t.charCodeAt(t.length-1).toString(16)+" ":"\\"+t)}unescapeId(e){return e===""||e==null?"":e.replace(/\\[\da-fA-F]{1,6}[\x20\t\r\n\f]?|\\([^\r\n\f])/g,(t,i)=>(t="0x"+t.slice(1)-65536,i||(t<0?String.fromCharCode(65536+t):String.fromCharCode(t>>10|55296,1023&t|56320))))}base64encode(e){return btoa(e)}base64decode(e){return atob(e)}async sha256(e){return e=new TextEncoder().encode(e),crypto.subtle.digest("SHA-256",e).then(t=>Array.from(new Uint8Array(t)).map(i=>i.toString(16).padStart(2,"0")).join(""))}transition(e,t,i,n){return new Promise((r,o)=>{var a=getComputedStyle(e);let l=parseInt(a.width),c=parseInt(a.height);if(e&&t){switch(e.parentNode.style.cssText+="perspective: 900px; overflow: hidden;",e.style.cssText+="; position: absolute; z-index: 1019; backface-visibility: hidden",t.style.cssText+="; position: absolute; z-index: 1020; backface-visibility: hidden",i){case"slide-left":e.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",t.style.cssText+="overflow: hidden; transform: translate3d("+l+"px, 0, 0)",p(t).show(),setTimeout(()=>{t.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)",e.style.cssText+="transition: 0.5s; transform: translate3d(-"+l+"px, 0, 0)"},1);break;case"slide-right":e.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",t.style.cssText+="overflow: hidden; transform: translate3d(-"+l+"px, 0, 0)",p(t).show(),setTimeout(()=>{t.style.cssText+="transition: 0.5s; transform: translate3d(0px, 0, 0)",e.style.cssText+="transition: 0.5s; transform: translate3d("+l+"px, 0, 0)"},1);break;case"slide-down":e.style.cssText+="overflow: hidden; z-index: 1; transform: translate3d(0, 0, 0)",t.style.cssText+="overflow: hidden; z-index: 0; transform: translate3d(0, 0, 0)",p(t).show(),setTimeout(()=>{t.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)",e.style.cssText+="transition: 0.5s; transform: translate3d(0, "+c+"px, 0)"},1);break;case"slide-up":e.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",t.style.cssText+="overflow: hidden; transform: translate3d(0, "+c+"px, 0)",p(t).show(),setTimeout(()=>{t.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)",e.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)"},1);break;case"flip-left":e.style.cssText+="overflow: hidden; transform: rotateY(0deg)",t.style.cssText+="overflow: hidden; transform: rotateY(-180deg)",p(t).show(),setTimeout(()=>{t.style.cssText+="transition: 0.5s; transform: rotateY(0deg)",e.style.cssText+="transition: 0.5s; transform: rotateY(180deg)"},1);break;case"flip-right":e.style.cssText+="overflow: hidden; transform: rotateY(0deg)",t.style.cssText+="overflow: hidden; transform: rotateY(180deg)",p(t).show(),setTimeout(()=>{t.style.cssText+="transition: 0.5s; transform: rotateY(0deg)",e.style.cssText+="transition: 0.5s; transform: rotateY(-180deg)"},1);break;case"flip-down":e.style.cssText+="overflow: hidden; transform: rotateX(0deg)",t.style.cssText+="overflow: hidden; transform: rotateX(180deg)",p(t).show(),setTimeout(()=>{t.style.cssText+="transition: 0.5s; transform: rotateX(0deg)",e.style.cssText+="transition: 0.5s; transform: rotateX(-180deg)"},1);break;case"flip-up":e.style.cssText+="overflow: hidden; transform: rotateX(0deg)",t.style.cssText+="overflow: hidden; transform: rotateX(-180deg)",p(t).show(),setTimeout(()=>{t.style.cssText+="transition: 0.5s; transform: rotateX(0deg)",e.style.cssText+="transition: 0.5s; transform: rotateX(180deg)"},1);break;case"pop-in":e.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",t.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); transform: scale(.8); opacity: 0;",p(t).show(),setTimeout(()=>{t.style.cssText+="transition: 0.5s; transform: scale(1); opacity: 1;",e.style.cssText+="transition: 0.5s;"},1);break;case"pop-out":e.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); transform: scale(1); opacity: 1;",t.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); opacity: 0;",p(t).show(),setTimeout(()=>{t.style.cssText+="transition: 0.5s; opacity: 1;",e.style.cssText+="transition: 0.5s; transform: scale(1.7); opacity: 0;"},1);break;default:e.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",t.style.cssText+="overflow: hidden; translate3d(0, 0, 0); opacity: 0;",p(t).show(),setTimeout(()=>{t.style.cssText+="transition: 0.5s; opacity: 1;",e.style.cssText+="transition: 0.5s"},1)}setTimeout(()=>{i==="slide-down"&&(p(e).css("z-index","1019"),p(t).css("z-index","1020")),t&&p(t).css({opacity:"1"}).css({transition:"",transform:""}),e&&p(e).css({opacity:"1"}).css({transition:"",transform:""}),typeof n=="function"&&n(),r()},500)}else console.log("ERROR: Cannot do transition when one of the divs is null")})}lock(e,t={}){if(e!=null){typeof t=="string"&&(t={msg:t}),arguments[2]&&(t.spinner=arguments[2]),t=this.extend({spinner:!1},t),(e==null?void 0:e[0])instanceof Node&&(e=Array.isArray(e)?e:e.get()),t.msg||t.msg===0||(t.msg=""),this.unlock(e);var i=p(e).get(0);let n=i.scrollWidth,r=i.scrollHeight,o=(i.tagName=="BODY"&&(n<innerWidth&&(n=innerWidth),r<innerHeight)&&(r=innerHeight),p(e).prepend(`<div class="w2ui-lock" style="height: ${r}px; width: ${n}px"></div><div class="w2ui-lock-msg"></div>`),p(e).find(".w2ui-lock"));i=p(e).find(".w2ui-lock-msg"),e=(t.msg||i.css({"background-color":"transparent","background-image":"none",border:"0px","box-shadow":"none"}),t.spinner===!0&&(t.msg=`<div class="w2ui-spinner" ${t.msg?"":'style="width: 35px; height: 35px"'}></div>`+t.msg),t.msg?i.html(t.msg).css("display","block"):i.remove(),t.opacity!=null&&o.css("opacity",t.opacity),o.css({display:"block"}),t.bgColor&&o.css({"background-color":t.bgColor}),getComputedStyle(o.get(0)));let a=e.opacity??.15;o.on("mousedown",function(){typeof t.onClick=="function"?t.onClick():o.css({transition:".2s",opacity:1.5*a})}).on("mouseup",function(){typeof t.onClick!="function"&&o.css({transition:".2s",opacity:a})}).on("mousewheel",function(l){l&&(l.stopPropagation(),l.preventDefault())})}}unlock(e,t){var i;e!=null&&(clearTimeout(e._prevUnlock),(e==null?void 0:e[0])instanceof Node&&(e=Array.isArray(e)?e:e.get()),this.isInt(t)&&0<t?(p(e).find(".w2ui-lock").css({transition:t/1e3+"s",opacity:0}),i=p(e).get(0),clearTimeout(i._prevUnlock),i._prevUnlock=setTimeout(()=>{p(e).find(".w2ui-lock").remove()},t)):p(e).find(".w2ui-lock").remove(),p(e).find(".w2ui-lock-msg").remove())}message(e,t){var f,_;let i,n,r;var o=()=>{var v;var g=p(e==null?void 0:e.box).find(".w2ui-message");g.length!=0&&typeof((v=t=g.get(0)._msg_options||{})==null?void 0:v.close)=="function"&&t.close()};let a=g=>{var x,E;var v,y=g.box._msg_prevFocus;p(e.box).find(".w2ui-message").length<=1?e.owner?e.owner.unlock(e.param,150):this.unlock(e.box,150):p(e.box).find(`#w2ui-message-${(x=e.owner)==null?void 0:x.name}-`+(g.msgIndex-1)).css("z-index",1500),y?0<(v=p(y).closest(".w2ui-message")).length?v.get(0)._msg_options.setFocus(y):y.focus():typeof((E=e.owner)==null?void 0:E.focus)=="function"&&e.owner.focus(),p(g.box).remove(),g.msgIndex===0&&(m.css("z-index",g.tmp.zIndex),p(e.box).css("overflow",g.tmp.overflow)),g.trigger&&r.finish()};if(typeof(t=typeof t!="string"&&typeof t!="number"?t:{width:String(t).length<300?350:550,height:String(t).length<300?170:250,text:String(t)})!="object")return void o();t.text!=null&&(t.body=`<div class="w2ui-centered w2ui-msg-text">${t.text}</div>`),t.width==null&&(t.width=350),t.height==null&&(t.height=170),t.hideOn==null&&(t.hideOn=["esc"]),t.on==null&&(h=t,t=new _n,b.extend(t,h)),t.on("open",g=>{b.bindEvents(p(t.box).find(".w2ui-eaction"),t),p(g.detail.box).find("button, input, textarea, [name=hidden-first]").off(".message").on("keydown.message",function(v){v.keyCode==27&&t.hideOn.includes("esc")&&(t.cancelAction?t.action(t.cancelAction):t.close())}),setTimeout(()=>t.setFocus(t.focus),300)}),t.off(".prom");let l={self:t,action(g){return t.on("action.prom",g),l},close(g){return t.on("close.prom",g),l},open(g){return t.on("open.prom",g),l},then(g){return t.on("open:after.prom",g),l}},c=(t.actions==null&&t.buttons==null&&t.html==null&&(t.actions={Ok(g){g.detail.self.close()}}),t.off(".buttons"),t.actions!=null&&(t.buttons="",Object.keys(t.actions).forEach(g=>{var v=t.actions[g];let y=g;typeof v=="function"&&(t.buttons+=`<button class="w2ui-btn w2ui-eaction" data-click='["action","${g}","event"]' name="${g}">${g}</button>`),typeof v=="object"&&(t.buttons+=`<button class="w2ui-btn w2ui-eaction ${v.class||""}" name="${g}" data-click='["action","${g}","event"]'
                        style="${v.style??""}" ${v.attrs??""}>${v.text||g}</button>`,y=Array.isArray(t.actions)?v.text:g),typeof v=="string"&&(t.buttons+=`<button class="w2ui-btn w2ui-eaction" name="${v}" data-click='["action","${v}","event"]'>${v}</button>`,y=v),typeof y=="string"&&(y=y[0].toLowerCase()+y.substr(1).replace(/\s+/g,"")),l[y]=function(x){return t.on("action.buttons",E=>{E.detail.action[0].toLowerCase()+E.detail.action.substr(1).replace(/\s+/g,"")==y&&x(E)}),l}})),Array("html","body","buttons").forEach(g=>{t[g]=String(t[g]??"").trim()}),t.body===""&&t.buttons===""||(t.html=`
                <div class="w2ui-message-body">${t.body||""}</div>
                <div class="w2ui-message-buttons">${t.buttons||""}</div>
            `),getComputedStyle(p(e.box).get(0)));var h=parseFloat(c.width),d=parseFloat(c.height);let u=0,m=(0<p(e.after).length&&(c=getComputedStyle(p(e.after).get(0)),u=parseInt(c.display!="none"?parseInt(c.height):0)),t.width>h&&(t.width=h-10),t.height>d-u&&(t.height=d-10-u),t.originalWidth=t.width,t.originalHeight=t.height,parseInt(t.width)<0&&(t.width=h+t.width),parseInt(t.width)<10&&(t.width=10),parseInt(t.height)<0&&(t.height=d+t.height-u),parseInt(t.height)<10&&(t.height=10),t.originalHeight<0&&(t.height=d+t.originalHeight-u),t.originalWidth<0&&(t.width=h+2*t.originalWidth),p(e.box).find(e.after));return t.tmp||(t.tmp={zIndex:m.css("z-index"),overflow:c.overflow}),t.html===""&&t.body===""&&t.buttons===""?o():(t.msgIndex=p(e.box).find(".w2ui-message").length,t.msgIndex===0&&typeof this.lock=="function"&&(p(e.box).css("overflow","hidden"),e.owner?e.owner.lock(e.param):this.lock(e.box)),p(e.box).find(".w2ui-message").css("z-index",1390),m.css("z-index",1501),d=`
                <div id="w2ui-message-${(f=e.owner)==null?void 0:f.name}-${t.msgIndex}" class="w2ui-message" data-mousedown="stop"
                    style="z-index: 1500; left: ${(h-t.width)/2}px; top: ${u}px;
                        width: ${t.width}px; height: ${t.height}px; transform: translateY(-${t.height}px)"
                    ${t.hideOn.includes("click")?e.param?`data-click='["message", "${e.param}"]`:'data-click="message"':""}>
                    <span name="hidden-first" tabindex="0" style="position: absolute; top: 0; outline: none"></span>
                    ${t.html}
                    <span name="hidden-last" tabindex="0" style="position: absolute; top: 0; outline: none"></span>
                </div>`,0<p(e.after).length?p(e.box).find(e.after).after(d):p(e.box).prepend(d),t.box=p(e.box).find(`#w2ui-message-${(_=e.owner)==null?void 0:_.name}-`+t.msgIndex)[0],b.bindEvents(t.box,this),p(t.box).addClass("animating"),(t.box._msg_options=t).box._msg_prevFocus=document.activeElement,setTimeout(()=>{var g;(r=t.trigger("open",{target:this.name,box:t.box,self:t})).isCancelled===!0?(p(e.box).find(`#w2ui-message-${(g=e.owner)==null?void 0:g.name}-`+t.msgIndex).remove(),t.msgIndex===0&&(m.css("z-index",t.tmp.zIndex),p(e.box).css("overflow",t.tmp.overflow))):p(t.box).css({transition:"0.3s",transform:"translateY(0px)"})},0),n=setTimeout(()=>{var g;p(e.box).find(`#w2ui-message-${(g=e.owner)==null?void 0:g.name}-`+t.msgIndex).removeClass("animating").css({transition:"0s"}),r.finish()},300)),t.action=(g,v)=>{let y=t.actions[g];y instanceof Object&&y.onClick&&(y=y.onClick),g=t.trigger("action",{target:this.name,action:g,self:t,originalEvent:v,value:t.input?t.input.value:null}),g.isCancelled!==!0&&(typeof y=="function"&&y(g),g.finish())},t.close=()=>{var g;(r=t.trigger("close",{target:"self",box:t.box,self:t})).isCancelled!==!0&&(clearTimeout(n),p(t.box).hasClass("animating")?(clearTimeout(i),a(t)):(p(t.box).addClass("w2ui-closing animating").css({transition:"0.15s",transform:"translateY(-"+t.height+"px)"}),t.msgIndex!==0&&p(e.box).find(`#w2ui-message-${(g=e.owner)==null?void 0:g.name}-`+(t.msgIndex-1)).css("z-index",1499),i=setTimeout(()=>{a(t)},150)))},t.setFocus=g=>{var E,R;var v=p(e.box).find(".w2ui-message").length-1;let y=p(e.box).find(`#w2ui-message-${(E=e.owner)==null?void 0:E.name}-`+v),x="input, button, select, textarea, [contentEditable], .w2ui-input";(R=g!=null?isNaN(g)?y.find(x).filter(g).get(0):y.find(x).get(g):y.find("[name=hidden-first]").get(0))==null||R.focus(),p(e.box).find(".w2ui-message").find(x+",[name=hidden-first],[name=hidden-last]").off(".keep-focus"),p(y).find(x+",[name=hidden-first],[name=hidden-last]").on("blur.keep-focus",function(M){setTimeout(()=>{var w,S,D;var C=document.activeElement,P=0<p(y).find(x).filter(C).length,N=p(C).attr("name");!P&&C&&C!==document.body&&((w=p(y).find(x).get(0))==null||w.focus()),N=="hidden-last"&&((S=p(y).find(x).get(0))==null||S.focus()),N=="hidden-first"&&((D=p(y).find(x).get(-1))==null||D.focus())},1)})},l}notify(e,t){return new Promise(i=>{if(typeof e=="object"&&(e=(t=e).text),(t=t||{}).where=t.where??document.body,t.timeout=t.timeout??15e3,typeof this.tmp.notify_resolve=="function"&&(this.tmp.notify_resolve(),p(this.tmp.notify_where).find("#w2ui-notify").remove()),this.tmp.notify_resolve=i,this.tmp.notify_where=t.where,clearTimeout(this.tmp.notify_timer),e){if(typeof t.actions=="object"){let r={};Object.keys(t.actions).forEach(o=>{r[o]=`<a class="w2ui-notify-link" value="${o}">${o}</a>`}),e=this.execTemplate(e,r)}var n=`
                    <div id="w2ui-notify">
                        <div class="${t.class} ${t.error?"w2ui-notify-error":""}">
                            ${e}
                            <span class="w2ui-notify-close w2ui-icon-cross"></span>
                        </div>
                    </div>`;p(t.where).append(n),p(t.where).find("#w2ui-notify").find(".w2ui-notify-close").on("click",r=>{p(t.where).find("#w2ui-notify").remove(),i()}),t.actions&&p(t.where).find("#w2ui-notify .w2ui-notify-link").on("click",r=>{r=p(r.target).attr("value"),t.actions[r](),p(t.where).find("#w2ui-notify").remove(),i()}),0<t.timeout&&(this.tmp.notify_timer=setTimeout(()=>{p(t.where).find("#w2ui-notify").remove(),i()},t.timeout))}})}confirm(e,t){return b.normButtons(t=typeof t=="string"?{text:t}:t,{yes:"Yes",no:"No"}),e=b.message(e,t),e&&e.action(i=>{i.detail.self.close()}),e}normButtons(e,t){e.actions=e.actions??{};var i=Object.keys(t);return i.forEach(n=>{var r=e["btn_"+n];r&&(t[n]={text:b.lang(r.text??""),class:r.class??"",style:r.style??"",attrs:r.attrs??""},delete e["btn_"+n]),Array("text","class","style","attrs").forEach(o=>{e[n+"_"+o]&&(typeof t[n]=="string"&&(t[n]={text:t[n]}),t[n][o]=e[n+"_"+o],delete e[n+"_"+o])})}),i.includes("yes")&&i.includes("no")&&(b.settings.macButtonOrder?b.extend(e.actions,{no:t.no,yes:t.yes}):b.extend(e.actions,{yes:t.yes,no:t.no})),i.includes("ok")&&i.includes("cancel")&&(b.settings.macButtonOrder?b.extend(e.actions,{cancel:t.cancel,ok:t.ok}):b.extend(e.actions,{ok:t.ok,cancel:t.cancel})),e}getSize(e,t){let i=0;if(0<(e=p(e)).length){e=e[0];var n=getComputedStyle(e);switch(t){case"width":i=parseFloat(n.width),n.width==="auto"&&(i=0);break;case"height":i=parseFloat(n.height),n.height==="auto"&&(i=0);break;default:i=parseFloat(n[t]??0)||0}}return i}getStrWidth(e,t){return p("body").append(`
            <div id="_tmp_width" style="position: absolute; top: -9000px; ${t||""}">
                ${this.encodeTags(e)}
            </div>`),t=p("#_tmp_width")[0].clientWidth,p("#_tmp_width").remove(),t}execTemplate(e,t){return typeof e=="string"&&t&&typeof t=="object"?e.replace(/\${([^}]+)?}/g,function(i,n){return t[n]||n}):e}marker(e,t,i={onlyFirst:!1,wholeWord:!1}){Array.isArray(t)||(t=t!=null&&t!==""?[t]:[]);let n=i.wholeWord;p(e).each(r=>{for(var o=r,a=/\<span class=\"w2ui\-marker\"\>((.|\n|\r)*)\<\/span\>/gi;o.innerHTML.indexOf('<span class="w2ui-marker"')!==-1;)o.innerHTML=o.innerHTML.replace(a,"$1");t.forEach(l=>{l=(l=typeof l!="string"?String(l):l).replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&").replace(/&/g,"&amp;").replace(/</g,"&gt;").replace(/>/g,"&lt;"),l=new RegExp((n?"\\b":"")+l+(n?"\\b":"")+"(?!([^<]+)?>)","i"+(i.onlyFirst?"":"g")),r.innerHTML=r.innerHTML.replace(l,c=>'<span class="w2ui-marker">'+c+"</span>")})})}lang(e,t){if(!e||this.settings.phrases==null||typeof e!="string"||"<=>=".includes(e))return this.execTemplate(e,t);let i=this.settings.phrases[e];return i==null?(i=e,this.settings.warnNoPhrase&&(this.settings.missing||(this.settings.missing={}),this.settings.missing[e]="---",this.settings.phrases[e]="---",console.log(`Missing translation for "%c${e}%c", see %c w2utils.settings.phrases %c with value "---"`,"color: orange","","color: #999",""))):i!=="---"||this.settings.warnNoPhrase||(i=e),i==="---"&&(i=`<span ${this.tooltip(e)}>---</span>`),this.execTemplate(i,t)}locale(e,t,i){return new Promise((n,r)=>{if(Array.isArray(e)){this.settings.phrases={};let o=[],a={};e.forEach((l,c)=>{l.length===5&&(l="locale/"+l.toLowerCase()+".json",e[c]=l),o.push(this.locale(l,!0,!1))}),Promise.allSettled(o).then(l=>{l.forEach(c=>{c.value&&(a[c.value.file]=c.value.data)}),e.forEach(c=>{this.settings=this.extend({},this.settings,a[c])}),n()})}else(e=e||"en-us")instanceof Object?this.settings=this.extend({},this.settings,ul,e):(e.length===5&&(e="locale/"+e.toLowerCase()+".json"),fetch(e,{method:"GET"}).then(o=>o.json()).then(o=>{i!==!0&&(this.settings=t?this.extend({},this.settings,o):this.extend({},this.settings,ul,{phrases:{}},o)),n({file:e,data:o})}).catch(o=>{console.log("ERROR: Cannot load locale "+e),r(o)}))})}scrollBarSize(){return this.tmp.scrollBarSize||(p("body").append(`
            <div id="_scrollbar_width" style="position: absolute; top: -300px; width: 100px; height: 100px; overflow-y: scroll;">
                <div style="height: 120px">1</div>
            </div>
        `),this.tmp.scrollBarSize=100-p("#_scrollbar_width > div")[0].clientWidth,p("#_scrollbar_width").remove()),this.tmp.scrollBarSize}checkName(e){return e==null?(console.log('ERROR: Property "name" is required but not supplied.'),!1):xt[e]!=null?(console.log(`ERROR: Object named "${e}" is already registered as w2ui.${e}.`),!1):!!this.isAlphaNumeric(e)||(console.log('ERROR: Property "name" has to be alpha-numeric (a-z, 0-9, dash and underscore).'),!1)}checkUniqueId(e,t,i,n){Array.isArray(t)||(t=[t]);let r=!0;return t.forEach(o=>{o.id===e&&(console.log(`ERROR: The item id="${e}" is not unique within the ${i} "${n}".`,t),r=!1)}),r}encodeParams(e,t=""){let i="";return Object.keys(e).forEach(n=>{i!=""&&(i+="&"),typeof e[n]=="object"?i+=this.encodeParams(e[n],t+n+(t?"]":"")+"["):i+=""+t+n+(t?"]":"")+"="+e[n]}),i}parseRoute(e){let t=[];return e=e.replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,(i,n,r,o,a,l)=>(t.push({name:o,optional:!!l}),n=n||"",(l?"":n)+"(?:"+(l?n:"")+(r||"")+(a||(r?"([^/.]+?)":"([^/]+?)"))+")"+(l||""))).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)"),{path:new RegExp("^"+e+"$","i"),keys:t}}getCursorPosition(e){if(e==null)return null;let t=0;var i,n=e.ownerDocument||e.document,r=n.defaultView||n.parentWindow;let o;return["INPUT","TEXTAREA"].includes(e.tagName)?t=e.selectionStart:r.getSelection?0<(o=r.getSelection()).rangeCount&&((i=(r=o.getRangeAt(0)).cloneRange()).selectNodeContents(e),i.setEnd(r.endContainer,r.endOffset),t=i.toString().length):(o=n.selection)&&o.type!=="Control"&&(r=o.createRange(),(i=n.body.createTextRange()).moveToElementText(e),i.setEndPoint("EndToEnd",r),t=i.text.length),t}setCursorPosition(e,t,i){if(e!=null){var n=document.createRange();let r,o=window.getSelection();if(["INPUT","TEXTAREA"].includes(e.tagName))e.setSelectionRange(t,i??t);else{for(let a=0;a<e.childNodes.length;a++){let l=p(e.childNodes[a]).text();if(t<=(l=e.childNodes[a].tagName?(l=p(e.childNodes[a]).html()).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&nbsp;/g," "):l).length){(r=(r=e.childNodes[a]).childNodes&&0<r.childNodes.length?r.childNodes[0]:r).childNodes&&0<r.childNodes.length&&(r=r.childNodes[0]);break}t-=l.length}r!=null&&(t>r.length&&(t=r.length),n.setStart(r,t),i?n.setEnd(r,i):n.collapse(!0),o.removeAllRanges(),o.addRange(n))}}}parseColor(e){if(typeof e!="string")return null;let t={};if((e=(e=e.trim().toUpperCase())[0]==="#"?e.substr(1):e).length===3)t={r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:1};else if(e.length===6)t={r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16),a:1};else if(e.length===8)t={r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16),a:Math.round(parseInt(e.substr(6,2),16)/255*100)/100};else if(4<e.length&&e.substr(0,4)==="RGB("){var i=e.replace("RGB","").replace(/\(/g,"").replace(/\)/g,"").split(",");t={r:parseInt(i[0],10),g:parseInt(i[1],10),b:parseInt(i[2],10),a:1}}else{if(!(5<e.length&&e.substr(0,5)==="RGBA("))return null;i=e.replace("RGBA","").replace(/\(/g,"").replace(/\)/g,"").split(","),t={r:parseInt(i[0],10),g:parseInt(i[1],10),b:parseInt(i[2],10),a:parseFloat(i[3])}}return t}hsv2rgb(e,t,i,n){let r,o,a,l,c,h,d,u;switch(arguments.length===1&&(t=e.s,i=e.v,n=e.a,e=e.h),h=(i/=100)*(1-(t/=100)),d=i*(1-(c=6*(e/=360)-(l=Math.floor(6*e)))*t),u=i*(1-(1-c)*t),l%6){case 0:r=i,o=u,a=h;break;case 1:r=d,o=i,a=h;break;case 2:r=h,o=i,a=u;break;case 3:r=h,o=d,a=i;break;case 4:r=u,o=h,a=i;break;case 5:r=i,o=h,a=d}return{r:Math.round(255*r),g:Math.round(255*o),b:Math.round(255*a),a:n??1}}rgb2hsv(e,t,i,n){arguments.length===1&&(t=e.g,i=e.b,n=e.a,e=e.r);let r=Math.max(e,t,i),o=Math.min(e,t,i),a=r-o,l,c=r===0?0:a/r,h=r/255;switch(r){case o:l=0;break;case e:l=t-i+a*(t<i?6:0),l/=6*a;break;case t:l=i-e+2*a,l/=6*a;break;case i:l=e-t+4*a,l/=6*a}return{h:Math.round(360*l),s:Math.round(100*c),v:Math.round(100*h),a:n??1}}tooltip(e,t){let i="mouseenter",n="mouseleave";return t=(t=typeof e=="object"?e:t)||{},typeof e=="string"&&(t.html=e),t.showOn&&(i=t.showOn,delete t.showOn),t.hideOn&&(n=t.hideOn,delete t.hideOn),t.name||(t.name="no-name"),` on${i}="w2tooltip.show(this, JSON.parse(w2utils.base64decode('${this.base64encode(JSON.stringify(t))}')))" on${n}="w2tooltip.hide('${t.name}')"`}isPlainObject(e){return e!=null&&Object.prototype.toString.call(e)==="[object Object]"&&(e.constructor===void 0||(e=Object.getPrototypeOf(e))===null||e===Object.prototype)}clone(e,t){let i;return t=Object.assign({functions:!0,elements:!0,events:!0,exclude:[]},t??{}),Array.isArray(e)?(i=Array.from(e)).forEach((n,r)=>{i[r]=this.clone(n,t)}):this.isPlainObject(e)?(i={},Object.assign(i,e),t.exclude&&t.exclude.forEach(n=>{delete i[n]}),Object.keys(i).forEach(n=>{i[n]=this.clone(i[n],t),i[n]===void 0&&delete i[n]})):e instanceof Function&&!t.functions||e instanceof Node&&!t.elements||e instanceof Event&&!t.events||(i=e),i}extend(e,t){if(Array.isArray(e)){if(!Array.isArray(t))throw new Error("Arrays can be extended with arrays only");e.splice(0,e.length),t.forEach(i=>{e.push(this.clone(i))})}else{if(e instanceof Node||e instanceof Event)throw new Error("HTML elmenents and events cannot be extended");if(e&&typeof e=="object"&&t!=null){if(typeof t!="object")throw new Error("Object can be extended with other objects only.");Object.keys(t).forEach(i=>{var n;e[i]!=null&&typeof e[i]=="object"&&t[i]!=null&&typeof t[i]=="object"?(n=this.clone(t[i]),e[i]instanceof Node||e[i]instanceof Event?e[i]=n:(Array.isArray(e[i])&&this.isPlainObject(n)&&(e[i]={}),this.extend(e[i],n))):e[i]=this.clone(t[i])})}else if(t!=null)throw new Error("Object is not extendable, only {} or [] can be extended.")}if(2<arguments.length)for(let i=2;i<arguments.length;i++)this.extend(e,arguments[i]);return e}naturalCompare(e,t){let i,n,r=1,o=0,a=0,l=String.alphabet;function c(h,d,u){if(u){for(i=d;(u=c(h,i))<76&&65<u;)++i;return+h.slice(d-1,i)}return-1<(u=l&&l.indexOf(h.charAt(d)))?u+76:(u=h.charCodeAt(d)||0)<45||127<u?u:u<46?65:u<48?u-1:u<58?u+18:u<65?u-11:u<91?u+11:u<97?u-37:u<123?u+5:u-63}if((e+="")!=(t+="")){for(;r;)if(n=c(e,o++),r=c(t,a++),n<76&&r<76&&66<n&&66<r&&(n=c(e,o,o),r=c(t,a,o=i),a=i),n!=r)return n<r?-1:1}return 0}normMenu(e,t){return Array.isArray(e)?(e.forEach((i,n)=>{typeof i=="string"||typeof i=="number"?e[n]={id:i,text:String(i)}:i!=null?(i.caption!=null&&i.text==null&&(i.text=i.caption),i.text!=null&&i.id==null&&(i.id=i.text),i.text==null&&i.id!=null&&(i.text=i.id)):e[n]={id:null,text:"null"}}),e):typeof e=="function"?(t=e.call(this,e,t),b.normMenu.call(this,t)):typeof e=="object"?Object.keys(e).map(i=>({id:i,text:e[i]})):void 0}prepareParams(e,t,i){i=i??b.settings.dataType;let n=t.body;switch(i){case"HTTPJSON":n={request:n},["PUT","DELETE"].includes(t.method)&&(t.method="POST"),r();break;case"HTTP":["PUT","DELETE"].includes(t.method)&&(t.method="POST"),r();break;case"RESTFULL":["PUT","DELETE"].includes(t.method)?t.headers["Content-Type"]="application/json":r();break;case"JSON":t.method=="GET"?(n={request:n},r()):(t.headers["Content-Type"]="application/json",t.method="POST")}return t.body=typeof t.body=="string"?t.body:JSON.stringify(t.body),t;function r(){Object.keys(n).forEach(o=>{let a=n[o];typeof a=="object"&&(a=JSON.stringify(a)),e.searchParams.append(o,a)}),delete t.body}}bindEvents(e,t){e.length!=0&&((e==null?void 0:e[0])instanceof Node&&(e=Array.isArray(e)?e:e.get()),p(e).each(i=>{let n=p(i).data();Object.keys(n).forEach(r=>{if(["click","dblclick","mouseenter","mouseleave","mouseover","mouseout","mousedown","mousemove","mouseup","contextmenu","focus","focusin","focusout","blur","input","change","keydown","keyup","keypress"].indexOf(String(r).toLowerCase())!=-1){let o=n[r],a=(o=typeof o=="string"?o.split("|").map(l=>{(l=(l=(l=l==="true"?!0:l)==="false"?!1:l)==="undefined"?void 0:l)==="null"&&(l=null);var c=["'",'"',"`"];return l=typeof(l=parseFloat(l)==l?parseFloat(l):l)=="string"&&c.includes(l[0])&&c.includes(l[l.length-1])?l.substring(1,l.length-1):l}):o)[0];o=o.slice(1),p(i).off(r+".w2utils-bind").on(r+".w2utils-bind",function(l){switch(a){case"alert":alert(o[0]);break;case"stop":l.stopPropagation();break;case"prevent":l.preventDefault();break;case"stopPrevent":return l.stopPropagation(),l.preventDefault(),!1;default:if(t[a]==null)throw new Error(`Cannot dispatch event as the method "${a}" does not exist.`);t[a].apply(t,o.map((c,h)=>{switch(String(c).toLowerCase()){case"event":return l;case"this":return this;default:return c}}))}})}})}))}debounce(e,t=250){let i;return(...n)=>{clearTimeout(i),i=setTimeout(()=>{e(...n)},t)}}}var b=new I1;class k1 extends _n{constructor(){super(),this.defaults={title:"",text:"",body:"",buttons:"",width:450,height:250,focus:null,actions:null,style:"",speed:.3,modal:!1,maximized:!1,keyboard:!0,showClose:!0,showMax:!1,transition:null,openMaximized:!1,moved:!1},this.name="popup",this.status="closed",this.onOpen=null,this.onClose=null,this.onMax=null,this.onMin=null,this.onToggle=null,this.onKeydown=null,this.onAction=null,this.onMove=null,this.tmp={},this.handleResize=e=>{this.options.moved||this.center(void 0,void 0,!0)}}open(e){let t=this;this.status!="closing"&&!p("#w2ui-popup").hasClass("animating")||this.close(!0);var i=this.options;(e=["string","number"].includes(typeof e)?b.extend({title:"Notification",body:`<div class="w2ui-centered">${e}</div>`,actions:{Ok(){t.close()}},cancelAction:"ok"},arguments[1]??{}):e).text!=null&&(e.body=`<div class="w2ui-centered w2ui-msg-text">${e.text}</div>`),e=Object.assign({},this.defaults,i,{title:"",body:""},e,{maximized:!1}),this.options=e,p("#w2ui-popup").length===0&&(this.off("*"),Object.keys(this).forEach(h=>{h.startsWith("on")&&h!="on"&&(this[h]=null)})),Object.keys(e).forEach(h=>{h.startsWith("on")&&h!="on"&&e[h]&&(this[h]=e[h])}),e.width=parseInt(e.width),e.height=parseInt(e.height);let n,r,o;var{top:a,left:l}=this.center();let c={self:this,action(h){return t.on("action.prom",h),c},close(h){return t.on("close.prom",h),c},then(h){return t.on("open:after.prom",h),c}};if(e.actions==null||e.buttons||(e.buttons="",Object.keys(e.actions).forEach(h=>{var d=e.actions[h];let u=h;typeof d=="function"&&(e.buttons+=`<button class="w2ui-btn w2ui-eaction" data-click='["action","${h}","event"]'>${h}</button>`),typeof d=="object"&&(e.buttons+=`<button class="w2ui-btn w2ui-eaction ${d.class||""}" name="${h}" data-click='["action","${h}","event"]'
                        style="${d.style}" ${d.attrs}>${d.text||h}</button>`,u=Array.isArray(e.actions)?d.text:h),typeof d=="string"&&(e.buttons+=`<button class="w2ui-btn w2ui-eaction" data-click='["action","${d}","event"]'>${d}</button>`,u=d),typeof u=="string"&&(u=u[0].toLowerCase()+u.substr(1).replace(/\s+/g,"")),c[u]=function(m){return t.on("action.buttons",f=>{f.detail.action[0].toLowerCase()+f.detail.action.substr(1).replace(/\s+/g,"")==u&&m(f)}),c}})),p("#w2ui-popup").length===0){if((n=this.trigger("open",{target:"popup",present:!1})).isCancelled===!0)return;this.status="opening",b.lock(document.body,{opacity:.3,onClick:e.modal?null:()=>{this.close()}});let h="";e.showClose&&(h+=`<div class="w2ui-popup-button w2ui-popup-close">
                            <span class="w2ui-icon w2ui-icon-cross w2ui-eaction" data-mousedown="stop" data-click="close"></span>
                        </div>`),e.showMax&&(h+=`<div class="w2ui-popup-button w2ui-popup-max">
                            <span class="w2ui-icon w2ui-icon-box w2ui-eaction" data-mousedown="stop" data-click="toggle"></span>
                        </div>`),l=`
                left: ${l}px;
                top: ${a}px;
                width: ${parseInt(e.width)}px;
                height: ${parseInt(e.height)}px;
                transition: ${e.speed}s
            `,r=`<div id="w2ui-popup" class="w2ui-popup w2ui-anim-open animating" style="${b.stripSpaces(l)}"></div>`,p("body").append(r),p("#w2ui-popup")[0]._w2popup={self:this,created:new Promise(d=>{this._promCreated=d}),opened:new Promise(d=>{this._promOpened=d}),closing:new Promise(d=>{this._promClosing=d}),closed:new Promise(d=>{this._promClosed=d})},l=`${e.title?"":"top: 0px !important;"} `+(e.buttons?"":"bottom: 0px !important;"),r=`
                <span name="hidden-first" tabindex="0" style="position: absolute; top: -100px"></span>
                <div class="w2ui-popup-title-btns">${h}</div>
                <div class="w2ui-popup-title" style="${e.title?"":"display: none"}"></div>
                <div class="w2ui-box" style="${l}">
                    <div class="w2ui-popup-body ${!e.title||" w2ui-popup-no-title"}
                        ${!e.buttons||" w2ui-popup-no-buttons"}" style="${e.style}">
                    </div>
                </div>
                <div class="w2ui-popup-buttons" style="${e.buttons?"":"display: none"}"></div>
                <span name="hidden-last" tabindex="0" style="position: absolute; top: -100px"></span>
            `,p("#w2ui-popup").html(r),e.title&&p("#w2ui-popup .w2ui-popup-title").append(b.lang(e.title)),e.buttons&&p("#w2ui-popup .w2ui-popup-buttons").append(e.buttons),e.body&&p("#w2ui-popup .w2ui-popup-body").append(e.body),setTimeout(()=>{p("#w2ui-popup").css("transition",e.speed+"s").removeClass("w2ui-anim-open"),b.bindEvents("#w2ui-popup .w2ui-eaction",this),p("#w2ui-popup").find(".w2ui-popup-body").show(),this._promCreated()},1),clearTimeout(this._timer),this._timer=setTimeout(()=>{this.status="open",t.setFocus(e.focus),n.finish(),this._promOpened(),p("#w2ui-popup").removeClass("animating")},1e3*e.speed)}else{if((n=this.trigger("open",{target:"popup",present:!0})).isCancelled===!0)return;this.status="opening",i!=null&&(i.maximized||i.width==e.width&&i.height==e.height||this.resize(e.width,e.height),e.prevSize=e.width+"px:"+e.height+"px",e.maximized=i.maximized),a=p("#w2ui-popup .w2ui-box").get(0).cloneNode(!0),p(a).removeClass("w2ui-box").addClass("w2ui-box-temp").find(".w2ui-popup-body").empty().append(e.body),p("#w2ui-popup .w2ui-box").after(a),e.buttons?(p("#w2ui-popup .w2ui-popup-buttons").show().html("").append(e.buttons),p("#w2ui-popup .w2ui-popup-body").removeClass("w2ui-popup-no-buttons"),p("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("bottom","")):(p("#w2ui-popup .w2ui-popup-buttons").hide().html(""),p("#w2ui-popup .w2ui-popup-body").addClass("w2ui-popup-no-buttons"),p("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("bottom","0px")),e.title?(p("#w2ui-popup .w2ui-popup-title").show().html((e.showClose?`<div class="w2ui-popup-button w2ui-popup-close">
                                <span class="w2ui-icon w2ui-icon-cross w2ui-eaction" data-mousedown="stop" data-click="close"></span>
                            </div>`:"")+(e.showMax?`<div class="w2ui-popup-button w2ui-popup-max">
                                <span class="w2ui-icon w2ui-icon-box w2ui-eaction" data-mousedown="stop" data-click="toggle"></span>
                            </div>`:"")).append(e.title),p("#w2ui-popup .w2ui-popup-body").removeClass("w2ui-popup-no-title"),p("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("top","")):(p("#w2ui-popup .w2ui-popup-title").hide().html(""),p("#w2ui-popup .w2ui-popup-body").addClass("w2ui-popup-no-title"),p("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("top","0px"));let h=p("#w2ui-popup .w2ui-box")[0],d=p("#w2ui-popup .w2ui-box-temp")[0];p("#w2ui-popup").addClass("animating"),b.transition(h,d,e.transition,()=>{p(h).remove(),p(d).removeClass("w2ui-box-temp").addClass("w2ui-box");var u=p(d).find(".w2ui-popup-body");u.length==1&&(u[0].style.cssText=e.style,u.show()),t.setFocus(e.focus),p("#w2ui-popup").removeClass("animating")}),this.status="open",n.finish(),b.bindEvents("#w2ui-popup .w2ui-eaction",this),p("#w2ui-popup").find(".w2ui-popup-body").show()}return e.openMaximized&&this.max(),e._last_focus=document.activeElement,e.keyboard&&p(document.body).on("keydown",h=>{this.keydown(h)}),p(window).on("resize",this.handleResize),o={resizing:!1,mvMove:function(h){o.resizing==1&&(h=h||window.event,o.div_x=h.screenX-o.x,o.div_y=h.screenY-o.y,(h=t.trigger("move",{target:"popup",div_x:o.div_x,div_y:o.div_y,originalEvent:h})).isCancelled!==!0)&&(p("#w2ui-popup").css({transition:"none",transform:"translate3d("+o.div_x+"px, "+o.div_y+"px, 0px)"}),t.options.moved=!0,h.finish())},mvStop:function(h){o.resizing!=1||(h=h||window.event,t.status="open",o.div_x=h.screenX-o.x,o.div_y=h.screenY-o.y,p("#w2ui-popup").css({left:o.pos_x+o.div_x+"px",top:o.pos_y+o.div_y+"px"}).css({transition:"none",transform:"translate3d(0px, 0px, 0px)"}),o.resizing=!1,p(document.body).off(".w2ui-popup"),o.isLocked)||t.unlock()}},p("#w2ui-popup .w2ui-popup-title").on("mousedown",function(h){var d;t.options.maximized||(h=(h=h)||window.event,t.status="moving",d=p("#w2ui-popup").get(0).getBoundingClientRect(),Object.assign(o,{resizing:!0,isLocked:p("#w2ui-popup > .w2ui-lock").length==1,x:h.screenX,y:h.screenY,pos_x:d.x,pos_y:d.y}),o.isLocked||t.lock({opacity:0}),p(document.body).on("mousemove.w2ui-popup",o.mvMove).on("mouseup.w2ui-popup",o.mvStop),h.stopPropagation?h.stopPropagation():h.cancelBubble=!0,h.preventDefault&&h.preventDefault())}),c}load(e){return new Promise((t,i)=>{if((e=typeof e=="string"?{url:e}:e).url==null)console.log("ERROR: The url is not defined."),i("The url is not defined");else{this.status="loading";let[n,r]=String(e.url).split("#");n&&fetch(n).then(o=>o.text()).then(o=>{t(this.template(o,r,e))})}})}template(e,t,i={}){let n;try{n=p(e)}catch{n=p.html(e)}return t&&(n=n.filter("#"+t)),Object.assign(i,{width:parseInt(p(n).css("width")),height:parseInt(p(n).css("height")),title:p(n).find("[rel=title]").html(),body:p(n).find("[rel=body]").html(),buttons:p(n).find("[rel=buttons]").html(),style:p(n).find("[rel=body]").get(0).style.cssText}),this.open(i)}action(e,t){let i=this.options.actions[e];i instanceof Object&&i.onClick&&(i=i.onClick),e=this.trigger("action",{action:e,target:"popup",self:this,originalEvent:t,value:this.input?this.input.value:null}),e.isCancelled!==!0&&(typeof i=="function"&&i.call(this,t),e.finish())}keydown(e){var t;this.options&&!this.options.keyboard||(t=this.trigger("keydown",{target:"popup",originalEvent:e})).isCancelled!==!0&&(e.keyCode===27&&(e.preventDefault(),p("#w2ui-popup .w2ui-message").length==0)&&(this.options.cancelAction?this.action(this.options.cancelAction):this.close()),t.finish())}close(e){let t=this.trigger("close",{target:"popup"});var i;t.isCancelled!==!0&&(i=()=>{p("#w2ui-popup").remove(),this.options._last_focus&&0<this.options._last_focus.length&&this.options._last_focus.focus(),this.status="closed",this.options={},t.finish(),this._promClosed()},p("#w2ui-popup").length!==0)&&this.status!="closed"&&(this.status=="opening"&&(e=!0),this.status=="closing"&&e===!0?(i(),clearTimeout(this.tmp.closingTimer),b.unlock(document.body,0)):(this.status="closing",p("#w2ui-popup").css("transition",this.options.speed+"s").addClass("w2ui-anim-close animating"),b.unlock(document.body,300),this._promClosing(),e?i():this.tmp.closingTimer=setTimeout(i,1e3*this.options.speed),this.options.keyboard&&p(document.body).off("keydown",this.keydown),p(window).off("resize",this.handleResize)))}toggle(){let e=this.trigger("toggle",{target:"popup"});e.isCancelled!==!0&&(this.options.maximized===!0?this.min():this.max(),setTimeout(()=>{e.finish()},1e3*this.options.speed+50))}max(){if(this.options.maximized!==!0){let t=this.trigger("max",{target:"popup"});var e;t.isCancelled!==!0&&(this.status="resizing",e=p("#w2ui-popup").get(0).getBoundingClientRect(),this.options.prevSize=e.width+":"+e.height,this.resize(1e4,1e4,()=>{this.status="open",this.options.maximized=!0,t.finish()}))}}min(){if(this.options.maximized===!0){var e=this.options.prevSize.split(":");let t=this.trigger("min",{target:"popup"});t.isCancelled!==!0&&(this.status="resizing",this.options.maximized=!1,this.resize(parseInt(e[0]),parseInt(e[1]),()=>{this.status="open",this.options.prevSize=null,t.finish()}))}}clear(){p("#w2ui-popup .w2ui-popup-title").html(""),p("#w2ui-popup .w2ui-popup-body").html(""),p("#w2ui-popup .w2ui-popup-buttons").html("")}reset(){this.open(this.defaults)}message(e){return b.message({owner:this,box:p("#w2ui-popup").get(0),after:".w2ui-popup-title"},e)}confirm(e){return b.confirm({owner:this,box:p("#w2ui-popup"),after:".w2ui-popup-title"},e)}setFocus(e){var n;let t=p("#w2ui-popup"),i="input, button, select, textarea, [contentEditable], .w2ui-input";e!=null?(n=isNaN(e)?t.find(i).filter(e).get(0):t.find(i).get(e))==null||n.focus():(e=t.find("[name=hidden-first]").get(0))&&e.focus(),p(t).find(i+",[name=hidden-first],[name=hidden-last]").off(".keep-focus").on("blur.keep-focus",function(r){setTimeout(()=>{var c,h,d;var o=document.activeElement,a=0<p(t).find(i).filter(o).length,l=p(o).attr("name");!a&&o&&o!==document.body&&((c=p(t).find(i).get(0))==null||c.focus()),l=="hidden-last"&&((h=p(t).find(i).get(0))==null||h.focus()),l=="hidden-first"&&((d=p(t).find(i).get(-1))==null||d.focus())},1)})}lock(e,t){var i=Array.from(arguments);i.unshift(p("#w2ui-popup")),b.lock(...i)}unlock(e){b.unlock(p("#w2ui-popup"),e)}center(e,t,i){let n,r;r=window.innerHeight==null?(n=parseInt(document.documentElement.offsetWidth),parseInt(document.documentElement.offsetHeight)):(n=parseInt(window.innerWidth),parseInt(window.innerHeight)),e=parseInt(e??this.options.width),t=parseInt(t??this.options.height),this.options.maximized===!0&&(e=n,t=r),n-10<e&&(e=n-10),r-10<t&&(t=r-10);var o=(r-t)/2,a=(n-e)/2;return i&&(p("#w2ui-popup").css({transition:"none",top:o+"px",left:a+"px",width:e+"px",height:t+"px"}),this.resizeMessages()),{top:o,left:a,width:e,height:t}}resize(r,o,i){let n=this;this.options.speed==null&&(this.options.speed=0);var{top:r,left:o,width:a,height:l}=this.center(r,o),c=this.options.speed;p("#w2ui-popup").css({transition:c+`s width, ${c}s height, ${c}s left, ${c}s top`,top:r+"px",left:o+"px",width:a+"px",height:l+"px"});let h=setInterval(()=>{n.resizeMessages()},10);setTimeout(()=>{clearInterval(h),n.resizeMessages(),typeof i=="function"&&i()},1e3*this.options.speed+50)}resizeMessages(){p("#w2ui-popup .w2ui-message").each(e=>{var t=e._msg_options,i=p("#w2ui-popup"),r=(parseInt(t.width)<10&&(t.width=10),parseInt(t.height)<10&&(t.height=10),i[0].getBoundingClientRect()),i=parseInt(i.find(".w2ui-popup-title")[0].clientHeight),n=parseInt(r.width),r=parseInt(r.height);t.width=t.originalWidth,t.width>n-10&&(t.width=n-10),t.height=t.originalHeight,t.height>r-i-5&&(t.height=r-i-5),t.originalHeight<0&&(t.height=r+t.originalHeight-i),t.originalWidth<0&&(t.width=n+2*t.originalWidth),p(e).css({left:(n-t.width)/2+"px",width:t.width+"px",height:t.height+"px"})})}}let N1=new k1;const st=class st{constructor(){this.defaults={name:null,html:"",style:"",class:"",position:"top|bottom",align:"",anchor:null,anchorClass:"",anchorStyle:"",autoShow:!1,autoShowOn:null,autoHideOn:null,arrowSize:8,margin:0,margin:1,screenMargin:2,autoResize:!0,offsetX:0,offsetY:0,maxWidth:null,maxHeight:null,watchScroll:null,watchResize:null,hideOn:null,onThen:null,onShow:null,onHide:null,onUpdate:null,onMove:null}}trigger(e,t){var i;if(arguments.length==2&&(i=e,(e=t).type=i),e.overlay)return e.overlay.trigger(e);console.log("ERROR: cannot find overlay where to trigger events")}get(e){return arguments.length==0?Object.keys(st.active):e===!0?st.active:st.active[e.replace(/[\s\.#]/g,"_")]}attach(e,t){let i,n,r=this;if(arguments.length!=0){arguments.length==1&&e.anchor?e=(i=e).anchor:arguments.length===2&&typeof t=="string"?t=(i={anchor:e,html:t}).html:arguments.length===2&&t!=null&&typeof t=="object"&&(t=(i=t).html),i=b.extend({},this.defaults,i||{}),!(t=!t&&i.text?i.text:t)&&i.html&&(t=i.html),delete i.anchor;let o=i.name||e.id;e!=document&&e!=document.body||(e=document.body,o="context-menu"),o||(o="noname-"+Object.keys(st.active).length,console.log("NOTICE: name property is not defined for tooltip, could lead to too many instances")),o=o.replace(/[\s\.#]/g,"_"),st.active[o]?((n=st.active[o]).prevOptions=n.options,n.options=i,n.anchor=e,n.prevOptions.html==n.options.html&&n.prevOptions.class==n.options.class&&n.prevOptions.style==n.options.style||(n.needsUpdate=!0),i=n.options):(n=new _n,Object.assign(n,{id:"w2overlay-"+o,name:o,options:i,anchor:e,displayed:!1,tmp:{observeResize:new ResizeObserver(()=>{this.resize(n.name)})},hide(){r.hide(o)}}),st.active[o]=n),Object.keys(n.options).forEach(l=>{var c=n.options[l];l.startsWith("on")&&typeof c=="function"&&(n[l]=c,delete n.options[l])}),i.autoShow===!0&&(i.autoShowOn=i.autoShowOn??"mouseenter",i.autoHideOn=i.autoHideOn??"mouseleave",i.autoShow=!1),i.autoShowOn&&(t="autoShow-"+n.name,p(e).off("."+t).on(i.autoShowOn+"."+t,l=>{r.show(n.name),l.stopPropagation()}),delete i.autoShowOn),i.autoHideOn&&(t="autoHide-"+n.name,p(e).off("."+t).on(i.autoHideOn+"."+t,l=>{r.hide(n.name),l.stopPropagation()}),delete i.autoHideOn),n.off(".attach");let a={overlay:n,then:l=>(n.on("show:after.attach",c=>{l(c)}),a),show:l=>(n.on("show.attach",c=>{l(c)}),a),hide:l=>(n.on("hide.attach",c=>{l(c)}),a),update:l=>(n.on("update.attach",c=>{l(c)}),a),move:l=>(n.on("move.attach",c=>{l(c)}),a)};return a}}update(e,t){var i=st.active[e];i?(i.needsUpdate=!0,i.options.html=t,this.show(e)):console.log(`Tooltip "${e}" is not displayed. Cannot update it.`)}show(e){if(e instanceof HTMLElement||e instanceof Object){let a=e,l=(e instanceof HTMLElement&&((a=arguments[1]||{}).anchor=e),this.attach(a));return p(l.overlay.anchor).off(".autoShow-"+l.overlay.name).off(".autoHide-"+l.overlay.name),setTimeout(()=>{this.show(l.overlay.name),this.initControls&&this.initControls(l.overlay)},1),l}let t,i=this,n=st.active[e.replace(/[\s\.#]/g,"_")];if(n){let a=n.options;if(!n||n.displayed&&!n.needsUpdate)this.resize(n==null?void 0:n.name);else{var r=a.position.split("|"),r=["top","bottom"].includes(r[0]);let l=a.align=="both"&&r?"":"white-space: nowrap;";if(a.maxWidth&&b.getStrWidth(a.html,"")>a.maxWidth&&(l="width: "+a.maxWidth+"px; white-space: inherit; overflow: auto;"),l+=" max-height: "+(a.maxHeight||window.innerHeight-40)+"px;",a.html!==""&&a.html!=null){if(n.box){if((t=this.trigger("update",{target:e,overlay:n})).isCancelled===!0)return void(n.prevOptions&&(n.options=n.prevOptions,delete n.prevOptions));p(n.box).find(".w2ui-overlay-body").attr("style",(a.style||"")+"; "+l).removeClass().addClass("w2ui-overlay-body "+a.class).html(a.html)}else{if((t=this.trigger("show",{target:e,overlay:n})).isCancelled===!0)return;p("body").append(`<div id="${n.id}" name="${e}" style="display: none; pointer-events: none" class="w2ui-overlay"
                        data-click="stop" data-focusin="stop">
                    <style></style>
                    <div class="w2ui-overlay-body ${a.class}" style="${a.style||""}; ${l}">
                        ${a.html}
                    </div>
                </div>`),n.box=p("#"+b.escapeId(n.id))[0],n.displayed=!0,r=p(n.anchor).data("tooltipName")??[],r.push(e),p(n.anchor).data("tooltipName",r),b.bindEvents(n.box,{}),n.tmp.originalCSS="",0<p(n.anchor).length&&(n.tmp.originalCSS=p(n.anchor)[0].style.cssText)}this.resize(n.name),a.anchorStyle&&(n.anchor.style.cssText+=";"+a.anchorStyle),!a.anchorClass||a.anchorClass=="w2ui-focus"&&n.anchor==document.body||p(n.anchor).addClass(a.anchorClass),typeof a.hideOn=="string"&&(a.hideOn=[a.hideOn]),Array.isArray(a.hideOn)||(a.hideOn=[]),Object.assign(n.tmp,{scrollLeft:document.body.scrollLeft,scrollTop:document.body.scrollTop});{let c=u=>{i.hide(n.name)},h=p(n.anchor),d="tooltip-"+n.name;p("body").off("."+d),a.hideOn.includes("doc-click")&&(["INPUT","TEXTAREA"].includes(n.anchor.tagName)&&h.off(`.${d}-doc`).on(`click.${d}-doc`,u=>{u.stopPropagation()}),p("body").on("click."+d,c)),a.hideOn.includes("focus-change")&&p("body").on("focusin."+d,u=>{document.activeElement!=n.anchor&&i.hide(n.name)}),["INPUT","TEXTAREA"].includes(n.anchor.tagName)&&(h.off("."+d),a.hideOn.forEach(u=>{["doc-click","focus-change"].indexOf(u)==-1&&h.on(u+"."+d,{once:!0},c)}))}{var o=document.body;let c="tooltip-"+n.name,h=o;o.tagName=="BODY"&&(h=o.ownerDocument),p(h).off("."+c).on("scroll."+c,d=>{Object.assign(n.tmp,{scrollLeft:o.scrollLeft,scrollTop:o.scrollTop}),i.resize(n.name)})}return p(n.box).show(),n.tmp.observeResize.observe(n.box),st.observeRemove.observe(document.body,{subtree:!0,childList:!0}),p(n.box).css("opacity",1).find(".w2ui-overlay-body").html(a.html),setTimeout(()=>{p(n.box).css({"pointer-events":"auto"}).data("ready","yes")},100),delete n.needsUpdate,n.box.overlay=n,t&&t.finish(),{overlay:n}}i.hide(e)}}}hide(e){var r;let t;if(arguments.length==0)Object.keys(st.active).forEach(o=>{this.hide(o)});else if(e instanceof HTMLElement)(p(e).data("tooltipName")??[]).forEach(o=>{this.hide(o)});else if(typeof e=="string"&&(e=e.replace(/[\s\.#]/g,"_"),t=st.active[e]),t&&t.box&&(delete st.active[e],e=this.trigger("hide",{target:e,overlay:t}),e.isCancelled!==!0)){var i="tooltip-"+t.name;(r=t.tmp.observeResize)==null||r.disconnect(),t.options.watchScroll&&p(t.options.watchScroll).off(".w2scroll-"+t.name);let o=0;Object.keys(st.active).forEach(a=>{st.active[a].displayed&&o++}),o==0&&st.observeRemove.disconnect(),p("body").off("."+i),p(document).off("."+i),t.box.remove(),t.box=null,t.displayed=!1;var n=p(t.anchor).data("tooltipName")??[];n.indexOf(t.name)!=-1&&n.splice(n.indexOf(t.name),1),n.length==0?p(t.anchor).removeData("tooltipName"):p(t.anchor).data("tooltipName",n),t.anchor.style.cssText=t.tmp.originalCSS,p(t.anchor).off("."+i).removeClass(t.options.anchorClass),e.finish()}}resize(e){if(arguments.length==0)Object.keys(st.active).forEach(n=>{n=st.active[n],n.displayed&&this.resize(n.name)});else{var t=st.active[e.replace(/[\s\.#]/g,"_")];let n=this.getPosition(t.name);var i=n.left+"x"+n.top;let r;t.tmp.lastPos!=i&&(r=this.trigger("move",{target:e,overlay:t,pos:n})),p(t.box).css({left:n.left+"px",top:n.top+"px"}).then(o=>{n.width!=null&&o.css("width",n.width+"px").find(".w2ui-overlay-body").css("width","100%"),n.height!=null&&o.css("height",n.height+"px").find(".w2ui-overlay-body").css("height","100%")}).find(".w2ui-overlay-body").removeClass("w2ui-arrow-right w2ui-arrow-left w2ui-arrow-top w2ui-arrow-bottom").addClass(n.arrow.class).closest(".w2ui-overlay").find("style").text(n.arrow.style),t.tmp.lastPos!=i&&r&&(t.tmp.lastPos=i,r.finish())}}getPosition(e){let t=st.active[e.replace(/[\s\.#]/g,"_")];if(t&&t.box){let d=t.options;(t.tmp.resizedY||t.tmp.resizedX)&&p(t.box).css({width:"",height:"",scroll:"auto"});var e=b.scrollBarSize(),i=document.body.scrollWidth!=document.body.clientWidth,n=document.body.scrollHeight!=document.body.clientHeight;let m={width:window.innerWidth-(n?e:0),height:window.innerHeight-(i?e:0)};var r,o=(d.position=="auto"?"top|bottom|right|left":d.position).split("|");let f=["top","bottom"].includes(o[0]),_=t.box.getBoundingClientRect(),g=t.anchor.getBoundingClientRect(),v=(t.anchor==document.body&&({x:a,y:l,width:c,height:h}=d.originalEvent,g={left:a-2,top:l-4,width:c,height:h,arrow:"none"}),d.arrowSize),y=(g.arrow=="none"&&(v=0),{top:g.top,bottom:m.height-(g.top+g.height)-+(i?e:0),left:g.left,right:m.width-(g.left+g.width)+(n?e:0)});_.width<22&&(_.width=22),_.height<14&&(_.height=14);let x,E,R,M,C="",P={offset:0,class:"",style:`#${t.id} { --tip-size: ${v}px; }`},N={left:0,top:0},w={posX:"",x:0,posY:"",y:0};o.forEach(S=>{["top","bottom"].includes(S)&&(!C&&_.height+v/1.893<y[S]&&(C=S),y[S]>w.y)&&Object.assign(w,{posY:S,y:y[S]}),["left","right"].includes(S)&&(!C&&_.width+v/1.893<y[S]&&(C=S),y[S]>w.x)&&Object.assign(w,{posX:S,x:y[S]})}),C=C||(f?w.posY:w.posX),d.autoResize&&(["top","bottom"].includes(C)&&(_.height>y[C]?(M=y[C],t.tmp.resizedY=!0):t.tmp.resizedY=!1),["left","right"].includes(C))&&(_.width>y[C]?(R=y[C],t.tmp.resizedX=!0):t.tmp.resizedX=!1);var a=C;switch(P.class=g.arrow||"w2ui-arrow-"+a,a){case"top":x=g.left+(g.width-(R??_.width))/2,E=g.top-(M??_.height)-v/1.5+1;break;case"bottom":x=g.left+(g.width-(R??_.width))/2,E=g.top+g.height+v/1.25+1;break;case"left":x=g.left-(R??_.width)-v/1.2-1,E=g.top+(g.height-(M??_.height))/2;break;case"right":x=g.left+g.width+v/1.2+1,E=g.top+(g.height-(M??_.height))/2}f&&(d.align=="left"&&(N.left=g.left-x,x=g.left),d.align=="right"&&(N.left=g.left+g.width-(R??_.width)-x,x=g.left+g.width-(R??_.width)),["top","bottom"].includes(C)&&d.align.startsWith("both")&&(r=d.align.split(":")[1]??50,g.width>=r)&&(x=g.left,R=g.width),d.align=="top"&&(N.top=g.top-E,E=g.top),d.align=="bottom"&&(N.top=g.top+g.height-(M??_.height)-E,E=g.top+g.height-(M??_.height)),["left","right"].includes(C)&&d.align.startsWith("both")&&(r=d.align.split(":")[1]??50,g.height>=r)&&(E=g.top,M=g.height));{let S;(["left","right"].includes(d.align)&&g.width<(R??_.width)||["top","bottom"].includes(d.align)&&g.height<(M??_.height))&&(S=!0);var l=C=="right"?v:d.screenMargin,c=C=="bottom"?v:d.screenMargin,h=m.width-(R??_.width)-(C=="left"?v:d.screenMargin),i=m.height-(M??_.height)-(C=="top"?v:d.screenMargin)+3;(["top","bottom"].includes(C)||d.autoResize)&&(x<l&&(S=!0,N.left-=x,x=l),x>h)&&(S=!0,N.left-=x-h,x+=h-x),(["left","right"].includes(C)||d.autoResize)&&(E<c&&(S=!0,N.top-=E,E=c),E>i)&&(S=!0,N.top-=E-i,E+=i-E),S&&(l=f?"left":"top",h=f?"width":"height",P.offset=-N[l],c=_[h]/2-v,Math.abs(P.offset)>c+v&&(P.class=""),Math.abs(P.offset)>c&&(P.offset=P.offset<0?-c:c),P.style=b.stripSpaces(`#${t.id} .w2ui-overlay-body:after,
                            #${t.id} .w2ui-overlay-body:before {
                                --tip-size: ${v}px;
                                margin-${l}: ${P.offset}px;
                            }`))}return n=C=="top"?-d.margin:C=="bottom"?d.margin:0,e=C=="left"?-d.margin:C=="right"?d.margin:0,E=Math.floor(100*(E+parseFloat(d.offsetY)+parseFloat(n)))/100,{left:x=Math.floor(100*(x+parseFloat(d.offsetX)+parseFloat(e)))/100,top:E,arrow:P,adjust:N,width:R,height:M,pos:C}}}};Zr(st,"active",{}),Zr(st,"observeRemove",new MutationObserver(e=>{let t=0;Object.keys(st.active).forEach(i=>{i=st.active[i],i.displayed&&(i.anchor&&i.anchor.isConnected?t++:i.hide())}),t===0&&st.observeRemove.disconnect()}));let hi=st;class O1 extends hi{constructor(){super(),this.palette=[["000000","333333","555555","777777","888888","999999","AAAAAA","CCCCCC","DDDDDD","EEEEEE","F7F7F7","FFFFFF"],["FF011B","FF9838","FFC300","FFFD59","86FF14","14FF7A","2EFFFC","2693FF","006CE7","9B24F4","FF21F5","FF0099"],["FFEAEA","FCEFE1","FCF4DC","FFFECF","EBFFD9","D9FFE9","E0FFFF","E8F4FF","ECF4FC","EAE6F4","FFF5FE","FCF0F7"],["F4CCCC","FCE5CD","FFF1C2","FFFDA1","D5FCB1","B5F7D0","BFFFFF","D6ECFF","CFE2F3","D9D1E9","FFE3FD","FFD9F0"],["EA9899","F9CB9C","FFE48C","F7F56F","B9F77E","84F0B1","83F7F7","B5DAFF","9FC5E8","B4A7D6","FAB9F6","FFADDE"],["E06666","F6B26B","DEB737","E0DE51","8FDB48","52D189","4EDEDB","76ACE3","6FA8DC","8E7CC3","E07EDA","F26DBD"],["CC0814","E69138","AB8816","B5B20E","6BAB30","27A85F","1BA8A6","3C81C7","3D85C6","674EA7","A14F9D","BF4990"],["99050C","B45F17","80650E","737103","395E14","10783D","13615E","094785","0A5394","351C75","780172","782C5A"]],this.defaults=b.extend({},this.defaults,{advanced:!1,transparent:!0,position:"top|bottom",class:"w2ui-white",color:"",liveUpdate:!0,arrowSize:12,autoResize:!1,anchorClass:"w2ui-focus",autoShowOn:"focus",hideOn:["doc-click","focus-change"],onSelect:null,onLiveUpdate:null})}attach(e,t){let i;arguments.length==1&&e.anchor?e=(i=e).anchor:arguments.length===2&&t!=null&&typeof t=="object"&&((i=t).anchor=e),t=i.hideOn,i=b.extend({},this.defaults,i||{}),t&&(i.hideOn=t),i.style+="; padding: 0;",i.transparent&&this.palette[0][1]=="333333"&&(this.palette[0].splice(1,1),this.palette[0].push("")),i.transparent||this.palette[0][1]=="333333"||(this.palette[0].splice(1,0,"333333"),this.palette[0].pop()),i.color&&(i.color=String(i.color).toUpperCase()),typeof i.color=="string"&&i.color.substr(0,1)==="#"&&(i.color=i.color.substr(1)),this.index=[-1,-1];let n=super.attach(i),r=n.overlay;return r.options.html=this.getColorHTML(r.name,i),r.on("show.attach",a=>{var a=a.detail.overlay,l=a.anchor,c=a.options;["INPUT","TEXTAREA"].includes(l.tagName)&&!c.color&&l.value&&(a.tmp.initColor=l.value),delete a.newColor}),r.on("show:after.attach",o=>{var l;var a;(l=n.overlay)!=null&&l.box&&(a=p(n.overlay.box).find(".w2ui-eaction"),b.bindEvents(a,this),this.initControls(n.overlay))}),r.on("update:after.attach",o=>{var l;var a;(l=n.overlay)!=null&&l.box&&(a=p(n.overlay.box).find(".w2ui-eaction"),b.bindEvents(a,this),this.initControls(n.overlay))}),r.on("hide.attach",a=>{var a=a.detail.overlay,c=a.anchor,l=a.newColor??a.options.color??"",c=(["INPUT","TEXTAREA"].includes(c.tagName)&&c.value!=l&&(c.value=l),this.trigger("select",{color:l,target:a.name,overlay:a}));c.isCancelled!==!0&&c.finish()}),n.liveUpdate=o=>(r.on("liveUpdate.attach",a=>{o(a)}),n),n.select=o=>(r.on("select.attach",a=>{o(a)}),n),n}select(e,r){let i;this.index=[-1,-1],typeof r!="string"&&(i=r.target,this.index=p(i).attr("index").split(":"),r=p(i).closest(".w2ui-overlay").attr("name"));var n=this.get(r),r=this.trigger("liveUpdate",{color:e,target:r,overlay:n,param:arguments[1]});r.isCancelled!==!0&&(["INPUT","TEXTAREA"].includes(n.anchor.tagName)&&n.options.liveUpdate&&p(n.anchor).val(e),n.newColor=e,p(n.box).find(".w2ui-selected").removeClass("w2ui-selected"),i&&p(i).addClass("w2ui-selected"),r.finish())}nextColor(e){var t=this.palette;switch(e){case"up":this.index[0]--;break;case"down":this.index[0]++;break;case"right":this.index[1]++;break;case"left":this.index[1]--}return this.index[0]<0&&(this.index[0]=0),this.index[0]>t.length-2&&(this.index[0]=t.length-2),this.index[1]<0&&(this.index[1]=0),this.index[1]>t[0].length-1&&(this.index[1]=t[0].length-1),t[this.index[0]][this.index[1]]}tabClick(e,i){typeof i!="string"&&(i=p(i.target).closest(".w2ui-overlay").attr("name"));var i=this.get(i),n=p(i.box).find(`.w2ui-color-tab:nth-child(${e})`);p(i.box).find(".w2ui-color-tab").removeClass("w2ui-selected"),p(n).addClass("w2ui-selected"),p(i.box).find(".w2ui-tab-content").hide().closest(".w2ui-colors").find(".tab-"+e).show()}getColorHTML(e,t){let i=`
            <div class="w2ui-colors">
                <div class="w2ui-tab-content tab-1">`;for(let r=0;r<this.palette.length;r++){i+='<div class="w2ui-color-row">';for(let o=0;o<this.palette[r].length;o++){var n=this.palette[r][o];let a=n==="FFFFFF"?"; border: 1px solid #efefef":"";i+=`
                    <div class="w2ui-color w2ui-eaction ${n===""?"w2ui-no-color":""} ${t.color==n?"w2ui-selected":""}"
                        style="background-color: #${n+a};" name="${n}" index="${r}:${o}"
                        data-mousedown="select|'${n}'|event" data-mouseup="hide|${e}">&nbsp;
                    </div>`}i+="</div>",r<2&&(i+='<div style="height: 8px"></div>')}return i=(i=(i+="</div>")+`
            <div class="w2ui-tab-content tab-2" style="display: none">
                <div class="color-info">
                    <div class="color-preview-bg"><div class="color-preview"></div><div class="color-original"></div></div>
                    <div class="color-part">
                        <span>H</span> <input class="w2ui-input" name="h" maxlength="3" max="360" tabindex="101">
                        <span>R</span> <input class="w2ui-input" name="r" maxlength="3" max="255" tabindex="104">
                    </div>
                    <div class="color-part">
                        <span>S</span> <input class="w2ui-input" name="s" maxlength="3" max="100" tabindex="102">
                        <span>G</span> <input class="w2ui-input" name="g" maxlength="3" max="255" tabindex="105">
                    </div>
                    <div class="color-part">
                        <span>V</span> <input class="w2ui-input" name="v" maxlength="3" max="100" tabindex="103">
                        <span>B</span> <input class="w2ui-input" name="b" maxlength="3" max="255" tabindex="106">
                    </div>
                    <div class="color-part opacity">
                        <span>${b.lang("Opacity")}</span>
                        <input class="w2ui-input" name="a" maxlength="5" max="1" tabindex="107">
                    </div>
                </div>
                <div class="palette" name="palette">
                    <div class="palette-bg"></div>
                    <div class="value1 move-x move-y"></div>
                </div>
                <div class="rainbow" name="rainbow">
                    <div class="value2 move-x"></div>
                </div>
                <div class="alpha" name="alpha">
                    <div class="alpha-bg"></div>
                    <div class="value2 move-x"></div>
                </div>
            </div>`)+`
            <div class="w2ui-color-tabs">
                <div class="w2ui-color-tab selected w2ui-eaction" data-click="tabClick|1|event|this"><span class="w2ui-icon w2ui-icon-colors"></span></div>
                <div class="w2ui-color-tab w2ui-eaction" data-click="tabClick|2|event|this"><span class="w2ui-icon w2ui-icon-settings"></span></div>
                <div style="padding: 5px; width: 100%; text-align: right;">
                    ${typeof t.html=="string"?t.html:""}
                </div>
            </div>`}initControls(e){let t,i=this;var n=e.options;let r=b.parseColor(n.color||e.tmp.initColor),o=(r==null&&(r={r:140,g:150,b:160,a:1}),b.rgb2hsv(r));n.advanced===!0&&this.tabClick(2,e.name),c(o,!0,!0),p(e.box).find("input").off(".w2color").on("change.w2color",g=>{g=p(g.target);let f=parseFloat(g.val());var _=parseFloat(g.attr("max")),_=(isNaN(f)&&(f=0,g.val(0)),1<_&&(f=parseInt(f)),0<_&&f>_&&(g.val(_),f=_),f<0&&(g.val(0),f=0),g.attr("name")),g={};["r","g","b","a"].indexOf(_)!==-1?(r[_]=f,o=b.rgb2hsv(r)):["h","s","v"].indexOf(_)!==-1&&(g[_]=f),c(g,!0)}),p(e.box).find(".color-original").off(".w2color").on("click.w2color",m=>{m=b.parseColor(p(m.target).css("background-color")),m!=null&&(r=m,c(o=b.rgb2hsv(r),!0))}),n=`${b.isIOS?"touchstart":"mousedown"}.w2color`;let a=`${b.isIOS?"touchend":"mouseup"}.w2color`,l=`${b.isIOS?"touchmove":"mousemove"}.w2color`;function c(m,f,_){var E;m.h!=null&&(o.h=m.h),m.s!=null&&(o.s=m.s),m.v!=null&&(o.v=m.v),m.a!=null&&(r.a=m.a,o.a=m.a);let g="rgba("+(r=b.hsv2rgb(o)).r+","+r.g+","+r.b+","+r.a+")",v=[Number(r.r).toString(16).toUpperCase(),Number(r.g).toString(16).toUpperCase(),Number(r.b).toString(16).toUpperCase(),Math.round(255*Number(r.a)).toString(16).toUpperCase()];var y,x;v.forEach((R,M)=>{R.length===1&&(v[M]="0"+R)}),g=v[0]+v[1]+v[2]+v[3],r.a===1&&(g=v[0]+v[1]+v[2]),p(e.box).find(".color-preview").css("background-color","#"+g),p(e.box).find("input").each(R=>{R.name&&(r[R.name]!=null&&(R.value=r[R.name]),o[R.name]!=null&&(R.value=o[R.name]),R.name==="a")&&(R.value=r.a)}),_?(m=((E=e.tmp)==null?void 0:E.initColor)||g,p(e.box).find(".color-original").css("background-color","#"+m),p(e.box).find(".w2ui-colors .w2ui-selected").removeClass("w2ui-selected"),p(e.box).find(`.w2ui-colors [name="${m}"]`).addClass("w2ui-selected"),g.length==8&&i.tabClick(2,e.name)):i.select(g,e.name),f&&(_=p(e.box).find(".palette .value1"),m=p(e.box).find(".rainbow .value2"),f=p(e.box).find(".alpha .value2"),y=parseInt(_[0].clientWidth)/2,x=parseInt(m[0].clientWidth)/2,_.css({left:150*o.s/100-y+"px",top:125*(100-o.v)/100-y+"px"}),m.css("left",o.h/2.4-x+"px"),f.css("left",150*r.a-x+"px"),h())}function h(){var m=b.hsv2rgb(o.h,100,100),m=`${m.r},${m.g},`+m.b;p(e.box).find(".palette").css("background-image",`linear-gradient(90deg, rgba(${m},0) 0%, rgba(${m},1) 100%)`)}function d(m){p("body").off(".w2color")}function u(v){var x=t.el,g=v.pageX-t.x,v=v.pageY-t.y;let f=t.left+g,_=t.top+v;var g=parseInt(x.prop("clientWidth"))/2,v=(f<-g&&(f=-g),_<-g&&(_=-g),f>t.width-g&&(f=t.width-g),_>t.height-g&&(_=t.height-g),x.hasClass("move-x")&&x.css({left:f+"px"}),x.hasClass("move-y")&&x.css({top:_+"px"}),p(x.get(0).parentNode).attr("name")),y=parseInt(x.css("left"))+g,x=parseInt(x.css("top"))+g;v==="palette"&&c({s:Math.round(y/t.width*100),v:Math.round(100-x/t.height*100)}),v==="rainbow"&&(c({h:Math.round(2.4*y)}),h()),v==="alpha"&&c({a:parseFloat(Number(y/150).toFixed(2))})}p(e.box).find(".palette, .rainbow, .alpha").off(".w2color").on(n+".w2color",function(m){var f=p(this).find(".value1, .value2"),_=parseInt(f.prop("clientWidth"))/2;f.hasClass("move-x")&&f.css({left:m.offsetX-_+"px"}),f.hasClass("move-y")&&f.css({top:m.offsetY-_+"px"}),t={el:f,x:m.pageX,y:m.pageY,width:f.prop("parentNode").clientWidth,height:f.prop("parentNode").clientHeight,left:parseInt(f.css("left")),top:parseInt(f.css("top"))},u(m),p("body").off(".w2color").on(l,u).on(a,d)})}}class F1 extends hi{constructor(){super(),this.defaults=b.extend({},this.defaults,{type:"normal",items:[],index:null,render:null,spinner:!1,msgNoItems:b.lang("No items found"),topHTML:"",menuStyle:"",filter:!1,markSearch:!1,match:"contains",search:!1,altRows:!1,arrowSize:10,align:"left",position:"bottom|top",class:"w2ui-white",anchorClass:"w2ui-focus",autoShowOn:"focus",hideOn:["doc-click","focus-change","select"],onSelect:null,onSubMenu:null,onRemove:null})}attach(e,t){let i;arguments.length==1&&e.anchor?e=(i=e).anchor:arguments.length===2&&t!=null&&typeof t=="object"&&((i=t).anchor=e),t=i.hideOn,i=b.extend({},this.defaults,i||{}),t&&(i.hideOn=t),i.style+="; padding: 0;",i.items==null&&(i.items=[]),i.html=this.getMenuHTML(i);let n=super.attach(i),r=n.overlay;return r.on("show:after.attach, update:after.attach",o=>{var l;if((l=n.overlay)!=null&&l.box){let c="";r.selected=null,r.options.items=b.normMenu(r.options.items),["INPUT","TEXTAREA"].includes(r.anchor.tagName)&&(c=r.anchor.value,r.selected=r.anchor.dataset.selectedIndex);var a=p(n.overlay.box).find(".w2ui-eaction");b.bindEvents(a,this),this.applyFilter(r.name,null,c).then(h=>{r.tmp.searchCount=h.count,r.tmp.search=h.search,this.refreshSearch(r.name),this.initControls(n.overlay),this.refreshIndex(r.name)})}}),r.on("hide:after.attach",o=>{Ne.hide(r.name+"-tooltip")}),n.select=o=>(r.on("select.attach",a=>{o(a)}),n),n.remove=o=>(r.on("remove.attach",a=>{o(a)}),n),n.subMenu=o=>(r.on("subMenu.attach",a=>{o(a)}),n),n}update(e,t){var i,n=hi.active[e];n?((i=n.options).items!=t&&(i.items=t),t=this.getMenuHTML(i),i.html!=t&&(i.html=t,n.needsUpdate=!0,this.show(e))):console.log(`Tooltip "${e}" is not displayed. Cannot update it.`)}initControls(e){p(e.box).find(".w2ui-menu:not(.w2ui-sub-menu)").off(".w2menu").on("mouseDown.w2menu",{delegate:".w2ui-menu-item"},t=>{var i=t.delegate.dataset;this.menuDown(e,t,i.index,i.parents)}).on((b.isIOS?"touchStart":"click")+".w2menu",{delegate:".w2ui-menu-item"},t=>{var i=t.delegate.dataset;this.menuClick(e,t,parseInt(i.index),i.parents)}).find(".w2ui-menu-item").off(".w2menu").on("mouseEnter.w2menu",t=>{var n;var i=t.target.dataset,i=(n=e.options.items[i.index])==null?void 0:n.tooltip;i&&Ne.show({name:e.name+"-tooltip",anchor:t.target,html:i,position:"right|left",hideOn:["doc-click"]})}).on("mouseLeave.w2menu",t=>{Ne.hide(e.name+"-tooltip")}),["INPUT","TEXTAREA"].includes(e.anchor.tagName)&&p(e.anchor).off(".w2menu").on("input.w2menu",t=>{}).on("keyup.w2menu",t=>{t._searchType="filter",this.keyUp(e,t)}),e.options.search&&p(e.box).find("#menu-search").off(".w2menu").on("keyup.w2menu",t=>{t._searchType="search",this.keyUp(e,t)})}getCurrent(a,r){var a=hi.active[a.replace(/[\s\.#]/g,"_")],i=a.options;let n=(r||(a.selected??"")).split("-");var r=n.length-1,a=n[r],o=n.slice(0,n.length-1).join("-"),a=b.isInt(a)?parseInt(a):0;let l=i.items;return n.forEach((c,h)=>{h<n.length-1&&(l=l[c].items)}),{last:r,index:a,items:l,item:l[a],parents:o}}getMenuHTML(e,t,i,n){if(e.spinner)return`
            <div class="w2ui-menu">
                <div class="w2ui-no-items">
                    <div class="w2ui-spinner"></div>
                    ${b.lang("Loading...")}
                </div>
            </div>`;n=n||[],t==null&&(t=e.items),Array.isArray(t)||(t=[]);let r=0,o=null,a="",l=(!i&&e.search&&(a+=`
                <div class="w2ui-menu-search">
                    <span class="w2ui-icon w2ui-icon-search"></span>
                    <input id="menu-search" class="w2ui-input" type="text"/>
                </div>`,t.forEach(c=>c.hidden=!1)),!i&&e.topHTML&&(a+=`<div class="w2ui-menu-top">${e.topHTML}</div>`),`
            ${a}
            <div class="w2ui-menu ${i?"w2ui-sub-menu":""}" ${i?"":`style="${e.menuStyle}"`}
                data-parent="${n}">
        `);return t.forEach((c,h)=>{o=c.icon;var d=(0<n.length?n.join("-")+"-":"")+h;if(o==null&&(o=null),["radio","check"].indexOf(e.type)==-1||Array.isArray(c.items)||c.group===!1||(o=c.checked===!0?"w2ui-icon-check":"w2ui-icon-empty"),c.hidden!==!0){let m=c.text,f="",_="";if(typeof(m=typeof e.render=="function"?e.render(c,e):m)=="function"&&(m=m(c,e)),o&&(String(o).slice(0,1)!=="<"&&(o=`<span class="w2ui-icon ${o}"></span>`),f=`<div class="menu-icon">${o}</span></div>`),c.type!=="break"&&m!=null&&m!==""&&String(m).substr(0,2)!="--"){var u=["w2ui-menu-item"];e.altRows==1&&u.push(r%2==0?"w2ui-even":"w2ui-odd");let g=1,v=(f===""&&g++,c.count==null&&c.hotkey==null&&c.remove!==!0&&c.items==null&&g++,c.tooltip==null&&c.hint!=null&&(c.tooltip=c.hint),"");if(c.remove===!0)v='<span class="remove">x</span>';else if(c.items!=null){let y=[];typeof c.items=="function"?y=c.items(c):Array.isArray(c.items)&&(y=c.items),v="<span></span>",_=`
                            <div class="w2ui-sub-menu-box" style="${c.expanded?"":"display: none"}">
                                ${this.getMenuHTML(e,y,!0,n.concat(h))}
                            </div>`}else c.count!=null&&(v+="<span>"+c.count+"</span>"),c.hotkey!=null&&(v+='<span class="hotkey">'+c.hotkey+"</span>");c.disabled===!0&&u.push("w2ui-disabled"),c._noSearchInside===!0&&u.push("w2ui-no-search-inside"),_!==""&&(u.push("has-sub-menu"),c.expanded?u.push("expanded"):u.push("collapsed")),l+=`
                        <div index="${d}" class="${u.join(" ")}" style="${c.style||""}"
                            data-index="${h}" data-parents="${n.join("-")}">
                                <div style="width: ${(i?20:0)+parseInt(c.indent??0)}px"></div>
                                ${f}
                                <div class="menu-text" colspan="${g}">${b.lang(m)}</div>
                                <div class="menu-extra">${v}</div>
                        </div>
                        `+_,r++}else u=(m??"").replace(/^-+/g,""),l+=`
                        <div index="${d}" class="w2ui-menu-divider ${u!=""?"has-text":""}">
                            <div class="line"></div>
                            ${u?`<div class="text">${u}</div>`:""}
                        </div>`}t[h]=c}),r===0&&e.msgNoItems&&(l+=`
                <div class="w2ui-no-items">
                    ${b.lang(e.msgNoItems)}
                </div>`),l+="</div>"}refreshIndex(n){var t,i,n=hi.active[n.replace(/[\s\.#]/g,"_")];n&&(n.displayed||this.show(n.name),t=p(n.box).find(".w2ui-overlay-body").get(0),i=p(n.box).find(".w2ui-menu-search, .w2ui-menu-top").get(0),p(n.box).find(".w2ui-menu-item.w2ui-selected").removeClass("w2ui-selected"),n=p(n.box).find(`.w2ui-menu-item[index="${n.selected}"]`).addClass("w2ui-selected").get(0))&&(n.offsetTop+n.clientHeight>t.clientHeight+t.scrollTop&&n.scrollIntoView({behavior:"smooth",block:"start",inline:"start"}),n.offsetTop<t.scrollTop+(i?i.clientHeight:0))&&n.scrollIntoView({behavior:"smooth",block:"end",inline:"end"})}refreshSearch(e){var i,n;let t=hi.active[e.replace(/[\s\.#]/g,"_")];t&&(t.displayed||this.show(t.name),p(t.box).find(".w2ui-no-items").hide(),p(t.box).find(".w2ui-menu-item, .w2ui-menu-divider").each(r=>{var a,l;var o;(a=this.getCurrent(e,r.getAttribute("index")).item)!=null&&a.hidden?p(r).hide():((o=(l=t.tmp)==null?void 0:l.search)&&t.options.markSearch&&b.marker(r,o,{onlyFirst:t.options.match=="begins"}),p(r).show())}),p(t.box).find(".w2ui-sub-menu").each(r=>{var o=p(r).find(".w2ui-menu-item").get().some(a=>a.style.display!="none");this.getCurrent(e,r.dataset.parent).item.expanded&&(o?p(r).parent().show():p(r).parent().hide())}),t.tmp.searchCount!=0&&((n=(i=t.options)==null?void 0:i.items)==null?void 0:n.length)!=0||(p(t.box).find(".w2ui-no-items").length==0&&p(t.box).find(".w2ui-menu:not(.w2ui-sub-menu)").append(`
                    <div class="w2ui-no-items">
                        ${b.lang(t.options.msgNoItems)}
                    </div>`),p(t.box).find(".w2ui-no-items").show()))}applyFilter(e,t,i,n){var m;let r=0;var o=hi.active[e.replace(/[\s\.#]/g,"_")];let a=o.options,l,c;var h=new Promise((f,_)=>{l=f,c=_});i==null&&(i=["INPUT","TEXTAREA"].includes(o.anchor.tagName)?o.anchor.value:"");let d=[];a.selected&&(Array.isArray(a.selected)?d=a.selected.map(f=>(f==null?void 0:f.id)??f):(m=a.selected)!=null&&m.id&&(d=[a.selected.id])),o.tmp.activeChain=null;var u=o.tmp.remote??{hasMore:!0,emtpySet:!1,search:null,total:-1};if(t==null&&a.url&&u.hasMore&&u.search!==i){let f=!0,_=b.lang("Loading...");i.length<a.minLength&&u.emptySet!==!0&&(_=b.lang("${count} letters or more...",{count:a.minLength}),f=!1,i==="")&&(_=b.lang(a.msgSearch)),p(o.box).find(".w2ui-no-items").html(_),u.search=i,a.items=[],o.tmp.remote=u,f&&this.request(o,i,n).then(g=>{this.update(e,g),this.applyFilter(e,null,i).then(v=>{l(v)})}).catch(g=>{console.log("Server Request error",g)})}else{let f;t==null&&(f=this.trigger("search",{search:i,overlay:o,prom:h,resolve:l,reject:c})).isCancelled===!0||(t==null&&(t=o.options.items),a.filter===!1?l({count:-1,search:i}):(t.forEach(_=>{let g="",v="";["is","begins","begins with"].indexOf(a.match)!==-1&&(g="^"),["is","ends","ends with"].indexOf(a.match)!==-1&&(v="$");try{new RegExp(g+i+v,"i").test(_.text)||_.text==="..."?_.hidden=!1:_.hidden=!0}catch{}a.hideSelected&&d.includes(_.id)&&(_.hidden=!0),Array.isArray(_.items)&&0<_.items.length&&(delete _._noSearchInside,this.applyFilter(e,_.items,i).then(y=>{y=y.count,0<y&&(r+=y,_.hidden&&(_._noSearchInside=!0),i&&(_.expanded=!0),_.hidden=!1)})),_.hidden!==!0&&r++}),l({count:r,search:i}),f==null||f.finish()))}return h}request(e,t,i){let n=e.options,r=e.tmp.remote,o,a;return(n.items.length===0&&r.total!==0||r.total==n.cacheMax&&t.length>r.search.length||t.length>=r.search.length&&t.substr(0,r.search.length)!==r.search||t.length<r.search.length)&&(r.controller&&r.controller.abort(),r.loading=!0,clearTimeout(r.timeout),r.timeout=setTimeout(()=>{var l=n.url;let c={search:t,max:n.cacheMax};Object.assign(c,n.postData);var h,d=this.trigger("request",{search:t,overlay:e,url:l,postData:c,httpMethod:n.method??"GET",httpHeaders:{}});d.isCancelled!==!0&&(l=new URL(d.detail.url,location),h=b.prepareParams(l,{method:d.detail.httpMethod,headers:d.detail.httpHeaders,body:d.detail.postData}),r.controller=new AbortController,h.signal=r.controller.signal,fetch(l,h).then(u=>u.json()).then(u=>{r.controller=null;var m=e.trigger("load",{search:c.search,overlay:e,data:u});m.isCancelled!==!0&&(typeof(u=m.detail.data)=="string"&&(u=JSON.parse(u)),(u=Array.isArray(u)?{records:u}:u).records==null&&u.items!=null&&(u.records=u.items,delete u.items),u.error||u.records!=null||(u.records=[]),Array.isArray(u.records)?(u.records.length>=n.cacheMax?(u.records.splice(n.cacheMax,u.records.length),r.hasMore=!0):r.hasMore=!1,n.recId==null&&n.recid!=null&&(n.recId=n.recid),(n.recId||n.recText)&&u.records.forEach(f=>{typeof n.recId=="string"&&(f.id=f[n.recId]),typeof n.recId=="function"&&(f.id=n.recId(f)),typeof n.recText=="string"&&(f.text=f[n.recText]),typeof n.recText=="function"&&(f.text=n.recText(f))}),r.loading=!1,r.search=t,r.total=u.records.length,r.lastError="",r.emptySet=t===""&&u.records.length===0,m.finish(),o(b.normMenu(u.records))):console.error("ERROR: server did not return proper data structure",`
`," - it should return",{records:[{id:1,text:"item"}]},`
`," - or just an array ",[{id:1,text:"item"}],`
`," - or if errorr ",{error:!0,message:"error message"}))}).catch(u=>{var m=this.trigger("error",{overlay:e,search:t,error:u});m.isCancelled!==!0&&((u==null?void 0:u.name)!=="AbortError"&&console.error("ERROR: Server communication failed.",`
`," - it should return",{records:[{id:1,text:"item"}]},`
`," - or just an array ",[{id:1,text:"item"}],`
`," - or if errorr ",{error:!0,message:"error message"}),r.loading=!1,r.search="",r.total=-1,r.emptySet=!0,r.lastError=m.detail.error||"Server communication failed",n.items=[],m.finish(),a())}),d.finish())},i?n.debounce??350:0)),new Promise((l,c)=>{o=l,a=c})}getActiveChain(e,t,i=[],n=[],r){var o=hi.active[e.replace(/[\s\.#]/g,"_")];return o.tmp.activeChain!=null?o.tmp.activeChain:((t=t??o.options.items).forEach((a,l)=>{var c;a.hidden||a.disabled||(c=a==null?void 0:a.text)!=null&&c.startsWith("--")||(n.push(i.concat([l]).join("-")),Array.isArray(a.items)&&0<a.items.length&&a.expanded&&(i.push(l),this.getActiveChain(e,a.items,i,n,!0),i.pop()))}),r==null&&(o.tmp.activeChain=n),n)}menuDown(e,t,i,n){e=e.options;let r=e.items;var o=p(t.delegate).find(".w2ui-icon");let a=p(t.target).closest(".w2ui-menu:not(.w2ui-sub-menu)"),l=(typeof n=="string"&&n!==""&&n.split("-").forEach(c=>{r=r[c].items}),r[i]);if(!l.disabled){let c=(h,d)=>{h.forEach((u,m)=>{u.id!=l.id&&(u.group===l.group&&u.checked&&(a.find(`.w2ui-menu-item[index="${(d?d+"-":"")+m}"] .w2ui-icon`).removeClass("w2ui-icon-check").addClass("w2ui-icon-empty"),h[m].checked=!1),Array.isArray(u.items))&&c(u.items,m)})};e.type!=="check"&&e.type!=="radio"||l.group===!1||p(t.target).hasClass("remove")||p(t.target).closest(".w2ui-menu-item").hasClass("has-sub-menu")||(l.checked=e.type=="radio"||!l.checked,l.checked?(e.type==="radio"&&p(t.target).closest(".w2ui-menu").find(".w2ui-icon").removeClass("w2ui-icon-check").addClass("w2ui-icon-empty"),e.type==="check"&&l.group!=null&&c(e.items),o.removeClass("w2ui-icon-empty").addClass("w2ui-icon-check")):e.type==="check"&&o.removeClass("w2ui-icon-check").addClass("w2ui-icon-empty")),p(t.target).hasClass("remove")||(a.find(".w2ui-menu-item").removeClass("w2ui-selected"),p(t.delegate).addClass("w2ui-selected"))}}menuClick(e,t,i,n){var r=e.options;let o=r.items;var a=p(t.delegate).closest(".w2ui-menu-item");let l=!r.hideOn.includes("select");(t.shiftKey||t.metaKey||t.ctrlKey)&&(l=!0),typeof n=="string"&&n!==""?n.split("-").forEach(h=>{o=o[h].items}):n=null;var c=(o=typeof o=="function"?o({overlay:e,index:i,parentIndex:n,event:t}):o)[i];if(!c.disabled||p(t.target).hasClass("remove")){let h;if(p(t.target).hasClass("remove")){if((h=this.trigger("remove",{originalEvent:t,target:e.name,overlay:e,item:c,index:i,parentIndex:n,el:a[0]})).isCancelled===!0)return;l=!r.hideOn.includes("item-remove"),a.remove()}else if(a.hasClass("has-sub-menu")){if((h=this.trigger("subMenu",{originalEvent:t,target:e.name,overlay:e,item:c,index:i,parentIndex:n,el:a[0]})).isCancelled===!0)return;l=!0,a.hasClass("expanded")?(c.expanded=!1,a.removeClass("expanded").addClass("collapsed"),p(a.get(0).nextElementSibling).hide()):(c.expanded=!0,a.addClass("expanded").removeClass("collapsed"),p(a.get(0).nextElementSibling).show()),e.selected=parseInt(a.attr("index"))}else{if(r=this.findChecked(r.items),e.selected=parseInt(a.attr("index")),(h=this.trigger("select",{originalEvent:t,target:e.name,overlay:e,item:c,index:i,parentIndex:n,selected:r,keepOpen:l,el:a[0]})).isCancelled===!0)return;c.keepOpen!=null&&(l=c.keepOpen),["INPUT","TEXTAREA"].includes(e.anchor.tagName)&&(e.anchor.dataset.selected=c.id,e.anchor.dataset.selectedIndex=e.selected)}l||this.hide(e.name),h.finish()}}findChecked(e){let t=[];return e.forEach(i=>{i.checked&&t.push(i),Array.isArray(i.items)&&(t=t.concat(this.findChecked(i.items)))}),t}keyUp(e,t){var h,d;var i=e.options,n=t.target.value;let r=!0,o=!1;switch(t.keyCode){case 46:case 8:n!==""||e.displayed||(r=!1);break;case 13:if(!e.displayed||!e.selected)return;var{index:l,parents:a}=this.getCurrent(e.name);t.delegate=p(e.box).find(".w2ui-selected").get(0),this.menuClick(e,t,parseInt(l),a),r=!1;break;case 27:r=!1,e.displayed?this.hide(e.name):(l=e.anchor,["INPUT","TEXTAREA"].includes(l.tagName)&&(l.value="",delete l.dataset.selected,delete l.dataset.selectedIndex));break;case 37:{if(!e.displayed)return;let{item:u,index:m,parents:f}=this.getCurrent(e.name);f&&(u=i.items[f],m=parseInt(f),f="",o=!0),Array.isArray(u==null?void 0:u.items)&&0<u.items.length&&u.expanded&&(t.delegate=p(e.box).find(`.w2ui-menu-item[index="${m}"]`).get(0),e.selected=m,this.menuClick(e,t,parseInt(m),f)),r=!1;break}case 39:if(!e.displayed)return;var{item:a,index:l,parents:c}=this.getCurrent(e.name);Array.isArray(a==null?void 0:a.items)&&0<a.items.length&&!a.expanded&&(t.delegate=p(e.box).find(".w2ui-selected").get(0),this.menuClick(e,t,parseInt(l),c)),r=!1;break;case 38:e.displayed&&(a=this.getActiveChain(e.name),e.selected==null||((h=e.selected)==null?void 0:h.length)==0?e.selected=a[a.length-1]:((l=a.indexOf(e.selected))==-1&&(e.selected=a[a.length-1]),0<l&&(e.selected=a[l-1])),r=!1,o=!0,t.preventDefault());break;case 40:e.displayed&&(c=this.getActiveChain(e.name),e.selected==null||((d=e.selected)==null?void 0:d.length)==0?e.selected=c[0]:((a=c.indexOf(e.selected))==-1&&(e.selected=c[0]),a<c.length-1&&(e.selected=c[a+1])),r=!1,o=!0,t.preventDefault())}r&&e.displayed&&(i.filter&&t._searchType=="filter"||i.search&&t._searchType=="search")&&this.applyFilter(e.name,null,n,!0).then(u=>{e.tmp.searchCount=u.count,e.tmp.search=u.search,u.count!==0&&this.getActiveChain(e.name).includes(e.selected)||(e.selected=null),this.refreshSearch(e.name)}),o&&this.refreshIndex(e.name)}}class U1 extends hi{constructor(){super();var e=new Date;this.daysCount=[31,28,31,30,31,30,31,31,30,31,30,31],this.today=e.getFullYear()+"/"+(Number(e.getMonth())+1)+"/"+e.getDate(),this.defaults=b.extend({},this.defaults,{position:"top|bottom",class:"w2ui-calendar",type:"date",format:"",value:"",start:null,end:null,blockDates:[],blockWeekdays:[],colored:{},arrowSize:12,autoResize:!1,anchorClass:"w2ui-focus",autoShowOn:"focus",hideOn:["doc-click","focus-change"],onSelect:null})}attach(r,n){let i;arguments.length==1&&r.anchor?r=(i=r).anchor:arguments.length===2&&n!=null&&typeof n=="object"&&((i=n).anchor=r);var n=i.hideOn,r=(i=b.extend({},this.defaults,i||{}),n&&(i.hideOn=n),i.format||(r=b.settings.dateFormat,n=b.settings.timeFormat,i.type=="date"?i.format=r:i.type=="time"?i.format=n:i.format=r+"|"+n),i.type=="time"?this.getHourHTML(i):this.getMonthHTML(i));i.style+="; padding: 0;",i.html=r.html;let o=super.attach(i),a=o.overlay;return Object.assign(a.tmp,r),a.on("show.attach",c=>{var c=c.detail.overlay,h=c.anchor,d=c.options;["INPUT","TEXTAREA"].includes(h.tagName)&&!d.value&&h.value&&(c.tmp.initValue=h.value),delete c.newValue,delete c.newDate}),a.on("show:after.attach",l=>{var c;(c=o.overlay)!=null&&c.box&&this.initControls(o.overlay)}),a.on("update:after.attach",l=>{var c;(c=o.overlay)!=null&&c.box&&this.initControls(o.overlay)}),a.on("hide.attach",c=>{var c=c.detail.overlay,h=c.anchor;c.newValue!=null&&(c.newDate&&(c.newValue=c.newDate+" "+c.newValue),["INPUT","TEXTAREA"].includes(h.tagName)&&h.value!=c.newValue&&(h.value=c.newValue),(h=this.trigger("select",{date:c.newValue,target:c.name,overlay:c})).isCancelled!==!0)&&h.finish()}),o.select=l=>(a.on("select.attach",c=>{l(c)}),o),o}initControls(e){let t=e.options,i=r=>{let{month:o,year:a}=e.tmp;12<(o+=r)&&(o=1,a++),o<1&&(o=12,a--),r=this.getMonthHTML(t,o,a),Object.assign(e.tmp,r),p(e.box).find(".w2ui-overlay-body").html(r.html),this.initControls(e)},n=(r,o)=>{p(r.target).parent().find(".w2ui-jump-month, .w2ui-jump-year").removeClass("w2ui-selected"),p(r.target).addClass("w2ui-selected"),r=new Date;let{jumpMonth:a,jumpYear:l}=e.tmp;(a=o&&(l==null&&(l=r.getFullYear()),a==null)?r.getMonth()+1:a)&&l&&(o=this.getMonthHTML(t,a,l),Object.assign(e.tmp,o),p(e.box).find(".w2ui-overlay-body").html(o.html),e.tmp.jump=!1,this.initControls(e))};p(e.box).find(".w2ui-cal-title").off(".calendar").on("click.calendar",r=>{var o,a;Object.assign(e.tmp,{jumpYear:null,jumpMonth:null}),e.tmp.jump?({month:o,year:a}=e.tmp,o=this.getMonthHTML(t,o,a),p(e.box).find(".w2ui-overlay-body").html(o.html),e.tmp.jump=!1):(p(e.box).find(".w2ui-overlay-body .w2ui-cal-days").replace(this.getYearHTML()),(a=p(e.box).find(`[name="${e.tmp.year}"]`).get(0))&&a.scrollIntoView(!0),e.tmp.jump=!0),this.initControls(e),r.stopPropagation()}).find(".w2ui-cal-previous").off(".calendar").on("click.calendar",r=>{i(-1),r.stopPropagation()}).parent().find(".w2ui-cal-next").off(".calendar").on("click.calendar",r=>{i(1),r.stopPropagation()}),p(e.box).find(".w2ui-cal-now").off(".calendar").on("click.calendar",r=>{t.type=="datetime"?e.newDate?e.newValue=b.formatTime(new Date,t.format.split("|")[1]):e.newValue=b.formatDateTime(new Date,t.format):t.type=="date"?e.newValue=b.formatDate(new Date,t.format):t.type=="time"&&(e.newValue=b.formatTime(new Date,t.format)),this.hide(e.name)}),p(e.box).off(".calendar").on("click.calendar",{delegate:".w2ui-day.w2ui-date"},r=>{t.type=="datetime"?(e.newDate=p(r.target).attr("date"),p(e.box).find(".w2ui-overlay-body").html(this.getHourHTML(e.options).html),this.initControls(e)):(e.newValue=p(r.target).attr("date"),this.hide(e.name))}).on("click.calendar",{delegate:".w2ui-jump-month"},r=>{e.tmp.jumpMonth=parseInt(p(r.target).attr("name")),n(r)}).on("dblclick.calendar",{delegate:".w2ui-jump-month"},r=>{e.tmp.jumpMonth=parseInt(p(r.target).attr("name")),n(r,!0)}).on("click.calendar",{delegate:".w2ui-jump-year"},r=>{e.tmp.jumpYear=parseInt(p(r.target).attr("name")),n(r)}).on("dblclick.calendar",{delegate:".w2ui-jump-year"},r=>{e.tmp.jumpYear=parseInt(p(r.target).attr("name")),n(r,!0)}).on("click.calendar",{delegate:".w2ui-time.hour"},o=>{var o=p(o.target).attr("hour");let a=this.str2min(t.value)%60;e.tmp.initValue&&!t.value&&(a=this.str2min(e.tmp.initValue)%60),t.noMinutes?(e.newValue=this.min2str(60*o,t.format),this.hide(e.name)):(e.newValue=o+":"+a,o=this.getMinHTML(o,t).html,p(e.box).find(".w2ui-overlay-body").html(o),this.initControls(e))}).on("click.calendar",{delegate:".w2ui-time.min"},r=>{r=60*Math.floor(this.str2min(e.newValue)/60)+parseInt(p(r.target).attr("min")),e.newValue=this.min2str(r,t.format),this.hide(e.name)})}getMonthHTML(e,t,i){var o=b.settings.fulldays.slice(),n=b.settings.shortdays.slice();b.settings.weekStarts!=="M"&&(o.unshift(o.pop()),n.unshift(n.pop()));let r=new Date;var o=e.type==="datetime"?b.isDateTime(e.value,e.format,!0):b.isDate(e.value,e.format,!0),a=b.formatDate(o);t!=null&&i!=null||(i=(o||r).getFullYear(),t=o?o.getMonth()+1:r.getMonth()+1),12<t&&(t-=12,i++),(t<1||t===0)&&(t+=12,i--),i/4==Math.floor(i/4)?this.daysCount[1]=29:this.daysCount[1]=28,e.current=t+"/"+i;let l=(r=new Date(i,t-1,1)).getDay(),c="";var h=b.settings.weekStarts;for(let y=0;y<n.length;y++){var d=h=="M"&&y==5||h!="M"&&y==6,u=h=="M"&&y==6||h!="M"&&y==0;c+=`<div class="w2ui-day w2ui-weekday ${d?"w2ui-sunday":""} ${u?"w2ui-saturday":""}">${n[y]}</div>`}let m=`
            <div class="w2ui-cal-title">
                <div class="w2ui-cal-previous">
                    <div></div>
                </div>
                <div class="w2ui-cal-next">
                    <div></div>
                </div>
                ${b.settings.fullmonths[t-1]}, ${i}
                <span class="arrow-down"></span>
            </div>
            <div class="w2ui-cal-days">
                ${c}
        `,f=new Date(i+`/${t}/1`);o=(f=new Date(f.getTime()+432e5)).getDay(),b.settings.weekStarts=="M"&&l--,0<o&&(f=new Date(f.getTime()-864e5*l));for(let y=0;y<42;y++){var _=[],g=`${f.getFullYear()}/${f.getMonth()+1}/`+f.getDate(),v=(f.getDay()===6&&_.push("w2ui-saturday"),f.getDay()===0&&_.push("w2ui-sunday"),f.getMonth()+1!==t&&_.push("outside"),g==this.today&&_.push("w2ui-today"),f.getDate());let x="",E="",R,M;M=e.type==="datetime"?(R=b.formatDateTime(g,e.format),b.formatDate(g,b.settings.dateFormat)):R=b.formatDate(g,e.format),e.colored&&e.colored[M]!==void 0&&(g=e.colored[M].split("|"),E="background-color: "+g[0]+";",x="color: "+g[1]+";"),m+=`<div class="w2ui-day ${this.inRange(R,e,!0)?"w2ui-date "+(M==a?"w2ui-selected":""):"w2ui-blocked"} ${_.join(" ")}"
                       style="${x+E}" date="${M}" data-date="${f.getTime()}">
                            ${v}
                    </div>`,f=new Date(f.getTime()+864e5)}return m+="</div>",e.btnNow&&(o=b.lang("Today"+(e.type=="datetime"?" & Now":"")),m+=`<div class="w2ui-cal-now">${o}</div>`),{html:m,month:t,year:i}}getYearHTML(){let e="",t="";for(let i=0;i<b.settings.fullmonths.length;i++)e+=`<div class="w2ui-jump-month" name="${i+1}">${b.settings.shortmonths[i]}</div>`;for(let i=b.settings.dateStartYear;i<=b.settings.dateEndYear;i++)t+=`<div class="w2ui-jump-year" name="${i}">${i}</div>`;return`<div class="w2ui-cal-jump">
            <div id="w2ui-jump-month">${e}</div>
            <div id="w2ui-jump-year">${t}</div>
        </div>`}getHourHTML(e){(e=e??{}).format||(e.format=b.settings.timeFormat);var t=-1<e.format.indexOf("h24"),i=e.value||(e.anchor?e.anchor.value:""),n=[];for(let a=0;a<24;a++){let l=(12<=a&&!t?a-12:a)+":00"+(t?"":a<12?" am":" pm"),c=(a!=12||t||(l="12:00 pm"),n[Math.floor(a/8)]||(n[Math.floor(a/8)]=""),this.min2str(this.str2min(l))),h=this.min2str(this.str2min(l)+59);e.type==="datetime"&&(o=b.isDateTime(i,e.format,!0),r=e.format.split("|")[0].trim(),c=b.formatDate(o,r)+" "+c,h=b.formatDate(o,r)+" "+h);var r,o=this.inRange(c,e)||this.inRange(h,e);n[Math.floor(a/8)]+=`<span hour="${a}"
                class="hour ${o?"w2ui-time ":"w2ui-blocked"}">${l}</span>`}return{html:`<div class="w2ui-calendar">
            <div class="w2ui-time-title">${b.lang("Select Hour")}</div>
            <div class="w2ui-cal-time">
                <div class="w2ui-cal-column">${n[0]}</div>
                <div class="w2ui-cal-column">${n[1]}</div>
                <div class="w2ui-cal-column">${n[2]}</div>
            </div>
            ${e.btnNow?`<div class="w2ui-cal-now">${b.lang("Now")}</div>`:""}
        </div>`}}getMinHTML(e,t){e==null&&(e=0),(t=t??{}).format||(t.format=b.settings.timeFormat);var i=-1<t.format.indexOf("h24"),n=t.value||(t.anchor?t.anchor.value:""),r=[];for(let h=0;h<60;h+=5){var o=(12<e&&!i?e-12:e)+":"+(h<10?0:"")+h+" "+(i?"":e<12?"am":"pm");let d=o;var a,l,c=h<20?0:h<40?1:2;r[c]||(r[c]=""),t.type==="datetime"&&(a=b.isDateTime(n,t.format,!0),l=t.format.split("|")[0].trim(),d=b.formatDate(a,l)+" "+d),r[c]+=`<span min="${h}" class="min ${this.inRange(d,t)?"w2ui-time ":"w2ui-blocked"}">${o}</span>`}return{html:`<div class="w2ui-calendar">
            <div class="w2ui-time-title">${b.lang("Select Minute")}</div>
            <div class="w2ui-cal-time">
                <div class="w2ui-cal-column">${r[0]}</div>
                <div class="w2ui-cal-column">${r[1]}</div>
                <div class="w2ui-cal-column">${r[2]}</div>
            </div>
            ${t.btnNow?`<div class="w2ui-cal-now">${b.lang("Now")}</div>`:""}
        </div>`}}inRange(e,t,i){let n=!1;if(t.type==="date"){var r=b.isDate(e,t.format,!0);if(r){if(t.start||t.end){var o=typeof t.start=="string"?t.start:p(t.start).val(),a=typeof t.end=="string"?t.end:p(t.end).val();let l=b.isDate(o,t.format,!0),c=b.isDate(a,t.format,!0);o=new Date(r),l=l||o,c=c||o,o>=l&&o<=c&&(n=!0)}else n=!0;Array.isArray(t.blockDates)&&t.blockDates.includes(e)&&(n=!1),Array.isArray(t.blockWeekdays)&&t.blockWeekdays.includes(r.getDay())&&(n=!1)}}else if(t.type==="time")if(t.start||t.end){a=this.str2min(e);let l=this.str2min(t.start),c=this.str2min(t.end);l=l||a,c=c||a,a>=l&&a<=c&&(n=!0)}else n=!0;else t.type==="datetime"&&(o=b.isDateTime(e,t.format,!0))&&(r=t.format.split("|").map(l=>l.trim()),i?(a=b.formatDate(o,r[0]),e=b.extend({},t,{type:"date",format:r[0]}),this.inRange(a,e)&&(n=!0)):(i=b.formatTime(o,r[1]),a={type:"time",format:r[1],start:t.startTime,end:t.endTime},this.inRange(i,a)&&(n=!0)));return n}str2min(e){var t;return typeof e!="string"||(t=e.split(":")).length!==2?null:(t[0]=parseInt(t[0]),t[1]=parseInt(t[1]),e.indexOf("pm")!==-1&&t[0]!==12&&(t[0]+=12),e.includes("am")&&t[0]==12&&(t[0]=0),60*t[0]+t[1])}min2str(n,t){1440<=n&&(n%=1440),n<0&&(n=1440+n);var i=Math.floor(n/60),n=(n%60<10?"0":"")+n%60;return t=t||b.settings.timeFormat,t.indexOf("h24")!==-1?i+":"+n:(i<=12?i:i-12)+":"+n+" "+(12<=i?"pm":"am")}}let Ne=new hi,Ot=new F1,cf=new O1,tr=new U1;class hf extends _n{constructor(e){super(e.name),this.box=null,this.name=null,this.routeData={},this.items=[],this.right="",this.tooltip="top|left",this.onClick=null,this.onMouseDown=null,this.onMouseUp=null,this.onMouseEnter=null,this.onMouseLeave=null,this.onRender=null,this.onRefresh=null,this.onResize=null,this.onDestroy=null,this.item_template={id:null,type:"button",text:null,html:"",tooltip:null,count:null,hidden:!1,disabled:!1,checked:!1,icon:null,route:null,arrow:null,style:null,group:null,items:null,selected:null,color:null,overlay:{anchorClass:""},onClick:null,onRefresh:null},this.last={badge:{}};var t=e.items;delete e.items,Object.assign(this,e),Array.isArray(t)&&this.add(t,!0),e.items=t,typeof this.box=="string"&&(this.box=p(this.box).get(0)),this.box&&this.render(this.box)}add(e,t){this.insert(null,e,t)}insert(e,t,i){(t=Array.isArray(t)?t:[t]).forEach((n,r,o)=>{typeof n=="string"&&(n=o[r]={id:n,text:n});var a,l=["button","check","radio","drop","menu","menu-radio","menu-check","color","text-color","html","break","spacer","new-line"];if(l.includes(String(n.type)))if(n.id!=null||["break","spacer","new-line"].includes(n.type)){if(n.type==null)console.log('ERROR: The parameter "type" is required but not supplied.',n);else if(b.checkUniqueId(n.id,this.items,"toolbar",this.name)){let c=b.extend({},this.item_template,n);c.type=="menu-check"?(Array.isArray(c.selected)||(c.selected=[]),Array.isArray(c.items)&&c.items.forEach(h=>{(h=typeof h=="string"?o[r]={id:h,text:h}:h).checked&&!c.selected.includes(h.id)&&c.selected.push(h.id),!h.checked&&c.selected.includes(h.id)&&(h.checked=!0),h.checked==null&&(h.checked=!1)})):c.type=="menu-radio"&&Array.isArray(c.items)&&c.items.forEach((h,d,u)=>{(h=typeof h=="string"?u[d]={id:h,text:h}:h).checked&&c.selected==null?c.selected=h.id:h.checked=!1,h.checked||c.selected!=h.id||(h.checked=!0),h.checked==null&&(h.checked=!1)}),e==null?this.items.push(c):(a=this.get(e,!0),this.items=this.items.slice(0,a).concat([c],this.items.slice(a))),c.line=c.line??1,i!==!0&&this.refresh(c.id)}}else console.log('ERROR: The parameter "id" is required but not supplied.',n);else console.log('ERROR: The parameter "type" should be one of the following:',l,`, but ${n.type} is supplied.`,n)}),i!==!0&&this.resize()}remove(){let e=0;return Array.from(arguments).forEach(t=>{var i=this.get(t);i&&String(t).indexOf(":")==-1&&(e++,p(this.box).find("#tb_"+this.name+"_item_"+b.escapeId(i.id)).remove(),(t=this.get(i.id,!0))!=null)&&this.items.splice(t,1)}),this.resize(),e}set(e,t){var i=this.get(e);return i!=null&&(Object.assign(i,t),this.refresh(String(e).split(":")[0]),!0)}get(e,t){if(arguments.length===0){var i=[];for(let a=0;a<this.items.length;a++)this.items[a].id!=null&&i.push(this.items[a].id);return i}var n=String(e).split(":");for(let a=0;a<this.items.length;a++){var r=this.items[a];if(["menu","menu-radio","menu-check"].includes(r.type)&&n.length==2&&r.id==n[0]){let l=r.items;typeof l=="function"&&(l=l(this));for(let c=0;c<l.length;c++){var o=l[c];if(o.id==n[1]||o.id==null&&o.text==n[1])return t==1?c:o;if(Array.isArray(o.items)){for(let h=0;h<o.items.length;h++)if(o.items[h].id==n[1]||o.items[h].id==null&&o.items[h].text==n[1])return t==1?c:o.items[h]}}}else if(r.id==n[0])return t==1?a:r}return null}setCount(e,t,i,n){var r=p(this.box).find(`#tb_${this.name}_item_${b.escapeId(e)} .w2ui-tb-count > span`);0<r.length?(r.removeClass().addClass(i??"").text(t).get(0).style.cssText=n??"",this.last.badge[e]={className:i??"",style:n??""},this.get(e).count=t):(this.set(e,{count:t}),this.setCount(...arguments))}show(){let e=[];return Array.from(arguments).forEach(t=>{var i=this.get(t);i&&(i.hidden=!1,e.push(String(t).split(":")[0]))}),setTimeout(()=>{e.forEach(t=>{this.refresh(t),this.resize()})},15),e}hide(){let e=[];return Array.from(arguments).forEach(t=>{var i=this.get(t);i&&(i.hidden=!0,e.push(String(t).split(":")[0]))}),setTimeout(()=>{e.forEach(t=>{this.refresh(t),this.tooltipHide(t),this.resize()})},15),e}enable(){let e=[];return Array.from(arguments).forEach(t=>{var i=this.get(t);i&&(i.disabled=!1,e.push(String(t).split(":")[0]))}),setTimeout(()=>{e.forEach(t=>{this.refresh(t)})},15),e}disable(){let e=[];return Array.from(arguments).forEach(t=>{var i=this.get(t);i&&(i.disabled=!0,e.push(String(t).split(":")[0]))}),setTimeout(()=>{e.forEach(t=>{this.refresh(t),this.tooltipHide(t)})},15),e}check(){let e=[];return Array.from(arguments).forEach(t=>{var i=this.get(t);i&&String(t).indexOf(":")==-1&&(i.checked=!0,e.push(String(t).split(":")[0]))}),setTimeout(()=>{e.forEach(t=>{this.refresh(t)})},15),e}uncheck(){let e=[];return Array.from(arguments).forEach(t=>{var i=this.get(t);i&&String(t).indexOf(":")==-1&&(["menu","menu-radio","menu-check","drop","color","text-color"].includes(i.type)&&i.checked&&Ne.hide(this.name+"-drop"),i.checked=!1,e.push(String(t).split(":")[0]))}),setTimeout(()=>{e.forEach(t=>{this.refresh(t)})},15),e}click(e,t){var i=String(e).split(":");let n=this.get(i[0]),r=n&&n.items?b.normMenu.call(this,n.items,n):[];if(1<i.length)(i=this.get(e))&&!i.disabled&&this.menuClick({name:this.name,item:n,subItem:i,originalEvent:t});else if(n&&!n.disabled&&(i=this.trigger("click",{target:e??this.name,item:n,object:n,originalEvent:t}),i.isCancelled!==!0)){r=n&&n.items?b.normMenu.call(this,n.items,n):[];let l="#tb_"+this.name+"_item_"+b.escapeId(n.id);if(p(this.box).find(l).removeClass("down"),n.type=="radio"){for(let c=0;c<this.items.length;c++){var o=this.items[c];o!=null&&o.id!=n.id&&o.type==="radio"&&o.group==n.group&&o.checked&&(o.checked=!1,this.refresh(o.id))}n.checked=!0,p(this.box).find(l).addClass("checked")}if(["menu","menu-radio","menu-check","drop","color","text-color"].includes(n.type)){if(this.tooltipHide(e),n.checked)return void Ne.hide(this.name+"-drop");setTimeout(()=>{var c=(d,u)=>{let m=this;return function(){m.set(d,{checked:!1})}},h=p(this.box).find("#tb_"+this.name+"_item_"+b.escapeId(n.id));if(b.isPlainObject(n.overlay)||(n.overlay={}),n.type=="drop"&&Ne.show(b.extend({html:n.html,class:"w2ui-white",hideOn:["doc-click"]},n.overlay,{anchor:h[0],name:this.name+"-drop",data:{item:n,btn:l}})).hide(c(n.id)),["menu","menu-radio","menu-check"].includes(n.type)){let d="normal";n.type=="menu-radio"&&(d="radio",r.forEach(u=>{n.selected==u.id?u.checked=!0:u.checked=!1})),n.type=="menu-check"&&(d="check",r.forEach(u=>{Array.isArray(n.selected)&&n.selected.includes(u.id)?u.checked=!0:u.checked=!1})),Ot.show(b.extend({items:r},n.overlay,{type:d,name:this.name+"-drop",anchor:h[0],data:{item:n,btn:l}})).hide(c(n.id)).remove(u=>{this.menuClick({name:this.name,remove:!0,item:n,subItem:u.detail.item,originalEvent:u})}).select(u=>{this.menuClick({name:this.name,item:n,subItem:u.detail.item,originalEvent:u})})}["color","text-color"].includes(n.type)&&cf.show(b.extend({color:n.color},n.overlay,{anchor:h[0],name:this.name+"-drop",data:{item:n,btn:l}})).hide(c(n.id)).select(d=>{d.detail.color!=null&&this.colorClick({name:this.name,item:n,color:d.detail.color})})},0)}if(["check","menu","menu-radio","menu-check","drop","color","text-color"].includes(n.type)&&(n.checked=!n.checked,n.checked?p(this.box).find(l).addClass("checked"):p(this.box).find(l).removeClass("checked")),n.route){let c=("/"+n.route).replace(/\/{2,}/g,"/");var a=b.parseRoute(c);if(0<a.keys.length)for(let h=0;h<a.keys.length;h++)c=c.replace(new RegExp(":"+a.keys[h].name,"g"),this.routeData[a.keys[h].name]);setTimeout(()=>{window.location.hash=c},1)}this.tooltipShow(e),i.finish()}}scroll(e,t,i){return new Promise((n,r)=>{var o=p(this.box).find(`.w2ui-tb-line:nth-child(${t}) .w2ui-scroll-wrapper`),a=o.get(0).scrollLeft,l=o.find(".w2ui-tb-right").get(0),c=o.parent().get(0).getBoundingClientRect().width,h=a+parseInt(l.offsetLeft)+parseInt(l.clientWidth);switch(e){case"left":(scroll=a-c+50)<=0&&(scroll=0),o.get(0).scrollTo({top:0,left:scroll,behavior:i?"atuo":"smooth"});break;case"right":(scroll=a+c-50)>=h-c&&(scroll=h-c),o.get(0).scrollTo({top:0,left:scroll,behavior:i?"atuo":"smooth"})}setTimeout(()=>{this.resize(),n()},i?0:500)})}render(e){var t=Date.now(),i=(typeof e=="string"&&(e=p(e).get(0)),this.trigger("render",{target:this.name,box:e??this.box}));if(i.isCancelled!==!0&&(e!=null&&(0<p(this.box).find(".w2ui-scroll-wrapper .w2ui-tb-right").length&&p(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-toolbar").html(""),this.box=e),this.box)){Array.isArray(this.right)||(this.right=[this.right]);let r="",o=0;for(let a=0;a<this.items.length;a++){var n=this.items[a];n!=null&&(n.id==null&&(n.id="item_"+a),n.caption!=null&&console.log("NOTICE: toolbar item.caption property is deprecated, please use item.text. Item -> ",n),n.hint!=null&&console.log("NOTICE: toolbar item.hint property is deprecated, please use item.tooltip. Item -> ",n),a!==0&&n.type!="new-line"||(o++,r+=`
                    <div class="w2ui-tb-line">
                        <div class="w2ui-scroll-wrapper w2ui-eaction" data-mousedown="resize">
                            <div class="w2ui-tb-right">${this.right[o-1]??""}</div>
                        </div>
                        <div class="w2ui-scroll-left w2ui-eaction" data-click='["scroll", "left", "${o}"]'></div>
                        <div class="w2ui-scroll-right w2ui-eaction" data-click='["scroll", "right", "${o}"]'></div>
                    </div>
                `),n.line=o)}return p(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-toolbar").html(r),0<p(this.box).length&&(p(this.box)[0].style.cssText+=this.style),b.bindEvents(p(this.box).find(".w2ui-tb-line .w2ui-eaction"),this),this.last.observeResize=new ResizeObserver(()=>{this.resize()}),this.last.observeResize.observe(this.box),this.refresh(),this.resize(),i.finish(),Date.now()-t}}refresh(e){var t=Date.now(),i=this.trigger("refresh",{target:e??this.name,item:this.get(e)});if(i.isCancelled!==!0){let l;if(e==null)for(let c=0;c<this.items.length;c++){var n=this.items[c];n.id==null&&(n.id="item_"+c),this.refresh(n.id)}else{var r=this.get(e);if(r==null)return!1;if(typeof r.onRefresh!="function"||(l=this.trigger("refresh",{target:e,item:r,object:r})).isCancelled!==!0){var o=`#tb_${this.name}_item_`+b.escapeId(r.id);let c=p(this.box).find(o);var a=this.getItemHTML(r);if(this.tooltipHide(e),r.type=="spacer"&&p(this.box).find(".w2ui-tb-line:nth-child("+r.line).find(".w2ui-tb-right").css("width","auto"),c.length===0){e=parseInt(this.get(e,!0))+1;let h=p(this.box).find(`#tb_${this.name}_item_`+b.escapeId(this.items[e]?this.items[e].id:""));h.length==0?h=p(this.box).find(".w2ui-tb-line:nth-child("+r.line).find(".w2ui-tb-right").before(a):h.after(a),b.bindEvents(p(this.box).find(o),this)}else{p(this.box).find(o).replace(p.html(a));let h=p(this.box).find(o).get(0),d=(b.bindEvents(h,this),Ne.get(!0));Object.keys(d).forEach(u=>{d[u].anchor==c.get(0)&&(d[u].anchor=h)})}if(["menu","menu-radio","menu-check"].includes(r.type)&&r.checked){let h=Array.isArray(r.selected)?r.selected:[r.selected];r.items.forEach(d=>{h.includes(d.id)?d.checked=!0:d.checked=!1}),Ot.update(this.name+"-drop",r.items)}return typeof r.onRefresh=="function"&&l.finish(),i.finish(),Date.now()-t}}}}resize(){var e=Date.now(),t=this.trigger("resize",{target:this.name});if(t.isCancelled!==!0)return p(this.box).find(".w2ui-tb-line").each(n=>{var n=p(n),r=(n.find(".w2ui-scroll-left, .w2ui-scroll-right").hide(),n.find(".w2ui-scroll-wrapper").get(0)),a=n.find(".w2ui-tb-right"),o=n.get(0).getBoundingClientRect().width,a=0<a.length?a[0].offsetLeft+a[0].clientWidth:0;o<a&&(0<r.scrollLeft&&n.find(".w2ui-scroll-left").show(),o<a-r.scrollLeft)&&n.find(".w2ui-scroll-right").show()}),t.finish(),Date.now()-e}destroy(){var t;var e=this.trigger("destroy",{target:this.name});e.isCancelled!==!0&&(0<p(this.box).find(".w2ui-scroll-wrapper  .w2ui-tb-right").length&&p(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-toolbar").html(""),p(this.box).html(""),(t=this.last.observeResize)==null||t.disconnect(),delete xt[this.name],e.finish())}getItemHTML(e){let t="",i=(e.caption!=null&&e.text==null&&(e.text=e.caption),e.text==null&&(e.text=""),e.tooltip==null&&e.hint!=null&&(e.tooltip=e.hint),e.tooltip==null&&(e.tooltip=""),typeof e.get=="function"||!Array.isArray(e.items)&&typeof e.items!="function"||(e.get=function(a){let l=e.items;return(l=typeof l=="function"?e.items(e):l).find(c=>c.id==a)}),""),n=typeof e.text=="function"?e.text.call(this,e):e.text;e.icon&&(i=e.icon,typeof e.icon=="function"&&(i=e.icon.call(this,e)),i=`<div class="w2ui-tb-icon">${i=String(i).slice(0,1)!=="<"?`<span class="${i}"></span>`:i}</div>`);var r=["w2ui-tb-button"];switch(e.checked&&r.push("checked"),e.disabled&&r.push("disabled"),e.hidden&&r.push("hidden"),i||r.push("no-icon"),e.type){case"color":case"text-color":typeof e.color=="string"&&(e.color.slice(0,1)=="#"&&(e.color=e.color.slice(1)),[3,6,8].includes(e.color.length))&&(e.color="#"+e.color),e.type=="color"&&(n=`<span class="w2ui-tb-color-box" style="background-color: ${e.color!=null?e.color:"#fff"}"></span>
                           `+(e.text?`<div style="margin-left: 17px;">${b.lang(e.text)}</div>`:"")),e.type=="text-color"&&(n='<span style="color: '+(e.color!=null?e.color:"#444")+';">'+(e.text?b.lang(e.text):"<b>Aa</b>")+"</span>");case"menu":case"menu-check":case"menu-radio":case"button":case"check":case"radio":case"drop":var o=e.arrow===!0||e.arrow!==!1&&["menu","menu-radio","menu-check","drop","color","text-color"].includes(e.type);t=`
                    <div id="tb_${this.name}_item_${e.id}" style="${e.hidden?"display: none":""}"
                        class="${r.join(" ")} ${e.class||""}"
                        ${e.disabled?"":`data-click='["click","${e.id}"]'
                               data-mouseenter='["mouseAction", "event", "this", "Enter", "${e.id}"]'
                               data-mouseleave='["mouseAction", "event", "this", "Leave", "${e.id}"]'
                               data-mousedown='["mouseAction", "event", "this", "Down", "${e.id}"]'
                               data-mouseup='["mouseAction", "event", "this", "Up", "${e.id}"]'`}
                    >
                        ${i}
                        ${n!=""?`<div class="w2ui-tb-text" style="${e.style||""}">
                                    ${b.lang(n)}
                                    ${e.count!=null?b.stripSpaces(`<span class="w2ui-tb-count">
                                                <span class="${this.last.badge[e.id]?this.last.badge[e.id].className??"":""}"
                                                    style="${this.last.badge[e.id]?this.last.badge[e.id].style??"":""}"
                                                >${e.count}</span>
                                           </span>`):""}
                                    ${o?'<span class="w2ui-tb-down"><span></span></span>':""}
                                </div>`:""}
                    </div>
                `;break;case"break":t=`<div id="tb_${this.name}_item_${e.id}" class="w2ui-tb-break"
                            style="${e.hidden?"display: none":""}; ${e.style||""}">
                            &#160;
                        </div>`;break;case"spacer":t=`<div id="tb_${this.name}_item_${e.id}" class="w2ui-tb-spacer"
                            style="${e.hidden?"display: none":""}; ${e.style||""}">
                        </div>`;break;case"html":t=`<div id="tb_${this.name}_item_${e.id}" class="w2ui-tb-html ${r.join(" ")}"
                            style="${e.hidden?"display: none":""}; ${e.style||""}">
                            ${typeof e.html=="function"?e.html.call(this,e):e.html}
                        </div>`}return t}tooltipShow(e){if(this.tooltip!=null){var t=p(this.box).find("#tb_"+this.name+"_item_"+b.escapeId(e)).get(0),e=this.get(e),i=this.tooltip;let r=e.tooltip;typeof r=="function"&&(r=r.call(this,e)),["menu","menu-radio","menu-check","drop","color","text-color"].includes(e.type)&&e.checked==1||Ne.show({anchor:t,name:this.name+"-tooltip",html:r,position:i})}}tooltipHide(e){this.tooltip!=null&&Ne.hide(this.name+"-tooltip")}menuClick(e){if(e.item&&!e.item.disabled){var t=this.trigger(e.remove!==!0?"click":"remove",{target:e.item.id+":"+e.subItem.id,item:e.item,subItem:e.subItem,originalEvent:e.originalEvent});if(t.isCancelled!==!0){let r=e.subItem,o=this.get(e.item.id),a=o.items;if(typeof a=="function"&&(a=o.items()),o.type=="menu"&&(o.selected=r.id),o.type=="menu-radio"&&(o.selected=r.id,Array.isArray(a)&&a.forEach(l=>{l.checked===!0&&delete l.checked,Array.isArray(l.items)&&l.items.forEach(c=>{c.checked===!0&&delete c.checked})}),r.checked=!0),o.type=="menu-check"){if(Array.isArray(o.selected)||(o.selected=[]),r.group==null){var i=o.selected.indexOf(r.id);i==-1?(o.selected.push(r.id),r.checked=!0):(o.selected.splice(i,1),r.checked=!1)}else if(r.group!==!1){let l=[];i=o.selected.indexOf(r.id);let c=h=>{h.forEach(d=>{var u;d.group===r.group&&(u=o.selected.indexOf(d.id))!=-1&&(d.id!=r.id&&l.push(d.id),o.selected.splice(u,1)),Array.isArray(d.items)&&c(d.items)})};c(a),i==-1&&(o.selected.push(r.id),r.checked=!0)}}if(typeof r.route=="string"){let l=r.route!==""?("/"+r.route).replace(/\/{2,}/g,"/"):"";var n=b.parseRoute(l);if(0<n.keys.length)for(let c=0;c<n.keys.length;c++)this.routeData[n.keys[c].name]!=null&&(l=l.replace(new RegExp(":"+n.keys[c].name,"g"),this.routeData[n.keys[c].name]));setTimeout(()=>{window.location.hash=l},1)}this.refresh(e.item.id),t.finish()}}}colorClick(e){var t;e.item&&!e.item.disabled&&(t=this.trigger("click",{target:e.item.id,item:e.item,color:e.color,final:e.final,originalEvent:e.originalEvent})).isCancelled!==!0&&(e.item.color=e.color,this.refresh(e.item.id),t.finish())}mouseAction(o,t,i,n){var r=this.get(n),o=this.trigger("mouse"+i,{target:n,item:r,object:r,originalEvent:o});if(o.isCancelled!==!0&&!r.disabled&&!r.hidden){switch(i){case"Enter":p(t).addClass("over"),this.tooltipShow(n);break;case"Leave":p(t).removeClass("over down"),this.tooltipHide(n);break;case"Down":p(t).addClass("down");break;case"Up":p(t).removeClass("down")}o.finish()}}}class df extends _n{constructor(e){super(e.name),this.box=null,this.name=null,this.active=null,this.reorder=!1,this.flow="down",this.tooltip="top|left",this.tabs=[],this.routeData={},this.last={},this.right="",this.style="",this.onClick=null,this.onMouseEnter=null,this.onMouseLeave=null,this.onMouseDown=null,this.onMouseUp=null,this.onClose=null,this.onRender=null,this.onRefresh=null,this.onResize=null,this.onDestroy=null,this.tab_template={id:null,text:null,route:null,hidden:!1,disabled:!1,closable:!1,tooltip:null,style:"",onClick:null,onRefresh:null,onClose:null};var t=e.tabs;delete e.tabs,Object.assign(this,e),Array.isArray(t)&&this.add(t),e.tabs=t,typeof this.box=="string"&&(this.box=p(this.box).get(0)),this.box&&this.render(this.box)}add(e){return this.insert(null,e)}insert(e,t){Array.isArray(t)||(t=[t]);let i=[];return t.forEach(n=>{var r,o;n.id==null?console.log(`ERROR: The parameter "id" is required but not supplied. (obj: ${this.name})`):b.checkUniqueId(n.id,this.tabs,"tabs",this.name)&&(n=Object.assign({},this.tab_template,n),e==null?(this.tabs.push(n),i.push(this.animateInsert(null,n))):(r=this.get(e,!0),o=this.tabs[r].id,this.tabs.splice(r,0,n),i.push(this.animateInsert(o,n))))}),Promise.all(i)}remove(){let e=0;return Array.from(arguments).forEach(t=>{t=this.get(t),t&&(e++,this.tabs.splice(this.get(t.id,!0),1),p(this.box).find(`#tabs_${this.name}_tab_`+b.escapeId(t.id)).remove())}),this.resize(),e}select(e){return this.active!=e&&this.get(e)!=null&&(this.active=e,this.refresh(),!0)}set(e,t){var i=this.get(e,!0);return i!=null&&(b.extend(this.tabs[i],t),this.refresh(e),!0)}get(e,t){if(arguments.length===0){var i=[];for(let n=0;n<this.tabs.length;n++)this.tabs[n].id!=null&&i.push(this.tabs[n].id);return i}for(let n=0;n<this.tabs.length;n++)if(this.tabs[n].id==e)return t===!0?n:this.tabs[n];return null}show(){let e=[];return Array.from(arguments).forEach(t=>{t=this.get(t),t&&t.hidden!==!1&&(t.hidden=!1,e.push(t.id))}),setTimeout(()=>{e.forEach(t=>{this.refresh(t),this.resize()})},15),e}hide(){let e=[];return Array.from(arguments).forEach(t=>{t=this.get(t),t&&t.hidden!==!0&&(t.hidden=!0,e.push(t.id))}),setTimeout(()=>{e.forEach(t=>{this.refresh(t),this.resize()})},15),e}enable(){let e=[];return Array.from(arguments).forEach(t=>{t=this.get(t),t&&t.disabled!==!1&&(t.disabled=!1,e.push(t.id))}),setTimeout(()=>{e.forEach(t=>{this.refresh(t)})},15),e}disable(){let e=[];return Array.from(arguments).forEach(t=>{t=this.get(t),t&&t.disabled!==!0&&(t.disabled=!0,e.push(t.id))}),setTimeout(()=>{e.forEach(t=>{this.refresh(t)})},15),e}dragMove(e){if(this.last.reordering){let l=function(c,h){c+=h;let d=a.tabs[c];return d=d&&d.hidden?l(c,h):d},a=this;var t=this.last.moving,r=this.tabs[t.index],i=l(t.index,1),n=l(t.index,-1),r=p(this.box).find("#tabs_"+this.name+"_tab_"+b.escapeId(r.id));if(0<t.divX&&i){var o=p(this.box).find("#tabs_"+this.name+"_tab_"+b.escapeId(i.id));let c=parseInt(r.get(0).clientWidth),h=parseInt(o.get(0).clientWidth);if(c=c<h?Math.floor(c/3):Math.floor(h/3),h-=c,t.divX>h)return i=this.tabs.indexOf(i),this.tabs.splice(t.index,0,this.tabs.splice(i,1)[0]),t.$tab.before(o.get(0)),t.$tab.css("opacity",0),void Object.assign(this.last.moving,{index:i,divX:-c,x:e.pageX+c,left:t.left+t.divX+c})}if(t.divX<0&&n){o=p(this.box).find("#tabs_"+this.name+"_tab_"+b.escapeId(n.id));let c=parseInt(r.get(0).clientWidth),h=parseInt(o.get(0).clientWidth);c=c<h?Math.floor(c/3):Math.floor(h/3),h-=c,Math.abs(t.divX)>h&&(i=this.tabs.indexOf(n),this.tabs.splice(t.index,0,this.tabs.splice(i,1)[0]),o.before(t.$tab),t.$tab.css("opacity",0),Object.assign(t,{index:i,divX:c,x:e.pageX-c,left:t.left+t.divX-c}))}}}mouseAction(e,t,i){var n=this.get(t),r=this.trigger("mouse"+e,{target:t,tab:n,object:n,originalEvent:i});if(r.isCancelled!==!0&&!n.disabled&&!n.hidden){switch(e){case"Enter":this.tooltipShow(t);break;case"Leave":this.tooltipHide(t);break;case"Down":this.initReorder(t,i)}r.finish()}}tooltipShow(i){var t=this.get(i),i=p(this.box).find("#tabs_"+this.name+"_tab_"+b.escapeId(i)).get(0);if(this.tooltip!=null&&!t.disabled&&!this.last.reordering){var n=this.tooltip;let r=t.tooltip;typeof r=="function"&&(r=r.call(this,t)),Ne.show({anchor:i,name:this.name+"_tooltip",html:r,position:n})}}tooltipHide(e){this.tooltip!=null&&Ne.hide(this.name+"_tooltip")}getTabHTML(e){if(e=this.get(e,!0),e=this.tabs[e],e==null)return!1;e.text==null&&e.caption!=null&&(e.text=e.caption),e.tooltip==null&&e.hint!=null&&(e.tooltip=e.hint),e.caption!=null&&console.log("NOTICE: tabs tab.caption property is deprecated, please use tab.text. Tab -> ",e),e.hint!=null&&console.log("NOTICE: tabs tab.hint property is deprecated, please use tab.tooltip. Tab -> ",e);let t=e.text,i=((t=typeof t=="function"?t.call(this,e):t)==null&&(t=""),""),n="";return e.hidden&&(n+="display: none;"),e.disabled&&(n+="opacity: 0.2;"),e.closable&&!e.disabled&&(i=`<div class="w2ui-tab-close w2ui-eaction ${this.active===e.id?"active":""}"
                data-mousedown="stop" data-mouseup="clickClose|${e.id}|event">
            </div>`),`
            <div id="tabs_${this.name}_tab_${e.id}" style="${n} ${e.style}"
                class="w2ui-tab w2ui-eaction ${this.active===e.id?"active":""} ${e.closable?"closable":""} ${e.class||""}"
                data-mouseenter="mouseAction|Enter|${e.id}|event]"
                data-mouseleave="mouseAction|Leave|${e.id}|event]"
                data-mousedown="mouseAction|Down|${e.id}|event"
                data-mouseup="mouseAction|Up|${e.id}|event"
                data-click="click|${e.id}|event"
               >
                    ${b.lang(t)+i}
            </div>`}refresh(e){var t=Date.now(),i=(this.flow=="up"?p(this.box).addClass("w2ui-tabs-up"):p(this.box).removeClass("w2ui-tabs-up"),this.trigger("refresh",{target:e??this.name,object:this.get(e)}));if(i.isCancelled!==!0){if(e==null)for(let o=0;o<this.tabs.length;o++)this.refresh(this.tabs[o].id);else{var n="#tabs_"+this.name+"_tab_"+b.escapeId(e),r=p(this.box).find(n),e=this.getTabHTML(e);r.length===0?p(this.box).find("#tabs_"+this.name+"_right").before(e):p(this.box).find(".tab-animate-insert").length==0&&r.replace(e),b.bindEvents(p(this.box).find(n+`, ${n} .w2ui-eaction`),this)}return p(this.box).find("#tabs_"+this.name+"_right").html(this.right),i.finish(),Date.now()-t}}render(e){var t=Date.now(),i=(typeof e=="string"&&(e=p(e).get(0)),this.trigger("render",{target:this.name,box:e??this.box}));if(i.isCancelled!==!0)return e!=null&&(0<p(this.box).find("#tabs_"+this.name+"_right").length&&p(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-tabs").html(""),this.box=e),!!this.box&&(e=`
            <div class="w2ui-tabs-line"></div>
            <div class="w2ui-scroll-wrapper w2ui-eaction" data-mousedown="resize">
                <div id="tabs_${this.name}_right" class="w2ui-tabs-right">${this.right}</div>
            </div>
            <div class="w2ui-scroll-left w2ui-eaction" data-click='["scroll","left"]'></div>
            <div class="w2ui-scroll-right w2ui-eaction" data-click='["scroll","right"]'></div>`,p(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-tabs").html(e),0<p(this.box).length&&(p(this.box)[0].style.cssText+=this.style),b.bindEvents(p(this.box).find(".w2ui-eaction"),this),this.last.observeResize=new ResizeObserver(()=>{this.resize()}),this.last.observeResize.observe(this.box),i.finish(),this.refresh(),this.resize(),Date.now()-t)}initReorder(e,t){if(this.reorder){let i=this,n=p(this.box).find("#tabs_"+this.name+"_tab_"+b.escapeId(e)),r=this.get(e,!0),o=p(n.get(0).cloneNode(!0)),a;o.attr("id","#tabs_"+this.name+"_tab_ghost"),this.last.moving={index:r,indexFrom:r,$tab:n,$ghost:o,divX:0,left:n.get(0).getBoundingClientRect().left,parentX:p(this.box).get(0).getBoundingClientRect().left,x:t.pageX,opacity:n.css("opacity")},p(document).off(".w2uiTabReorder").on("mousemove.w2uiTabReorder",function(l){if(!i.last.reordering){if((a=i.trigger("reorder",{target:i.tabs[r].id,indexFrom:r,tab:i.tabs[r]})).isCancelled===!0)return;Ne.hide(this.name+"_tooltip"),i.last.reordering=!0,o.addClass("moving"),o.css({"pointer-events":"none",position:"absolute",left:n.get(0).getBoundingClientRect().left}),n.css("opacity",0),p(i.box).find(".w2ui-scroll-wrapper").append(o.get(0)),p(i.box).find(".w2ui-tab-close").hide()}i.last.moving.divX=l.pageX-i.last.moving.x,o.css("left",i.last.moving.left-i.last.moving.parentX+i.last.moving.divX+"px"),i.dragMove(l)}).on("mouseup.w2uiTabReorder",function(){p(document).off(".w2uiTabReorder"),o.css({transition:"0.1s",left:i.last.moving.$tab.get(0).getBoundingClientRect().left-i.last.moving.parentX}),p(i.box).find(".w2ui-tab-close").show(),setTimeout(()=>{o.remove(),n.css({opacity:i.last.moving.opacity}),i.last.reordering&&a.finish({indexTo:i.last.moving.index}),i.last.reordering=!1},100)})}}scroll(e,t){return new Promise((i,n)=>{var r=p(this.box).find(".w2ui-scroll-wrapper"),o=r.get(0).scrollLeft,a=r.find(".w2ui-tabs-right").get(0),l=r.parent().get(0).getBoundingClientRect().width,c=o+parseInt(a.offsetLeft)+parseInt(a.clientWidth);switch(e){case"left":{let h=o-l+50;h<=0&&(h=0),r.get(0).scrollTo({top:0,left:h,behavior:t?"atuo":"smooth"});break}case"right":{let h=o+l-50;h>=c-l&&(h=c-l),r.get(0).scrollTo({top:0,left:h,behavior:t?"atuo":"smooth"});break}}setTimeout(()=>{this.resize(),i()},t?0:350)})}scrollIntoView(e,t){return new Promise((i,n)=>{e==null&&(e=this.active),this.get(e)!=null&&(p(this.box).find("#tabs_"+this.name+"_tab_"+b.escapeId(e)).get(0).scrollIntoView({block:"start",inline:"center",behavior:t?"atuo":"smooth"}),setTimeout(()=>{this.resize(),i()},t?0:500))})}resize(){var e=Date.now();if(this.box!=null){var t,i,n,r,o=this.trigger("resize",{target:this.name});if(o.isCancelled!==!0)return(t=p(this.box)).find(".w2ui-scroll-left, .w2ui-scroll-right").hide(),i=t.find(".w2ui-scroll-wrapper").get(0),r=t.find(".w2ui-tabs-right"),(n=t.get(0).getBoundingClientRect().width)<(r=0<r.length?r[0].offsetLeft+r[0].clientWidth:0)&&(0<i.scrollLeft&&t.find(".w2ui-scroll-left").show(),n<r-i.scrollLeft)&&t.find(".w2ui-scroll-right").show(),o.finish(),Date.now()-e}}destroy(){var t;var e=this.trigger("destroy",{target:this.name});e.isCancelled!==!0&&(0<p(this.box).find("#tabs_"+this.name+"_right").length&&p(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-tabs").html(""),(t=this.last.observeResize)==null||t.disconnect(),delete xt[this.name],e.finish())}click(e,t){var i=this.get(e);if(i==null||i.disabled||this.last.reordering)return!1;if(e=this.trigger("click",{target:e,tab:i,object:i,originalEvent:t}),e.isCancelled!==!0){if(p(this.box).find("#tabs_"+this.name+"_tab_"+b.escapeId(this.active)).removeClass("active"),this.active=i.id,p(this.box).find("#tabs_"+this.name+"_tab_"+b.escapeId(this.active)).addClass("active"),typeof i.route=="string"){let r=i.route!==""?("/"+i.route).replace(/\/{2,}/g,"/"):"";var n=b.parseRoute(r);if(0<n.keys.length)for(let o=0;o<n.keys.length;o++)this.routeData[n.keys[o].name]!=null&&(r=r.replace(new RegExp(":"+n.keys[o].name,"g"),this.routeData[n.keys[o].name]));setTimeout(()=>{window.location.hash=r},1)}e.finish()}}clickClose(e,t){var i=this.get(e);if(i==null||i.disabled)return!1;let n=this.trigger("close",{target:e,object:i,tab:i,originalEvent:t});n.isCancelled!==!0&&(this.animateClose(e).then(()=>{this.remove(e),n.finish(),this.refresh()}),t)&&t.stopPropagation()}animateClose(e){return new Promise((t,i)=>{var n=p(this.box).find("#tabs_"+this.name+"_tab_"+b.escapeId(e)),r=parseInt(n.get(0).clientWidth||0);let o=n.replace(`<div class="tab-animate-close" style="display: inline-block; flex-shrink: 0; width: ${r}px; transition: width 0.25s"></div>`);setTimeout(()=>{o.css({width:"0px"})},1),setTimeout(()=>{o.remove(),this.resize(),t()},500)})}animateInsert(e,t){return new Promise((i,n)=>{let r=p(this.box).find("#tabs_"+this.name+"_tab_"+b.escapeId(e)),o=p.html(this.getTabHTML(t.id));if(r.length==0)(r=p(this.box).find("#tabs_tabs_right")).before(o),this.resize();else{o.css({opacity:0}),p(this.box).find("#tabs_tabs_right").before(o.get(0));let a=p(this.box).find("#"+o.attr("id")).get(0).clientWidth??0,l=p.html('<div class="tab-animate-insert" style="flex-shrink: 0; width: 0; transition: width 0.25s"></div>');r.before(l),o.hide(),l.before(o[0]),setTimeout(()=>{l.css({width:a+"px"})},1),setTimeout(()=>{l.remove(),o.css({opacity:1}).show(),this.refresh(t.id),this.resize(),i()},500)}})}}let jt=["top","left","main","preview","right","bottom"];class nu extends _n{constructor(e){super(e.name),this.box=null,this.name=null,this.panels=[],this.last={},this.padding=1,this.resizer=4,this.style="",this.onShow=null,this.onHide=null,this.onResizing=null,this.onResizerClick=null,this.onRender=null,this.onRefresh=null,this.onChange=null,this.onResize=null,this.onDestroy=null,this.panel_template={type:null,title:"",size:100,minSize:20,maxSize:!1,hidden:!1,resizable:!1,overflow:"auto",style:"",html:"",tabs:null,toolbar:null,width:null,height:null,show:{toolbar:!1,tabs:!1},removed:null,onRefresh:null,onShow:null,onHide:null},Object.assign(this,e),Array.isArray(this.panels)||(this.panels=[]),this.panels.forEach((t,i)=>{var n,r,o;this.panels[i]=b.extend({},this.panel_template,t),(b.isPlainObject(t.tabs)||Array.isArray(t.tabs))&&function(a,l,c){var h=a.get(l);if(h!=null&&c==null&&(c=h.tabs),!(h==null||c==null)){Array.isArray(c)&&(c={tabs:c});var d=a.name+"_"+l+"_tabs";xt[d]&&xt[d].destroy(),h.tabs=new df(b.extend({},c,{owner:a,name:a.name+"_"+l+"_tabs"})),h.show.tabs=!0}}(this,t.type),(b.isPlainObject(t.toolbar)||Array.isArray(t.toolbar))&&(i=this,t=t.type,n=void 0,(r=i.get(t))!=null&&n==null&&(n=r.toolbar),r!=null)&&n!=null&&(Array.isArray(n)&&(n={items:n}),o=i.name+"_"+t+"_toolbar",xt[o]&&xt[o].destroy(),r.toolbar=new hf(b.extend({},n,{owner:i,name:i.name+"_"+t+"_toolbar"})),r.show.toolbar=!0)}),jt.forEach(t=>{this.get(t)==null&&this.panels.push(b.extend({},this.panel_template,{type:t,hidden:t!=="main",size:50}))}),typeof this.box=="string"&&(this.box=p(this.box).get(0)),this.box&&this.render(this.box)}html(e,t,i){let n=this.get(e);var r={panel:e,html:n.html,error:!1,cancelled:!1,removed(l){typeof l=="function"&&(n.removed=l)}};if(typeof n.removed=="function"&&(n.removed({panel:e,html:n.html,html_new:t,transition:i||"none"}),n.removed=null),e=="css")p(this.box).find("#layout_"+this.name+"_panel_css").html("<style>"+t+"</style>"),r.status=!0;else if(n==null)console.log("ERROR: incorrect panel name. Panel name can be main, left, right, top, bottom, preview or css"),r.error=!0;else if(t!=null){var o=this.trigger("change",{target:e,panel:n,html_new:t,transition:i});if(o.isCancelled===!0)r.cancelled=!0;else{let l="#layout_"+this.name+"_panel_"+n.type;var a=p(this.box).find(l+"> .w2ui-panel-content");let c=0;if(0<a.length&&(p(this.box).find(l).get(0).scrollTop=0,c=p(a).css("top")),n.html==="")n.html=t,this.refresh(e);else if(n.html=t,!n.hidden)if(i!=null&&i!==""){p(this.box).addClass("animating");let h=p(this.box).find(l+"> .w2ui-panel-content"),d=(h.after('<div class="w2ui-panel-content new-panel" style="'+h[0].style.cssText+'"></div>'),p(this.box).find(l+"> .w2ui-panel-content.new-panel"));h.css("top",c),d.css("top",c),typeof t=="object"?(t.box=d[0],t.render()):d.hide().html(t),b.transition(h[0],d[0],i,()=>{h.remove(),d.removeClass("new-panel"),d.css("overflow",n.overflow),p(p(this.box).find(l+"> .w2ui-panel-content").get(1)).remove(),p(this.box).removeClass("animating"),this.refresh(e)})}else this.refresh(e);o.finish()}}return r}message(e,t){var i=this.get(e);let n=p(this.box).find("#layout_"+this.name+"_panel_"+i.type),r=n.css("overflow");return n.css("overflow","hidden"),i=b.message({owner:this,box:n.get(0),after:".w2ui-panel-title",param:e},t),i&&i.self.on("close:after",()=>{n.css("overflow",r)}),i}confirm(e,t){var i=this.get(e);let n=p(this.box).find("#layout_"+this.name+"_panel_"+i.type),r=n.css("overflow");return n.css("overflow","hidden"),i=b.confirm({owner:this,box:n.get(0),after:".w2ui-panel-title",param:e},t),i&&i.self.on("close:after",()=>{n.css("overflow",r)}),i}load(e,t,i){return new Promise((n,r)=>{e!="css"&&this.get(e)==null||t==null?r():fetch(t).then(o=>o.text()).then(o=>{this.resize(),n(this.html(e,o,i))})})}sizeTo(e,t,i){return this.get(e)!=null&&(p(this.box).find(":scope > div > .w2ui-panel").css("transition",i!==!0?".2s":"0s"),setTimeout(()=>{this.set(e,{size:t})},1),setTimeout(()=>{p(this.box).find(":scope > div > .w2ui-panel").css("transition","0s"),this.resize()},300),!0)}show(e,t){let i=this.trigger("show",{target:e,thisect:this.get(e),immediate:t});var n;if(i.isCancelled!==!0)return(n=this.get(e))!=null&&(!(n.hidden=!1)===t?(p(this.box).find("#layout_"+this.name+"_panel_"+e).css({opacity:"1"}),i.finish(),this.resize()):(p(this.box).addClass("animating"),p(this.box).find("#layout_"+this.name+"_panel_"+e).css({opacity:"0"}),p(this.box).find(":scope > div > .w2ui-panel").css("transition",".2s"),setTimeout(()=>{this.resize()},1),setTimeout(()=>{p(this.box).find("#layout_"+this.name+"_panel_"+e).css({opacity:"1"})},250),setTimeout(()=>{p(this.box).find(":scope > div > .w2ui-panel").css("transition","0s"),p(this.box).removeClass("animating"),i.finish(),this.resize()},300)),!0)}hide(e,t){let i=this.trigger("hide",{target:e,object:this.get(e),immediate:t});var n;if(i.isCancelled!==!0)return(n=this.get(e))!=null&&((n.hidden=!0)===t?(p(this.box).find("#layout_"+this.name+"_panel_"+e).css({opacity:"0"}),i.finish(),this.resize()):(p(this.box).addClass("animating"),p(this.box).find(":scope > div > .w2ui-panel").css("transition",".2s"),p(this.box).find("#layout_"+this.name+"_panel_"+e).css({opacity:"0"}),setTimeout(()=>{this.resize()},1),setTimeout(()=>{p(this.box).find(":scope > div > .w2ui-panel").css("transition","0s"),p(this.box).removeClass("animating"),i.finish(),this.resize()},300)),!0)}toggle(e,t){var i=this.get(e);return i!=null&&(i.hidden?this.show(e,t):this.hide(e,t))}set(e,t){var i=this.get(e,!0);return i!=null&&(b.extend(this.panels[i],t),t.html==null&&t.resizable==null||this.refresh(e),this.resize(),!0)}get(e,t){for(let i=0;i<this.panels.length;i++)if(this.panels[i].type==e)return t===!0?i:this.panels[i];return null}el(e){return e=p(this.box).find("#layout_"+this.name+"_panel_"+e+"> .w2ui-panel-content"),e.length!=1?null:e[0]}hideToolbar(e){var t=this.get(e);t&&(t.show.toolbar=!1,p(this.box).find("#layout_"+this.name+"_panel_"+e+"> .w2ui-panel-toolbar").hide(),this.resize())}showToolbar(e){var t=this.get(e);t&&(t.show.toolbar=!0,p(this.box).find("#layout_"+this.name+"_panel_"+e+"> .w2ui-panel-toolbar").show(),this.resize())}toggleToolbar(e){var t=this.get(e);t&&(t.show.toolbar?this.hideToolbar(e):this.showToolbar(e))}assignToolbar(e,t){typeof t=="string"&&xt[t]!=null&&(t=xt[t]);var i=this.get(e),n=(i.toolbar=t,p(this.box).find(e+"> .w2ui-panel-toolbar"));i.toolbar!=null?(n.find("[name="+i.toolbar.name+"]").length===0?i.toolbar.render(n.get(0)):i.toolbar!=null&&i.toolbar.refresh(),(t.owner=this).showToolbar(e),this.refresh(e)):(n.html(""),this.hideToolbar(e))}hideTabs(e){var t=this.get(e);t&&(t.show.tabs=!1,p(this.box).find("#layout_"+this.name+"_panel_"+e+"> .w2ui-panel-tabs").hide(),this.resize())}showTabs(e){var t=this.get(e);t&&(t.show.tabs=!0,p(this.box).find("#layout_"+this.name+"_panel_"+e+"> .w2ui-panel-tabs").show(),this.resize())}toggleTabs(e){var t=this.get(e);t&&(t.show.tabs?this.hideTabs(e):this.showTabs(e))}render(e){var t=Date.now();let i=this;typeof e=="string"&&(e=p(e).get(0));var n=this.trigger("render",{target:this.name,box:e??this.box});if(n.isCancelled!==!0){if(e!=null&&(0<p(this.box).find("#layout_"+this.name+"_panel_main").length&&p(this.box).removeAttr("name").removeClass("w2ui-layout").html(""),this.box=e),!this.box)return!1;p(this.box).attr("name",this.name).addClass("w2ui-layout").html("<div></div>"),0<p(this.box).length&&(p(this.box)[0].style.cssText+=this.style);for(let c=0;c<jt.length;c++){var r='<div id="layout_'+this.name+"_panel_"+jt[c]+'" class="w2ui-panel">    <div class="w2ui-panel-title"></div>    <div class="w2ui-panel-tabs"></div>    <div class="w2ui-panel-toolbar"></div>    <div class="w2ui-panel-content"></div></div><div id="layout_'+this.name+"_resizer_"+jt[c]+'" class="w2ui-resizer"></div>';p(this.box).find(":scope > div").append(r)}return p(this.box).find(":scope > div").append('<div id="layout_'+this.name+'_panel_css" style="position: absolute; top: 10000px;"></div>'),this.refresh(),this.last.observeResize=new ResizeObserver(()=>{this.resize()}),this.last.observeResize.observe(this.box),n.finish(),setTimeout(()=>{i.last.events={resizeStart:o,mouseMove:l,mouseUp:a},this.resize()},0),Date.now()-t}function o(c,h){i.box&&(h=h||window.event,p(document).off("mousemove",i.last.events.mouseMove).on("mousemove",i.last.events.mouseMove),p(document).off("mouseup",i.last.events.mouseUp).on("mouseup",i.last.events.mouseUp),i.last.resize={type:c,x:h.screenX,y:h.screenY,diff_x:0,diff_y:0,value:0},jt.forEach(d=>{var u=p(i.el(d)).find(".w2ui-lock");0<u.length?u.data("locked","yes"):i.lock(d,{opacity:0})}),h=p(i.box).find("#layout_"+i.name+"_resizer_"+c).get(0),c!="left"&&c!="right"||(i.last.resize.value=parseInt(h.style.left)),c!="top"&&c!="preview"&&c!="bottom"||(i.last.resize.value=parseInt(h.style.top)))}function a(c){if(i.box&&(c=c||window.event,p(document).off("mousemove",i.last.events.mouseMove),p(document).off("mouseup",i.last.events.mouseUp),i.last.resize!=null)){if(jt.forEach(_=>{var g=p(i.el(_)).find(".w2ui-lock");g.data("locked")=="yes"?g.removeData("locked"):i.unlock(_)}),i.last.diff_x!==0||i.last.resize.diff_y!==0){var h=i.get("top"),d=i.get("bottom"),u=i.get(i.last.resize.type),c=b.getSize(p(i.box),"width"),m=b.getSize(p(i.box),"height"),f=String(u.size);let g,v;switch(i.last.resize.type){case"top":g=parseInt(u.sizeCalculated)+i.last.resize.diff_y,v=0;break;case"bottom":g=parseInt(u.sizeCalculated)-i.last.resize.diff_y,v=0;break;case"preview":g=parseInt(u.sizeCalculated)-i.last.resize.diff_y,v=(h&&!h.hidden?h.sizeCalculated:0)+(d&&!d.hidden?d.sizeCalculated:0);break;case"left":g=parseInt(u.sizeCalculated)+i.last.resize.diff_x,v=0;break;case"right":g=parseInt(u.sizeCalculated)-i.last.resize.diff_x,v=0}f.substr(f.length-1)=="%"?u.size=Math.floor(100*g/(u.type=="left"||u.type=="right"?c:m-v)*100)/100+"%":String(u.size).substr(0,1)=="-"?u.size=parseInt(u.size)-u.sizeCalculated+g:u.size=g,i.resize()}p(i.box).find("#layout_"+i.name+"_resizer_"+i.last.resize.type).removeClass("active"),delete i.last.resize}}function l(c){if(i.box&&(c=c||window.event,i.last.resize!=null)){var h=i.get(i.last.resize.type),d=i.last.resize,u=i.trigger("resizing",{target:i.name,object:h,originalEvent:c,panel:d?d.type:"all",diff_x:d?d.diff_x:0,diff_y:d?d.diff_y:0});if(u.isCancelled!==!0){var m=p(i.box).find("#layout_"+i.name+"_resizer_"+d.type);let _=c.screenX-d.x,g=c.screenY-d.y;var f=i.get("main");switch(m.hasClass("active")||m.addClass("active"),d.type){case"left":h.minSize-_>h.width&&(_=h.minSize-h.width),h.maxSize&&h.width+_>h.maxSize&&(_=h.maxSize-h.width),f.minSize+_>f.width&&(_=f.width-f.minSize);break;case"right":h.minSize+_>h.width&&(_=h.width-h.minSize),h.maxSize&&h.width-_>h.maxSize&&(_=h.width-h.maxSize),f.minSize-_>f.width&&(_=f.minSize-f.width);break;case"top":h.minSize-g>h.height&&(g=h.minSize-h.height),h.maxSize&&h.height+g>h.maxSize&&(g=h.maxSize-h.height),f.minSize+g>f.height&&(g=f.height-f.minSize);break;case"preview":case"bottom":h.minSize+g>h.height&&(g=h.height-h.minSize),h.maxSize&&h.height-g>h.maxSize&&(g=h.height-h.maxSize),f.minSize-g>f.height&&(g=f.minSize-f.height)}switch(d.diff_x=_,d.diff_y=g,d.type){case"top":case"preview":case"bottom":(d.diff_x=0)<m.length&&(m[0].style.top=d.value+d.diff_y+"px");break;case"left":case"right":(d.diff_y=0)<m.length&&(m[0].style.left=d.value+d.diff_x+"px")}u.finish()}}}}refresh(e){let t=this;e==null&&(e=null);var i=Date.now(),n=t.trigger("refresh",{target:e??t.name,object:t.get(e)});if(n.isCancelled!==!0){if(typeof e=="string"){let r=t.get(e);if(r==null)return;let o="#layout_"+t.name+"_panel_"+r.type;e="#layout_"+t.name+"_resizer_"+r.type,p(t.box).find(o).css({display:r.hidden?"none":"block"}),r.resizable?p(t.box).find(e).show():p(t.box).find(e).hide(),typeof r.html=="object"&&typeof r.html.render=="function"?(r.html.box=p(t.box).find(o+"> .w2ui-panel-content")[0],setTimeout(()=>{0<p(t.box).find(o+"> .w2ui-panel-content").length&&(p(t.box).find(o+"> .w2ui-panel-content").removeClass().removeAttr("name").addClass("w2ui-panel-content").css("overflow",r.overflow)[0].style.cssText+=";"+r.style),r.html&&typeof r.html.render=="function"&&r.html.render()},1)):0<p(t.box).find(o+"> .w2ui-panel-content").length&&(p(t.box).find(o+"> .w2ui-panel-content").removeClass().removeAttr("name").addClass("w2ui-panel-content").html(r.html).css("overflow",r.overflow)[0].style.cssText+=";"+r.style);let a=p(t.box).find(o+"> .w2ui-panel-tabs");r.show.tabs?a.find("[name="+r.tabs.name+"]").length===0&&r.tabs!=null?r.tabs.render(a.get(0)):r.tabs.refresh():a.html("").removeClass("w2ui-tabs").hide(),a=p(t.box).find(o+"> .w2ui-panel-toolbar"),r.show.toolbar?a.find("[name="+r.toolbar.name+"]").length===0&&r.toolbar!=null?r.toolbar.render(a.get(0)):r.toolbar.refresh():a.html("").removeClass("w2ui-toolbar").hide(),a=p(t.box).find(o+"> .w2ui-panel-title"),r.title?a.html(r.title).show():a.html("").hide()}else{if(p(t.box).find("#layout_"+t.name+"_panel_main").length===0)return void t.render();t.resize();for(let r=0;r<this.panels.length;r++)t.refresh(this.panels[r].type)}return n.finish(),Date.now()-i}}resize(){if(!this.box)return!1;var e=Date.now();let t=this.last.resize;var i=this.trigger("resize",{target:this.name,panel:t?t.type:"all",diff_x:t?t.diff_x:0,diff_y:t?t.diff_y:0});if(i.isCancelled!==!0){this.padding<0&&(this.padding=0);var n=b.getSize(p(this.box),"width"),r=b.getSize(p(this.box),"height");let R=this;var o=this.get("main"),a=this.get("preview"),l=this.get("left"),c=this.get("right"),h=this.get("top"),d=this.get("bottom"),u=a!=null&&a.hidden!==!0,m=l!=null&&l.hidden!==!0,f=c!=null&&c.hidden!==!0,_=h!=null&&h.hidden!==!0,g=d!=null&&d.hidden!==!0;let M,C,P,N;for(let w=0;w<jt.length;w++)if(jt[w]!=="main"&&(t=this.get(jt[w]))){var v=String(t.size||0);if(v.substr(v.length-1)=="%"){let S=r;t.type=="preview"&&(S=S-(h&&!h.hidden?h.sizeCalculated:0)-(d&&!d.hidden?d.sizeCalculated:0)),t.sizeCalculated=parseInt((t.type=="left"||t.type=="right"?n:S)*parseFloat(t.size)/100)}else t.sizeCalculated=parseInt(t.size);t.sizeCalculated=Math.max(t.sizeCalculated,parseInt(t.minSize))}String(c.size).substr(0,1)=="-"&&(m&&String(l.size).substr(0,1)=="-"?console.log("ERROR: you cannot have both left panel.size and right panel.size be negative."):c.sizeCalculated=n-(m?l.sizeCalculated:0)+parseInt(c.size)),String(l.size).substr(0,1)=="-"&&(f&&String(c.size).substr(0,1)=="-"?console.log("ERROR: you cannot have both left panel.size and right panel.size be negative."):l.sizeCalculated=n-(f?c.sizeCalculated:0)+parseInt(l.size)),h!=null&&h.hidden!==!0?(M=0,C=0,P=n,N=h.sizeCalculated,p(this.box).find("#layout_"+this.name+"_panel_top").css({display:"block",left:M+"px",top:C+"px",width:P+"px",height:N+"px"}),h.width=P,h.height=N,h.resizable&&(C=h.sizeCalculated-(this.padding===0?this.resizer:0),N=this.resizer>this.padding?this.resizer:this.padding,p(this.box).find("#layout_"+this.name+"_resizer_top").css({display:"block",left:M+"px",top:C+"px",width:P+"px",height:N+"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",function(w){w.preventDefault();var S=R.trigger("resizerClick",{target:"top",originalEvent:w});if(S.isCancelled!==!0)return xt[R.name].last.events.resizeStart("top",w),S.finish(),!1}))):(p(this.box).find("#layout_"+this.name+"_panel_top").hide(),p(this.box).find("#layout_"+this.name+"_resizer_top").hide()),l!=null&&l.hidden!==!0?(M=0,C=0+(_?h.sizeCalculated+this.padding:0),P=l.sizeCalculated,N=r-(_?h.sizeCalculated+this.padding:0)-(g?d.sizeCalculated+this.padding:0),p(this.box).find("#layout_"+this.name+"_panel_left").css({display:"block",left:M+"px",top:C+"px",width:P+"px",height:N+"px"}),l.width=P,l.height=N,l.resizable&&(M=l.sizeCalculated-(this.padding===0?this.resizer:0),P=this.resizer>this.padding?this.resizer:this.padding,p(this.box).find("#layout_"+this.name+"_resizer_left").css({display:"block",left:M+"px",top:C+"px",width:P+"px",height:N+"px",cursor:"ew-resize"}).off("mousedown").on("mousedown",function(w){w.preventDefault();var S=R.trigger("resizerClick",{target:"left",originalEvent:w});if(S.isCancelled!==!0)return xt[R.name].last.events.resizeStart("left",w),S.finish(),!1}))):(p(this.box).find("#layout_"+this.name+"_panel_left").hide(),p(this.box).find("#layout_"+this.name+"_resizer_left").hide()),c!=null&&c.hidden!==!0?(M=n-c.sizeCalculated,C=0+(_?h.sizeCalculated+this.padding:0),P=c.sizeCalculated,N=r-(_?h.sizeCalculated+this.padding:0)-(g?d.sizeCalculated+this.padding:0),p(this.box).find("#layout_"+this.name+"_panel_right").css({display:"block",left:M+"px",top:C+"px",width:P+"px",height:N+"px"}),c.width=P,c.height=N,c.resizable&&(M-=this.padding,P=this.resizer>this.padding?this.resizer:this.padding,p(this.box).find("#layout_"+this.name+"_resizer_right").css({display:"block",left:M+"px",top:C+"px",width:P+"px",height:N+"px",cursor:"ew-resize"}).off("mousedown").on("mousedown",function(w){w.preventDefault();var S=R.trigger("resizerClick",{target:"right",originalEvent:w});if(S.isCancelled!==!0)return xt[R.name].last.events.resizeStart("right",w),S.finish(),!1}))):(p(this.box).find("#layout_"+this.name+"_panel_right").hide(),p(this.box).find("#layout_"+this.name+"_resizer_right").hide()),d!=null&&d.hidden!==!0?(M=0,C=r-d.sizeCalculated,P=n,N=d.sizeCalculated,p(this.box).find("#layout_"+this.name+"_panel_bottom").css({display:"block",left:M+"px",top:C+"px",width:P+"px",height:N+"px"}),d.width=P,d.height=N,d.resizable&&(C-=this.padding===0?0:this.padding,N=this.resizer>this.padding?this.resizer:this.padding,p(this.box).find("#layout_"+this.name+"_resizer_bottom").css({display:"block",left:M+"px",top:C+"px",width:P+"px",height:N+"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",function(w){w.preventDefault();var S=R.trigger("resizerClick",{target:"bottom",originalEvent:w});if(S.isCancelled!==!0)return xt[R.name].last.events.resizeStart("bottom",w),S.finish(),!1}))):(p(this.box).find("#layout_"+this.name+"_panel_bottom").hide(),p(this.box).find("#layout_"+this.name+"_resizer_bottom").hide()),M=0+(m?l.sizeCalculated+this.padding:0),C=0+(_?h.sizeCalculated+this.padding:0),P=n-(m?l.sizeCalculated+this.padding:0)-(f?c.sizeCalculated+this.padding:0),N=r-(_?h.sizeCalculated+this.padding:0)-(g?d.sizeCalculated+this.padding:0)-(u?a.sizeCalculated+this.padding:0),p(this.box).find("#layout_"+this.name+"_panel_main").css({display:"block",left:M+"px",top:C+"px",width:P+"px",height:N+"px"}),o.width=P,o.height=N,a!=null&&a.hidden!==!0?(M=0+(m?l.sizeCalculated+this.padding:0),C=r-(g?d.sizeCalculated+this.padding:0)-a.sizeCalculated,P=n-(m?l.sizeCalculated+this.padding:0)-(f?c.sizeCalculated+this.padding:0),N=a.sizeCalculated,p(this.box).find("#layout_"+this.name+"_panel_preview").css({display:"block",left:M+"px",top:C+"px",width:P+"px",height:N+"px"}),a.width=P,a.height=N,a.resizable&&(C-=this.padding===0?0:this.padding,N=this.resizer>this.padding?this.resizer:this.padding,p(this.box).find("#layout_"+this.name+"_resizer_preview").css({display:"block",left:M+"px",top:C+"px",width:P+"px",height:N+"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",function(w){w.preventDefault();var S=R.trigger("resizerClick",{target:"preview",originalEvent:w});if(S.isCancelled!==!0)return xt[R.name].last.events.resizeStart("preview",w),S.finish(),!1}))):(p(this.box).find("#layout_"+this.name+"_panel_preview").hide(),p(this.box).find("#layout_"+this.name+"_resizer_preview").hide());for(let w=0;w<jt.length;w++){var y,x=this.get(jt[w]),E="#layout_"+this.name+"_panel_"+jt[w]+" > .w2ui-panel-";let S=0;x&&(x.title&&(y=p(this.box).find(E+"title").css({top:S+"px",display:"block"}),S+=b.getSize(y,"height")),x.show.tabs&&(y=p(this.box).find(E+"tabs").css({top:S+"px",display:"block"}),S+=b.getSize(y,"height")),x.show.toolbar)&&(x=p(this.box).find(E+"toolbar").css({top:S+"px",display:"block"}),S+=b.getSize(x,"height")),p(this.box).find(E+"content").css({display:"block"}).css({top:S+"px"})}return i.finish(),Date.now()-e}}destroy(){var t;var e=this.trigger("destroy",{target:this.name});if(e.isCancelled!==!0)return xt[this.name]!=null&&(0<p(this.box).find("#layout_"+this.name+"_panel_main").length&&p(this.box).removeAttr("name").removeClass("w2ui-layout").html(""),(t=this.last.observeResize)==null||t.disconnect(),delete xt[this.name],e.finish(),this.last.events&&this.last.events.resize&&p(window).off("resize",this.last.events.resize),!0)}lock(e,t,i){var n;jt.indexOf(e)==-1?console.log("ERROR: First parameter needs to be the a valid panel name."):((n=Array.from(arguments))[0]="#layout_"+this.name+"_panel_"+e,b.lock(...n))}unlock(e,t){jt.indexOf(e)==-1?console.log("ERROR: First parameter needs to be the a valid panel name."):(e="#layout_"+this.name+"_panel_"+e,b.unlock(e,t))}}class z1 extends _n{constructor(e){if(super(e.name),this.name=null,this.box=null,this.columns=[],this.columnGroups=[],this.records=[],this.summary=[],this.searches=[],this.toolbar={},this.ranges=[],this.contextMenu=[],this.searchMap={},this.searchData=[],this.sortMap={},this.sortData=[],this.savedSearches=[],this.defaultSearches=[],this.total=0,this.recid=null,this.last={field:"",label:"",logic:"AND",search:"",searchIds:[],selection:{indexes:[],columns:{}},saved_sel:null,multi:!1,scrollTop:0,scrollLeft:0,colStart:0,colEnd:0,fetch:{action:"",offset:null,start:0,response:0,options:null,controller:null,loaded:!1,hasMore:!1},pull_more:!1,pull_refresh:!0,range_start:null,range_end:null,sel_ind:null,sel_col:null,sel_type:null,sel_recid:null,idCache:{},move:null,cancelClick:null,inEditMode:!1,_edit:null,kbd_timer:null,marker_timer:null,click_time:null,click_recid:null,bubbleEl:null,colResizing:!1,tmp:null,copy_event:null,userSelect:"",columnDrag:!1,state:null,show_extra:0,toolbar_height:0},this.header="",this.url="",this.limit=100,this.offset=0,this.postData={},this.routeData={},this.httpHeaders={},this.show={header:!1,toolbar:!1,footer:!1,columnMenu:!0,columnHeaders:!0,lineNumbers:!1,expandColumn:!1,selectColumn:!1,emptyRecords:!0,toolbarReload:!0,toolbarColumns:!1,toolbarSearch:!0,toolbarAdd:!1,toolbarEdit:!1,toolbarDelete:!1,toolbarSave:!1,searchAll:!0,searchLogic:!0,searchHiddenMsg:!1,searchSave:!0,statusRange:!0,statusBuffered:!1,statusRecordID:!0,statusSelection:!0,statusResponse:!0,statusSort:!1,statusSearch:!1,recordTitles:!1,selectionBorder:!0,skipRecords:!0,saveRestoreState:!0},this.stateId=null,this.hasFocus=!1,this.autoLoad=!0,this.fixedBody=!0,this.recordHeight=32,this.lineNumberWidth=34,this.keyboard=!0,this.selectType="row",this.liveSearch=!1,this.multiSearch=!0,this.multiSelect=!0,this.multiSort=!0,this.reorderColumns=!1,this.reorderRows=!1,this.showExtraOnSearch=0,this.markSearch=!0,this.columnTooltip="top|bottom",this.disableCVS=!1,this.nestedFields=!0,this.vs_start=150,this.vs_extra=5,this.style="",this.tabIndex=null,this.dataType=null,this.parser=null,this.advanceOnEdit=!0,this.useLocalStorage=!0,this.colTemplate={text:"",field:"",size:null,min:20,max:null,gridMinWidth:null,sizeCorrected:null,sizeCalculated:null,sizeOriginal:null,sizeType:null,hidden:!1,sortable:!1,sortMode:null,searchable:!1,resizable:!0,hideable:!0,autoResize:null,attr:"",style:"",render:null,title:null,tooltip:null,editable:{},frozen:!1,info:null,clipboardCopy:!1},this.stateColProps={text:!1,field:!0,size:!0,min:!1,max:!1,gridMinWidth:!1,sizeCorrected:!1,sizeCalculated:!0,sizeOriginal:!0,sizeType:!0,hidden:!0,sortable:!1,sortMode:!0,searchable:!1,resizable:!1,hideable:!1,autoResize:!1,attr:!1,style:!1,render:!1,title:!1,tooltip:!1,editable:!1,frozen:!0,info:!1,clipboardCopy:!1},this.msgDelete="Are you sure you want to delete ${count} ${records}?",this.msgNotJSON="Returned data is not in valid JSON format.",this.msgHTTPError="HTTP error. See console for more details.",this.msgServerError="Server error",this.msgRefresh="Refreshing...",this.msgNeedReload="Your remote data source record count has changed, reloading from the first record.",this.msgEmpty="",this.buttons={reload:{type:"button",id:"w2ui-reload",icon:"w2ui-icon-reload",tooltip:"Reload data in the list"},columns:{type:"menu-check",id:"w2ui-column-on-off",icon:"w2ui-icon-columns",tooltip:"Show/hide columns",overlay:{align:"none"}},search:{type:"html",id:"w2ui-search",html:'<div class="w2ui-icon w2ui-icon-search w2ui-search-down w2ui-action" data-click="searchShowFields"></div>'},add:{type:"button",id:"w2ui-add",text:"Add New",tooltip:"Add new record",icon:"w2ui-icon-plus"},edit:{type:"button",id:"w2ui-edit",text:"Edit",tooltip:"Edit selected record",icon:"w2ui-icon-pencil",batch:1,disabled:!0},delete:{type:"button",id:"w2ui-delete",text:"Delete",tooltip:"Delete selected records",icon:"w2ui-icon-cross",batch:!0,disabled:!0},save:{type:"button",id:"w2ui-save",text:"Save",tooltip:"Save changed records",icon:"w2ui-icon-check"}},this.operators={text:["is","begins","contains","ends"],number:["=","between",">","<",">=","<="],date:["is",{oper:"less",text:"before"},{oper:"more",text:"since"},"between"],list:["is"],hex:["is","between"],color:["is","begins","contains","ends"],enum:["in","not in"]},this.defaultOperator={text:"begins",number:"=",date:"is",list:"is",enum:"in",hex:"begins",color:"begins"},this.operatorsMap={text:"text",int:"number",float:"number",money:"number",currency:"number",percent:"number",hex:"hex",alphanumeric:"text",color:"color",date:"date",time:"date",datetime:"date",list:"list",combo:"text",enum:"enum",file:"enum",select:"list",radio:"list",checkbox:"list",toggle:"list"},this.onAdd=null,this.onEdit=null,this.onRequest=null,this.onLoad=null,this.onDelete=null,this.onSave=null,this.onSelect=null,this.onClick=null,this.onDblClick=null,this.onContextMenu=null,this.onContextMenuClick=null,this.onColumnClick=null,this.onColumnDblClick=null,this.onColumnContextMenu=null,this.onColumnResize=null,this.onColumnAutoResize=null,this.onSort=null,this.onSearch=null,this.onSearchOpen=null,this.onChange=null,this.onRestore=null,this.onExpand=null,this.onCollapse=null,this.onError=null,this.onKeydown=null,this.onToolbar=null,this.onColumnOnOff=null,this.onCopy=null,this.onPaste=null,this.onSelectionExtend=null,this.onEditField=null,this.onRender=null,this.onRefresh=null,this.onReload=null,this.onResize=null,this.onDestroy=null,this.onStateSave=null,this.onStateRestore=null,this.onFocus=null,this.onBlur=null,this.onReorderRow=null,this.onSearchSave=null,this.onSearchRemove=null,this.onSearchSelect=null,this.onColumnSelect=null,this.onColumnDragStart=null,this.onColumnDragEnd=null,this.onResizerDblClick=null,this.onMouseEnter=null,this.onMouseLeave=null,b.extend(this,e),Array.isArray(this.records)){let t=[];this.records.forEach((i,n)=>{var r;i[this.recid]!=null&&(i.recid=i[this.recid]),i.recid==null&&console.log("ERROR: Cannot add records without recid. (obj: "+this.name+")"),((r=i.w2ui)==null?void 0:r.summary)===!0&&(this.summary.push(i),t.push(n))}),t.sort();for(let i=t.length-1;0<=i;i--)this.records.splice(t[i],1)}Array.isArray(this.columns)&&this.columns.forEach((t,i)=>{if(t=b.extend({},this.colTemplate,t),i=(this.columns[i]=t).searchable,i!=null&&i!==!1&&this.getSearch(t.field)==null)if(b.isPlainObject(i))this.addSearch(b.extend({field:t.field,label:t.text,type:"text"},i));else{let n=t.searchable,r="";t.searchable===!0&&(n="text",r='size="20"'),this.addSearch({field:t.field,label:t.text,type:n,attr:r})}}),Array.isArray(this.defaultSearches)&&this.defaultSearches.forEach((t,i)=>{t.id="default-"+i,t.icon??(t.icon="w2ui-icon-search")}),e=this.cache("searches"),Array.isArray(e)&&e.forEach(t=>{this.savedSearches.push({id:t.id??"none",text:t.text??"none",icon:"w2ui-icon-search",remove:!0,logic:t.logic??"AND",data:t.data??[]})}),typeof this.box=="string"&&(this.box=p(this.box).get(0)),this.box&&this.render(this.box)}add(e,t){var r,o;Array.isArray(e)||(e=[e]);let i=0;for(let a=0;a<e.length;a++){var n=e[a];n[this.recid]!=null&&(n.recid=n[this.recid]),n.recid==null?console.log("ERROR: Cannot add record without recid. (obj: "+this.name+")"):(((r=n.w2ui)==null?void 0:r.summary)===!0?t?this.summary.unshift(n):this.summary.push(n):t?this.records.unshift(n):this.records.push(n),i++)}return(((o=this.url)==null?void 0:o.get)??this.url)||(this.total=this.records.length,this.localSort(!1,!0),this.localSearch()),this.refresh(),i}find(e,t,i){var n,r=[];let o=!1;for(n in e=e??{})String(n).indexOf(".")!=-1&&(o=!0);var a=i?this.last.range_start:0;let l=i?this.last.range_end+1:this.records.length;l>this.records.length&&(l=this.records.length);for(let h=a;h<l;h++){let d=!0;for(var c in e){let u=this.records[h][c];o&&String(c).indexOf(".")!=-1&&(u=this.parseField(this.records[h],c)),e[c]=="not-null"?u!=null&&u!==""||(d=!1):e[c]!=u&&(d=!1)}d&&t!==!0&&r.push(this.records[h].recid),d&&t===!0&&r.push(h)}return r}set(e,t,i){if(typeof e=="object"&&e!==null&&(i=t,t=e,e=null),e==null){for(let r=0;r<this.records.length;r++)b.extend(this.records[r],t);i!==!0&&this.refresh()}else{var n=this.get(e,!0);if(n==null)return!1;!this.records[n]||this.records[n].recid!=e?b.extend(this.summary[n],t):b.extend(this.records[n],t),i!==!0&&this.refreshRow(e,n)}return!0}get(e,t){if(Array.isArray(e)){var i=[];for(let o=0;o<e.length;o++){var n=this.get(e[o],t);n!==null&&i.push(n)}return i}{let o=this.last.idCache;o||(this.last.idCache=o={});var r=o[e];if(typeof r=="number"){if(0<=r&&r<this.records.length&&this.records[r].recid==e)return t===!0?r:this.records[r];if(0<=(r=~r)&&r<this.summary.length&&this.summary[r].recid==e)return t===!0?r:this.summary[r];this.last.idCache=o={}}for(let a=0;a<this.records.length;a++)if(this.records[a].recid==e)return o[e]=a,t===!0?a:this.records[a];for(let a=0;a<this.summary.length;a++)if(this.summary[a].recid==e)return o[e]=~a,t===!0?a:this.summary[a];return null}}getFirst(e){if(this.records.length==0)return null;let t=this.records[0];var i=this.last.searchIds;return t=0<this.searchData.length?Array.isArray(i)&&0<i.length?this.records[i[e||0]]:null:t}remove(){var t;let e=0;for(let i=0;i<arguments.length;i++){for(let n=this.records.length-1;0<=n;n--)this.records[n].recid==arguments[i]&&(this.records.splice(n,1),e++);for(let n=this.summary.length-1;0<=n;n--)this.summary[n].recid==arguments[i]&&(this.summary.splice(n,1),e++)}return(((t=this.url)==null?void 0:t.get)??this.url)||(this.localSort(!1,!0),this.localSearch()),this.refresh(),e}addColumn(e,t){let i=0;arguments.length==1?(t=e,e=this.columns.length):(e=typeof e=="string"?this.getColumn(e,!0):e)==null&&(e=this.columns.length),Array.isArray(t)||(t=[t]);for(let r=0;r<t.length;r++){var n=b.extend({},this.colTemplate,t[r]);if(this.columns.splice(e,0,n),t[r].searchable){let o=t[r].searchable,a="";t[r].searchable===!0&&(o="text",a='size="20"'),this.addSearch({field:t[r].field,label:t[r].text,type:o,attr:a})}e++,i++}return this.refresh(),i}removeColumn(){let e=0;for(let t=0;t<arguments.length;t++)for(let i=this.columns.length-1;0<=i;i--)this.columns[i].field==arguments[t]&&(this.columns[i].searchable&&this.removeSearch(arguments[t]),this.columns.splice(i,1),e++);return this.refresh(),e}getColumn(e,t){if(arguments.length===0){var i=[];for(let n=0;n<this.columns.length;n++)i.push(this.columns[n].field);return i}for(let n=0;n<this.columns.length;n++)if(this.columns[n].field==e)return t===!0?n:this.columns[n];return null}updateColumn(e,t){let i=0;return(e=Array.isArray(e)?e:[e]).forEach(n=>{this.columns.forEach(r=>{if(r.field==n){let o=b.clone(t);Object.keys(o).forEach(a=>{typeof o[a]=="function"&&(o[a]=o[a](r)),r[a]!=o[a]&&i++}),b.extend(r,o)}})}),0<i&&this.refresh(),i}toggleColumn(){return this.updateColumn(Array.from(arguments),{hidden(e){return!e.hidden}})}showColumn(){return this.updateColumn(Array.from(arguments),{hidden:!1})}hideColumn(){return this.updateColumn(Array.from(arguments),{hidden:!0})}addSearch(e,t){let i=0;arguments.length==1?(t=e,e=this.searches.length):(e=typeof e=="string"?this.getSearch(e,!0):e)==null&&(e=this.searches.length),Array.isArray(t)||(t=[t]);for(let n=0;n<t.length;n++)this.searches.splice(e,0,t[n]),e++,i++;return this.searchClose(),i}removeSearch(){let e=0;for(let t=0;t<arguments.length;t++)for(let i=this.searches.length-1;0<=i;i--)this.searches[i].field==arguments[t]&&(this.searches.splice(i,1),e++);return this.searchClose(),e}getSearch(e,t){if(arguments.length===0){var i=[];for(let n=0;n<this.searches.length;n++)i.push(this.searches[n].field);return i}for(let n=0;n<this.searches.length;n++)if(this.searches[n].field==e)return t===!0?n:this.searches[n];return null}toggleSearch(){let e=0;for(let t=0;t<arguments.length;t++)for(let i=this.searches.length-1;0<=i;i--)this.searches[i].field==arguments[t]&&(this.searches[i].hidden=!this.searches[i].hidden,e++);return this.searchClose(),e}showSearch(){let e=0;for(let t=0;t<arguments.length;t++)for(let i=this.searches.length-1;0<=i;i--)this.searches[i].field==arguments[t]&&this.searches[i].hidden!==!1&&(this.searches[i].hidden=!1,e++);return this.searchClose(),e}hideSearch(){let e=0;for(let t=0;t<arguments.length;t++)for(let i=this.searches.length-1;0<=i;i--)this.searches[i].field==arguments[t]&&this.searches[i].hidden!==!0&&(this.searches[i].hidden=!0,e++);return this.searchClose(),e}getSearchData(e){for(let t=0;t<this.searchData.length;t++)if(this.searchData[t].field==e)return this.searchData[t];return null}localSort(e,t){var a,l,c;let i=this;if(((a=this.url)==null?void 0:a.get)??this.url)console.log("ERROR: grid.localSort can only be used on local data source, grid.url should be empty.");else if(Object.keys(this.sortData).length!==0){let d=function(f){var _;return f.w2ui&&f.w2ui.parent_recid!=null?f.w2ui._path||((_=i.get(f.w2ui.parent_recid))?d(_).concat(f):(console.log("ERROR: no parent record: "+f.w2ui.parent_recid),[f])):[f]},u=function(f,_){if(f===_)return 0;for(let y=0;y<i.sortData.length;y++){var g=i.sortData[y].field,v=i.sortData[y].field_||g;let x=f[v],E=_[v];if(String(g).indexOf(".")!=-1&&(x=i.parseField(f,v),E=i.parseField(_,v)),v=i.getColumn(g),g=(v&&0<Object.keys(v.editable).length&&(b.isPlainObject(x)&&x.text&&(x=x.text),b.isPlainObject(E))&&E.text&&(E=E.text),m(x,E,y,i.sortData[y].direction,v.sortMode||"default")),g!==0)return g}return m(f.recid,_.recid,0,"asc")},m=function(f,_,g,v,y){if(f===_)return 0;if((f==null||f==="")&&_!=null&&_!=="")return 1;if(f!=null&&f!==""&&(_==null||_===""))return-1;if(v=v.toLowerCase()==="asc"?1:-1,typeof f!=typeof _)return typeof _<typeof f?v:-v;if(f.constructor.name!=_.constructor.name)return f.constructor.name>_.constructor.name?v:-v;f&&typeof f=="object"&&(f=f.valueOf()),_&&typeof _=="object"&&(_=_.valueOf());var x={}.toString;switch(f&&typeof f=="object"&&f.toString!=x&&(f=String(f)),_&&typeof _=="object"&&_.toString!=x&&(_=String(_)),typeof f=="string"&&(f=f.toLowerCase().trim()),typeof _=="string"&&(_=_.toLowerCase().trim()),y){case"natural":y=b.naturalCompare;break;case"i18n":y=b.i18nCompare}return typeof y=="function"?y(f,_)*v:_<f?v:f<_?-v:0},h=Date.now();this.selectionSave(),this.prepareData(),t||this.reset();for(let f=0;f<this.sortData.length;f++){var n=this.getColumn(this.sortData[f].field);if(!n)return;typeof n.render=="string"&&(["date","age"].indexOf(n.render.split(":")[0])!=-1&&(this.sortData[f].field_=n.field+"_"),["time"].indexOf(n.render.split(":")[0])!=-1)&&(this.sortData[f].field_=n.field+"_")}for(let f=0;f<i.records.length;f++){var r=i.records[f];((l=r.w2ui)==null?void 0:l.parent_recid)!=null&&(r.w2ui._path=d(r))}this.records.sort((f,_)=>{if(!(f.w2ui&&f.w2ui.parent_recid!=null||_.w2ui&&_.w2ui.parent_recid!=null))return u(f,_);var g=d(f),v=d(_);for(let x=0;x<Math.min(g.length,v.length);x++){var y=u(g[x],v[x]);if(y!==0)return y}return g.length>v.length?1:g.length<v.length?-1:(console.log("ERROR: two paths should not be equal."),0)});for(let f=0;f<i.records.length;f++){var o=i.records[f];((c=o.w2ui)==null?void 0:c.parent_recid)!=null&&(o.w2ui._path=null)}return this.selectionRestore(t),h=Date.now()-h,e!==!0&&this.show.statusSort&&setTimeout(()=>{this.status(b.lang("Sorting took ${count} seconds",{count:h/1e3}))},10),h}}localSearch(e){var r;let t=this;var i=((r=this.url)==null?void 0:r.get)??this.url;if(i)console.log("ERROR: grid.localSearch can only be used on local data source, grid.url should be empty.");else{let o=Date.now(),a={}.toString,l={};if(this.total=this.records.length,this.last.searchIds=[],this.prepareData(),0<this.searchData.length&&!i){for(let c=this.total=0;c<this.records.length;c++){var n=this.records[c];if(function h(d){var y,x;let u=0,m,f,_,g,v=!1;for(let E=0;E<t.searchData.length;E++){let R=t.searchData[E],M=t.getSearch(R.field);if(R!=null){M==null&&(M={field:R.field,type:R.type});let C=t.parseField(d,M.field);switch(m=C==null||typeof C=="object"&&C.toString==a?"":String(C).toLowerCase(),R.value!=null&&(Array.isArray(R.value)?(f=R.value[0],_=R.value[1]):f=String(R.value).toLowerCase()),R.operator){case"=":case"is":t.parseField(d,M.field)==R.value?u++:M.type=="date"?(g=t.parseField(d,M.field+"_")instanceof Date?t.parseField(d,M.field+"_"):t.parseField(d,M.field),m=b.formatDate(g,"yyyy-mm-dd"),f=b.formatDate(b.isDate(f,b.settings.dateFormat,!0),"yyyy-mm-dd"),m==f&&u++):M.type=="time"?(g=t.parseField(d,M.field+"_")instanceof Date?t.parseField(d,M.field+"_"):t.parseField(d,M.field),m=b.formatTime(g,"hh24:mi"),f=b.formatTime(f,"hh24:mi"),m==f&&u++):M.type=="datetime"&&(g=t.parseField(d,M.field+"_")instanceof Date?t.parseField(d,M.field+"_"):t.parseField(d,M.field),m=b.formatDateTime(g,"yyyy-mm-dd|hh24:mm:ss"),f=b.formatDateTime(b.isDateTime(f,b.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss"),m==f)&&u++;break;case"between":["int","float","money","currency","percent"].indexOf(M.type)!=-1?parseFloat(t.parseField(d,M.field))>=parseFloat(f)&&parseFloat(t.parseField(d,M.field))<=parseFloat(_)&&u++:M.type=="date"?(g=t.parseField(d,M.field+"_")instanceof Date?t.parseField(d,M.field+"_"):t.parseField(d,M.field),m=b.isDate(g,b.settings.dateFormat,!0),f=b.isDate(f,b.settings.dateFormat,!0),(_=b.isDate(_,b.settings.dateFormat,!0))!=null&&(_=new Date(_.getTime()+864e5)),m>=f&&m<_&&u++):M.type=="time"?(m=t.parseField(d,M.field+"_")instanceof Date?t.parseField(d,M.field+"_"):t.parseField(d,M.field),f=b.isTime(f,!0),_=b.isTime(_,!0),f=new Date().setHours(f.hours,f.minutes,f.seconds||0,0),_=new Date().setHours(_.hours,_.minutes,_.seconds||0,0),m>=f&&m<_&&u++):M.type=="datetime"&&(m=t.parseField(d,M.field+"_")instanceof Date?t.parseField(d,M.field+"_"):t.parseField(d,M.field),f=b.isDateTime(f,b.settings.datetimeFormat,!0),_=(_=b.isDateTime(_,b.settings.datetimeFormat,!0))&&new Date(_.getTime()+864e5),m>=f)&&m<_&&u++;break;case"<=":v=!0;case"<":case"less":["int","float","money","currency","percent"].indexOf(M.type)!=-1?(m=parseFloat(t.parseField(d,M.field)),f=parseFloat(R.value),(m<f||v&&m===f)&&u++):M.type=="date"?(g=t.parseField(d,M.field+"_")instanceof Date?t.parseField(d,M.field+"_"):t.parseField(d,M.field),m=b.isDate(g,b.settings.dateFormat,!0),f=b.isDate(f,b.settings.dateFormat,!0),(m<f||v&&m===f)&&u++):M.type=="time"?(g=t.parseField(d,M.field+"_")instanceof Date?t.parseField(d,M.field+"_"):t.parseField(d,M.field),m=b.formatTime(g,"hh24:mi"),f=b.formatTime(f,"hh24:mi"),(m<f||v&&m===f)&&u++):M.type=="datetime"&&(g=t.parseField(d,M.field+"_")instanceof Date?t.parseField(d,M.field+"_"):t.parseField(d,M.field),m=b.formatDateTime(g,"yyyy-mm-dd|hh24:mm:ss"),f=b.formatDateTime(b.isDateTime(f,b.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss"),m.length==f.length)&&(m<f||v&&m===f)&&u++;break;case">=":v=!0;case">":case"more":["int","float","money","currency","percent"].indexOf(M.type)!=-1?(m=parseFloat(t.parseField(d,M.field)),f=parseFloat(R.value),(m>f||v&&m===f)&&u++):M.type=="date"?(g=t.parseField(d,M.field+"_")instanceof Date?t.parseField(d,M.field+"_"):t.parseField(d,M.field),m=b.isDate(g,b.settings.dateFormat,!0),f=b.isDate(f,b.settings.dateFormat,!0),(m>f||v&&m===f)&&u++):M.type=="time"?(g=t.parseField(d,M.field+"_")instanceof Date?t.parseField(d,M.field+"_"):t.parseField(d,M.field),m=b.formatTime(g,"hh24:mi"),f=b.formatTime(f,"hh24:mi"),(m>f||v&&m===f)&&u++):M.type=="datetime"&&(g=t.parseField(d,M.field+"_")instanceof Date?t.parseField(d,M.field+"_"):t.parseField(d,M.field),m=b.formatDateTime(g,"yyyy-mm-dd|hh24:mm:ss"),f=b.formatDateTime(b.isDateTime(f,b.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss"),m.length==f.length)&&(m>f||v&&m===f)&&u++;break;case"in":g=R.value,(g=R.svalue?R.svalue:g).indexOf(b.isFloat(C)?parseFloat(C):C)===-1&&g.indexOf(m)===-1||u++;break;case"not in":g=R.value,(g=R.svalue?R.svalue:g).indexOf(b.isFloat(C)?parseFloat(C):C)===-1&&g.indexOf(m)===-1&&u++;break;case"begins":case"begins with":m.indexOf(f)===0&&u++;break;case"contains":0<=m.indexOf(f)&&u++;break;case"null":t.parseField(d,M.field)==null&&u++;break;case"not null":t.parseField(d,M.field)!=null&&u++;break;case"ends":case"ends with":let P=m.lastIndexOf(f);P!==-1&&P==m.length-f.length&&u++}}}if(t.last.logic=="OR"&&u!==0||t.last.logic=="AND"&&u==t.searchData.length)return!0;if((y=d.w2ui)!=null&&y.children&&((x=d.w2ui)==null?void 0:x.expanded)!==!0)for(let E=0;E<d.w2ui.children.length;E++){let R=d.w2ui.children[E];if(h(R))return!0}return!1}(n))if(n!=null&&n.w2ui&&function h(d){let u=t.get(d,!0);if(u==null||d==null||l[d]||t.last.searchIds.includes(u))return;l[d]=!0;let m=t.records[u];m!=null&&m.w2ui&&h(m.w2ui.parent_recid),t.last.searchIds.push(u)}(n.w2ui.parent_recid),0<this.showExtraOnSearch){let h=this.showExtraOnSearch,d=this.showExtraOnSearch;if(c<h&&(h=c),c+d>this.records.length&&(d=this.records.length-c),0<h)for(let u=c-h;u<c;u++)this.last.searchIds.indexOf(u)<0&&this.last.searchIds.push(u);if(this.last.searchIds.indexOf(c)<0&&this.last.searchIds.push(c),0<d)for(let u=c+1;u<=c+d;u++)this.last.searchIds.indexOf(u)<0&&this.last.searchIds.push(u)}else this.last.searchIds.push(c)}this.total=this.last.searchIds.length}return o=Date.now()-o,e!==!0&&this.show.statusSearch&&setTimeout(()=>{this.status(b.lang("Search took ${count} seconds",{count:o/1e3}))},10),o}}getRangeData(e,t){var i=this.get(e[0].recid,!0),n=this.get(e[1].recid,!0),r=e[0].column,o=e[1].column,a=[];if(r==o)for(let f=i;f<=n;f++){var l=this.records[f],c=l[this.columns[r].field]||null;a.push(t!==!0?c:{data:c,column:r,index:f,record:l})}else if(i==n){var h=this.records[i];for(let f=r;f<=o;f++){var d=h[this.columns[f].field]||null;a.push(t!==!0?d:{data:d,column:f,index:i,record:h})}}else for(let f=i;f<=n;f++){var u=this.records[f];a.push([]);for(let _=r;_<=o;_++){var m=u[this.columns[_].field];t!==!0?a[a.length-1].push(m):a[a.length-1].push({data:m,column:_,index:f,record:u})}}return a}addRange(e){let t=0,i,n;if(this.selectType!="row"){Array.isArray(e)||(e=[e]);for(let o=0;o<e.length;o++){if(typeof e[o]!="object"&&(e[o]={name:"selection"}),e[o].name=="selection"){if(this.show.selectionBorder===!1)continue;var r=this.getSelection();if(r.length===0){this.removeRange("selection");continue}i=r[0],n=r[r.length-1]}else i=e[o].range[0],n=e[o].range[1];if(i){r={name:e[o].name,range:[{recid:i.recid,column:i.column},{recid:n.recid,column:n.column}],style:e[o].style||""};let a=!1;for(let l=0;l<this.ranges.length;l++)if(this.ranges[l].name==e[o].name){a=l;break}a!==!1?this.ranges[a]=r:this.ranges.push(r),t++}}this.refreshRanges()}return t}removeRange(){let e=0;for(let i=0;i<arguments.length;i++){var t=arguments[i];p(this.box).find("#grid_"+this.name+"_"+t).remove(),p(this.box).find("#grid_"+this.name+"_f"+t).remove();for(let n=this.ranges.length-1;0<=n;n--)this.ranges[n].name==t&&(this.ranges.splice(n,1),e++)}return e}refreshRanges(){if(this.ranges.length!==0){let _=function(v){var y=u.last.move;if(y&&y.type=="expand"){y.divX=v.screenX-y.x,y.divY=v.screenY-y.y;let x,E,R=v.target;R.tagName.toUpperCase()!="TD"&&(R=p(R).closest("td")[0]),(E=p(R).attr("col")!=null?parseInt(p(R).attr("col")):E)!=null&&(R=p(R).closest("tr")[0],x=u.records[p(R).attr("index")].recid,y.newRange[1].recid!=x||y.newRange[1].column!=E)&&(v=b.clone(y.newRange),y.newRange=[{recid:y.recid,column:y.column},{recid:x,column:E}],f.detail&&(f.detail.newRange=b.clone(y.newRange),f.detail.originalRange=b.clone(y.originalRange)),(f=u.trigger("selectionExtend",f)).isCancelled===!0?(y.newRange=v,f.detail.newRange=v):(u.removeRange("grid-selection-expand"),u.addRange({name:"grid-selection-expand",range:y.newRange,style:"background-color: rgba(100,100,100,0.1); border: 2px dotted rgba(100,100,100,0.5);"})))}},g=function(v){u.removeRange("grid-selection-expand"),delete u.last.move,p("body").off(".w2ui-"+u.name),f.finish&&f.finish()},u=this,m;var e=Date.now(),t=p(this.box).find(`#grid_${this.name}_frecords`),i=p(this.box).find(`#grid_${this.name}_records`);for(let v=0;v<this.ranges.length;v++){var n=this.ranges[v],r=n.range[0],o=n.range[1];r.index==null&&(r.index=this.get(r.recid,!0)),o.index==null&&(o.index=this.get(o.recid,!0));let y=p(this.box).find("#grid_"+this.name+"_rec_"+b.escapeId(r.recid)+' td[col="'+r.column+'"]'),x=p(this.box).find("#grid_"+this.name+"_rec_"+b.escapeId(o.recid)+' td[col="'+o.column+'"]'),E=p(this.box).find("#grid_"+this.name+"_frec_"+b.escapeId(r.recid)+' td[col="'+r.column+'"]'),R=p(this.box).find("#grid_"+this.name+"_frec_"+b.escapeId(o.recid)+' td[col="'+o.column+'"]'),M=o.column;r.column<this.last.colStart&&o.column>this.last.colStart&&(y=p(this.box).find("#grid_"+this.name+"_rec_"+b.escapeId(r.recid)+' td[col="start"]')),r.column<this.last.colEnd&&o.column>this.last.colEnd&&(x=p(this.box).find("#grid_"+this.name+"_rec_"+b.escapeId(o.recid)+' td[col="end"]'),M='"end"');var c=parseInt(p(this.box).find("#grid_"+this.name+"_rec_top").next().attr("index")),h=parseInt(p(this.box).find("#grid_"+this.name+"_rec_bottom").prev().attr("index")),d=parseInt(p(this.box).find("#grid_"+this.name+"_frec_top").next().attr("index")),a=parseInt(p(this.box).find("#grid_"+this.name+"_frec_bottom").prev().attr("index"));y.length===0&&r.index<c&&o.index>c&&(y=p(this.box).find("#grid_"+this.name+"_rec_top").next().find('td[col="'+r.column+'"]')),x.length===0&&o.index>h&&r.index<h&&(x=p(this.box).find("#grid_"+this.name+"_rec_bottom").prev().find('td[col="'+M+'"]')),E.length===0&&r.index<d&&o.index>d&&(E=p(this.box).find("#grid_"+this.name+"_frec_top").next().find('td[col="'+r.column+'"]')),R.length===0&&o.index>a&&r.index<a&&(R=p(this.box).find("#grid_"+this.name+"_frec_bottom").prev().find('td[col="'+o.column+'"]'));var l,c=p(this.box).find("#grid_"+this.name+"_editable").find(".w2ui-input"),h=c.attr("recid"),d=c.attr("column");n.name=="selection"&&n.range[0].recid==h&&n.range[0].column==d||(m=p(this.box).find("#grid_"+this.name+"_f"+n.name),(0<E.length||0<R.length)&&(m.length===0?(t.append('<div id="grid_'+this.name+"_f"+n.name+'" class="w2ui-selection" style="'+n.style+'">'+(n.name=="selection"?'<div id="grid_'+this.name+'_resizer" class="w2ui-selection-resizer"></div>':"")+"</div>"),m=p(this.box).find("#grid_"+this.name+"_f"+n.name)):(m.attr("style",n.style),m.find(".w2ui-selection-resizer").show()),R.length===0&&((R=p(this.box).find("#grid_"+this.name+"_frec_"+b.escapeId(o.recid)+" td:last-child")).length===0&&(R=p(this.box).find("#grid_"+this.name+"_frec_bottom td:first-child")),m.css("border-right","0px"),m.find(".w2ui-selection-resizer").hide()),r.recid!=null)&&o.recid!=null&&0<E.length&&0<R.length?(a=getComputedStyle(R[0]),c=E.prop("offsetTop")-E.prop("scrollTop"),h=E.prop("offsetLeft")+E.prop("scrollLeft"),d=R.prop("offsetTop")-R.prop("scrollTop"),l=R.prop("offsetLeft")+R.prop("scrollLeft"),m.show().css({top:(0<c?c:0)+"px",left:(0<h?h:0)+"px",width:l-h+parseFloat(a.width)+2+"px",height:d-c+parseFloat(a.height)+1+"px"})):m.hide(),m=p(this.box).find("#grid_"+this.name+"_"+n.name),(0<y.length||0<x.length)&&(m.length===0?(i.append('<div id="grid_'+this.name+"_"+n.name+'" class="w2ui-selection" style="'+n.style+'">'+(n.name=="selection"?'<div id="grid_'+this.name+'_resizer" class="w2ui-selection-resizer"></div>':"")+"</div>"),m=p(this.box).find("#grid_"+this.name+"_"+n.name)):m.attr("style",n.style),y.length===0&&(y=p(this.box).find("#grid_"+this.name+"_rec_"+b.escapeId(r.recid)+" td:first-child")).length===0&&(y=p(this.box).find("#grid_"+this.name+"_rec_top td:first-child")),R.length!==0&&m.css("border-left","0px"),r.recid!=null)&&o.recid!=null&&0<y.length&&0<x.length?(l=getComputedStyle(x[0]),h=y.prop("offsetTop")-y.prop("scrollTop"),d=y.prop("offsetLeft")+y.prop("scrollLeft"),c=x.prop("offsetTop")-x.prop("scrollTop"),a=x.prop("offsetLeft")+x.prop("scrollLeft"),m.show().css({top:(0<h?h:0)+"px",left:(0<d?d:0)+"px",width:a-d+parseFloat(l.width)+2+"px",height:c-h+parseFloat(l.height)+1+"px"})):m.hide())}p(this.box).find(".w2ui-selection-resizer").off(".resizer").on("mousedown.resizer",function(v){var y=u.getSelection();u.last.move={type:"expand",x:v.screenX,y:v.screenY,divX:0,divY:0,recid:y[0].recid,column:y[0].column,originalRange:[b.clone(y[0]),b.clone(y[y.length-1])],newRange:[b.clone(y[0]),b.clone(y[y.length-1])]},p("body").off(".w2ui-"+u.name).on("mousemove.w2ui-"+u.name,_).on("mouseup.w2ui-"+u.name,g),v.preventDefault()}).on("dblclick.resizer",v=>{v=this.trigger("resizerDblClick",{target:this.name,originalEvent:v}),v.isCancelled!==!0&&v.finish()});let f={target:this.name,originalRange:null,newRange:null};return Date.now()-e}}select(){if(arguments.length===0)return 0;let e=0;var t=this.last.selection;this.multiSelect||this.selectNone(!0);let i=Array.from(arguments);Array.isArray(i[0])&&(i=i[0]);var n={target:this.name},n=(i.length==1?(n.multiple=!1,b.isPlainObject(i[0])?n.clicked={recid:i[0].recid,column:i[0].column}:n.recid=i[0]):(n.multiple=!0,n.clicked={recids:i}),this.trigger("select",n));if(n.isCancelled===!0)return 0;if(this.selectType=="row")for(let v=0;v<i.length;v++){var r=typeof i[v]=="object"?i[v].recid:i[v],o=this.get(r,!0);if(o!=null){let y=null,x=null;(this.searchData.length!==0||o+1>=this.last.range_start&&o+1<=this.last.range_end)&&(y=p(this.box).find("#grid_"+this.name+"_frec_"+b.escapeId(r)),x=p(this.box).find("#grid_"+this.name+"_rec_"+b.escapeId(r))),this.selectType=="row"&&t.indexes.indexOf(o)==-1&&(t.indexes.push(o),y&&x&&(y.addClass("w2ui-selected").find(".w2ui-col-number").addClass("w2ui-row-selected"),x.addClass("w2ui-selected").find(".w2ui-col-number").addClass("w2ui-row-selected"),y.find(".w2ui-grid-select-check").prop("checked",!0)),e++)}}else{var a={};for(let v=0;v<i.length;v++){var l=typeof i[v]=="object"?i[v].recid:i[v],c=typeof i[v]=="object"?i[v].column:null;if(a[l]=a[l]||[],Array.isArray(c))a[l]=c;else if(b.isInt(c))a[l].push(c);else for(let y=0;y<this.columns.length;y++)this.columns[y].hidden||a[l].push(parseInt(y))}var h,d=[];for(h in a){var u=this.get(h,!0);if(u!=null){let v=null,y=null;u+1>=this.last.range_start&&u+1<=this.last.range_end&&(v=p(this.box).find("#grid_"+this.name+"_rec_"+b.escapeId(h)),y=p(this.box).find("#grid_"+this.name+"_frec_"+b.escapeId(h)));var m=t.columns[u]||[];t.indexes.indexOf(u)==-1&&t.indexes.push(u);for(let x=0;x<a[h].length;x++)m.indexOf(a[h][x])==-1&&m.push(a[h][x]);m.sort((x,E)=>x-E);for(let x=0;x<a[h].length;x++){var f=a[h][x];d.indexOf(f)==-1&&d.push(f),v&&(v.find("#grid_"+this.name+"_data_"+u+"_"+f).addClass("w2ui-selected"),v.find(".w2ui-col-number").addClass("w2ui-row-selected"),v.find(".w2ui-grid-select-check").prop("checked",!0)),y&&(y.find("#grid_"+this.name+"_data_"+u+"_"+f).addClass("w2ui-selected"),y.find(".w2ui-col-number").addClass("w2ui-row-selected"),y.find(".w2ui-grid-select-check").prop("checked",!0)),e++}t.columns[u]=m}}for(let v=0;v<d.length;v++)p(this.box).find("#grid_"+this.name+"_column_"+d[v]+" .w2ui-col-header").addClass("w2ui-col-selected")}t.indexes.sort((v,y)=>v-y);var _=0<this.records.length&&t.indexes.length==this.records.length,g=0<t.indexes.length&&this.searchData.length!==0&&t.indexes.length==this.last.searchIds.length;return _||g?p(this.box).find("#grid_"+this.name+"_check_all").prop("checked",!0):p(this.box).find("#grid_"+this.name+"_check_all").prop("checked",!1),this.status(),this.addRange("selection"),this.updateToolbar(t,_),n.finish(),e}unselect(){let e=0;var t=this.last.selection;let i=Array.from(arguments);Array.isArray(i[0])&&(i=i[0]);var n={target:this.name},n=(i.length==1?(n.multiple=!1,b.isPlainObject(i[0])?n.clicked={recid:i[0].recid,column:i[0].column}:n.clicked={recid:i[0]}):(n.multiple=!0,n.recids=i),this.trigger("select",n));if(n.isCancelled===!0)return 0;for(let f=0;f<i.length;f++){var r=typeof i[f]=="object"?i[f].recid:i[f],o=this.get(r);if(o!=null){var o=this.get(o.recid,!0),a=p(this.box).find("#grid_"+this.name+"_frec_"+b.escapeId(r)),l=p(this.box).find("#grid_"+this.name+"_rec_"+b.escapeId(r));if(this.selectType=="row")t.indexes.indexOf(o)!=-1&&(t.indexes.splice(t.indexes.indexOf(o),1),a.removeClass("w2ui-selected w2ui-inactive").find(".w2ui-col-number").removeClass("w2ui-row-selected"),l.removeClass("w2ui-selected w2ui-inactive").find(".w2ui-col-number").removeClass("w2ui-row-selected"),a.length!=0&&(a[0].style.cssText="height: "+this.recordHeight+"px; "+a.attr("custom_style"),l[0].style.cssText="height: "+this.recordHeight+"px; "+l.attr("custom_style")),a.find(".w2ui-grid-select-check").prop("checked",!1),e++);else{var c=i[f].column;if(!b.isInt(c)){var h=[];for(let g=0;g<this.columns.length;g++)this.columns[g].hidden||h.push({recid:r,column:g});return this.unselect(h)}if(l=t.columns[o],Array.isArray(l)&&l.indexOf(c)!=-1){l.splice(l.indexOf(c),1),p(this.box).find(`#grid_${this.name}_rec_${b.escapeId(r)} > td[col="${c}"]`).removeClass("w2ui-selected w2ui-inactive"),p(this.box).find(`#grid_${this.name}_frec_${b.escapeId(r)} > td[col="${c}"]`).removeClass("w2ui-selected w2ui-inactive");let g=!1,v=!1;var d=this.getSelection();for(let y=0;y<d.length;y++)d[y].column==c&&(g=!0),d[y].recid==r&&(v=!0);g||p(this.box).find(`.w2ui-grid-columns td[col="${c}"] .w2ui-col-header, .w2ui-grid-fcolumns td[col="${c}"] .w2ui-col-header`).removeClass("w2ui-col-selected"),v||p(this.box).find("#grid_"+this.name+"_frec_"+b.escapeId(r)).find(".w2ui-col-number").removeClass("w2ui-row-selected"),e++,l.length===0&&(delete t.columns[o],t.indexes.splice(t.indexes.indexOf(o),1),a.find(".w2ui-grid-select-check").prop("checked",!1))}}}}var u=0<this.records.length&&t.indexes.length==this.records.length,m=0<t.indexes.length&&this.searchData.length!==0&&t.indexes.length==this.last.searchIds.length;return u||m?p(this.box).find("#grid_"+this.name+"_check_all").prop("checked",!0):p(this.box).find("#grid_"+this.name+"_check_all").prop("checked",!1),this.status(),this.addRange("selection"),this.updateToolbar(t,u),n.finish(),e}selectAll(){var n;var e=Date.now();if(this.multiSelect!==!1){var t=((n=this.url)==null?void 0:n.get)??this.url;let r=b.clone(this.last.selection);var i=[];for(let o=0;o<this.columns.length;o++)i.push(o);if(r.indexes=[],t||this.searchData.length===0){let o=this.records.length;this.searchData.length==0||t||(o=this.last.searchIds.length);for(let a=0;a<o;a++)r.indexes.push(a),this.selectType!="row"&&(r.columns[a]=i.slice())}else for(let o=0;o<this.last.searchIds.length;o++)r.indexes.push(this.last.searchIds[o]),this.selectType!="row"&&(r.columns[this.last.searchIds[o]]=i.slice());if(t=this.trigger("select",{target:this.name,multiple:!0,all:!0,clicked:r}),t.isCancelled!==!0)return this.last.selection=r,this.selectType=="row"?(p(this.box).find(".w2ui-grid-records tr:not(.w2ui-empty-record)").addClass("w2ui-selected").find(".w2ui-col-number").addClass("w2ui-row-selected"),p(this.box).find(".w2ui-grid-frecords tr:not(.w2ui-empty-record)").addClass("w2ui-selected").find(".w2ui-col-number").addClass("w2ui-row-selected")):(p(this.box).find(".w2ui-grid-columns td .w2ui-col-header, .w2ui-grid-fcolumns td .w2ui-col-header").addClass("w2ui-col-selected"),p(this.box).find(".w2ui-grid-records tr .w2ui-col-number").addClass("w2ui-row-selected"),p(this.box).find(".w2ui-grid-records tr:not(.w2ui-empty-record)").find(".w2ui-grid-data:not(.w2ui-col-select)").addClass("w2ui-selected"),p(this.box).find(".w2ui-grid-frecords tr .w2ui-col-number").addClass("w2ui-row-selected"),p(this.box).find(".w2ui-grid-frecords tr:not(.w2ui-empty-record)").find(".w2ui-grid-data:not(.w2ui-col-select)").addClass("w2ui-selected")),p(this.box).find("input.w2ui-grid-select-check").prop("checked",!0),r=this.getSelection(!0),this.addRange("selection"),p(this.box).find("#grid_"+this.name+"_check_all").prop("checked",!0),this.status(),this.updateToolbar({indexes:r},!0),t.finish(),Date.now()-e}}selectNone(e){var t,i=Date.now();let n;if(e||(n=this.trigger("select",{target:this.name,clicked:[]})).isCancelled!==!0)return t=this.last.selection,this.selectType=="row"?(p(this.box).find(".w2ui-grid-records tr.w2ui-selected").removeClass("w2ui-selected w2ui-inactive").find(".w2ui-col-number").removeClass("w2ui-row-selected"),p(this.box).find(".w2ui-grid-frecords tr.w2ui-selected").removeClass("w2ui-selected w2ui-inactive").find(".w2ui-col-number").removeClass("w2ui-row-selected")):(p(this.box).find(".w2ui-grid-columns td .w2ui-col-header, .w2ui-grid-fcolumns td .w2ui-col-header").removeClass("w2ui-col-selected"),p(this.box).find(".w2ui-grid-records tr .w2ui-col-number").removeClass("w2ui-row-selected"),p(this.box).find(".w2ui-grid-frecords tr .w2ui-col-number").removeClass("w2ui-row-selected"),p(this.box).find(".w2ui-grid-data.w2ui-selected").removeClass("w2ui-selected w2ui-inactive")),p(this.box).find("input.w2ui-grid-select-check").prop("checked",!1),t.indexes=[],t.columns={},this.removeRange("selection"),p(this.box).find("#grid_"+this.name+"_check_all").prop("checked",!1),this.status(),this.updateToolbar(t,!1),e||n.finish(),Date.now()-i}updateToolbar(e){let t=this,i=e&&e.indexes?e.indexes.length:0;function n(r,o){if(r.batch!=null){let a=!1;r.batch===!0?0<i&&(a=!0):typeof r.batch=="number"?i===r.batch&&(a=!0):typeof r.batch=="function"&&(a=r.batch({cnt:i,sel:e})),a?t.toolbar.enable(o+r.id):t.toolbar.disable(o+r.id)}}this.toolbar.items.forEach(r=>{n(r,""),Array.isArray(r.items)&&r.items.forEach(o=>{n(o,r.id+":")})}),this.show.toolbarSave&&(0<this.getChanges().length?this.toolbar.enable("w2ui-save"):this.toolbar.disable("w2ui-save"))}getSelection(e){var t=[],i=this.last.selection;if(this.selectType=="row")for(let r=0;r<i.indexes.length;r++)this.records[i.indexes[r]]&&t.push(e===!0?i.indexes[r]:this.records[i.indexes[r]].recid);else for(let r=0;r<i.indexes.length;r++){var n=i.columns[i.indexes[r]];if(this.records[i.indexes[r]])for(let o=0;o<n.length;o++)t.push({recid:this.records[i.indexes[r]].recid,index:parseInt(i.indexes[r]),column:n[o]})}return t}search(e,t){var w;var i=((w=this.url)==null?void 0:w.get)??this.url,n=[];let r=this.last.multi,o=this.last.logic,a=this.last.field,l=this.last.search,c=!1;var h=p(`#w2overlay-${this.name}-search-overlay`);for(let S=0;S<this.searches.length;S++)this.searches[S].hidden&&this.searches[S].value!=null&&(n.push({field:this.searches[S].field,operator:this.searches[S].operator||"is",type:this.searches[S].type,value:this.searches[S].value||""}),c=!0);if(arguments.length===0&&h.length===0&&(t=this.multiSearch?(e=this.searchData,this.last.logic):(e=this.last.field,this.last.search)),arguments.length===0&&h.length!==0){this.focus(),o=h.find(`#grid_${this.name}_logic`).val(),l="";for(let S=0;S<this.searches.length;S++){var d=this.searches[S],u=h.find("#grid_"+this.name+"_operator_"+S).val(),m=h.find("#grid_"+this.name+"_field_"+S),f=h.find("#grid_"+this.name+"_field2_"+S);let D=m.val(),I=f.val(),V=null,q=null;if(["int","float","money","currency","percent"].indexOf(d.type)!=-1&&(_=m[0]._w2field,f=f[0]._w2field,_&&(D=_.clean(D)),f)&&(I=f.clean(I)),["list","enum"].indexOf(d.type)!=-1||["in","not in"].indexOf(u)!=-1)if(D=m[0]._w2field.selected||{},Array.isArray(D)){V=[];for(let H=0;H<D.length;H++)V.push(b.isFloat(D[H].id)?parseFloat(D[H].id):String(D[H].id).toLowerCase()),delete D[H].hidden;Object.keys(D).length===0&&(D="")}else q=D.text||"",D=D.id||"";if(D!==""&&D!=null||I!=null&&I!==""){var _={field:d.field,type:d.type,operator:u};u=="between"?b.extend(_,{value:[D,I]}):u=="in"&&typeof D=="string"||u=="not in"&&typeof D=="string"?b.extend(_,{value:D.split(",")}):b.extend(_,{value:D}),V&&b.extend(_,{svalue:V}),q&&b.extend(_,{text:q});try{d.type=="date"&&u=="between"&&(_.value[0]=D,_.value[1]=I),d.type=="date"&&u=="is"&&(_.value=D)}catch{}n.push(_),r=!0}}}if(typeof e=="string"&&(arguments.length==1&&(t=e,e="all"),a=e,l=t,r=!1,o=c?"AND":"OR",t!=null))if(e.toLowerCase()=="all")if(0<this.searches.length)for(let S=0;S<this.searches.length;S++){var g,v=this.searches[S];if((v.type=="text"||v.type=="alphanumeric"&&b.isAlphaNumeric(t)||v.type=="int"&&b.isInt(t)||v.type=="float"&&b.isFloat(t)||v.type=="percent"&&b.isFloat(t)||(v.type=="hex"||v.type=="color")&&b.isHex(t)||v.type=="currency"&&b.isMoney(t)||v.type=="money"&&b.isMoney(t)||v.type=="date"&&b.isDate(t)||v.type=="time"&&b.isTime(t)||v.type=="datetime"&&b.isDateTime(t)||v.type=="datetime"&&b.isDate(t)||v.type=="enum"&&b.isAlphaNumeric(t)||v.type=="list"&&b.isAlphaNumeric(t))&&(g=this.defaultOperator[this.operatorsMap[v.type]],g={field:v.field,type:v.type,operator:v.operator!=null?v.operator:g,value:t},String(t).trim()!="")&&n.push(g),["int","float","money","currency","percent"].indexOf(v.type)!=-1&&String(t).trim().split("-").length==2&&(g=String(t).trim().split("-"),y={field:v.field,type:v.type,operator:v.operator!=null?v.operator:"between",value:[g[0],g[1]]},n.push(y)),["list","enum"].indexOf(v.type)!=-1){var y,x=[];v.options==null&&(v.options={}),Array.isArray(v.options.items)||(v.options.items=[]);for(let D=0;D<v.options.items;D++){var E=v.options.items[D];try{var R=new RegExp(t,"i");R.test(E)&&x.push(D),E.text&&R.test(E.text)&&x.push(E.id)}catch{}}0<x.length&&(y={field:v.field,type:v.type,operator:v.operator!=null?v.operator:"in",value:x},n.push(y))}}else for(let S=0;S<this.columns.length;S++){var M={field:this.columns[S].field,type:"text",operator:this.defaultOperator.text,value:t};n.push(M)}else{var C=h.find("#grid_"+this.name+"_search_all");let S=this.getSearch(e);if((S=S??{field:e,type:"text"}).field==e&&(this.last.label=S.label),t!==""){let D=this.defaultOperator[this.operatorsMap[S.type]],I=t;if(["date","time","datetime"].indexOf(S.type)!=-1&&(D="is"),["list","enum"].indexOf(S.type)!=-1&&(D="is",C=C._w2field.get(),I=C&&0<Object.keys(C).length?C.id:""),S.type=="int"&&t!==""&&(D="is",String(t).indexOf("-")!=-1&&(C=t.split("-")).length==2&&(D="between",I=[parseInt(C[0]),parseInt(C[1])]),String(t).indexOf(",")!=-1)){var P=t.split(",");D="in",I=[];for(let V=0;V<P.length;V++)I.push(P[V])}S.operator!=null&&(D=S.operator),C={field:S.field,type:S.type,operator:D,value:I},n.push(C)}}if(Array.isArray(e)){let S="AND";typeof t=="string"&&(S=t.toUpperCase())!="OR"&&S!="AND"&&(S="AND"),l="",r=!0,o=S;for(let D=0;D<e.length;D++){var N=e[D];typeof N.value=="number"&&N.operator==null&&(N.operator=this.defaultOperator.number),typeof N.value=="string"&&N.operator==null&&(N.operator=this.defaultOperator.text),Array.isArray(N.value)&&N.operator==null&&(N.operator=this.defaultOperator.enum),b.isDate(N.value)&&N.operator==null&&(N.operator=this.defaultOperator.date),n.push(N)}}C=this.trigger("search",{target:this.name,multi:arguments.length===0,searchField:e||"multi",searchValue:e?t:"multi",searchData:n,searchLogic:o}),C.isCancelled!==!0&&(this.searchData=C.detail.searchData,this.last.field=a,this.last.search=l,this.last.multi=r,this.last.logic=C.detail.searchLogic,this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selection.indexes=[],this.last.selection.columns={},this.searchClose(),i?(this.last.fetch.offset=0,this.reload()):(this.localSearch(),this.refresh()),C.finish())}searchOpen(){if(this.box&&this.searches.length!==0){let e=this.trigger("searchOpen",{target:this.name});if(e.isCancelled!==!0){let t=p(this.toolbar.box).find(".w2ui-grid-search-input .w2ui-search-drop");t.addClass("checked"),Ne.show({name:this.name+"-search-overlay",anchor:p(this.box).find("#grid_"+this.name+"_search_all").get(0),position:"bottom|top",html:this.getSearchesHTML(),align:"left",arrowSize:12,class:"w2ui-grid-search-advanced",hideOn:["doc-click"]}).then(i=>{this.initSearches(),this.last.search_opened=!0;let n=p(`#w2overlay-${this.name}-search-overlay`);n.data("gridName",this.name).off(".grid-search").on("click.grid-search",()=>{n.find("input, select").each(o=>{o=p(o).data("tooltipName"),o&&o.forEach(a=>{Ne.hide(a)})})}),b.bindEvents(n.find("select, input, button"),this);var r=p(`#w2overlay-${this.name}-search-overlay *[rel=search]`);0<r.length&&r[0].focus(),e.finish()}).hide(i=>{t.removeClass("checked"),this.last.search_opened=!1})}}}searchClose(){Ne.hide(this.name+"-search-overlay")}searchFieldTooltip(n,t,i){var n=this.searches[n],r=this.searchData[t];let o=r.operator,a=((o=o=="more"&&r.type=="date"?"since":o)=="less"&&r.type=="date"&&(o="before"),""),l=r.value;Array.isArray(r.value)?(r.value.forEach(c=>{a+=`<span class="value">${c.text||c}</span>`}),r.type=="date"&&(a="",r.value.forEach(c=>{a+=`<span class="value">${b.formatDate(c)}</span>`}))):r.type=="date"&&(l=b.formatDateTime(l)),Ne.hide(this.name+"-search-props"),Ne.show({name:this.name+"-search-props",anchor:i,class:"w2ui-white",hideOn:"doc-click",html:`
                <div class="w2ui-grid-search-single">
                    <span class="field">${n.label}</span>
                    <span class="operator">${b.lang(o)}</span>
                    ${Array.isArray(r.value)?""+a:`<span class="value">${l}</span>`}
                    <div class="buttons">
                        <button id="remove" class="w2ui-btn">${b.lang("Remove This Field")}</button>
                    </div>
                </div>`}).then(c=>{p(c.detail.overlay.box).find("#remove").on("click",()=>{this.searchData.splice(""+t,1),this.reload(),this.localSearch(),Ne.hide(this.name+"-search-props")})})}searchSuggest(e,t,i){var n,r;clearTimeout(this.last.kbd_timer),clearTimeout(this.last.overlay_timer),this.searchShowFields(!0),this.searchClose(),t===!0?Ne.hide(this.name+"-search-suggest"):0<p(`#w2overlay-${this.name}-search-suggest`).length||(e?(t=p(this.box).find(`#grid_${this.name}_search_all`).get(0),e=[...this.defaultSearches??[],...0<((n=this.defaultSearches)==null?void 0:n.length)&&0<((r=this.savedSearches)==null?void 0:r.length)?["--"]:[],...this.savedSearches??[]],Array.isArray(e)&&0<e.length&&Ot.show({name:this.name+"-search-suggest",anchor:t,align:"both",items:e,hideOn:["doc-click","sleect","remove"],render(o){let a=o.text;return a=o.isDefault?`<b>${a}</b>`:a}}).select(o=>{var a=this.trigger("searchSelect",{target:this.name,index:o.detail.index,item:o.detail.item});a.isCancelled===!0?o.preventDefault():(o.detail.overlay.hide(),this.last.logic=o.detail.item.logic||"AND",this.last.search="",this.last.label="[Multiple Fields]",this.searchData=b.clone(o.detail.item.data),this.searchSelected=b.clone(o.detail.item,{exclude:["icon","remove"]}),this.reload(),a.finish())}).remove(o=>{let a=o.detail.item,l=this.trigger("searchRemove",{target:this.name,index:o.detail.index,item:a});l.isCancelled===!0?o.preventDefault():(o.detail.overlay.hide(),this.confirm(b.lang('Do you want to delete search "${item}"?',{item:a.text})).yes(c=>{var h=this.savedSearches.findIndex(d=>d.id==a.id);h!==-1&&this.savedSearches.splice(h,1),this.cacheSave("searches",this.savedSearches.map(d=>b.clone(d,{exclude:["remove","icon"]}))),c.detail.self.close(),l.finish()}).no(c=>{c.detail.self.close()}))})):this.last.overlay_timer=setTimeout(()=>{this.searchSuggest(!0)},100))}searchSave(){let e="",t=(this.searchSelected&&(e=this.searchSelected.text),this.savedSearches.findIndex(n=>{var r;return n.id==((r=this.searchSelected)==null?void 0:r.id)})),i=this.trigger("searchSave",{target:this.name,saveLocalStorage:!0});i.isCancelled!==!0&&this.message({width:350,height:150,body:`<div class="w2ui-grid-save-search">
                        <span>${b.lang(t!=-1?"Update Search":"Save New Search")}</span>
                        <input class="search-name w2ui-input" placeholder="${b.lang("Search name")}">
                   </div>`,buttons:`
                <button id="grid-search-cancel" class="w2ui-btn">${b.lang("Cancel")}</button>
                <button id="grid-search-save" class="w2ui-btn w2ui-btn-blue" ${String(e).trim()==""?"disabled":""}>${b.lang("Save")}</button>
            `}).open(async n=>{p(n.detail.box).find("input, button").eq(0).val(e),await n.complete,p(n.detail.box).find("#grid-search-cancel").on("click",()=>{this.message()}),p(n.detail.box).find("#grid-search-save").on("click",()=>{var r=p(n.detail.box).find(".w2ui-message .search-name").val();this.searchSelected&&t!=-1?Object.assign(this.savedSearches[t],{id:r,text:r,logic:this.last.logic,data:b.clone(this.searchData)}):this.savedSearches.push({id:r,text:r,icon:"w2ui-icon-search",remove:!0,logic:this.last.logic,data:this.searchData}),this.cacheSave("searches",this.savedSearches.map(o=>b.clone(o,{exclude:["remove","icon"]}))),this.message(),(this.searchSelected?(this.searchSelected.text=r,p(this.box).find(`#grid_${this.name}_search_name .name-text`)):(this.searchSelected={text:r,logic:this.last.logic,data:b.clone(this.searchData)},p(n.detail.box).find(`#grid_${this.name}_search_all`).val(" ").prop("readOnly",!0),p(n.detail.box).find(`#grid_${this.name}_search_name`).show().find(".name-text"))).html(r),i.finish({name:r})}),p(n.detail.box).find("input, button").off(".message").on("keydown.message",r=>{var o=String(p(n.detail.box).find(".w2ui-message-body input").val()).trim();r.keyCode==13&&o!=""&&p(n.detail.box).find("#grid-search-save").trigger("click"),r.keyCode==27&&this.message()}).eq(0).on("input.message",r=>{var o=p(n.detail.box).closest(".w2ui-message").find("#grid-search-save");String(p(n.detail.box).val()).trim()===""?o.prop("disabled",!0):o.prop("disabled",!1)}).get(0).focus()})}cache(e){var i;if(b.hasLocalStorage&&this.useLocalStorage)try{var t=JSON.parse(localStorage.w2ui||"{}");return t[i=this.stateId||this.name]??(t[i]={}),t[this.stateId||this.name][e]}catch{}return null}cacheSave(e,t){var n;if(b.hasLocalStorage&&this.useLocalStorage)try{var i=JSON.parse(localStorage.w2ui||"{}");return i[n=this.stateId||this.name]??(i[n]={}),i[this.stateId||this.name][e]=t,localStorage.w2ui=JSON.stringify(i),!0}catch{delete localStorage.w2ui}return!1}searchReset(e){var t=[];let i=!1;for(let o=0;o<this.searches.length;o++)this.searches[o].hidden&&this.searches[o].value!=null&&(t.push({field:this.searches[o].field,operator:this.searches[o].operator||"is",type:this.searches[o].type,value:this.searches[o].value||""}),i=!0);var n=this.trigger("search",{reset:!0,target:this.name,searchData:t});if(n.isCancelled!==!0){var r=p(this.box).find("#grid_"+this.name+"_search_all");if(this.searchData=n.detail.searchData,this.searchSelected=null,this.last.search="",this.last.logic=i?"AND":"OR",r.next().hide(),0<this.searches.length)if(this.multiSearch&&this.show.searchAll)this.last.field="all",this.last.label="All Fields",r.next().show();else{let o=0;for(;o<this.searches.length&&(this.searches[o].hidden||this.searches[o].simple===!1);)o++;o>=this.searches.length?(this.last.field="",this.last.label=""):(this.last.field=this.searches[o].field,this.last.label=this.searches[o].label)}this.last.multi=!1,this.last.fetch.offset=0,this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selection.indexes=[],this.last.selection.columns={},this.searchClose(),r=r.val("").get(0),r!=null&&r._w2field&&r._w2field.reset(),e||this.reload(),n.finish()}}searchShowFields(e){if(e===!0)Ne.hide(this.name+"-search-fields");else{var t=[];for(let n=-1;n<this.searches.length;n++){let r=this.searches[n];var i=r?r.field:null,i=this.getColumn(i);let o=!1,a=null;if(this.show.searchHiddenMsg==1&&n!=-1&&(i==null||i.hidden===!0&&i.hideable!==!1)&&(o=!0,a=b.lang("This column "+(i==null?"does not exist":"is hidden"))),n==-1){if(!this.multiSearch||!this.show.searchAll)continue;r={field:"all",label:"All Fields"}}else if(i!=null&&i.hideable===!1||r.hidden===!0&&(a=b.lang("This column is hidden"),r.simple===!1))continue;r.label==null&&r.caption!=null&&(console.log("NOTICE: grid search.caption property is deprecated, please use search.label. Search ->",r),r.label=r.caption),t.push({id:r.field,text:b.lang(r.label),search:r,tooltip:a,disabled:o,checked:r.field==this.last.field})}Ot.show({type:"radio",name:this.name+"-search-fields",anchor:p(this.box).find("#grid_"+this.name+"_search_name").parent().find(".w2ui-search-down").get(0),items:t,align:"none",hideOn:["doc-click","select"]}).select(n=>{this.searchInitInput(n.detail.item.search.field)})}}searchInitInput(e,t){let i;var n=p(this.box).find("#grid_"+this.name+"_search_all");if(e=="all")i={field:"all",label:b.lang("All Fields")};else if((i=this.getSearch(e))==null)return;this.last.search!=""?(this.last.label=i.label,this.search(i.field,this.last.search)):(this.last.field=i.field,this.last.label=i.label),n.attr("placeholder",b.lang("Search")+" "+b.lang(i.label||i.caption||i.field,!0))}clear(e){this.total=0,this.records=[],this.summary=[],this.last.fetch.offset=0,this.last.idCache={},this.last.selection={indexes:[],columns:{}},this.reset(!0),e||this.refresh()}reset(e){this.last.scrollTop=0,this.last.scrollLeft=0,this.last.range_start=null,this.last.range_end=null,p(this.box).find(`#grid_${this.name}_records`).prop("scrollTop",0),e||this.refresh()}skip(e,t){var i;((i=this.url)==null?void 0:i.get)??this.url?(this.offset=parseInt(e),this.offset>this.total&&(this.offset=this.total-this.limit),(this.offset<0||!b.isInt(this.offset))&&(this.offset=0),this.clear(!0),this.reload(t)):console.log("ERROR: grid.skip() can only be called when you have remote data source.")}load(e,t){return e==null?(console.log('ERROR: You need to provide url argument when calling .load() method of "'+this.name+'" object.'),new Promise((i,n)=>{n()})):(this.clear(!0),this.request("load",{},e,t))}reload(e){var n;let t=this;var i=((n=this.url)==null?void 0:n.get)??this.url;return t.selectionSave(),i?this.load(i,()=>{t.selectionRestore(),typeof e=="function"&&e()}):(this.reset(!0),this.localSearch(),this.selectionRestore(),typeof e=="function"&&e({status:"success"}),new Promise(r=>{r()}))}request(e,t,i,n){let r=this,o,a;var l=new Promise((m,f)=>{o=m,a=f});if(t==null&&(t={}),!(i=i||this.url))return new Promise((m,f)=>{f()});b.isInt(this.offset)||(this.offset=0),b.isInt(this.last.fetch.offset)||(this.last.fetch.offset=0);let c;var h={limit:this.limit,offset:parseInt(this.offset)+parseInt(this.last.fetch.offset),searchLogic:this.last.logic,search:this.searchData.map(m=>(m=b.clone(m),this.searchMap&&this.searchMap[m.field]&&(m.field=this.searchMap[m.field]),m)),sort:this.sortData.map(m=>(m=b.clone(m),this.sortMap&&this.sortMap[m.field]&&(m.field=this.sortMap[m.field]),m))};if(this.searchData.length===0&&(delete h.search,delete h.searchLogic),this.sortData.length===0&&delete h.sort,b.extend(h,this.postData),b.extend(h,t),e!="delete"&&e!="save"||(delete h.limit,delete h.offset,(h.action=e)=="delete"&&(h[this.recid||"recid"]=this.getSelection())),e=="load"){if((c=this.trigger("request",{target:this.name,url:i,postData:h,httpMethod:"GET",httpHeaders:this.httpHeaders})).isCancelled===!0)return new Promise((m,f)=>{f()})}else c={detail:{url:i,postData:h,httpMethod:e=="save"?"PUT":"DELETE",httpHeaders:this.httpHeaders}};if(this.last.fetch.offset===0&&this.lock(b.lang(this.msgRefresh),!0),this.last.fetch.controller)try{this.last.fetch.controller.abort()}catch{}switch(i=c.detail.url,e){case"save":i!=null&&i.save&&(i=i.save);break;case"delete":i!=null&&i.remove&&(i=i.remove);break;default:i=(i==null?void 0:i.get)??i}if(0<Object.keys(this.routeData).length){var d=b.parseRoute(i);if(0<d.keys.length)for(let m=0;m<d.keys.length;m++)this.routeData[d.keys[m].name]!=null&&(i=i.replace(new RegExp(":"+d.keys[m].name,"g"),this.routeData[d.keys[m].name]))}return i=new URL(i,location),t=b.prepareParams(i,{method:c.detail.httpMethod,headers:c.detail.httpHeaders,body:c.detail.postData},this.dataType),Object.assign(this.last.fetch,{action:e,options:t,controller:new AbortController,start:Date.now(),loaded:!1}),t.signal=this.last.fetch.controller.signal,fetch(i,t).catch(u).then(m=>{m!=null&&((m==null?void 0:m.status)!=200?u(m??{}):(r.unlock(),m.json().catch(u).then(f=>{this.requestComplete(f,e,n,o,a)})))}),e=="load"&&c.finish(),l;function u(m){var f;(m==null?void 0:m.name)!=="AbortError"&&(r.unlock(),(f=r.trigger("error",{response:m,lastFetch:r.last.fetch})).isCancelled!==!0)&&(m.status&&m.status!=200?r.error(m.status+": "+m.statusText):(console.log("ERROR: Server communication failed.",`
   EXPECTED:`,{total:5,records:[{recid:1,field:"value"}]},`
         OR:`,{error:!0,message:"error message"}),r.requestComplete({error:!0,message:b.lang(this.msgHTTPError),response:m},e,n,o,a)),f.finish())}}requestComplete(e,t,i,n,r){var c;let o=e.error??!1,a=(e.error==null&&e.status==="error"&&(o=!0),this.last.fetch.response=(Date.now()-this.last.fetch.start)/1e3,setTimeout(()=>{this.show.statusResponse&&this.status(b.lang("Server Response ${count} seconds",{count:this.last.fetch.response}))},10),this.last.pull_more=!1,this.last.pull_refresh=!0,"load");this.last.fetch.action=="save"&&(a="save"),this.last.fetch.action=="delete"&&(a="delete");var l=this.trigger(a,{target:this.name,error:o,data:e,lastFetch:this.last.fetch});if(l.isCancelled===!0)r();else{if(o)this.error(b.lang(e.message??this.msgServerError)),r(e);else if(typeof this.parser=="function"?typeof(e=this.parser(e))!="object"&&console.log("ERROR: Your parser did not return proper object"):e==null?e={error:!0,message:b.lang(this.msgNotJSON)}:Array.isArray(e)&&(e={error:o,records:e,total:e.length}),t=="load"){if(e.total==null&&(e.total=-1),e.records==null&&(e.records=[]),e.records.length==this.limit?(r=this.records.length+e.records.length,this.last.fetch.hasMore=r!=this.total):(this.last.fetch.hasMore=!1,this.total=this.offset+this.last.fetch.offset+e.records.length),this.last.fetch.hasMore||p(this.box).find("#grid_"+this.name+"_rec_more, #grid_"+this.name+"_frec_more").hide(),this.last.fetch.offset===0)this.records=[],this.summary=[];else if(e.total!=-1&&parseInt(e.total)!=parseInt(this.total)){let h=this;return this.message(b.lang(this.msgNeedReload)).ok(()=>{delete h.last.fetch.offset,h.reload()}),new Promise(d=>{d()})}b.isInt(e.total)&&(this.total=parseInt(e.total)),e.records&&e.records.forEach(h=>{var d;this.recid&&(h.recid=this.parseField(h,this.recid)),h.recid==null&&(h.recid="recid-"+this.records.length),(((d=h.w2ui)==null?void 0:d.summary)===!0?this.summary:this.records).push(h)}),e.summary&&(this.summary=[],e.summary.forEach(h=>{this.recid&&(h.recid=this.parseField(h,this.recid)),h.recid==null&&(h.recid="recid-"+this.summary.length),this.summary.push(h)}))}else if(t=="delete")return this.reset(),this.reload();(((c=this.url)==null?void 0:c.get)??this.url)||(this.localSort(),this.localSearch()),this.total=parseInt(this.total),this.last.fetch.offset===0?this.refresh():(this.scroll(),this.resize()),typeof i=="function"&&i(e),n(e),l.finish(),this.last.fetch.loaded=!0}}error(e){var t=this.trigger("error",{target:this.name,message:e});t.isCancelled!==!0&&(this.message(e),t.finish())}getChanges(e){var t=[];e===void 0&&(e=this.records);for(let r=0;r<e.length;r++){var i,n=e[r];n!=null&&n.w2ui&&(n.w2ui.changes!=null&&((i={})[this.recid||"recid"]=n.recid,t.push(b.extend(i,n.w2ui.changes))),n.w2ui.expanded!==!0)&&n.w2ui.children&&n.w2ui.children.length&&t.push(...this.getChanges(n.w2ui.children))}return t}mergeChanges(){var e=this.getChanges();for(let n=0;n<e.length;n++){var t,i=this.get(e[n][this.recid||"recid"]);for(t in e[n])if(!(t=="recid"||this.recid&&t==this.recid)){typeof e[n][t]=="object"&&(e[n][t]=e[n][t].text);try{(function r(o,a,l){let c=a.split(".");c.length==1?o[a]=l:(o=o[c[0]],c.shift(),r(o,c.join("."),l))})(i,t,e[n][t])}catch(r){console.log("ERROR: Cannot merge. ",r.message||"",r)}i.w2ui&&delete i.w2ui.changes}}this.refresh()}save(e){var r;var t=this.getChanges(),i=((r=this.url)==null?void 0:r.save)??this.url;let n=this.trigger("save",{target:this.name,changes:t});n.isCancelled!==!0&&(i?this.request("save",{changes:n.detail.changes},null,o=>{o.error||this.mergeChanges(),n.finish(),typeof e=="function"&&e(o)}):(this.mergeChanges(),n.finish()))}editField(e,t,i,n){var c,h;let r=this;if(this.last.inEditMode===!0)n&&n.keyCode==13?({index:o,column:a,value:l}=this.last._edit,this.editChange({type:"custom",value:l},o,a,n),this.editDone(o,a,n)):0<(l=p(this.box).find("div.w2ui-edit-box .w2ui-input")).length&&(l.get(0).tagName=="DIV"?(l.text(l.text()+i),b.setCursorPosition(l.get(0),l.text().length)):(l.val(l.val()+i),b.setCursorPosition(l.get(0),l.val().length)));else{let d=this.get(e,!0),u=this.getCellEditable(d,t);if(u&&!["checkbox","check"].includes(u.type)){let m=this.records[d],f=this.columns[t];var o=f.frozen===!0?"_f":"_";if(["enum","file"].indexOf(u.type)!=-1)console.log('ERROR: input types "enum" and "file" are not supported in inline editing.');else{var a=this.trigger("editField",{target:this.name,recid:e,column:t,value:i,index:d,originalEvent:n});if(a.isCancelled!==!0){let R=function(M){try{var C=getComputedStyle(M),P=M.tagName.toUpperCase()=="DIV"?M.innerText:M.value,N=p(r.box).find("#grid_"+r.name+"_editable").get(0),w=`font-family: ${C["font-family"]}; font-size: ${C["font-size"]}; white-space: no-wrap;`,S=b.getStrWidth(P,w);S+20>N.clientWidth&&p(N).css("width",S+20+"px")}catch{}};i=a.detail.value,this.last.inEditMode=!0,this.last.editColumn=t,this.last._edit={value:i,index:d,column:t,recid:e},this.selectNone(!0),this.select({recid:e,column:t});var l=p(this.box).find("#grid_"+this.name+o+"rec_"+b.escapeId(e));let _=l.find('[col="'+t+'"] > div'),g=(this.last._edit.tr=l,this.last._edit.div=_,p(this.box).find("div.w2ui-edit-box").remove(),this.selectType!="row"&&(p(this.box).find("#grid_"+this.name+o+"selection").attr("id","grid_"+this.name+"_editable").removeClass("w2ui-selection").addClass("w2ui-edit-box").prepend('<div style="position: absolute; top: 0px; bottom: 0px; left: 0px; right: 0px;"></div>').find(".w2ui-selection-resizer").remove(),_=p(this.box).find("#grid_"+this.name+"_editable > div:first-child")),u.attr=u.attr??"",u.text=u.text??"",u.style=u.style??"",u.items=u.items??[],((h=(c=m.w2ui)==null?void 0:c.changes)==null?void 0:h[f.field])!=null?b.stripTags(m.w2ui.changes[f.field]):b.stripTags(r.parseField(m,f.field))),v=typeof(g=g??"")!="object"?g:"",y=(a.detail.prevValue!=null&&(v=a.detail.prevValue),i!=null&&(g=i),f.style!=null?f.style+";":"");typeof f.render=="string"&&["number","int","float","money","percent","size"].includes(f.render.split(":")[0])&&(y+="text-align: right;"),0<u.items.length&&!b.isPlainObject(u.items[0])&&(u.items=b.normMenu(u.items));let x,E=["date","time","datetime","color","list","combo"];n=getComputedStyle(l.find('[col="'+t+'"] > div').get(0)),o=`font-family: ${n["font-family"]}; font-size: ${n["font-size"]};`,u.type==="div"?(_.addClass("w2ui-editable").html(b.stripSpaces(`<div id="grid_${this.name}_edit_${e}_${t}" class="w2ui-input w2ui-focus"
                        contenteditable autocorrect="off" autocomplete="off" spellcheck="false"
                        style="${o+y+u.style}"
                        field="${f.field}" recid="${e}" column="${t}" ${u.attr}>
                    </div>`+u.text)),(x=_.find("div.w2ui-input").get(0)).innerText=typeof g!="object"?g:"",i!=null?b.setCursorPosition(x,x.innerText.length):b.setCursorPosition(x,0,x.innerText.length)):(_.addClass("w2ui-editable").html(b.stripSpaces(`<input id="grid_${this.name}_edit_${e}_${t}" class="w2ui-input"
                        autocorrect="off" autocomplete="off" spellcheck="false" type="text"
                        style="${o+y+u.style}"
                        field="${f.field}" recid="${e}" column="${t}" ${u.attr}>`+u.text)),x=_.find("input").get(0),u.type=="number"&&(g=b.formatNumber(g)),u.type=="date"&&(g=b.formatDate(b.isDate(g,u.format,!0)||new Date,u.format)),x.value=typeof g!="object"?g:"",l=M=>{var w,S,D,I;var C=(w=this.last._edit)==null?void 0:w.escKey;let P=!1;var N=p(x).data("tooltipName");N&&((S=Ne.get(N[0]))==null?void 0:S.selected)!=null&&(P=!0),!this.last.inEditMode||C||!E.includes(u.type)||((D=M.detail.overlay.anchor)==null?void 0:D.id)!=((I=this.last._edit.input)==null?void 0:I.id)&&u.type!="list"||(this.editChange(),this.editDone(void 0,void 0,{keyCode:P?13:0}))},new No(b.extend({},u,{el:x,selected:g,onSelect:l,onHide:l})),i==null&&x&&x.select()),Object.assign(this.last._edit,{input:x,edit:u}),p(x).off(".w2ui-editable").on("blur.w2ui-editable",M=>{var C,P;this.last.inEditMode&&(C=this.last._edit.edit.type,P=p(x).data("tooltipName"),E.includes(C)&&P||(this.editChange(x,d,t,M),this.editDone()))}).on("mousedown.w2ui-editable",M=>{M.stopPropagation()}).on("click.w2ui-editable",M=>{R.call(x,M)}).on("paste.w2ui-editable",M=>{M.preventDefault(),M=M.clipboardData.getData("text/plain"),document.execCommand("insertHTML",!1,M)}).on("keyup.w2ui-editable",M=>{R.call(x,M)}).on("keydown.w2ui-editable",M=>{switch(M.keyCode){case 8:u.type!="list"||x._w2field||M.preventDefault();break;case 9:case 13:M.preventDefault();break;case 27:var C=p(x).data("tooltipName");C&&0<C.length&&(this.last._edit.escKey=!0,Ne.hide(C[0]),M.preventDefault()),M.stopPropagation()}setTimeout(()=>{var w,S;switch(M.keyCode){case 9:var P=M.shiftKey?r.prevCell(d,t,!0):r.nextCell(d,t,!0);P!=null&&(N=r.records[P.index].recid,this.editChange(x,d,t,M),this.editDone(d,t,M),r.selectType!="row"?(r.selectNone(!0),r.select({recid:N,column:P.colIndex})):r.editField(N,P.colIndex,null,M),M.preventDefault)&&M.preventDefault();break;case 13:{let D=!1;var N=p(x).data("tooltipName");N&&Ne.get(N[0]).selected!=null&&(D=!0),N&&D||(this.editChange(x,d,t,M),this.editDone(d,t,M));break}case 27:{this.last._edit.escKey=!1;let D=r.parseField(m,f.field);((S=(w=m.w2ui)==null?void 0:w.changes)==null?void 0:S[f.field])!=null&&(D=m.w2ui.changes[f.field]),x._prevValue!=null&&(D=x._prevValue),x.tagName=="DIV"?x.innerText=D??"":x.value=D??"",this.editDone(d,t,M),setTimeout(()=>{r.select({recid:e,column:t})},1);break}}R(x)},1)}),x&&(x._prevValue=v),u.type!="list"&&setTimeout(()=>{this.last.inEditMode&&x&&(x.focus(),clearTimeout(this.last.kbd_timer),(x.resize=R)(x))},50),a.finish({input:x})}}}}}editChange(e,t,i,n){var m,f,_,g;e=e??this.last._edit.input,t=t??this.last._edit.index,i=i??this.last._edit.column,n=n??{};var r=(t<0?this.summary:this.records)[t=t<0?-t-1:t],o=this.columns[i];let a=(e==null?void 0:e.tagName)=="DIV"?e.innerText:e.value;var l=e._w2field,c=(l&&(l.type=="list"&&(a=l.selected),Object.keys(a).length!==0&&a!=null||(a=""),b.isPlainObject(a)||(a=l.clean(a))),e.type=="checkbox"&&(((m=r.w2ui)==null?void 0:m.editable)===!1&&(e.checked=!e.checked),a=e.checked),this.parseField(r,o.field)),h=(f=r.w2ui)!=null&&f.changes&&r.w2ui.changes.hasOwnProperty(o.field)?r.w2ui.changes[o.field]:c;let d={target:this.name,input:e,recid:r.recid,index:t,column:i,originalEvent:n,value:{new:a,previous:h,original:c}},u=(((_=n.target)==null?void 0:_._prevValue)!=null&&(d.value.previous=n.target._prevValue),0);for(;u<20;){if(u++,typeof(a=d.value.new)!="object"&&String(c)!=String(a)||typeof a=="object"&&a&&a.id!=c&&(typeof c!="object"||c==null||a.id!=c.id)){if((d=this.trigger("change",d)).isCancelled!==!0){if(a!==d.detail.value.new)continue;(d.detail.value.new!==""&&d.detail.value.new!=null||h!==""&&h!=null)&&(r.w2ui=r.w2ui??{},r.w2ui.changes=r.w2ui.changes??{},r.w2ui.changes[o.field]=d.detail.value.new),d.finish()}}else if((d=this.trigger("restore",d)).isCancelled!==!0){if(a!==d.detail.value.new)continue;(g=r.w2ui)!=null&&g.changes&&(delete r.w2ui.changes[o.field],Object.keys(r.w2ui.changes).length===0)&&delete r.w2ui.changes,d.finish()}break}}editDone(e,t,i){var l,c;if(e=e??this.last._edit.index,t=t??this.last._edit.column,i=i??{},this.advanceOnEdit&&i.keyCode==13){let h=i.shiftKey?this.prevRow(e,t,1):this.nextRow(e,t,1);h==null&&(h=e),setTimeout(()=>{this.selectType!="row"?(this.selectNone(!0),this.select({recid:this.records[h].recid,column:t})):this.editField(this.records[h].recid,t,null,i)},1)}var n=e<0,r=p(this.last._edit.tr).find('[col="'+t+'"]'),o=this.records[e],a=this.columns[t];this.last.inEditMode=!1,this.last._edit=null,n||(((c=(l=o.w2ui)==null?void 0:l.changes)==null?void 0:c[a.field])!=null?r.addClass("w2ui-changed"):r.removeClass("w2ui-changed"),r.replace(this.getCellHTML(e,t,n))),p(this.box).find("div.w2ui-edit-box").remove(),this.updateToolbar(),setTimeout(()=>{var h=p(this.box).find(`#grid_${this.name}_focus`).get(0);document.activeElement===h||this.last.inEditMode||h.focus()},10)}delete(e){var a;var t=this.trigger("delete",{target:this.name,force:e});if(e&&this.message(),t.isCancelled!==!0){e=t.detail.force;var i=this.getSelection();if(i.length!==0)if(this.msgDelete==""||e){if(typeof this.url!="object"?this.url:this.url.remove)this.request("delete");else if(typeof i[0]!="object")this.selectNone(),this.remove.apply(this,i);else{for(let l=0;l<i.length;l++){var n=this.columns[i[l].column].field,r=this.get(i[l].recid,!0),o=this.records[r];r!=null&&n!="recid"&&(this.records[r][n]="",(a=o.w2ui)==null?void 0:a.changes)&&delete o.w2ui.changes[n]}this.update()}t.finish()}else this.confirm({text:b.lang(this.msgDelete,{count:i.length,records:b.lang(i.length==1?"record":"records")}),width:380,height:170,yes_text:b.lang("Delete"),yes_class:"w2ui-btn-red",no_text:b.lang("Cancel")}).yes(l=>{l.detail.self.close(),this.delete(!0)}).no(l=>{l.detail.self.close()})}}click(e,t){var d,u,m;var i=Date.now();let n=null;if(!(this.last.cancelClick==1||t&&t.altKey))if(typeof e=="object"&&e!==null&&(n=e.column,e=e.recid),t==null&&(t={}),i-parseInt(this.last.click_time)<350&&this.last.click_recid==e&&t.type=="click")this.dblClick(e,t);else{if(this.last.bubbleEl&&(this.last.bubbleEl=null),this.last.click_time=i,i=this.last.click_recid,this.last.click_recid=e,n==null&&t.target){let f=t.target;f.tagName!="TD"&&(f=p(f).closest("td")[0]),p(f).attr("col")!=null&&(n=parseInt(p(f).attr("col")))}var r=this.trigger("click",{target:this.name,recid:e,column:n,originalEvent:t});if(r.isCancelled!==!0){var o=this.getSelection(),a=(p(this.box).find("#grid_"+this.name+"_check_all").prop("checked",!1),this.get(e,!0)),l=[];this.last.sel_ind=a,this.last.sel_col=n,this.last.sel_recid=e,this.last.sel_type="click";let f,_,g,v;if(t.shiftKey&&0<o.length&&this.multiSelect){if(o[0].recid){f=this.get(o[0].recid,!0),_=this.get(e,!0),v=n>o[0].column?(g=o[0].column,n):(g=n,o[0].column);for(let y=g;y<=v;y++)l.push(y)}else f=this.get(i,!0),_=this.get(e,!0);var c=[],h=(f>_&&(i=f,f=_,_=i),(d=this.url)!=null&&d.get?this.url.get:this.url);for(let y=f;y<=_;y++)if(!(0<this.searchData.length)||h||this.last.searchIds.includes(y))if(this.selectType=="row")c.push(this.records[y].recid);else for(let x=0;x<l.length;x++)c.push({recid:this.records[y].recid,column:l[x]});this.select(c)}else{i=this.last.selection;let y=i.indexes.indexOf(a)!=-1,x=!1;p(t.target).closest("td").hasClass("w2ui-col-select")&&(x=!0),(t.ctrlKey||t.shiftKey||t.metaKey||x)&&this.multiSelect||this.showSelectColumn?(y=this.selectType=="row"||(u=i.columns[a])!=null&&u.includes(n)?y:!1)===!0?this.unselect({recid:e,column:n}):this.select({recid:e,column:n}):(this.selectType=="row"||(m=i.columns[a])!=null&&m.includes(n)||(y=!1),this.selectNone(!0),y===!0&&o.length==1?this.unselect({recid:e,column:n}):this.select({recid:e,column:n}))}this.status(),this.initResize(),r.finish()}}}columnClick(e,t){if(this.last.colResizing!==!0){let o=this.trigger("columnClick",{target:this.name,field:e,originalEvent:t});if(o.isCancelled!==!0){if(this.selectType=="row"){var i=this.getColumn(e);i&&i.sortable&&this.sort(e,null,!(!t||!t.ctrlKey&&!t.metaKey)),o.detail.field=="line-number"&&(this.getSelection().length>=this.records.length?this.selectNone():this.selectAll())}else if(t.altKey&&(i=this.getColumn(e))&&i.sortable&&this.sort(e,null,!(!t||!t.ctrlKey&&!t.metaKey)),o.detail.field=="line-number")this.getSelection().length>=this.records.length?this.selectNone():this.selectAll();else{t.shiftKey||t.metaKey||t.ctrlKey||this.selectNone(!0);var i=this.getSelection(),e=this.getColumn(o.detail.field,!0),n=[],r=[];if(i.length!=0&&t.shiftKey){let c=e,h=i[0].column;c>h&&(c=i[0].column,h=e);for(let d=c;d<=h;d++)r.push(d)}else r.push(e);if((o=this.trigger("columnSelect",{target:this.name,columns:r})).isCancelled!==!0){for(let c=0;c<this.records.length;c++)n.push({recid:this.records[c].recid,column:r});this.select(n)}o.finish()}o.finish()}}}columnDblClick(e,t){e=this.trigger("columnDblClick",{target:this.name,field:e,originalEvent:t}),e.isCancelled!==!0&&e.finish()}columnContextMenu(e,t){e=this.trigger("columnContextMenu",{target:this.name,field:e,originalEvent:t}),e.isCancelled!==!0&&(this.show.columnMenu&&(Ot.show({type:"check",anchor:document.body,originalEvent:t,items:this.initColumnOnOff()}).then(()=>{p("#w2overlay-context-menu .w2ui-grid-skip").off(".w2ui-grid").on("click.w2ui-grid",i=>{i.stopPropagation()}).on("keypress",i=>{i.keyCode==13&&(this.skip(i.target.value),this.toolbar.click("w2ui-column-on-off"))})}).select(i=>{var n=i.detail.item.id;["w2ui-stateSave","w2ui-stateReset"].includes(n)?this[n.substring(5)]():n!="w2ui-skip"&&this.columnOnOff(i,i.detail.item.id),clearTimeout(this.last.kbd_timer)}),clearTimeout(this.last.kbd_timer)),t.preventDefault(),e.finish())}focus(e){if(e=this.trigger("focus",{target:this.name,originalEvent:e}),e.isCancelled===!0)return!1;this.hasFocus=!0,p(this.box).removeClass("w2ui-inactive").find(".w2ui-inactive").removeClass("w2ui-inactive"),setTimeout(()=>{var t=p(this.box).find(`#grid_${this.name}_focus`).get(0);t&&document.activeElement!=t&&t.focus()},10),e.finish()}blur(e){if(e=this.trigger("blur",{target:this.name,originalEvent:e}),e.isCancelled===!0)return!1;this.hasFocus=!1,p(this.box).addClass("w2ui-inactive").find(".w2ui-selected").addClass("w2ui-inactive"),p(this.box).find(".w2ui-selection").addClass("w2ui-inactive"),e.finish()}keydown(e){let t=this,i=typeof this.url!="object"?this.url:this.url.get;if(t.keyboard===!0){var n=t.trigger("keydown",{target:t.name,originalEvent:e});if(n.isCancelled!==!0)if(0<p(this.box).find(".w2ui-message").length)e.keyCode==27&&this.message();else{let E=function(P){if(l&&M(),!(g.length<=0)){let S=t.prevRow(f,t.selectType=="row"?0:h[0].column,P);if((S=x||S!=null?S:t.searchData.length==0||i?0:t.last.searchIds[0])!=null){if(x&&t.multiSelect){if(C())return;if(t.selectType=="row")t.last.sel_ind>S&&t.last.sel_ind!=_?t.unselect(t.records[_].recid):t.select(t.records[S].recid);else if(t.last.sel_ind>S&&t.last.sel_ind!=_){S=_;var N=[];for(let D=0;D<u.length;D++)N.push({recid:t.records[S].recid,column:u[D]});t.unselect(N)}else{var w=[];for(let D=0;D<u.length;D++)w.push({recid:t.records[S].recid,column:u[D]});t.select(w)}}else t.selectNone(!0),t.click({recid:t.records[S].recid,column:u[0]},e);t.scrollIntoView(S,null,!0,P!=1),e.preventDefault&&e.preventDefault()}else x||t.selectNone(!0)}},R=function(P){if(l&&M(),!(g.length<=0)){let S=t.nextRow(_,t.selectType=="row"?0:h[0].column,P);if((S=x||S!=null?S:t.searchData.length==0||i?t.records.length-1:t.last.searchIds[t.last.searchIds.length-1])!=null){if(x&&t.multiSelect){if(C())return;if(t.selectType=="row")t.last.sel_ind<S&&t.last.sel_ind!=f?t.unselect(t.records[f].recid):t.select(t.records[S].recid);else if(t.last.sel_ind<S&&t.last.sel_ind!=f){S=f;var N=[];for(let D=0;D<u.length;D++)N.push({recid:t.records[S].recid,column:u[D]});t.unselect(N)}else{var w=[];for(let D=0;D<u.length;D++)w.push({recid:t.records[S].recid,column:u[D]});t.select(w)}}else t.selectNone(!0),t.click({recid:t.records[S].recid,column:u[0]},e);t.scrollIntoView(S,null,!0,P!=1),v=!0}else x||t.selectNone(!0)}},M=function(){if(t.records&&t.records.length!==0){let P=Math.floor(c[0].scrollTop/t.recordHeight)+1;(!t.records[P]||P<2)&&(P=0),t.records[P]!==void 0&&t.select({recid:t.records[P].recid,column:0})}},C=function(){if(t.last.sel_type=="click"){if(t.selectType=="row")return t.last.sel_type="key",1<h.length&&(h.splice(h.indexOf(t.records[t.last.sel_ind].recid),1),t.unselect(h),1);if(t.last.sel_type="key",1<h.length){for(let P=0;P<h.length;P++)if(h[P].recid==t.last.sel_recid&&h[P].column==t.last.sel_col){h.splice(P,1);break}return t.unselect(h),1}}},l=!1,c=p(t.box).find("#grid_"+t.name+"_records"),h=t.getSelection(),d=(h.length===0&&(l=!0),h[0]||null),u=[],m=h[h.length-1];if(typeof d=="object"&&d!=null){d=h[0].recid,u=[];let P=0;for(;!(!h[P]||h[P].recid!=d);)u.push(h[P].column),P++;m=h[h.length-1].recid}let f=t.get(d,!0),_=t.get(m,!0),g=p(t.box).find(`#grid_${t.name}_rec_`+(f!=null?b.escapeId(t.records[f].recid):"none"));var r,o=Math.floor(c[0].clientHeight/t.recordHeight);let v=!1,y=e.keyCode,x=e.shiftKey;switch(y){case 8:case 46:t.delete(),v=!0,e.stopPropagation();break;case 27:t.selectNone(),v=!0;break;case 65:(e.metaKey||e.ctrlKey)&&(t.selectAll(),v=!0);break;case 13:if(this.selectType=="row"&&t.show.expandColumn===!0){if(g.length<=0)break;t.toggle(d,e),v=!0}else{for(let P=0;P<this.columns.length;P++)if(this.getCellEditable(f,P)){u.push(parseInt(P));break}0<(u=this.selectType=="row"&&this.last._edit&&this.last._edit.column?[this.last._edit.column]:u).length&&(t.editField(d,this.last.editColumn||u[0],null,e),v=!0)}break;case 37:(function(){if(l)M();else{if(t.selectType=="row"){if(g.length<=0)return;var P=t.records[f].w2ui||{};!P||P.parent_recid==null||Array.isArray(P.children)&&P.children.length!==0&&P.expanded?t.collapse(d,e):(t.unselect(d),t.collapse(P.parent_recid,e),t.select(P.parent_recid))}else{let D=t.prevCell(f,u[0]);if(D=(D==null?void 0:D.index)!=f?null:D==null?void 0:D.colIndex,x||D!=null||(t.selectNone(!0),D=0),D!=null)if(x&&t.multiSelect){if(C())return;var N=[],w=[],S=[];if(u.indexOf(t.last.sel_col)===0&&1<u.length){for(let I=0;I<h.length;I++)N.indexOf(h[I].recid)==-1&&N.push(h[I].recid),S.push({recid:h[I].recid,column:u[u.length-1]});t.unselect(S),t.scrollIntoView(f,u[u.length-1],!0)}else{for(let I=0;I<h.length;I++)N.indexOf(h[I].recid)==-1&&N.push(h[I].recid),w.push({recid:h[I].recid,column:D});t.select(w),t.scrollIntoView(f,D,!0)}}else t.click({recid:d,column:D},e),t.scrollIntoView(f,D,!0);else x||t.selectNone(!0)}v=!0}})();break;case 39:(function(){if(l)M();else{if(t.selectType=="row"){if(g.length<=0)return;t.expand(d,e)}else{let S=t.nextCell(f,u[u.length-1]);if(S=S.index!=f?null:S.colIndex,x||S!=null||(t.selectNone(!0),S=t.columns.length-1),S!=null)if(x&&y==39&&t.multiSelect){if(C())return;var P=[],N=[],w=[];if(u.indexOf(t.last.sel_col)==u.length-1&&1<u.length){for(let D=0;D<h.length;D++)P.indexOf(h[D].recid)==-1&&P.push(h[D].recid),w.push({recid:h[D].recid,column:u[0]});t.unselect(w),t.scrollIntoView(f,u[0],!0)}else{for(let D=0;D<h.length;D++)P.indexOf(h[D].recid)==-1&&P.push(h[D].recid),N.push({recid:h[D].recid,column:S});t.select(N),t.scrollIntoView(f,S,!0)}}else t.click({recid:d,column:S},e),t.scrollIntoView(f,S,!0);else x||t.selectNone(!0)}v=!0}})();break;case 33:E(o);break;case 34:R(o);break;case 35:R(-1);break;case 36:E(-1);break;case 38:E(e.metaKey||e.ctrlKey?-1:1);break;case 40:R(e.metaKey||e.ctrlKey?-1:1);break;case 17:case 91:l||b.isSafari&&(t.last.copy_event=t.copy(!1,e),(r=p(t.box).find("#grid_"+t.name+"_focus")).val(t.last.copy_event.detail.text),r[0].select());break;case 67:(e.metaKey||e.ctrlKey)&&(b.isSafari||(t.last.copy_event=t.copy(!1,e),(r=p(t.box).find("#grid_"+t.name+"_focus")).val(t.last.copy_event.detail.text),r[0].select()),t.copy(t.last.copy_event,e));break;case 88:l||(e.ctrlKey||e.metaKey)&&(b.isSafari||(t.last.copy_event=t.copy(!1,e),(r=p(t.box).find("#grid_"+t.name+"_focus")).val(t.last.copy_event.detail.text),r[0].select()),t.copy(t.last.copy_event,e))}var a=[32,187,189,192,219,220,221,186,222,188,190,191];for(let P=48;P<=111;P++)a.push(P);a.indexOf(y)==-1||e.ctrlKey||e.metaKey||v||(u.length===0&&u.push(0),v=!1,setTimeout(()=>{var P=p(t.box).find("#grid_"+t.name+"_focus"),N=P.val();P.val(""),t.editField(d,u[0],N,e)},1)),v&&e.preventDefault&&e.preventDefault(),n.finish()}}}scrollIntoView(e,t,i,n){let r=this.records.length;if((r=this.searchData.length==0||this.url?r:this.last.searchIds.length)!==0){if(e==null){var o=this.getSelection();if(o.length===0)return;b.isPlainObject(o[0])?(e=o[0].index,t=o[0].column):e=this.get(o[0],!0)}var o=p(this.box).find(`#grid_${this.name}_records`),a=o[0].clientWidth,l=o[0].clientHeight,c=o[0].scrollTop,h=o[0].scrollLeft,d=this.last.searchIds.length;if(0<d&&(e=this.last.searchIds.indexOf(e)),o.css({"scroll-behavior":i?"auto":"smooth"}),l<this.recordHeight*(0<d?d:r)&&0<o.length&&(d=(i=Math.floor(c/this.recordHeight))+Math.floor(l/this.recordHeight),e==i&&o.prop("scrollTop",c-l/1.3),e==d&&o.prop("scrollTop",c+l/1.3),(e<i||d<e)&&o.prop("scrollTop",(e-1)*this.recordHeight),n===!0)&&o.prop("scrollTop",e*this.recordHeight),t!=null){let m=0,f=0;c=b.scrollBarSize();for(let _=0;_<=t;_++){var u=this.columns[_];u.frozen||u.hidden||(m=f,f+=parseInt(u.sizeCalculated))}a<f-h?o.prop("scrollLeft",m-c):m<h&&o.prop("scrollLeft",f-a+2*c)}}}scrollToColumn(e){if(e!=null){let i=0,n=!1;for(let r=0;r<this.columns.length;r++){var t=this.columns[r];if(t.field==e){n=!0;break}t.frozen||t.hidden||(t=parseInt(t.sizeCalculated||t.size),i+=t)}n&&(this.last.scrollLeft=i+1,this.scroll())}}dblClick(e,t){let i=null;if(typeof e=="object"&&e!==null&&(i=e.column,e=e.recid),t==null&&(t={}),i==null&&t.target){let a=t.target;a.tagName.toUpperCase()!="TD"&&(a=p(a).closest("td")[0]),i=parseInt(p(a).attr("col"))}var n=this.get(e,!0),r=this.records[n],o=this.trigger("dblClick",{target:this.name,recid:e,column:i,originalEvent:t});o.isCancelled!==!0&&(this.selectNone(!0),this.getCellEditable(n,i)?this.editField(e,i,null,t):(this.select({recid:e,column:i}),(this.show.expandColumn||r&&r.w2ui&&Array.isArray(r.w2ui.children))&&this.toggle(e)),o.finish())}showContextMenu(e,t,i){if(this.last.userSelect!="text"){(i=i??{offsetX:0,offsetY:0,target:p(this.box).find(`#grid_${this.name}_rec_`+e)[0]}).offsetX==null&&(i.offsetX=i.layerX-i.target.offsetLeft,i.offsetY=i.layerY-i.target.offsetTop),b.isFloat(e)&&(e=parseFloat(e));var n=this.getSelection();if(this.selectType=="row")n.indexOf(e)==-1&&this.click(e);else{let o=!1;for(let a=0;a<n.length;a++)n[a].recid!=e&&n[a].column!=t||(o=!0);o||e==null||this.click({recid:e,column:t}),o||t==null||this.columnClick(this.columns[t].field,i)}var r=this.trigger("contextMenu",{target:this.name,originalEvent:i,recid:e,column:t});r.isCancelled!==!0&&(0<this.contextMenu.length&&(Ot.show({anchor:document.body,originalEvent:i,items:this.contextMenu}).select(o=>{clearTimeout(this.last.kbd_timer),this.contextMenuClick(e,t,o)}),clearTimeout(this.last.kbd_timer)),i.preventDefault(),r.finish())}}contextMenuClick(e,t,i){e=this.trigger("contextMenuClick",{target:this.name,recid:e,column:t,originalEvent:i.detail.originalEvent,menuEvent:i,menuIndex:i.detail.index,menuItem:i.detail.item}),e.isCancelled!==!0&&e.finish()}toggle(e){var t=this.get(e);if(t!=null)return t.w2ui=t.w2ui??{},t.w2ui.expanded===!0?this.collapse(e):this.expand(e)}expand(e,t){var l;var i=this.get(e,!0);let n=this.records[i];n.w2ui=n.w2ui??{};var r=b.escapeId(e),o=n.w2ui.children;let a;if(Array.isArray(o)){if(n.w2ui.expanded===!0||o.length===0||(a=this.trigger("expand",{target:this.name,recid:e})).isCancelled===!0)return!1;n.w2ui.expanded=!0,o.forEach(c=>{c.w2ui=c.w2ui??{},c.w2ui.parent_recid=n.recid,c.w2ui.children==null&&(c.w2ui.children=[])}),this.records.splice.apply(this.records,[i+1,0].concat(o)),this.total!==-1&&(this.total+=o.length),(typeof this.url!="object"?this.url:this.url.get)||(this.localSort(!0,!0),0<this.searchData.length&&this.localSearch(!0)),t!==!0&&this.refresh(),a.finish()}else{if(0<p(this.box).find("#grid_"+this.name+"_rec_"+r+"_expanded_row").length||this.show.expandColumn!==!0||n.w2ui.expanded=="none")return!1;if(p(this.box).find("#grid_"+this.name+"_rec_"+r).after(`<tr id="grid_${this.name}_rec_${e}_expanded_row" class="w2ui-expanded-row">
                    <td colspan="100" class="w2ui-expanded2">
                        <div id="grid_${this.name}_rec_${e}_expanded"></div>
                    </td>
                    <td class="w2ui-grid-data-last"></td>
                </tr>`),p(this.box).find("#grid_"+this.name+"_frec_"+r).after(`<tr id="grid_${this.name}_frec_${e}_expanded_row" class="w2ui-expanded-row">
                    ${this.show.lineNumbers?'<td class="w2ui-col-number"></td>':""}
                    <td class="w2ui-grid-data w2ui-expanded1" colspan="100">
                       <div id="grid_${this.name}_frec_${e}_expanded"></div>
                    </td>
                </tr>`),(a=this.trigger("expand",{target:this.name,recid:e,box_id:"grid_"+this.name+"_rec_"+e+"_expanded",fbox_id:"grid_"+this.name+"_frec_"+e+"_expanded"})).isCancelled===!0)return p(this.box).find("#grid_"+this.name+"_rec_"+r+"_expanded_row").remove(),p(this.box).find("#grid_"+this.name+"_frec_"+r+"_expanded_row").remove(),!1;i=p(this.box).find("#grid_"+this.name+"_rec_"+e+"_expanded"),o=p(this.box).find("#grid_"+this.name+"_frec_"+e+"_expanded"),t=((l=i.find(":scope div:first-child")[0])==null?void 0:l.clientHeight)??50,i[0].clientHeight<t&&i.css({height:t+"px"}),o[0].clientHeight<t&&o.css({height:t+"px"}),p(this.box).find("#grid_"+this.name+"_rec_"+r).attr("expanded","yes").addClass("w2ui-expanded"),p(this.box).find("#grid_"+this.name+"_frec_"+r).attr("expanded","yes").addClass("w2ui-expanded"),p(this.box).find("#grid_"+this.name+"_cell_"+this.get(e,!0)+"_expand div").html("-"),n.w2ui.expanded=!0,a.finish(),this.resizeRecords()}return!0}collapse(e,t){var i=this.get(e,!0);let n=this.records[i],r=(n.w2ui=n.w2ui||{},b.escapeId(e));var o=n.w2ui.children;let a;if(Array.isArray(o)){if(n.w2ui.expanded!==!0||(a=this.trigger("collapse",{target:this.name,recid:e})).isCancelled===!0)return!1;(function h(d){d.w2ui.expanded=!1;for(let u=0;u<d.w2ui.children.length;u++){let m=d.w2ui.children[u];m.w2ui.expanded&&h(m)}})(n);var l=[];for(let h=n;h!=null;h=this.get(h.w2ui.parent_recid))l.push(h.w2ui.parent_recid);o=i+1;let c=o;for(;!(this.records.length<=c+1||this.records[c+1].w2ui==null||0<=l.indexOf(this.records[c+1].w2ui.parent_recid));)c++;this.records.splice(o,c-o+1),this.total!==-1&&(this.total-=c-o+1),(typeof this.url!="object"?this.url:this.url.get)||0<this.searchData.length&&this.localSearch(!0),t!==!0&&this.refresh(),a.finish()}else{if(p(this.box).find("#grid_"+this.name+"_rec_"+r+"_expanded_row").length===0||this.show.expandColumn!==!0||(a=this.trigger("collapse",{target:this.name,recid:e,box_id:"grid_"+this.name+"_rec_"+e+"_expanded",fbox_id:"grid_"+this.name+"_frec_"+e+"_expanded"})).isCancelled===!0)return!1;p(this.box).find("#grid_"+this.name+"_rec_"+r).removeAttr("expanded").removeClass("w2ui-expanded"),p(this.box).find("#grid_"+this.name+"_frec_"+r).removeAttr("expanded").removeClass("w2ui-expanded"),p(this.box).find("#grid_"+this.name+"_cell_"+this.get(e,!0)+"_expand div").html("+"),p(this.box).find("#grid_"+this.name+"_rec_"+r+"_expanded").css("height","0px"),p(this.box).find("#grid_"+this.name+"_frec_"+r+"_expanded").css("height","0px"),setTimeout(()=>{p(this.box).find("#grid_"+this.name+"_rec_"+r+"_expanded_row").remove(),p(this.box).find("#grid_"+this.name+"_frec_"+r+"_expanded_row").remove(),n.w2ui.expanded=!1,a.finish(),this.resizeRecords()},300)}return!0}sort(e,t,i){var n=this.trigger("sort",{target:this.name,field:e,direction:t,multiField:i});if(n.isCancelled!==!0){if(e!=null){let r=this.sortData.length;for(let o=0;o<this.sortData.length;o++)if(this.sortData[o].field==e){r=o;break}t==null&&(t=this.sortData[r]!=null&&(this.sortData[r].direction==null&&(this.sortData[r].direction=""),this.sortData[r].direction.toLowerCase()==="asc")?"desc":"asc"),this.multiSort===!1&&(this.sortData=[],r=0),i!=1&&(this.sortData=[],r=0),this.sortData[r]==null&&(this.sortData[r]={}),this.sortData[r].field=e,this.sortData[r].direction=t}else this.sortData=[];(typeof this.url!="object"?this.url:this.url.get)?(n.finish({direction:t}),this.last.fetch.offset=0,this.reload()):(this.localSort(!1,!0),0<this.searchData.length&&this.localSearch(!0),this.last.scrollTop=0,p(this.box).find(`#grid_${this.name}_records`).prop("scrollTop",0),n.finish({direction:t}),this.refresh())}}copy(e,t){if(b.isPlainObject(e))return e.finish(),e.text;var i=this.getSelection();if(i.length===0)return"";let n="";if(typeof i[0]=="object"){let h=i[0].column,d=i[0].column;var r=[];for(let u=0;u<i.length;u++)i[u].column<h&&(h=i[u].column),i[u].column>d&&(d=i[u].column),r.indexOf(i[u].index)==-1&&r.push(i[u].index);r.sort((u,m)=>u-m);for(let u=0;u<r.length;u++){var o=r[u];for(let m=h;m<=d;m++)this.columns[m].hidden!==!0&&(n+=this.getCellCopy(o,m)+"	");n=n.substr(0,n.length-1),n+=`
`}}else{for(let h=0;h<this.columns.length;h++){var a=this.columns[h];if(a.hidden!==!0){let d=a.text||a.field;a.text&&a.text.length<3&&a.tooltip&&(d=a.tooltip),n+='"'+b.stripTags(d)+'"	'}}n=n.substr(0,n.length-1),n+=`
`;for(let h=0;h<i.length;h++){var l=this.get(i[h],!0);for(let d=0;d<this.columns.length;d++)this.columns[d].hidden!==!0&&(n+='"'+this.getCellCopy(l,d)+'"	');n=n.substr(0,n.length-1),n+=`
`}}n=n.substr(0,n.length-1);let c;return e==null?(c=this.trigger("copy",{target:this.name,text:n,cut:t.keyCode==88,originalEvent:t})).isCancelled===!0?"":(n=c.detail.text,c.finish(),n):e===!1?(c=this.trigger("copy",{target:this.name,text:n,cut:t.keyCode==88,originalEvent:t})).isCancelled===!0?"":(n=c.detail.text,c):void 0}getCellCopy(e,t){return b.stripTags(this.getCellHTML(e,t))}paste(e,c){var i=this.getSelection();let n=this.get(i[0].recid,!0);var r,o,a,l=i[0].column,c=this.trigger("paste",{target:this.name,text:e,index:n,column:l,originalEvent:c});if(c.isCancelled!==!0){if(e=c.detail.text,this.selectType=="row"||i.length===0)console.log("ERROR: You can paste only if grid.selectType = 'cell' and when at least one cell selected.");else{if(typeof e!="object"){var h=[];e=e.split(`
`);for(let f=0;f<e.length;f++){var d=e[f].split("	");let _=0;var u=this.records[n],m=[];if(u!=null){for(let g=0;g<d.length;g++)this.columns[l+_]&&(r=u,o=this.columns[l+_].field,a=d[g],r.w2ui=r.w2ui??{},r.w2ui.changes=r.w2ui.changes||{},r.w2ui.changes[o]=a,m.push(l+_),_++);for(let g=0;g<m.length;g++)h.push({recid:u.recid,column:m[g]});n++}}this.selectNone(!0),this.select(h)}else this.selectNone(!0),this.select([{recid:this.records[n],column:l}]);this.refresh()}c.finish()}}resize(){var e=Date.now();if(this.box&&p(this.box).attr("name")==this.name){var t=this.trigger("resize",{target:this.name});if(t.isCancelled!==!0)return this.resizeBoxes(),this.resizeRecords(),t.finish(),Date.now()-e}}update({cells:e,fullCellRefresh:t,ignoreColumns:i}={}){var n=Date.now();let r=this;if(this.box==null)return 0;if(Array.isArray(e))for(let d=0;d<e.length;d++){var o=e[d].index,a=e[d].column;if(!(o<0))if(o==null||a==null)console.log("ERROR: Wrong argument for grid.update({ cells }), cells should be [{ index: X, column: Y }, ...]");else{var l=this.records[o]??{};l.w2ui=l.w2ui??{},l.w2ui._update=l.w2ui._update??{cells:[]};let u=l.w2ui._update.row1,m=l.w2ui._update.row2;u!=null&&u.isConnected&&m!=null&&m.isColSelected||(u=this.box.querySelector(`#grid_${this.name}_rec_`+b.escapeId(l.recid)),m=this.box.querySelector(`#grid_${this.name}_frec_`+b.escapeId(l.recid)),l.w2ui._update.row1=u,l.w2ui._update.row2=m),h(l,u,m,o,a)}}else for(let d=this.last.range_start-1;d<=this.last.range_end;d++){let u=d;u=0<this.last.searchIds.length?this.last.searchIds[d]:d;var c=this.records[u];if(!(u<0||c==null)){c.w2ui=c.w2ui??{},c.w2ui._update=c.w2ui._update??{cells:[]};let m=c.w2ui._update.row1,f=c.w2ui._update.row2;m!=null&&m.isConnected&&f!=null&&f.isColSelected||(m=this.box.querySelector(`#grid_${this.name}_rec_`+b.escapeId(c.recid)),f=this.box.querySelector(`#grid_${this.name}_frec_`+b.escapeId(c.recid)),c.w2ui._update.row1=m,c.w2ui._update.row2=f);for(let _=0;_<this.columns.length;_++)h(c,m,f,u,_)}}return Date.now()-n;function h(d,u,m,f,_){var g=r.columns[_];if(!Array.isArray(i)||!i.includes(_)&&!i.includes(g.field)){let E=d.w2ui._update.cells[_];if(E!=null&&E.isConnected||(E=r.box.querySelector(`#grid_${r.name}_data_${f}_`+_),d.w2ui._update.cells[_]=E),E!=null){if(t)p(E).replace(r.getCellHTML(f,_,!1)),E=r.box.querySelector(`#grid_${r.name}_data_${f}_`+_),d.w2ui._update.cells[_]=E;else{var v=E.children[0],{value:f,style:y,className:x}=r.getCellValue(f,_,!1,!0);if(v.innerHTML!=f&&(v.innerHTML=f),y!=""&&E.style.cssText!=y&&(E.style.cssText=y),x!=""){let M=["w2ui-grid-data"],C=[];v=x.split(" ").filter(P=>!!P),E.classList.forEach(P=>{M.includes(P)||C.push(P)}),E.classList.remove(...C),E.classList.add(...v)}}if(r.columns[_].style&&r.columns[_].style!=E.style.cssText&&(E.style.cssText=r.columns[_].style??""),d.w2ui.class!=null){if(typeof d.w2ui.class=="string"){let R=["w2ui-odd","w2ui-even","w2ui-record"],M=[];f=d.w2ui.class.split(" ").filter(C=>!!C),u&&m&&(u.classList.forEach(C=>{R.includes(C)||M.push(C)}),u.classList.remove(...M),u.classList.add(...f),m.classList.remove(...M),m.classList.add(...f))}if(b.isPlainObject(d.w2ui.class)&&typeof d.w2ui.class[g.field]=="string"){let R=["w2ui-grid-data"],M=[];y=d.w2ui.class[g.field].split(" ").filter(C=>!!C),E.classList.forEach(C=>{R.includes(C)||M.push(C)}),E.classList.remove(...M),E.classList.add(...y)}}d.w2ui.style!=null&&(u&&m&&typeof d.w2ui.style=="string"&&u.style.cssText!==d.w2ui.style&&(u.style.cssText="height: "+r.recordHeight+"px;"+d.w2ui.style,u.setAttribute("custom_style",d.w2ui.style),m.style.cssText="height: "+r.recordHeight+"px;"+d.w2ui.style,m.setAttribute("custom_style",d.w2ui.style)),b.isPlainObject(d.w2ui.style))&&typeof d.w2ui.style[g.field]=="string"&&E.style.cssText!==d.w2ui.style[g.field]&&(E.style.cssText=d.w2ui.style[g.field])}}}}refreshCell(r,n){var i=this.get(r,!0),n=this.getColumn(n,!0),r=!this.records[i]||this.records[i].recid!=r,o=p(this.box).find(`${r?".w2ui-grid-summary ":""}#grid_${this.name}_data_${i}_`+n);return o.length!=0&&(o.replace(this.getCellHTML(i,n,r)),!0)}refreshRow(e,t=null){let i=p(this.box).find("#grid_"+this.name+"_frec_"+b.escapeId(e)),n=p(this.box).find("#grid_"+this.name+"_rec_"+b.escapeId(e));if(0<i.length){t==null&&(t=this.get(e,!0));var r=i.attr("line"),o=!this.records[t]||this.records[t].recid!=e,a=typeof this.url!="object"?this.url:this.url.get;if(0<this.searchData.length&&!a)for(let c=0;c<this.last.searchIds.length;c++)this.last.searchIds[c]==t&&(t=c);a=this.getRecordHTML(t,r,o),i.replace(a[0]),n.replace(a[1]);let l=this.records[t].w2ui?this.records[t].w2ui.style:"";return typeof l=="string"&&(i=p(this.box).find("#grid_"+this.name+"_frec_"+b.escapeId(e)),n=p(this.box).find("#grid_"+this.name+"_rec_"+b.escapeId(e)),i.attr("custom_style",l),n.attr("custom_style",l),i.hasClass("w2ui-selected")&&(l=l.replace("background-color","none")),i[0].style.cssText="height: "+this.recordHeight+"px;"+l,n[0].style.cssText="height: "+this.recordHeight+"px;"+l),o&&this.resize(),!0}return!1}refresh(){var e=Date.now(),t=typeof this.url!="object"?this.url:this.url.get;if(this.total<=0&&!t&&this.searchData.length===0&&(this.total=this.records.length),this.box&&(t=this.trigger("refresh",{target:this.name}),t.isCancelled!==!0)){this.show.header?p(this.box).find(`#grid_${this.name}_header`).html(b.lang(this.header)+"&#160;").show():p(this.box).find(`#grid_${this.name}_header`).hide(),this.show.toolbar?p(this.box).find("#grid_"+this.name+"_toolbar").show():p(this.box).find("#grid_"+this.name+"_toolbar").hide(),this.searchClose();var i=p(this.box).find("#grid_"+this.name+"_search_all");!this.multiSearch&&this.last.field=="all"&&0<this.searches.length&&(this.last.field=this.searches[0].field,this.last.label=this.searches[0].label);for(let a=0;a<this.searches.length;a++)this.searches[a].field==this.last.field&&(this.last.label=this.searches[a].label);if(this.last.multi?i.attr("placeholder","["+b.lang("Multiple Fields")+"]"):i.attr("placeholder",b.lang("Search")+" "+b.lang(this.last.label,!0)),i.val()!=this.last.search){let a=this.last.search;var n=i._w2field;n&&(a=n.format(a)),i.val(a)}this.refreshSearch(),this.refreshBody(),this.show.footer?p(this.box).find(`#grid_${this.name}_footer`).html(this.getFooterHTML()).show():p(this.box).find(`#grid_${this.name}_footer`).hide();var n=this.last.selection,i=0<this.records.length&&n.indexes.length==this.records.length,n=0<n.indexes.length&&this.searchData.length!==0&&n.indexes.length==this.last.searchIds.length,r=(i||n?p(this.box).find("#grid_"+this.name+"_check_all").prop("checked",!0):p(this.box).find("#grid_"+this.name+"_check_all").prop("checked",!1),this.status(),this.find({"w2ui.expanded":!0},!0,!0));for(let a=0;a<r.length;a++){var o=this.records[r[a]].w2ui;o&&!Array.isArray(o.children)&&(o.expanded=!1)}return this.markSearch&&setTimeout(()=>{var a=[];for(let h=0;h<this.searchData.length;h++){var l=this.searchData[h],c=this.getSearch(l.field);c&&!c.hidden&&(c=this.getColumn(l.field,!0),a.push({field:l.field,search:l.value,col:c}))}0<a.length&&a.forEach(h=>{var d=p(this.box).find('td[col="'+h.col+'"]:not(.w2ui-head)');b.marker(d,h.search)})},50),this.updateToolbar(this.last.selection),t.finish(),this.resize(),this.addRange("selection"),setTimeout(()=>{this.resize(),this.scroll()},1),this.reorderColumns&&!this.last.columnDrag?this.last.columnDrag=this.initColumnDrag():!this.reorderColumns&&this.last.columnDrag&&this.last.columnDrag.remove(),Date.now()-e}}refreshSearch(){if(this.multiSearch&&0<this.searchData.length){p(this.box).find(".w2ui-grid-searches").length==0&&p(this.box).find(".w2ui-grid-toolbar").css("height",this.last.toolbar_height+35+"px").append(`<div id="grid_${this.name}_searches" class="w2ui-grid-searches"></div>`);let e=`
                <span id="grid_${this.name}_search_logic" class="w2ui-grid-search-logic"></span>
                <div class="grid-search-line"></div>`;this.searchData.forEach((t,i)=>{var n=this.getSearch(t.field,!0),r=this.searches[n];let o;if(o=Array.isArray(t.value)?`<span class="grid-search-count">${t.value.length}</span>`:r&&r.type=="list"&&t.text&&t.text!==t.value?": "+t.text:": "+t.value,r&&r.type=="date")if(t.operator=="between"){let a=t.value[0],l=t.value[1];Number(a)===a&&(a=b.formatDate(a)),Number(l)===l&&(l=b.formatDate(l)),o=`: ${a} - `+l}else{let a=t.value,l=(Number(a)==a&&(a=b.formatDate(a)),t.operator);(l=(l=l=="more"?"since":l)=="less"?"before":l).substr(0,5)=="more:"&&(l="since"),o=`: ${l} `+a}e+=`<span class="w2ui-action" data-click="searchFieldTooltip|${n}|${i}|this">
                    ${r?r.label:""}
                    ${o}
                    <span class="icon-chevron-down"></span>
                </span>`}),e+=`
                ${this.show.searchSave?`<div class="grid-search-line"></div>
                       <button class="w2ui-btn grid-search-btn" data-click="searchSave">${b.lang("Save")}</button>
                      `:""}
                <button class="w2ui-btn grid-search-btn btn-remove"
                    data-click="searchReset">X</button>
            `,p(this.box).find(`#grid_${this.name}_searches`).html(e),p(this.box).find(`#grid_${this.name}_search_logic`).html(b.lang(this.last.logic=="AND"?"All":"Any"))}else p(this.box).find(".w2ui-grid-toolbar").css("height",this.last.toolbar_height+"px").find(".w2ui-grid-searches").remove();this.searchSelected?(p(this.box).find(`#grid_${this.name}_search_all`).val(" ").prop("readOnly",!0),p(this.box).find(`#grid_${this.name}_search_name`).show().find(".name-text").html(this.searchSelected.text)):(p(this.box).find(`#grid_${this.name}_search_all`).prop("readOnly",!1),p(this.box).find(`#grid_${this.name}_search_name`).hide().find(".name-text").html("")),b.bindEvents(p(this.box).find(`#grid_${this.name}_searches .w2ui-action, #grid_${this.name}_searches button`),this)}refreshBody(){this.scroll();var t=this.getRecordsHTML(),e=this.getColumnsHTML(),t='<div id="grid_'+this.name+'_frecords" class="w2ui-grid-frecords" style="margin-bottom: '+(b.scrollBarSize()-1)+'px;">'+t[0]+'</div><div id="grid_'+this.name+'_records" class="w2ui-grid-records">'+t[1]+'</div><div id="grid_'+this.name+'_scroll1" class="w2ui-grid-scroll1" style="height: '+b.scrollBarSize()+'px"></div><div id="grid_'+this.name+'_fcolumns" class="w2ui-grid-fcolumns">    <table><tbody>'+e[0]+'</tbody></table></div><div id="grid_'+this.name+'_columns" class="w2ui-grid-columns">    <table><tbody>'+e[1]+`</tbody></table></div><div class="w2ui-intersection-marker" style="display: none; height: ${this.recordHeight-5}px">
               <div class="top-marker"></div>
               <div class="bottom-marker"></div>
            </div>`;let i=p(this.box).find(`#grid_${this.name}_body`,this.box).html(t);e=p(this.box).find(`#grid_${this.name}_records`,this.box),t=p(this.box).find(`#grid_${this.name}_frecords`,this.box),this.selectType=="row"&&(e.on("mouseover mouseout",{delegate:"tr"},n=>{var r=p(n.delegate).attr("recid");p(this.box).find(`#grid_${this.name}_frec_`+b.escapeId(r)).toggleClass("w2ui-record-hover",n.type=="mouseover")}),t.on("mouseover mouseout",{delegate:"tr"},n=>{var r=p(n.delegate).attr("recid");p(this.box).find(`#grid_${this.name}_rec_`+b.escapeId(r)).toggleClass("w2ui-record-hover",n.type=="mouseover")})),b.isIOS?e.append(t).on("click",{delegate:"tr"},n=>{var r=p(n.delegate).attr("recid");this.dblClick(r,n)}):e.add(t).on("click",{delegate:"tr"},n=>{var r=p(n.delegate).attr("recid");r!="-none-"&&this.click(r,n)}).on("contextmenu",{delegate:"tr"},n=>{var r=p(n.delegate).attr("recid"),o=p(n.target).closest("td"),o=parseInt(o.attr("col")??-1);this.showContextMenu(r,o,n)}).on("mouseover",{delegate:"tr"},n=>{this.last.rec_out=!1;let r=p(n.delegate).attr("index"),o=p(n.delegate).attr("recid");r!==this.last.rec_over&&(this.last.rec_over=r,setTimeout(()=>{delete this.last.rec_out,this.trigger("mouseEnter",{target:this.name,originalEvent:n,index:r,recid:o}).finish()}))}).on("mouseout",{delegate:"tr"},n=>{let r=p(n.delegate).attr("index"),o=p(n.delegate).attr("recid");this.last.rec_out=!0,setTimeout(()=>{let a=()=>{this.trigger("mouseLeave",{target:this.name,originalEvent:n,index:r,recid:o}).finish()};r!==this.last.rec_over&&a(),setTimeout(()=>{this.last.rec_out&&(delete this.last.rec_out,delete this.last.rec_over,a())})})}),i.data("scroll",{lastDelta:0,lastTime:0}).find(".w2ui-grid-frecords").on("mousewheel DOMMouseScroll ",a=>{a.preventDefault();var r=i.data("scroll"),o=i.find(".w2ui-grid-records"),a=typeof a.wheelDelta!=null?-a.wheelDelta:a.detail||a.deltaY,l=o.prop("scrollTop");r.lastDelta+=a,a=Math.round(r.lastDelta),i.data("scroll",r),o.get(0).scroll({top:l+a,behavior:"smooth"})}),e.off(".body-global").on("scroll.body-global",{delegate:".w2ui-grid-records"},n=>{this.scroll(n)}),p(this.box).find(".w2ui-grid-body").off(".body-global").on("click.body-global dblclick.body-global contextmenu.body-global",{delegate:"td.w2ui-head"},n=>{var r=p(n.delegate).attr("col"),o=this.columns[r]??{field:r};switch(n.type){case"click":this.columnClick(o.field,n);break;case"dblclick":this.columnDblClick(o.field,n);break;case"contextmenu":this.columnContextMenu(o.field,n)}}).on("mouseover.body-global",{delegate:".w2ui-col-header"},n=>{let r=p(n.delegate).parent().attr("col");this.columnTooltipShow(r,n),p(n.delegate).off(".tooltip").on("mouseleave.tooltip",()=>{this.columnTooltipHide(r,n)})}).on("click.body-global",{delegate:"input.w2ui-select-all"},n=>{n.delegate.checked?this.selectAll():this.selectNone(),n.stopPropagation(),clearTimeout(this.last.kbd_timer)}).on("click.body-global",{delegate:".w2ui-show-children, .w2ui-col-expand"},n=>{n.stopPropagation(),this.toggle(p(n.target).parents("tr").attr("recid"))}).on("click.body-global mouseover.body-global",{delegate:".w2ui-info"},n=>{var c,h;var r=p(n.delegate).closest("td"),o=r.parent(),a=this.columns[r.attr("col")],l=o.parents(".w2ui-grid-body").hasClass("w2ui-grid-summary");["mouseenter","mouseover"].includes((h=(c=a.info)==null?void 0:c.showOn)==null?void 0:h.toLowerCase())&&n.type=="mouseover"?this.showBubble(o.attr("index"),r.attr("col"),l).then(()=>{p(n.delegate).off(".tooltip").on("mouseleave.tooltip",()=>{Ne.hide(this.name+"-bubble")})}):n.type=="click"&&(Ne.hide(this.name+"-bubble"),this.showBubble(o.attr("index"),r.attr("col"),l))}).on("mouseover.body-global",{delegate:".w2ui-clipboard-copy"},n=>{if(!n.delegate._tooltipShow){let o=p(n.delegate).parent(),a=o.parent();var r=this.columns[o.attr("col")];let l=a.parents(".w2ui-grid-body").hasClass("w2ui-grid-summary");Ne.show({name:this.name+"-bubble",anchor:n.delegate,html:b.lang(typeof r.clipboardCopy=="string"?r.clipboardCopy:"Copy to clipboard"),position:"top|bottom",offsetY:-2}).hide(c=>{n.delegate._tooltipShow=!1,p(n.delegate).off(".tooltip")}),p(n.delegate).off(".tooltip").on("mouseleave.tooltip",c=>{Ne.hide(this.name+"-bubble")}).on("click.tooltip",c=>{c.stopPropagation(),Ne.update(this.name+"-bubble",b.lang("Copied")),this.clipboardCopy(a.attr("index"),o.attr("col"),l)}),n.delegate._tooltipShow=!0}}).on("click.body-global",{delegate:".w2ui-editable-checkbox"},n=>{var r=p(n.delegate).data();this.editChange.call(this,n.delegate,r.changeind,r.colind,n),this.updateToolbar()}),this.records.length===0&&this.msgEmpty?p(this.box).find(`#grid_${this.name}_body`).append(`<div id="grid_${this.name}_empty_msg" class="w2ui-grid-empty-msg"><div>${b.lang(this.msgEmpty)}</div></div>`):0<p(this.box).find(`#grid_${this.name}_empty_msg`).length&&p(this.box).find(`#grid_${this.name}_empty_msg`).remove(),0<this.summary.length?(t=this.getSummaryHTML(),p(this.box).find(`#grid_${this.name}_fsummary`).html(t[0]).show(),p(this.box).find(`#grid_${this.name}_summary`).html(t[1]).show()):(p(this.box).find(`#grid_${this.name}_fsummary`).hide(),p(this.box).find(`#grid_${this.name}_summary`).hide())}render(e){var t=Date.now();let i=this;typeof e=="string"&&(e=p(e).get(0));var n=this.trigger("render",{target:this.name,box:e??this.box});if(n.isCancelled!==!0&&(e!=null&&(0<p(this.box).find(`#grid_${this.name}_body`).length&&p(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-grid w2ui-inactive").html(""),this.box=e),this.box)){let a=function(h){var R,M;if(h.target.tagName){var d=i.last.move;if(d&&["select","select-column"].indexOf(d.type)!=-1&&(d.divX=h.screenX-d.x,d.divY=h.screenY-d.y,!(Math.abs(d.divX)<=1&&Math.abs(d.divY)<=1)))if(i.last.cancelClick=!0,i.reorderRows==1&&i.last.move.reorder){let C=p(h.target).parents("tr").attr("recid");(C=C=="-none-"?"bottom":C)!=d.from&&(m=p(i.box).find("#grid_"+i.name+"_rec_"+C),p(i.box).find(".insert-before"),m.addClass("insert-before"),d.lastY=h.screenY,d.to=C,m={top:(R=m.get(0))==null?void 0:R.offsetTop,left:(M=m.get(0))==null?void 0:M.offsetLeft},p(i.box).find("#grid_"+i.name+"_ghost_line").css({top:m.top+"px",left:d.pos.left+"px","border-top":"2px solid #769EFC"})),p(i.box).find("#grid_"+i.name+"_ghost").css({top:d.pos.top+d.divY+"px",left:d.pos.left+"px"})}else{d.start&&d.recid&&(i.selectNone(),d.start=!1);var u=[],m=(h.target.tagName.toUpperCase()=="TR"?p(h.target):p(h.target).parents("tr")).attr("recid");if(m==null){if(i.selectType!="row"&&(!i.last.move||i.last.move.type!="select")){var f=parseInt(p(h.target).parents("td").attr("col"));if(isNaN(f))i.removeRange("column-selection"),p(i.box).find(".w2ui-grid-columns .w2ui-col-header, .w2ui-grid-fcolumns .w2ui-col-header").removeClass("w2ui-col-selected"),p(i.box).find(".w2ui-col-number").removeClass("w2ui-row-selected"),delete d.colRange;else{let C=f+"-"+f;d.column<f&&(C=d.column+"-"+f);var _=[],g=(C=d.column>f?f+"-"+d.column:C).split("-");for(let P=parseInt(g[0]);P<=parseInt(g[1]);P++)_.push(P);if(d.colRange!=C&&(o=i.trigger("columnSelect",{target:i.name,columns:_})).isCancelled!==!0){d.colRange==null&&i.selectNone();var v=C.split("-");p(i.box).find(".w2ui-grid-columns .w2ui-col-header, .w2ui-grid-fcolumns .w2ui-col-header").removeClass("w2ui-col-selected");for(let P=parseInt(v[0]);P<=parseInt(v[1]);P++)p(i.box).find("#grid_"+i.name+"_column_"+P+" .w2ui-col-header").addClass("w2ui-col-selected");p(i.box).find(".w2ui-col-number").not(".w2ui-head").addClass("w2ui-row-selected"),d.colRange=C,i.removeRange("column-selection"),i.addRange({name:"column-selection",range:[{recid:i.records[0].recid,column:v[0]},{recid:i.records[i.records.length-1].recid,column:v[1]}],style:"background-color: rgba(90, 145, 234, 0.1)"})}}}}else{let C=i.get(d.recid,!0);if(!(C==null||i.records[C]&&i.records[C].recid!=d.recid)){let P=i.get(m,!0);if(P!=null){let N=parseInt(d.column),w=parseInt((h.target.tagName.toUpperCase()=="TD"?p(h.target):p(h.target).parents("td")).attr("col"));isNaN(N)&&isNaN(w)&&(N=0,w=i.columns.length-1),C>P&&(f=C,C=P,P=f);var y,m="ind1:"+C+",ind2;"+P+",col1:"+N+",col2:"+w;if(d.range!=m){d.range=m;for(let D=C;D<=P;D++)if(!(0<i.last.searchIds.length&&i.last.searchIds.indexOf(D)==-1))if(i.selectType!="row"){N>w&&(y=N,N=w,w=y);for(let I=N;I<=w;I++)i.columns[I].hidden||u.push({recid:i.records[D].recid,column:parseInt(I)})}else u.push(i.records[D].recid);if(i.selectType!="row"){var x=i.getSelection();let D=[];for(let I=0;I<u.length;I++){let V=!1;for(let q=0;q<x.length;q++)u[I].recid==x[q].recid&&u[I].column==x[q].column&&(V=!0);V||D.push({recid:u[I].recid,column:u[I].column})}i.select(D),D=[];for(let I=0;I<x.length;I++){let V=!1;for(let q=0;q<u.length;q++)u[q].recid==x[I].recid&&u[q].column==x[I].column&&(V=!0);V||D.push({recid:x[I].recid,column:x[I].column})}i.unselect(D)}else if(i.multiSelect){var E=i.getSelection();for(let D=0;D<u.length;D++)E.indexOf(u[D])==-1&&i.select(u[D]);for(let D=0;D<E.length;D++)u.indexOf(E[D])==-1&&i.unselect(E[D])}}}}}}}},l=function(h){var d=i.last.move;if(setTimeout(()=>{delete i.last.cancelClick},1),!p(h.target).parents().hasClass(".w2ui-head")&&!p(h.target).hasClass(".w2ui-head")){if(d&&["select","select-column"].indexOf(d.type)!=-1){if(d.colRange!=null&&o.isCancelled!==!0){var u=d.colRange.split("-"),m=[];for(let g=0;g<i.records.length;g++){var f=[];for(let v=parseInt(u[0]);v<=parseInt(u[1]);v++)f.push(v);m.push({recid:i.records[g].recid,column:f})}i.removeRange("column-selection"),o.finish(),i.select(m)}if(i.reorderRows==1&&i.last.move.reorder)if(d.to!=null){if(h=i.trigger("reorderRow",{target:i.name,recid:d.from,moveBefore:d.to}),h.isCancelled===!0)return c(),void delete i.last.move;var _=i.get(d.from,!0);let g=i.get(d.to,!0);d.to=="bottom"&&(g=i.records.length),d=i.records[_],_!=null&&g!=null&&(i.records.splice(_,1),_>g?i.records.splice(g,0,d):i.records.splice(g-1,0,d)),i.sortData=[],p(i.box).find(`#grid_${i.name}_columns .w2ui-col-header`).removeClass("w2ui-col-sorted"),c(),h.finish()}else c()}delete i.last.move,p(document).off(".w2ui-"+i.name)}},c=function(){p(i.box).find(`#grid_${i.name}_ghost`).remove(),p(i.box).find(`#grid_${i.name}_ghost_line`).remove(),i.refresh(),delete i.last.move};if(e=typeof this.url!="object"?this.url:this.url.get,this.reset(!0),!this.last.field)if(this.multiSearch&&this.show.searchAll)this.last.field="all",this.last.label="All Fields";else{let h=0;for(;h<this.searches.length&&(this.searches[h].hidden||this.searches[h].simple===!1);)h++;h>=this.searches.length?(this.last.field="",this.last.label=""):(this.last.field=this.searches[h].field,this.last.label=this.searches[h].label)}if(p(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-grid w2ui-inactive").html('<div class="w2ui-grid-box">    <div id="grid_'+this.name+'_header" class="w2ui-grid-header"></div>    <div id="grid_'+this.name+'_toolbar" class="w2ui-grid-toolbar"></div>    <div id="grid_'+this.name+'_body" class="w2ui-grid-body"></div>    <div id="grid_'+this.name+'_fsummary" class="w2ui-grid-body w2ui-grid-summary"></div>    <div id="grid_'+this.name+'_summary" class="w2ui-grid-body w2ui-grid-summary"></div>    <div id="grid_'+this.name+'_footer" class="w2ui-grid-footer"></div>    <textarea id="grid_'+this.name+'_focus" class="w2ui-grid-focus-input" '+(this.tabIndex?'tabindex="'+this.tabIndex+'"':"")+(b.isIOS?"readonly":"")+"></textarea></div>"),this.selectType!="row"&&p(this.box).addClass("w2ui-ss"),0<p(this.box).length&&(p(this.box)[0].style.cssText+=this.style),this.initToolbar(),this.toolbar!=null&&this.toolbar.render(p(this.box).find("#grid_"+this.name+"_toolbar")[0]),this.last.toolbar_height=p(this.box).find(`#grid_${this.name}_toolbar`).prop("offsetHeight"),this.last.field&&this.last.field!="all"){let h=this.searchData;setTimeout(()=>{this.searchInitInput(this.last.field,h.length==1?h[0].value:null)},1)}p(this.box).find(`#grid_${this.name}_footer`).html(this.getFooterHTML()),this.last.state||(this.last.state=this.stateSave(!0)),this.stateRestore(),e&&(this.clear(),this.refresh());let r=!1;for(let h=0;h<this.searches.length;h++)if(this.searches[h].hidden){r=!0;break}r?(this.searchReset(!1),e||setTimeout(()=>{this.searchReset()},1)):this.reload(),p(this.box).find(`#grid_${this.name}_focus`).on("focus",h=>{clearTimeout(this.last.kbd_timer),this.hasFocus||this.focus()}).on("blur",h=>{clearTimeout(this.last.kbd_timer),this.last.kbd_timer=setTimeout(()=>{this.hasFocus&&this.blur()},100)}).on("paste",h=>{var d=h.clipboardData||null;if(d){let f=d.items,_=[];for(var u in f=f.length==2&&(f=f.length==2&&f[1].kind=="file"?[f[1]]:f).length==2&&f[0].type=="text/plain"&&f[1].type=="text/html"?[f[1]]:f)if(u=f[u],u.kind==="file"){var m=u.getAsFile();_.push({kind:"file",data:m})}else if(u.kind==="string"&&(u.type==="text/plain"||u.type==="text/html")){h.preventDefault();let g=d.getData("text/plain");g.indexOf("\r")!=-1&&g.indexOf(`
`)==-1&&(g=g.replace(/\r/g,`
`)),_.push({kind:u.type=="text/html"?"html":"text",data:g})}_.length===1&&_[0].kind!="file"&&(_=_[0].data),xt[this.name].paste(_,h),h.preventDefault()}}).on("keydown",function(h){xt[i.name].keydown.call(xt[i.name],h)});let o;return p(this.box).off("mousedown.mouseStart").on("mousedown.mouseStart",function(h){if(h.which==1&&(i.last.userSelect=="text"&&(i.last.userSelect="",p(i.box).find(".w2ui-grid-body").css("user-select","none")),!(i.selectType=="row"&&(p(h.target).parents().hasClass("w2ui-head")||p(h.target).hasClass("w2ui-head"))||i.last.move&&i.last.move.type=="expand"))){if(h.altKey)p(i.box).find(".w2ui-grid-body").css("user-select","text"),i.selectNone(),i.last.move={type:"text-select"},i.last.userSelect="text";else{let v=h.target;var d={x:h.offsetX-10,y:h.offsetY-10};let y=!1;for(;v&&(!v.classList||!v.classList.contains("w2ui-grid"));)v.tagName&&v.tagName.toUpperCase()=="TD"&&(y=!0),v.tagName&&v.tagName.toUpperCase()!="TR"&&y==1&&(d.x+=v.offsetLeft,d.y+=v.offsetTop),v=v.parentNode;i.last.move={x:h.screenX,y:h.screenY,divX:0,divY:0,focusX:d.x,focusY:d.y,recid:p(h.target).parents("tr").attr("recid"),column:parseInt((h.target.tagName.toUpperCase()=="TD"?p(h.target):p(h.target).parents("td")).attr("col")),type:"select",ghost:!1,start:!0},i.last.move.recid==null&&(i.last.move.type="select-column");let x=h.target,E=p(i.box).find("#grid_"+i.name+"_focus");if(i.last.move){let R=i.last.move.focusX,M=i.last.move.focusY;var u=p(x).parents("table").parent();(u.hasClass("w2ui-grid-records")||u.hasClass("w2ui-grid-frecords")||u.hasClass("w2ui-grid-columns")||u.hasClass("w2ui-grid-fcolumns")||u.hasClass("w2ui-grid-summary"))&&(R=i.last.move.focusX-p(i.box).find("#grid_"+i.name+"_records").prop("scrollLeft"),M=i.last.move.focusY-p(i.box).find("#grid_"+i.name+"_records").prop("scrollTop")),(p(x).hasClass("w2ui-grid-footer")||0<p(x).parents("div.w2ui-grid-footer").length)&&(M=p(i.box).find("#grid_"+i.name+"_footer").get(0).offsetTop),u.hasClass("w2ui-scroll-wrapper")&&u.parent().hasClass("w2ui-toolbar")&&(R=i.last.move.focusX-u.prop("scrollLeft")),E.css({left:R-10,top:M})}setTimeout(()=>{var R;i.last.inEditMode||(["INPUT","TEXTAREA","SELECT"].includes(x.tagName)?x.focus():E.get(0)!==document.active&&((R=E.get(0))==null||R.focus({preventScroll:!0})))},50),i.multiSelect||i.reorderRows||i.last.move.type!="drag"||delete i.last.move}if(i.reorderRows==1){let v=h.target;var m,f,_,g;v.tagName.toUpperCase()!="TD"&&(v=p(v).parents("td")[0]),p(v).hasClass("w2ui-col-number")||p(v).hasClass("w2ui-col-order")?(i.selectNone(),i.last.move.reorder=!0,u=p(i.box).find(".w2ui-even.w2ui-empty-record").css("background-color"),m=p(i.box).find(".w2ui-odd.w2ui-empty-record").css("background-color"),p(i.box).find(".w2ui-even td").filter(":not(.w2ui-col-number)").css("background-color",u),p(i.box).find(".w2ui-odd td").filter(":not(.w2ui-col-number)").css("background-color",m),m=i.last.move,f=p(i.box).find(".w2ui-grid-records"),m.ghost||(_=p(i.box).find(`#grid_${i.name}_rec_`+m.recid),g=_.parents("table").find("tr:first-child").get(0).cloneNode(!0),m.offsetY=h.offsetY,m.from=m.recid,m.pos={top:_.get(0).offsetTop-1,left:_.get(0).offsetLeft},m.ghost=p(_.get(0).cloneNode(!0)),m.ghost.removeAttr("id"),m.ghost.find("td").css({"border-top":"1px solid silver","border-bottom":"1px solid silver"}),_.find("td").remove(),_.append(`<td colspan="1000"><div class="w2ui-reorder-empty" style="height: ${i.recordHeight-2}px"></div></td>`),f.append('<div id="grid_'+i.name+'_ghost_line" style="position: absolute; z-index: 999999; pointer-events: none; width: 100%;"></div>'),f.append('<table id="grid_'+i.name+'_ghost" style="position: absolute; z-index: 999998; opacity: 0.9; pointer-events: none;"></table>'),p(i.box).find("#grid_"+i.name+"_ghost").append(g).append(m.ghost)),p(i.box).find("#grid_"+i.name+"_ghost").css({top:m.pos.top+"px",left:m.pos.left+"px"})):i.last.move.reorder=!1}p(document).on("mousemove.w2ui-"+i.name,a).on("mouseup.w2ui-"+i.name,l),h.stopPropagation()}}),this.updateToolbar(),n.finish(),this.last.observeResize=new ResizeObserver(()=>{this.resize()}),this.last.observeResize.observe(this.box),Date.now()-t}}destroy(){var t;var e=this.trigger("destroy",{target:this.name});e.isCancelled!==!0&&(p(this.box).off(),typeof this.toolbar=="object"&&this.toolbar.destroy&&this.toolbar.destroy(),0<p(this.box).find(`#grid_${this.name}_body`).length&&p(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-grid w2ui-inactive").html(""),(t=this.last.observeResize)==null||t.disconnect(),delete xt[this.name],e.finish())}initColumnOnOff(){var e,t=[{id:"line-numbers",text:"Line #",checked:this.show.lineNumbers}];for(let r=0;r<this.columns.length;r++){var i=this.columns[r];let o=this.columns[r].text;i.hideable!==!1&&(o=(o=!o&&this.columns[r].tooltip?this.columns[r].tooltip:o)||"- column "+(parseInt(r)+1)+" -",t.push({id:i.field,text:b.stripTags(o),checked:!i.hidden}))}((typeof this.url!="object"?this.url:this.url.get)&&this.show.skipRecords||this.show.saveRestoreState)&&t.push({text:"--"}),this.show.skipRecords&&(e=b.lang("Skip")+`<input id="${this.name}_skip" type="text" class="w2ui-input w2ui-grid-skip" value="${this.offset}">`+b.lang("records"),t.push({id:"w2ui-skip",text:e,group:!1,icon:"w2ui-icon-empty"})),this.show.saveRestoreState&&t.push({id:"w2ui-stateSave",text:b.lang("Save Grid State"),icon:"w2ui-icon-empty",group:!1},{id:"w2ui-stateReset",text:b.lang("Restore Default State"),icon:"w2ui-icon-empty",group:!1});let n=[];return t.forEach(r=>{r.text=b.lang(r.text),r.checked&&n.push(r.id)}),this.toolbar.set("w2ui-column-on-off",{selected:n,items:t}),t}initColumnDrag(e){if(this.columnGroups&&this.columnGroups.length)throw"Draggable columns are not currently supported with column groups.";let t=this,i={pressed:!1,targetPos:null,columnHead:null},n=(a,l)=>{var c=["w2ui-col-number","w2ui-col-expand","w2ui-col-select"];l!==!0&&c.push("w2ui-head-last");for(let h=0;h<c.length;h++)if(p(a).closest(".w2ui-head").hasClass(c[h]))return!0;return!1};function r(a){var l,c,h,d;i.pressed&&i.columnHead&&(l=a.pageX,c=a.pageY,n(a.target,!0)||(a=a,p(a.target).closest("td").length!=0&&(d=p(t.box).find(".w2ui-grid-body").get(0).getBoundingClientRect(),h=p(a.target).closest("td").get(0).getBoundingClientRect(),p(t.box).find(".w2ui-intersection-marker").show().css({left:h.left-d.left+"px"}),h=p(a.target).closest("td"),i.targetPos=h.hasClass("w2ui-head-last")?t.columns.length:parseInt(h.attr("col")))),d=l,a=c,p(i.ghost).css({left:d-10+"px",top:a-10+"px"}).show())}function o(a){if(i.pressed&&i.columnHead){i.pressed=!1;var l,c,h=()=>{var d=p(t.box).find(".w2ui-grid-ghost");p(t.box).find(".w2ui-intersection-marker").hide(),p(i.ghost).remove(),d.remove(),p(document).off(".colDrag"),i={}};if(a.pageX==i.initialX&&a.pageY==i.initialY)t.columnClick(t.columns[i.originalPos].field,a),h();else{if((a=t.trigger("columnDragEnd",{originalEvent:a,target:i.columnHead[0],dragData:i})).isCancelled===!0)return!1;l=t.columns[i.originalPos],c=t.columns,i.originalPos!=i.targetPos&&i.targetPos!=null&&(c.splice(i.targetPos,0,b.clone(l)),c.splice(c.indexOf(l),1)),h(),t.refresh(),a.finish({targetColumn:NaN})}}}return p(t.box).off(".colDrag").on("mousedown.colDrag",function(a){if(!i.pressed&&i.numberPreColumnsPresent!==0&&a.button===0){var l,c;if(p(a.target).parents().hasClass("w2ui-head")&&!n(a.target)){if(i.pressed=!0,i.initialX=a.pageX,i.initialY=a.pageY,i.numberPreColumnsPresent=p(t.box).find(".w2ui-head.w2ui-col-number, .w2ui-head.w2ui-col-expand, .w2ui-head.w2ui-col-select").length,i.columnHead=h=p(a.target).closest(".w2ui-head"),i.originalPos=c=parseInt(h.attr("col"),10),(c=t.trigger("columnDragStart",{originalEvent:a,origColumnNumber:c,target:h[0]})).isCancelled===!0)return!1;l=i.columns=p(t.box).find(".w2ui-head:not(.w2ui-head-last)"),p(document).on("mouseup.colDrag",o),p(document).on("mousemove.colDrag",r);var h=t.columns[i.originalPos],h=b.lang(typeof h.text=="function"?h.text(h):h.text);i.ghost=p.html(`<span col="${i.originalPos}">${h}</span>`)[0],p(document.body).append(i.ghost),p(i.ghost).css({display:"none",left:a.pageX,top:a.pageY,opacity:1,margin:"3px 0 0 20px",padding:"3px","background-color":"white",position:"fixed","z-index":999999}).addClass(".w2ui-grid-ghost"),i.offsets=[];for(let u=0,m=l.length;u<m;u++){var d=l[u].getBoundingClientRect();i.offsets.push(d.left)}c.finish()}}}),{remove(){p(t.box).off(".colDrag"),t.last.columnDrag=!1}}}columnOnOff(e,t){if(e=this.trigger("columnOnOff",{target:this.name,field:t,originalEvent:e}),e.isCancelled!==!0){var i=this.find({"w2ui.expanded":!0},!0);for(let r=0;r<i.length;r++){var n=this.records[r].w2ui;n&&!Array.isArray(n.children)&&(this.records[r].w2ui.expanded=!1)}t=="line-numbers"?(this.show.lineNumbers=!this.show.lineNumbers,this.refresh()):(t=this.getColumn(t)).hidden?this.showColumn(t.field):this.hideColumn(t.field),e.finish()}}initToolbar(){if(this.toolbar.render==null){let t=this.toolbar.items||[];var e;this.toolbar.items=[],this.toolbar=new hf(b.extend({},this.toolbar,{name:this.name+"_toolbar",owner:this})),this.show.toolbarReload&&this.toolbar.items.push(b.extend({},this.buttons.reload)),this.show.toolbarColumns&&this.toolbar.items.push(b.extend({},this.buttons.columns)),this.show.toolbarSearch&&(e=`
                <div class="w2ui-grid-search-input">
                    ${this.buttons.search.html}
                    <div id="grid_${this.name}_search_name" class="w2ui-grid-search-name">
                        <span class="name-icon w2ui-icon-search"></span>
                        <span class="name-text"></span>
                        <span class="name-cross w2ui-action" data-click="searchReset">x</span>
                    </div>
                    <input type="text" id="grid_${this.name}_search_all" class="w2ui-search-all" tabindex="-1"
                        autocapitalize="off" autocomplete="off" autocorrect="off" spellcheck="false"
                        placeholder="${b.lang(this.last.label,!0)}" value="${this.last.search}"
                        data-focus="searchSuggest" data-click="stop"
                    >
                    <div class="w2ui-search-drop w2ui-action" data-click="searchOpen"
                            style="${this.multiSearch?"":"display: none"}">
                        <span class="w2ui-icon-drop"></span>
                    </div>
                </div>`,this.toolbar.items.push({id:"w2ui-search",type:"html",html:e,onRefresh:async n=>{await n.complete;var n=p(this.box).find(`#grid_${this.name}_search_all`),r=(b.bindEvents(p(this.box).find(`#grid_${this.name}_search_all, .w2ui-action`),this),b.debounce(o=>{var a=o.target.value;this.liveSearch&&this.last.liveText!=a&&(this.last.liveText=a,this.search(this.last.field,a)),o.keyCode==40&&this.searchSuggest(!0)},250));n.on("change",o=>{this.liveSearch||(this.search(this.last.field,o.target.value),this.searchSuggest(!0,!0,this))}).on("blur",()=>{this.last.liveText=""}).on("keyup",r)}})),Array.isArray(t)&&(e=t.map(i=>i.id),this.show.toolbarAdd&&!e.includes(this.buttons.add.id)&&this.toolbar.items.push(b.extend({},this.buttons.add)),this.show.toolbarEdit&&!e.includes(this.buttons.edit.id)&&this.toolbar.items.push(b.extend({},this.buttons.edit)),this.show.toolbarDelete&&!e.includes(this.buttons.delete.id)&&this.toolbar.items.push(b.extend({},this.buttons.delete)),this.show.toolbarSave&&!e.includes(this.buttons.save.id)&&((this.show.toolbarAdd||this.show.toolbarDelete||this.show.toolbarEdit)&&this.toolbar.items.push({type:"break",id:"w2ui-break2"}),this.toolbar.items.push(b.extend({},this.buttons.save))),t=t.map(i=>this.buttons[i.name]?b.extend({},this.buttons[i.name],i):i)),this.toolbar.items.push(...t),this.toolbar.on("click",i=>{var n=this.trigger("toolbar",{target:i.target,originalEvent:i});if(n.isCancelled!==!0){let o;switch(i.detail.item.id){case"w2ui-reload":if((o=this.trigger("reload",{target:this.name})).isCancelled===!0)return!1;this.reload(),o.finish();break;case"w2ui-column-on-off":i.detail.subItem?(r=i.detail.subItem.id,["w2ui-stateSave","w2ui-stateReset"].includes(r)?this[r.substring(5)]():r!="w2ui-skip"&&this.columnOnOff(i,i.detail.subItem.id)):(this.initColumnOnOff(),setTimeout(()=>{p(`#w2overlay-${this.name}_toolbar-drop .w2ui-grid-skip`).off(".w2ui-grid").on("click.w2ui-grid",a=>{a.stopPropagation()}).on("keypress",a=>{a.keyCode==13&&(this.skip(a.target.value),this.toolbar.click("w2ui-column-on-off"))})},100));break;case"w2ui-add":if((o=this.trigger("add",{target:this.name,recid:null})).isCancelled===!0)return!1;o.finish();break;case"w2ui-edit":{var r=this.getSelection();let a=null;if(r.length==1&&(a=r[0]),(o=this.trigger("edit",{target:this.name,recid:a})).isCancelled===!0)return!1;o.finish();break}case"w2ui-delete":this.delete();break;case"w2ui-save":this.save()}n.finish()}}),this.toolbar.on("refresh",i=>{if(i.target=="w2ui-search"){let n=this.searchData;setTimeout(()=>{this.searchInitInput(this.last.field,n.length==1?n[0].value:null)},1)}})}}initResize(){let e=this;p(this.box).find(".w2ui-resizer").off(".grid-col-resize").on("click.grid-col-resize",function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.preventDefault&&t.preventDefault()}).on("mousedown.grid-col-resize",function(t){t=t||window.event,e.last.colResizing=!0,e.last.tmp={x:t.screenX,y:t.screenY,gx:t.screenX,gy:t.screenY,col:parseInt(p(this).attr("name"))},e.last.tmp.tds=p(e.box).find("#grid_"+e.name+'_body table tr:first-child td[col="'+e.last.tmp.col+'"]'),t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.preventDefault&&t.preventDefault();for(let r=0;r<e.columns.length;r++)e.columns[r].hidden||(e.columns[r].sizeOriginal==null&&(e.columns[r].sizeOriginal=e.columns[r].size),e.columns[r].size=e.columns[r].sizeCalculated);let i={phase:"before",type:"columnResize",target:e.name,column:e.last.tmp.col,field:e.columns[e.last.tmp.col].field};i=e.trigger(b.extend(i,{resizeBy:0,originalEvent:t}));let n;p(document).off(".grid-col-resize").on("mousemove.grid-col-resize",function(r){var o;e.last.colResizing==1&&(r=r||window.event,(i=e.trigger(b.extend(i,{resizeBy:r.screenX-e.last.tmp.gx,originalEvent:r}))).isCancelled===!0?i.isCancelled=!1:(e.last.tmp.x=r.screenX-e.last.tmp.x,e.last.tmp.y=r.screenY-e.last.tmp.y,o=parseInt(e.columns[e.last.tmp.col].size)+e.last.tmp.x+"px",e.columns[e.last.tmp.col].size=o,n&&clearTimeout(n),n=setTimeout(()=>{e.resizeRecords(),e.scroll()},100),e.last.tmp.tds.css({width:o}),e.last.tmp.x=r.screenX,e.last.tmp.y=r.screenY))}).on("mouseup.grid-col-resize",function(r){p(document).off(".grid-col-resize"),e.resizeRecords(),e.scroll(),i.finish({originalEvent:r}),setTimeout(()=>{e.last.colResizing=!1},1)})}).on("dblclick.grid-col-resize",function(t){let i=parseInt(p(this).attr("name")),n=e.columns[i],r=0;if(n.autoResize===!1)return!0;t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.preventDefault&&t.preventDefault(),p(e.box).find('.w2ui-grid-records td[col="'+i+'"] > div',e.box).each(()=>{var a=this.offsetWidth-this.scrollWidth;a<r&&(r=a-3)});var o={phase:"before",type:"columnAutoResize",target:e.name,column:n,field:n.field};(o=e.trigger(b.extend(o,{resizeBy:Math.abs(r),originalEvent:t}))).isCancelled===!0?o.isCancelled=!1:(r<0&&(n.size=Math.min(parseInt(n.size)+Math.abs(r),n.max||1/0)+"px",e.resizeRecords(),e.resizeRecords(),e.scroll()),o.finish({originalEvent:t}))}).each(t=>{var i=p(t).get(0).parentNode;p(t).css({height:i.clientHeight+"px","margin-left":i.clientWidth-3+"px"})})}resizeBoxes(){var e=p(this.box).find(`#grid_${this.name}_header`),t=p(this.box).find(`#grid_${this.name}_toolbar`),i=p(this.box).find(`#grid_${this.name}_fsummary`),n=p(this.box).find(`#grid_${this.name}_summary`),r=p(this.box).find(`#grid_${this.name}_footer`),o=p(this.box).find(`#grid_${this.name}_body`);this.show.header&&e.css({top:"0px",left:"0px",right:"0px"}),this.show.toolbar&&t.css({top:0+(this.show.header?b.getSize(e,"height"):0)+"px",left:"0px",right:"0px"}),0<this.summary.length&&(i.css({bottom:0+(this.show.footer?b.getSize(r,"height"):0)+"px"}),n.css({bottom:0+(this.show.footer?b.getSize(r,"height"):0)+"px",right:"0px"})),this.show.footer&&r.css({bottom:"0px",left:"0px",right:"0px"}),o.css({top:0+(this.show.header?b.getSize(e,"height"):0)+(this.show.toolbar?b.getSize(t,"height"):0)+"px",bottom:0+(this.show.footer?b.getSize(r,"height"):0)+(0<this.summary.length?b.getSize(n,"height"):0)+"px",left:"0px",right:"0px"})}resizeRecords(){var X,oe,ae,fe,ze,Se;let e=this;p(this.box).find(".w2ui-empty-record").remove();var t,i,n=p(this.box),r=p(this.box).find(":scope > div.w2ui-grid-box"),o=p(this.box).find(`#grid_${this.name}_header`),a=p(this.box).find(`#grid_${this.name}_toolbar`),l=p(this.box).find(`#grid_${this.name}_summary`),c=p(this.box).find(`#grid_${this.name}_fsummary`),h=p(this.box).find(`#grid_${this.name}_footer`),d=p(this.box).find(`#grid_${this.name}_body`),u=p(this.box).find(`#grid_${this.name}_columns`),m=p(this.box).find(`#grid_${this.name}_fcolumns`),f=p(this.box).find(`#grid_${this.name}_records`),_=p(this.box).find(`#grid_${this.name}_frecords`),g=p(this.box).find(`#grid_${this.name}_scroll1`);let v=8*String(this.total).length+10,y=(v<34&&(v=34),this.lineNumberWidth!=null&&(v=this.lineNumberWidth),!1),x=!1,E=0;for(let U=0;U<this.columns.length;U++)this.columns[U].frozen||this.columns[U].hidden||(t=parseInt(this.columns[U].sizeCalculated||this.columns[U].size),E+=t);((X=f[0])==null?void 0:X.clientWidth)<E&&(y=!0),((oe=d[0])==null?void 0:oe.clientHeight)-(((ae=u[0])==null?void 0:ae.clientHeight)??0)<(((fe=p(f).find(":scope > table")[0])==null?void 0:fe.clientHeight)??0)+(y?b.scrollBarSize():0)&&(x=!0),this.fixedBody?(i=((ze=r[0])==null?void 0:ze.clientHeight)-(this.show.header?b.getSize(o,"height"):0)-(this.show.toolbar?b.getSize(a,"height"):0)-(l.css("display")!="none"?b.getSize(l,"height"):0)-(this.show.footer?b.getSize(h,"height"):0),d.css("height",i+"px")):(o=(i=b.getSize(u,"height")+b.getSize(p(this.box).find("#grid_"+this.name+"_records table"),"height")+(y?b.scrollBarSize():0))+(this.show.header?b.getSize(o,"height"):0)+(this.show.toolbar?b.getSize(a,"height"):0)+(l.css("display")!="none"?b.getSize(l,"height"):0)+(this.show.footer?b.getSize(h,"height"):0),r.css("height",o+"px"),d.css("height",i+"px"),n.css("height",b.getSize(r,"height")+"px"));let R=this.records.length;if(a=typeof this.url!="object"?this.url:this.url.get,this.searchData.length==0||a||(R=this.last.searchIds.length),this.fixedBody||(x=!1),y||x?(u.find(":scope > table > tbody > tr:nth-child(1) td.w2ui-head-last").css("width",b.scrollBarSize()+"px").show(),f.css({top:(0<this.columnGroups.length&&this.show.columns?1:0)+b.getSize(u,"height")+"px","-webkit-overflow-scrolling":"touch","overflow-x":y?"auto":"hidden","overflow-y":x?"auto":"hidden"})):(u.find(":scope > table > tbody > tr:nth-child(1) td.w2ui-head-last").hide(),f.css({top:(0<this.columnGroups.length&&this.show.columns?1:0)+b.getSize(u,"height")+"px",overflow:"hidden"}),0<f.length&&(this.last.scrollTop=0,this.last.scrollLeft=0)),y?(_.css("margin-bottom",b.scrollBarSize()+"px"),g.show()):(_.css("margin-bottom",0),g.hide()),_.css({overflow:"hidden",top:f.css("top")}),this.show.emptyRecords&&!x){let U=Math.floor((((Se=f[0])==null?void 0:Se.clientHeight)??0)/this.recordHeight)-1,K=0;if((K=f[0]?f[0].scrollHeight-U*this.recordHeight:K)>=this.recordHeight&&(K-=this.recordHeight,U++),this.fixedBody){for(let Y=R;Y<U;Y++)M(Y,this.recordHeight,this);M(U,K,this)}}function M(U,K,Y){let Q="",Me="";var Ee;Q+='<tr class="'+(U%2?"w2ui-even":"w2ui-odd")+' w2ui-empty-record" recid="-none-" style="height: '+K+'px">',Me+='<tr class="'+(U%2?"w2ui-even":"w2ui-odd")+' w2ui-empty-record" recid="-none-" style="height: '+K+'px">',Y.show.lineNumbers&&(Q+='<td class="w2ui-col-number"></td>'),Y.show.selectColumn&&(Q+='<td class="w2ui-grid-data w2ui-col-select"></td>'),Y.show.expandColumn&&(Q+='<td class="w2ui-grid-data w2ui-col-expand"></td>'),Me+='<td class="w2ui-grid-data-spacer" col="start" style="border-right: 0"></td>',Y.reorderRows&&(Me+='<td class="w2ui-grid-data w2ui-col-order" col="order"></td>');for(let Be=0;Be<Y.columns.length;Be++){var Fe=Y.columns[Be];(Fe.hidden||Be<Y.last.colStart||Be>Y.last.colEnd)&&!Fe.frozen||(Ee='<td class="w2ui-grid-data" '+(Fe.attr!=null?Fe.attr:"")+' col="'+Be+'"></td>',Fe.frozen?Q+=Ee:Me+=Ee)}Q+='<td class="w2ui-grid-data-last"></td> </tr>',Me+='<td class="w2ui-grid-data-last" col="end"></td> </tr>',p(Y.box).find("#grid_"+Y.name+"_frecords > table").append(Q),p(Y.box).find("#grid_"+Y.name+"_records > table").append(Me)}let C,P;if(0<d.length){let U=parseInt(d[0].clientWidth)-(x?b.scrollBarSize():0)-(this.show.lineNumbers?v:0)-(this.reorderRows?26:0)-(this.show.selectColumn?26:0)-(this.show.expandColumn?26:0)-1,K=(C=U,!1);for(let Y=P=0;Y<this.columns.length;Y++){var N=this.columns[Y];0<N.gridMinWidth&&(N.gridMinWidth>C&&N.hidden!==!0&&(N.hidden=!0,K=!0),N.gridMinWidth<C)&&N.hidden===!0&&(N.hidden=!1,K=!0)}if(K===!0)return void this.refresh();for(let Y=0;Y<this.columns.length;Y++){var w=this.columns[Y];w.hidden||(String(w.size).substr(String(w.size).length-2).toLowerCase()=="px"?(U-=parseFloat(w.size),this.columns[Y].sizeCalculated=w.size,this.columns[Y].sizeType="px"):(P+=parseFloat(w.size),this.columns[Y].sizeType="%",delete w.sizeCorrected))}if(P!=100&&0<P)for(let Y=0;Y<this.columns.length;Y++){var S=this.columns[Y];S.hidden||S.sizeType=="%"&&(S.sizeCorrected=Math.round(100*parseFloat(S.size)*100/P)/100+"%")}for(let Y=0;Y<this.columns.length;Y++){var D=this.columns[Y];D.hidden||D.sizeType=="%"&&(this.columns[Y].sizeCorrected!=null?this.columns[Y].sizeCalculated=Math.floor(U*parseFloat(D.sizeCorrected)/100)-1+"px":this.columns[Y].sizeCalculated=Math.floor(U*parseFloat(D.size)/100)-1+"px")}}let I=0;for(let U=0;U<this.columns.length;U++){var V=this.columns[U];V.hidden||(V.min==null&&(V.min=20),parseInt(V.sizeCalculated)<parseInt(V.min)&&(V.sizeCalculated=V.min+"px"),parseInt(V.sizeCalculated)>parseInt(V.max)&&(V.sizeCalculated=V.max+"px"),I+=parseInt(V.sizeCalculated))}let q=parseInt(C)-parseInt(I);if(0<q&&0<P){let U=0;for(;;){var H=this.columns[U];if(H==null)U=0;else{if(!H.hidden&&H.sizeType!="px"&&(H.sizeCalculated=parseInt(H.sizeCalculated)+1+"px",--q===0))break;U++}}}else 0<q&&u.find(":scope > table > tbody > tr:nth-child(1) td.w2ui-head-last").css("width",b.scrollBarSize()+"px").show();let te=1;this.show.lineNumbers&&(te+=v),this.show.selectColumn&&(te+=26),this.show.expandColumn&&(te+=26);for(let U=0;U<this.columns.length;U++)this.columns[U].hidden||this.columns[U].frozen&&(te+=parseInt(this.columns[U].sizeCalculated));m.css("width",te+"px"),_.css("width",te+"px"),c.css("width",te+"px"),g.css("width",te+"px"),u.css("left",te+"px"),f.css("left",te+"px"),l.css("left",te+"px"),u.find(":scope > table > tbody > tr:nth-child(1) td").add(m.find(":scope > table > tbody > tr:nth-child(1) td")).each(U=>{p(U).hasClass("w2ui-col-number")&&p(U).css("width",v+"px");var K=p(U).attr("col");if(K!=null){if(K=="start"){let Y=0;for(let Q=0;Q<e.last.colStart;Q++)!e.columns[Q]||e.columns[Q].frozen||e.columns[Q].hidden||(Y+=parseInt(e.columns[Q].sizeCalculated));p(U).css("width",Y+"px")}e.columns[K]&&p(U).css("width",e.columns[K].sizeCalculated)}if(p(U).hasClass("w2ui-head-last"))if(e.last.colEnd+1<e.columns.length){let Y=0;for(let Q=e.last.colEnd+1;Q<e.columns.length;Q++)!e.columns[Q]||e.columns[Q].frozen||e.columns[Q].hidden||(Y+=parseInt(e.columns[Q].sizeCalculated));p(U).css("width",Y+"px")}else p(U).css("width",b.scrollBarSize()+(0<q&&P===0?q:0)+"px")}),u.find(":scope > table > tbody > tr").length==3&&u.find(":scope > table > tbody > tr:nth-child(1) td").add(m.find(":scope > table > tbody > tr:nth-child(1) td")).html("").css({height:"0",border:"0",padding:"0",margin:"0"}),f.find(":scope > table > tbody > tr:nth-child(1) td").add(_.find(":scope > table > tbody > tr:nth-child(1) td")).each(U=>{p(U).hasClass("w2ui-col-number")&&p(U).css("width",v+"px");var K=p(U).attr("col");if(K!=null){if(K=="start"){let Y=0;for(let Q=0;Q<e.last.colStart;Q++)!e.columns[Q]||e.columns[Q].frozen||e.columns[Q].hidden||(Y+=parseInt(e.columns[Q].sizeCalculated));p(U).css("width",Y+"px")}e.columns[K]&&p(U).css("width",e.columns[K].sizeCalculated)}if(p(U).hasClass("w2ui-grid-data-last")&&p(U).parents(".w2ui-grid-frecords").length===0)if(e.last.colEnd+1<e.columns.length){let Y=0;for(let Q=e.last.colEnd+1;Q<e.columns.length;Q++)!e.columns[Q]||e.columns[Q].frozen||e.columns[Q].hidden||(Y+=parseInt(e.columns[Q].sizeCalculated));p(U).css("width",Y+"px")}else p(U).css("width",(0<q&&P===0?q:0)+"px")}),l.find(":scope > table > tbody > tr:nth-child(1) td").add(c.find(":scope > table > tbody > tr:nth-child(1) td")).each(U=>{p(U).hasClass("w2ui-col-number")&&p(U).css("width",v+"px");var K=p(U).attr("col");if(K!=null){if(K=="start"){let Y=0;for(let Q=0;Q<e.last.colStart;Q++)!e.columns[Q]||e.columns[Q].frozen||e.columns[Q].hidden||(Y+=parseInt(e.columns[Q].sizeCalculated));p(U).css("width",Y+"px")}e.columns[K]&&p(U).css("width",e.columns[K].sizeCalculated)}p(U).hasClass("w2ui-grid-data-last")&&p(U).parents(".w2ui-grid-frecords").length===0&&p(U).css("width",b.scrollBarSize()+(0<q&&P===0?q:0)+"px")}),this.initResize(),this.refreshRanges(),(this.last.scrollTop||this.last.scrollLeft)&&0<f.length&&(u.prop("scrollLeft",this.last.scrollLeft),f.prop("scrollTop",this.last.scrollTop),f.prop("scrollLeft",this.last.scrollLeft)),u.css("will-change","scroll-position")}getSearchesHTML(){let e=`
            <div class="search-title">
                ${b.lang("Advanced Search")}
                <span class="search-logic" style="${this.show.searchLogic?"":"display: none"}">
                    <select id="grid_${this.name}_logic" class="w2ui-input">
                        <option value="AND" ${this.last.logic=="AND"?"selected":""}>${b.lang("All")}</option>
                        <option value="OR" ${this.last.logic=="OR"?"selected":""}>${b.lang("Any")}</option>
                    </select>
                </span>
            </div>
            <table cellspacing="0"><tbody>
        `;for(let n=0;n<this.searches.length;n++){var t=this.searches[n];if(t.type=String(t.type).toLowerCase(),!t.hidden){t.attr==null&&(t.attr=""),t.text==null&&(t.text=""),t.style==null&&(t.style=""),t.type==null&&(t.type="text"),t.label==null&&t.caption!=null&&(console.log("NOTICE: grid search.caption property is deprecated, please use search.label. Search ->",t),t.label=t.caption);var i=`<select id="grid_${this.name}_operator_${n}" class="w2ui-input" data-change="initOperator|${n}">
                    ${this.getOperators(t.type,t.operators)}
                </select>`;e+=`<tr>
                        <td class="caption">${b.lang(t.label)||""}</td>
                        <td class="operator">${i}</td>
                        <td class="value">`;let r;switch(t.type){case"text":case"alphanumeric":case"hex":case"color":case"list":case"combo":case"enum":r="width: 250px;",["hex","color"].indexOf(t.type)!=-1&&(r="width: 90px;"),e+=`<input rel="search" type="text" id="grid_${this.name}_field_${n}" name="${t.field}"
                               class="w2ui-input" style="${r+t.style}" ${t.attr}>`;break;case"int":case"float":case"money":case"currency":case"percent":case"date":case"time":case"datetime":r="width: 90px;",t.type=="datetime"&&(r="width: 140px;"),e+=`<input id="grid_${this.name}_field_${n}" name="${t.field}" ${t.attr} rel="search" type="text"
                                class="w2ui-input" style="${r+t.style}">
                            <span id="grid_${this.name}_range_${n}" style="display: none">&#160;-&#160;&#160;
                                <input rel="search" type="text" class="w2ui-input" style="${r+t.style}" id="grid_${this.name}_field2_${n}" name="${t.field}" ${t.attr}>
                            </span>`;break;case"select":e+=`<select rel="search" class="w2ui-input" style="${t.style}" id="grid_${this.name}_field_${n}"
                                name="${t.field}" ${t.attr}></select>`}e+=t.text+"    </td></tr>"}}return e+=`<tr>
            <td colspan="2" class="actions">
                <button type="button" class="w2ui-btn close-btn" data-click="searchClose">${b.lang("Close")}</button>
            </td>
            <td class="actions">
                <button type="button" class="w2ui-btn" data-click="searchReset">${b.lang("Reset")}</button>
                <button type="button" class="w2ui-btn w2ui-btn-blue" data-click="search">${b.lang("Search")}</button>
            </td>
        </tr></tbody></table>`}getOperators(e,t){let i=this.operators[this.operatorsMap[e]]||[],n=(t!=null&&Array.isArray(t)&&(i=t),"");return i.forEach(r=>{let o=r,a=r;Array.isArray(r)?(o=r[1],a=r[0]):b.isPlainObject(r)&&(o=r.text,a=r.oper),o==null&&(o=r),n+=`<option name="11" value="${a}">${b.lang(o)}</option>
`}),n}initOperator(e){let t;var i=this.searches[e],n=this.getSearchData(i.field),r=p(`#w2overlay-${this.name}-search-overlay`),o=r.find(`#grid_${this.name}_range_`+e);let a=r.find(`#grid_${this.name}_field_`+e),l=r.find(`#grid_${this.name}_field2_`+e);var c=r.find(`#grid_${this.name}_operator_`+e).val();switch(a.show(),o.hide(),c){case"between":o.show();break;case"null":case"not null":a.hide(),a.val(c),a.trigger("change")}switch(i.type){case"text":case"alphanumeric":var h=a[0]._w2field;h&&h.reset();break;case"int":case"float":case"hex":case"color":case"money":case"currency":case"percent":case"date":case"time":case"datetime":a[0]._w2field||(new No(i.type,{el:a[0],...i.options}),new No(i.type,{el:l[0],...i.options}),setTimeout(()=>{a.trigger("keydown"),l.trigger("keydown")},1));break;case"list":case"combo":case"enum":t=i.options,i.type=="list"&&(t.selected={}),i.type=="enum"&&(t.selected=[]),n&&(t.selected=n.value),a[0]._w2field||(h=new No(i.type,{el:a[0],...t}),n&&n.text!=null&&h.set({id:n.value,text:n.text}));break;case"select":t='<option value="">--</option>';for(let u=0;u<i.options.items.length;u++){var d=i.options.items[u];if(b.isPlainObject(i.options.items[u])){let m=d.id,f=d.text;m==null&&d.value!=null&&(m=d.value),f==null&&d.text!=null&&(f=d.text),m==null&&(m=""),t+='<option value="'+m+'">'+f+"</option>"}else t+='<option value="'+d+'">'+d+"</option>"}a.html(t)}}initSearches(){var e=p(`#w2overlay-${this.name}-search-overlay`);for(let r=0;r<this.searches.length;r++){var i=this.searches[r],t=this.getSearchData(i.field);i.type=String(i.type).toLowerCase(),typeof i.options!="object"&&(i.options={});let o=i.operator,a=[...this.operators[this.operatorsMap[i.type]]];i.operators&&(a=i.operators),b.isPlainObject(o)&&(o=o.oper),a.forEach((l,c)=>{b.isPlainObject(l)&&(a[c]=l.oper)}),t&&t.operator&&(o=t.operator);var i=this.defaultOperator[this.operatorsMap[i.type]],i=(a.indexOf(o)==-1&&(o=i),e.find(`#grid_${this.name}_operator_`+r).val(o),this.initOperator(r),e.find(`#grid_${this.name}_field_`+r)),n=e.find(`#grid_${this.name}_field2_`+r);t!=null&&(Array.isArray(t.value)?["in","not in"].includes(t.operator)?i[0]._w2field.set(t.value):(i.val(t.value[0]).trigger("change"),n.val(t.value[1]).trigger("change")):t.value!=null&&i.val(t.value).trigger("change"))}e.find(".w2ui-grid-search-advanced *[rel=search]").on("keypress",r=>{r.keyCode==13&&(this.search(),Ne.hide(this.name+"-search-overlay"))})}getColumnsHTML(){let e=this,t="",i="";var n,r,o;return this.show.columnHeaders&&(i=0<this.columnGroups.length?(o=a(!0),n=function(){let l="<tr>",c="<tr>",h="",d=e.columnGroups.length-1;e.columnGroups[d].text==null&&e.columnGroups[d].caption!=null&&(console.log("NOTICE: grid columnGroup.caption property is deprecated, please use columnGroup.text. Group -> ",e.columnGroups[d]),e.columnGroups[d].text=e.columnGroups[d].caption),e.columnGroups[e.columnGroups.length-1].text!=""&&e.columnGroups.push({text:""}),e.show.lineNumbers&&(l+='<td class="w2ui-head w2ui-col-number" col="line-number">    <div>&#160;</div></td>'),e.show.selectColumn&&(l+='<td class="w2ui-head w2ui-col-select" col="select">    <div style="height: 25px">&#160;</div></td>'),e.show.expandColumn&&(l+='<td class="w2ui-head w2ui-col-expand" col="expand">    <div style="height: 25px">&#160;</div></td>');let u=0;c+=`<td id="grid_${e.name}_column_start" class="w2ui-head" col="start" style="border-right: 0"></td>`,e.reorderRows&&(c+='<td class="w2ui-head w2ui-col-order" col="order">    <div style="height: 25px">&#160;</div></td>');for(let g=0;g<e.columnGroups.length;g++){var m=e.columnGroups[g],f=e.columns[u]||{};m.colspan!=null&&(m.span=m.colspan),m.span!=null&&m.span==parseInt(m.span)||(m.span=1),f.text==null&&f.caption!=null&&(console.log("NOTICE: grid column.caption property is deprecated, please use column.text. Column ->",f),f.text=f.caption);let v=0;for(let y=u;y<u+m.span;y++)e.columns[y]&&!e.columns[y].hidden&&v++;if(!((v=g==e.columnGroups.length-1?100:v)<=0)){if(m.main===!0){let y="";for(let E=0;E<e.sortData.length;E++)e.sortData[E].field==f.field&&((e.sortData[E].direction||"").toLowerCase()==="asc"&&(y="w2ui-sort-up"),(e.sortData[E].direction||"").toLowerCase()==="desc")&&(y="w2ui-sort-down");let x="";f.resizable!==!1&&(x=`<div class="w2ui-resizer" name="${u}"></div>`);var _=b.lang(typeof f.text=="function"?f.text(f):f.text);h=`<td id="grid_${e.name}_column_${u}" class="w2ui-head ${y}" col="${u}"     rowspan="2" colspan="${v}">`+x+`    <div class="w2ui-col-group w2ui-col-header ${y?"w2ui-col-sorted":""}">        <div class="${y}"></div>`+(_||"&#160;")+"    </div></td>"}else _=b.lang(typeof m.text=="function"?m.text(m):m.text),h=`<td id="grid_${e.name}_column_${u}" class="w2ui-head" col="${u}" colspan="${v}">    <div class="w2ui-col-group" style="${m.style??""}">${_||"&#160;"}</div></td>`;f&&f.frozen?l+=h:c+=h}u+=m.span}return l+="<td></td></tr>",c+=`<td id="grid_${e.name}_column_end" class="w2ui-head" col="end"></td></tr>`,[l,c]}(),r=a(!1),t=o[0]+n[0]+r[0],o[1]+n[1]+r[1]):(o=a(!0),t=o[0],o[1])),[t,i];function a(l){let c="<tr>",h="<tr>",d=(e.show.lineNumbers&&(c+='<td class="w2ui-head w2ui-col-number" col="line-number">    <div>#</div></td>'),e.show.selectColumn&&(c+=`<td class="w2ui-head w2ui-col-select" col="select">    <div>        <input type="checkbox" id="grid_${e.name}_check_all" class="w2ui-select-all" tabindex="-1"            style="${e.multiSelect==0?"display: none;":""}"        >    </div></td>`),e.show.expandColumn&&(c+='<td class="w2ui-head w2ui-col-expand" col="expand">    <div>&#160;</div></td>'),0),u=0,m;h+=`<td id="grid_${e.name}_column_start" class="w2ui-head" col="start" style="border-right: 0"></td>`,e.reorderRows&&(h+='<td class="w2ui-head w2ui-col-order" col="order">    <div>&#160;</div></td>');for(let g=0;g<e.columns.length;g++){var f,_=e.columns[g];_.text==null&&_.caption!=null&&(console.log("NOTICE: grid column.caption property is deprecated, please use column.text. Column -> ",_),_.text=_.caption),_.size==null&&(_.size="100%"),g==u&&(m=e.columnGroups[d++]||{},u+=m.span),(g<e.last.colStart||g>e.last.colEnd)&&!_.frozen||_.hidden||m.main===!0&&!l||(f=e.getColumnCellHTML(g),_&&_.frozen?c+=f:h+=f)}return c+='<td class="w2ui-head w2ui-head-last"><div>&#160;</div></td>',h+='<td class="w2ui-head w2ui-head-last" col="end"><div>&#160;</div></td>',c+="</tr>",h+="</tr>",[c,h]}}getColumnCellHTML(e){var t=this.columns[e];if(t==null)return"";var i=!this.reorderColumns||this.columnGroups&&this.columnGroups.length?"":" w2ui-col-reorderable ";let n="";for(let c=0;c<this.sortData.length;c++)this.sortData[c].field==t.field&&((this.sortData[c].direction||"").toLowerCase()==="asc"&&(n="w2ui-sort-up"),(this.sortData[c].direction||"").toLowerCase()==="desc")&&(n="w2ui-sort-down");var r,o=this.last.selection.columns;let a=!1;for(r in o)for(let c=0;c<o[r].length;c++)o[r][c]==e&&(a=!0);var l=b.lang(typeof t.text=="function"?t.text(t):t.text);return'<td id="grid_'+this.name+"_column_"+e+'" col="'+e+'" class="w2ui-head '+n+i+'">'+(t.resizable!==!1?'<div class="w2ui-resizer" name="'+e+'"></div>':"")+'    <div class="w2ui-col-header '+(n?"w2ui-col-sorted":"")+" "+(a?"w2ui-col-selected":"")+'">        <div class="'+n+'"></div>'+(l||"&#160;")+"    </div></td>"}columnTooltipShow(n,t){var i=p(this.box).find("#grid_"+this.name+"_column_"+n),n=this.columns[n],r=this.columnTooltip;Ne.show({name:this.name+"-column-tooltip",anchor:i.get(0),html:n==null?void 0:n.tooltip,position:r})}columnTooltipHide(e,t){Ne.hide(this.name+"-column-tooltip")}getRecordsHTML(){var a;let e=this.records.length;var t=typeof this.url!="object"?this.url:this.url.get,t=((e=this.searchData.length==0||t?e:this.last.searchIds.length)>this.vs_start?this.last.show_extra=this.vs_extra:this.last.show_extra=this.vs_start,p(this.box).find(`#grid_${this.name}_records`));let i=Math.floor((((a=t.get(0))==null?void 0:a.clientHeight)||0)/this.recordHeight)+this.last.show_extra+1;(!this.fixedBody||i>e)&&(i=e);var n=this.getRecordHTML(-1,0);let r="<table><tbody>"+n[0],o="<table><tbody>"+n[1];r+='<tr id="grid_'+this.name+'_frec_top" line="top" style="height: 0px">    <td colspan="2000"></td></tr>',o+='<tr id="grid_'+this.name+'_rec_top" line="top" style="height: 0px">    <td colspan="2000"></td></tr>';for(let l=0;l<i;l++)n=this.getRecordHTML(l,l+1),r+=n[0],o+=n[1];return t=(e-i)*this.recordHeight,r+='<tr id="grid_'+this.name+'_frec_bottom" rec="bottom" line="bottom" style="height: '+t+'px; vertical-align: top">    <td colspan="2000" style="border-right: 1px solid #D6D5D7;"></td></tr><tr id="grid_'+this.name+'_frec_more" style="display: none; ">    <td colspan="2000" class="w2ui-load-more"></td></tr></tbody></table>',o+='<tr id="grid_'+this.name+'_rec_bottom" rec="bottom" line="bottom" style="height: '+t+'px; vertical-align: top">    <td colspan="2000" style="border: 0"></td></tr><tr id="grid_'+this.name+'_rec_more" style="display: none">    <td colspan="2000" class="w2ui-load-more"></td></tr></tbody></table>',this.last.range_start=0,this.last.range_end=i,[r,o]}getSummaryHTML(){if(this.summary.length!==0){var e=this.getRecordHTML(-1,0);let t="<table><tbody>"+e[0],i="<table><tbody>"+e[1];for(let n=0;n<this.summary.length;n++)e=this.getRecordHTML(n,n+1,!0),t+=e[0],i+=e[1];return t+="</tbody></table>",i+="</tbody></table>",[t,i]}}scroll(e){let t=this;var i=typeof this.url!="object"?this.url:this.url.get,n=p(this.box).find(`#grid_${this.name}_records`),r=p(this.box).find(`#grid_${this.name}_frecords`);e&&(x=e.target.scrollTop,e=e.target.scrollLeft,this.last.scrollTop=x,this.last.scrollLeft=e,d=p(this.box).find(`#grid_${this.name}_columns`)[0],u=p(this.box).find(`#grid_${this.name}_summary`)[0],d&&(d.scrollLeft=e),u&&(u.scrollLeft=e),r[0])&&(r[0].scrollTop=x),this.last.bubbleEl&&(Ne.hide(this.name+"-bubble"),this.last.bubbleEl=null);let o=null,a=null;if(this.disableCVS||0<this.columnGroups.length)o=0,a=this.columns.length-1;else{var l,c=n.prop("clientWidth");let w=0;for(let S=0;S<this.columns.length;S++)this.columns[S].frozen||this.columns[S].hidden||(l=parseInt(this.columns[S].sizeCalculated||this.columns[S].size),w+l+30>this.last.scrollLeft&&o==null&&(o=S),w+l-30>this.last.scrollLeft+c&&a==null&&(a=S),w+=l);a==null&&(a=this.columns.length-1)}if(o!=null&&(o<0&&(o=0),a<0&&(a=0),o==a&&(0<o?o--:a++),o!=this.last.colStart||a!=this.last.colEnd)){var h=p(this.box),d=Math.abs(o-this.last.colStart),u=Math.abs(a-this.last.colEnd);if(d<5&&u<5){var m=h.find(`.w2ui-grid-columns #grid_${this.name}_column_start`),f=h.find(".w2ui-grid-columns .w2ui-head-last"),_=h.find(`#grid_${this.name}_records .w2ui-grid-data-spacer`),g=h.find(`#grid_${this.name}_records .w2ui-grid-data-last`),v=h.find(`#grid_${this.name}_summary .w2ui-grid-data-spacer`),y=h.find(`#grid_${this.name}_summary .w2ui-grid-data-last`);if(o>this.last.colStart)for(let w=this.last.colStart;w<o;w++)h.find("#grid_"+this.name+"_columns #grid_"+this.name+"_column_"+w).remove(),h.find("#grid_"+this.name+'_records td[col="'+w+'"]').remove(),h.find("#grid_"+this.name+'_summary td[col="'+w+'"]').remove();if(a<this.last.colEnd)for(let w=this.last.colEnd;w>a;w--)h.find("#grid_"+this.name+"_columns #grid_"+this.name+"_column_"+w).remove(),h.find("#grid_"+this.name+'_records td[col="'+w+'"]').remove(),h.find("#grid_"+this.name+'_summary td[col="'+w+'"]').remove();if(o<this.last.colStart)for(let w=this.last.colStart-1;w>=o;w--)this.columns[w]&&(this.columns[w].frozen||this.columns[w].hidden)||(m.after(this.getColumnCellHTML(w)),_.each(S=>{var D=p(S).parent().attr("index");let I='<td class="w2ui-grid-data" col="'+w+'" style="height: 0px"></td>';D!=null&&(I=this.getCellHTML(parseInt(D),w,!1)),p(S).after(I)}),v.each(S=>{var D=p(S).parent().attr("index");let I='<td class="w2ui-grid-data" col="'+w+'" style="height: 0px"></td>';D!=null&&(I=this.getCellHTML(parseInt(D),w,!0)),p(S).after(I)}));if(a>this.last.colEnd)for(let w=this.last.colEnd+1;w<=a;w++)this.columns[w]&&(this.columns[w].frozen||this.columns[w].hidden)||(f.before(this.getColumnCellHTML(w)),g.each(S=>{var D=p(S).parent().attr("index");let I='<td class="w2ui-grid-data" col="'+w+'" style="height: 0px"></td>';D!=null&&(I=this.getCellHTML(parseInt(D),w,!1)),p(S).before(I)}),y.each(S=>{var D=p(S).parent().attr("index")||-1,D=this.getCellHTML(parseInt(D),w,!0);p(S).before(D)}));this.last.colStart=o,this.last.colEnd=a}else{this.last.colStart=o,this.last.colEnd=a;var e=this.getColumnsHTML(),x=this.getRecordsHTML(),d=this.getSummaryHTML(),u=h.find(`#grid_${this.name}_columns`);let I=h.find(`#grid_${this.name}_records`);var E=h.find(`#grid_${this.name}_frecords`);let V=h.find(`#grid_${this.name}_summary`);u.find("tbody").html(e[1]),E.html(x[0]),I.prepend(x[1]),d!=null&&V.html(d[1]),setTimeout(()=>{I.find(":scope > table").filter(":not(table:first-child)").remove(),V[0]&&(V[0].scrollLeft=this.last.scrollLeft)},1)}this.resizeRecords()}let R=this.records.length;if(R>this.total&&this.total!==-1&&(R=this.total),(R=this.searchData.length==0||i?R:this.last.searchIds.length)!==0&&n.length!==0&&n.prop("clientHeight")!==0){R>this.vs_start?this.last.show_extra=this.vs_extra:this.last.show_extra=this.vs_start;let w=Math.round(n.prop("scrollTop")/this.recordHeight+1),S=w+(Math.round(n.prop("clientHeight")/this.recordHeight)-1);if(w>R&&(w=R),S>=R-1&&(S=R),p(this.box).find("#grid_"+this.name+"_footer .w2ui-footer-right").html((this.show.statusRange?b.formatNumber(this.offset+w)+"-"+b.formatNumber(this.offset+S)+(this.total!=-1?" "+b.lang("of")+" "+b.formatNumber(this.total):""):"")+(i&&this.show.statusBuffered?" ("+b.lang("buffered")+" "+b.formatNumber(R)+(0<this.offset?", skip "+b.formatNumber(this.offset):"")+")":"")),i||this.fixedBody&&!(this.total!=-1&&this.total<=this.vs_start)){let ze=function(){t.markSearch&&(clearTimeout(t.last.marker_timer),t.last.marker_timer=setTimeout(()=>{var Se=[];for(let Y=0;Y<t.searchData.length;Y++){var U=t.searchData[Y],K=t.getSearch(U.field);K&&!K.hidden&&(K=t.getColumn(U.field,!0),Se.push({field:U.field,search:U.value,col:K}))}0<Se.length&&Se.forEach(Y=>{var Q=p(t.box).find('td[col="'+Y.col+'"]:not(.w2ui-head)');b.marker(Q,Y.search)})},50))},D=Math.floor(n.prop("scrollTop")/this.recordHeight)-this.last.show_extra,I=D+Math.floor(n.prop("clientHeight")/this.recordHeight)+2*this.last.show_extra+1;D<1&&(D=1),I>this.total&&this.total!=-1&&(I=this.total);var M=n.find("#grid_"+this.name+"_rec_top"),C=n.find("#grid_"+this.name+"_rec_bottom"),P=r.find("#grid_"+this.name+"_frec_top"),N=r.find("#grid_"+this.name+"_frec_bottom"),u=(String(M.next().prop("id")).indexOf("_expanded_row")!=-1&&(M.next().remove(),P.next().remove()),this.total>I&&String(C.prev().prop("id")).indexOf("_expanded_row")!=-1&&(C.prev().remove(),N.prev().remove()),parseInt(M.next().attr("line"))),e=parseInt(C.prev().attr("line"));let H,te,X,oe,ae;if(u<D||u==1||this.last.pull_refresh){if(I<=e+this.last.show_extra-2&&I!=this.total)return;for(this.last.pull_refresh=!1;te=r.find("#grid_"+this.name+"_frec_top").next(),!((X=n.find("#grid_"+this.name+"_rec_top").next()).attr("line")=="bottom"||!(parseInt(X.attr("line"))<D));)te.remove(),X.remove();H=n.find("#grid_"+this.name+"_rec_bottom").prev(),(oe=H.attr("line"))=="top"&&(oe=D);for(let Se=parseInt(oe)+1;Se<=I;Se++)this.records[Se-1]&&((X=this.records[Se-1].w2ui)&&!Array.isArray(X.children)&&(X.expanded=!1),ae=this.getRecordHTML(Se-1,Se),C.before(ae[1]),N.before(ae[0]))}else{if(D>=u-this.last.show_extra+2&&1<D)return;for(;te=r.find("#grid_"+this.name+"_frec_bottom").prev(),!((X=n.find("#grid_"+this.name+"_rec_bottom").prev()).attr("line")=="top"||!(parseInt(X.attr("line"))>I));)te.remove(),X.remove();H=n.find("#grid_"+this.name+"_rec_top").next(),(oe=H.attr("line"))=="bottom"&&(oe=I);for(let Se=parseInt(oe)-1;Se>=D;Se--)this.records[Se-1]&&((X=this.records[Se-1].w2ui)&&!Array.isArray(X.children)&&(X.expanded=!1),ae=this.getRecordHTML(Se-1,Se),M.after(ae[1]),P.after(ae[0]))}ze(),setTimeout(()=>{this.refreshRanges()},0),E=(D-1)*this.recordHeight;let fe=(R-I)*this.recordHeight;fe<0&&(fe=0),M.css("height",E+"px"),P.css("height",E+"px"),C.css("height",fe+"px"),N.css("height",fe+"px"),this.last.range_start=D,this.last.range_end=I,Math.floor(n.prop("scrollTop")/this.recordHeight)+Math.floor(n.prop("clientHeight")/this.recordHeight)+10>R&&this.last.pull_more!==!0&&(R<this.total-this.offset||this.total==-1&&this.last.fetch.hasMore)&&(this.autoLoad===!0&&(this.last.pull_more=!0,this.last.fetch.offset+=this.limit,this.request("load")),p(this.box).find("#grid_"+this.name+"_rec_more, #grid_"+this.name+"_frec_more").show().eq(1).off(".load-more").on("click.load-more",function(){p(this).find("td").html('<div><div style="width: 20px; height: 20px;" class="w2ui-spinner"></div></div>'),t.last.pull_more=!0,t.last.fetch.offset+=t.limit,t.request("load")}).find("td").html(t.autoLoad?'<div><div style="width: 20px; height: 20px;" class="w2ui-spinner"></div></div>':'<div style="padding-top: 15px">'+b.lang("Load ${count} more...",{count:t.limit})+"</div>"))}}}getRecordHTML(e,t,i){var _,g,v,y,x;let n="",r="";var o=this.last.selection;let a;if(e==-1){n+='<tr line="0">',r+='<tr line="0">',this.show.lineNumbers&&(n+='<td class="w2ui-col-number" style="height: 0px"></td>'),this.show.selectColumn&&(n+='<td class="w2ui-col-select" style="height: 0px"></td>'),this.show.expandColumn&&(n+='<td class="w2ui-col-expand" style="height: 0px"></td>'),r+='<td class="w2ui-grid-data w2ui-grid-data-spacer" col="start" style="height: 0px; width: 0px"></td>',this.reorderRows&&(r+='<td class="w2ui-col-order" style="height: 0px"></td>');for(let E=0;E<this.columns.length;E++){var l=this.columns[E],c='<td class="w2ui-grid-data" col="'+E+'" style="height: 0px;"></td>';l.frozen&&!l.hidden?n+=c:l.hidden||E<this.last.colStart||E>this.last.colEnd||(r+=c)}n+='<td class="w2ui-grid-data-last" style="height: 0px"></td>',r+='<td class="w2ui-grid-data-last" col="end" style="height: 0px"></td>'}else{var h=typeof this.url!="object"?this.url:this.url.get;if(i!==!0){if(0<this.searchData.length&&!h){if(e>=this.last.searchIds.length)return"";e=this.last.searchIds[e]}else if(e>=this.records.length)return"";a=this.records[e]}else{if(e>=this.summary.length)return"";a=this.summary[e]}if(!a)return"";a.recid==null&&this.recid!=null&&(h=this.parseField(a,this.recid))!=null&&(a.recid=h);let E=!1,R=(o.indexes.indexOf(e)!=-1&&(E=!0),a.w2ui?a.w2ui.style:""),M=(R!=null&&typeof R=="string"||(R=""),a.w2ui?a.w2ui.class:"");if(M!=null&&typeof M=="string"||(M=""),n+='<tr id="grid_'+this.name+"_frec_"+a.recid+'" recid="'+a.recid+'" line="'+t+'" index="'+e+'"  class="'+(t%2==0?"w2ui-even":"w2ui-odd")+" w2ui-record "+M+(E&&this.selectType=="row"?" w2ui-selected":"")+(a.w2ui&&a.w2ui.editable===!1?" w2ui-no-edit":"")+(a.w2ui&&a.w2ui.expanded===!0?" w2ui-expanded":"")+'"  style="height: '+this.recordHeight+"px; "+(E||R==""?R.replace("background-color","none"):R)+'" '+(R!=""?'custom_style="'+R+'"':"")+">",r+='<tr id="grid_'+this.name+"_rec_"+a.recid+'" recid="'+a.recid+'" line="'+t+'" index="'+e+'"  class="'+(t%2==0?"w2ui-even":"w2ui-odd")+" w2ui-record "+M+(E&&this.selectType=="row"?" w2ui-selected":"")+(a.w2ui&&a.w2ui.editable===!1?" w2ui-no-edit":"")+(a.w2ui&&a.w2ui.expanded===!0?" w2ui-expanded":"")+'"  style="height: '+this.recordHeight+"px; "+(E||R==""?R.replace("background-color","none"):R)+'" '+(R!=""?'custom_style="'+R+'"':"")+">",this.show.lineNumbers&&(n+='<td id="grid_'+this.name+"_cell_"+e+"_number"+(i?"_s":"")+'"    class="w2ui-col-number '+(E?" w2ui-row-selected":"")+'"'+(this.reorderRows?' style="cursor: move"':"")+">"+(i!==!0?this.getLineHTML(t,a):"")+"</td>"),this.show.selectColumn&&(n+='<td id="grid_'+this.name+"_cell_"+e+"_select"+(i?"_s":"")+'" class="w2ui-grid-data w2ui-col-select">'+(i===!0||a.w2ui&&a.w2ui.hideCheckBox===!0?"":'    <div>        <input class="w2ui-grid-select-check" type="checkbox" tabindex="-1" '+(E?'checked="checked"':"")+' style="pointer-events: none"/>    </div>')+"</td>"),this.show.expandColumn){let N="";N=((_=a.w2ui)==null?void 0:_.expanded)===!0?"-":"+",((g=a.w2ui)==null?void 0:g.expanded)!="none"&&Array.isArray((v=a.w2ui)==null?void 0:v.children)&&((y=a.w2ui)!=null&&y.children.length)||(N="+"),((x=a.w2ui)==null?void 0:x.expanded)=="spinner"&&(N='<div class="w2ui-spinner" style="width: 16px; margin: -2px 2px;"></div>'),n+='<td id="grid_'+this.name+"_cell_"+e+"_expand"+(i?"_s":"")+'" class="w2ui-grid-data w2ui-col-expand">'+(i!==!0?`<div>${N}</div>`:"")+"</td>"}r+='<td class="w2ui-grid-data-spacer" col="start" style="border-right: 0"></td>',this.reorderRows&&(r+='<td id="grid_'+this.name+"_cell_"+e+"_order"+(i?"_s":"")+'" class="w2ui-grid-data w2ui-col-order" col="order">'+(i!==!0?'<div title="Drag to reorder">&nbsp;</div>':"")+"</td>");let C=0,P=0;for(;;){let N=1;var d,u=this.columns[C];if(u==null)break;if(u.hidden)C++,0<P&&P--;else if(0<P){if(C++,this.columns[C]==null)break;a.w2ui.colspan[this.columns[C-1].field]=0,P--}else{if(a.w2ui&&(f=a.w2ui.colspan,d=this.columns[C].field,f)&&f[d]===0&&delete f[d],!(C<this.last.colStart||C>this.last.colEnd)||u.frozen){if(a.w2ui&&typeof a.w2ui.colspan=="object"){var m=parseInt(a.w2ui.colspan[u.field])||null;if(1<m){let w=0;for(let S=C;S<C+m&&!(S>=this.columns.length);S++)this.columns[S].hidden&&w++;N=m-w,P=m-1}}var f=this.getCellHTML(e,C,i,N);u.frozen?n+=f:r+=f}C++}}n+='<td class="w2ui-grid-data-last"></td>',r+='<td class="w2ui-grid-data-last" col="end"></td>'}return n+="</tr>",r+="</tr>",[n,r]}getLineHTML(e){return"<div>"+e+"</div>"}getCellHTML(e,t,i,n){var P,N,w,S;let r=this,o=this.columns[t];if(o==null)return"";let a=(i!==!0?this.records:this.summary)[e],{value:l,style:c,className:h,attr:d,divAttr:u}=this.getCellValue(e,t,i,!0);var m=e!==-1?this.getCellEditable(e,t):"";let f="max-height: "+parseInt(this.recordHeight)+"px;"+(o.clipboardCopy?"margin-right: 20px":"");var _=!i&&((P=a==null?void 0:a.w2ui)==null?void 0:P.changes)&&a.w2ui.changes[o.field]!=null,g=this.last.selection;let v=!1,y="";if(g.indexes.indexOf(e)!=-1&&(v=!0),n==null&&(n=(N=a==null?void 0:a.w2ui)!=null&&N.colspan&&a.w2ui.colspan[o.field]?a.w2ui.colspan[o.field]:1),t===0&&Array.isArray((w=a==null?void 0:a.w2ui)==null?void 0:w.children)){let D=0,I=this.get(a.w2ui.parent_recid,!0);for(;I!=null;){D++;var x=this.records[I].w2ui;if(x==null||x.parent_recid==null)break;I=this.get(x.parent_recid,!0)}if(a.w2ui.parent_recid)for(let V=0;V<D;V++)y+='<span class="w2ui-show-children w2ui-icon-empty"></span>';var E=0<a.w2ui.children.length?a.w2ui.expanded?"w2ui-icon-collapse":"w2ui-icon-expand":"w2ui-icon-empty";y+=`<span class="w2ui-show-children ${E}"></span>`}if(o.info===!0&&(o.info={}),o.info!=null){let D="w2ui-icon-info",I=(typeof o.info.icon=="function"?D=o.info.icon(a,{self:this,index:e,colIndex:t,summary:!!i}):typeof o.info.icon=="object"?D=o.info.icon[this.parseField(a,o.field)]||"":typeof o.info.icon=="string"&&(D=o.info.icon),o.info.style||"");typeof o.info.style=="function"?I=o.info.style(a,{self:this,index:e,colIndex:t,summary:!!i}):typeof o.info.style=="object"?I=o.info.style[this.parseField(a,o.field)]||"":typeof o.info.style=="string"&&(I=o.info.style),y+=`<span class="w2ui-info ${D}" style="${I}"></span>`}let R=l,M=(m&&["checkbox","check"].indexOf(m.type)!=-1&&(f+="text-align: center;",R=`<input tabindex="-1" type="checkbox" class="w2ui-editable-checkbox"
                            data-changeInd="${i?-(e+1):e}" data-colInd="${t}" ${R?'checked="checked"':""}>`,y=""),(R=`<div style="${f}" ${function(D){let I;return r.show.recordTitles&&(o.title!=null?(typeof o.title=="function"&&(I=o.title.call(r,a,{self:this,index:e,colIndex:t,summary:!!i})),typeof o.title=="string"&&(I=o.title)):I=b.stripTags(String(D).replace(/"/g,"''"))),I!=null?'title="'+String(I)+'"':""}(R)} ${u}>${y}${String(R)}</div>`)==null&&(R=""),typeof o.render=="string"&&(E=o.render.toLowerCase().split(":"),["number","int","float","money","currency","percent","size"].indexOf(E[0])!=-1)&&(c+="text-align: right;"),a!=null&&a.w2ui&&(typeof a.w2ui.style=="object"&&(typeof a.w2ui.style[t]=="string"&&(c+=a.w2ui.style[t]+";"),typeof a.w2ui.style[o.field]=="string")&&(c+=a.w2ui.style[o.field]+";"),typeof a.w2ui.class=="object")&&(typeof a.w2ui.class[t]=="string"&&(h+=a.w2ui.class[t]+" "),typeof a.w2ui.class[o.field]=="string")&&(h+=a.w2ui.class[o.field]+" "),!1);v&&((S=g.columns[e])!=null&&S.includes(t))&&(M=!0);let C;return o.clipboardCopy&&(C='<span class="w2ui-clipboard-copy w2ui-icon-paste"></span>'),R='<td class="w2ui-grid-data'+(M?" w2ui-selected":"")+" "+h+(_?" w2ui-changed":"")+'"    id="grid_'+this.name+"_data_"+e+"_"+t+'" col="'+t+'"    style="'+c+(o.style!=null?o.style:"")+'" '+(o.attr!=null?o.attr:"")+d+(1<n?'colspan="'+n+'"':"")+">"+R+(C&&b.stripTags(R)?C:"")+"</td>",R=e===-1&&i===!0?'<td class="w2ui-grid-data" col="'+t+'" style="height: 0px; '+c+'" '+(1<n?'colspan="'+n+'"':"")+"></td>":R}clipboardCopy(e,t,i){var n=(i?this.summary:this.records)[e],r=this.columns[t];let o=r?this.parseField(n,r.field):"";typeof r.clipboardCopy=="function"&&(o=r.clipboardCopy(n,{self:this,index:e,colIndex:t,summary:!!i})),p(this.box).find("#grid_"+this.name+"_focus").text(o).get(0).select(),document.execCommand("copy")}showBubble(e,t,i){var n=this.columns[t].info;if(n){let u="";var r=this.records[e],o=p(this.box).find(`${i?".w2ui-grid-summary":""} #grid_${this.name}_data_${e}_${t} .w2ui-info`);if(this.last.bubbleEl&&Ne.hide(this.name+"-bubble"),this.last.bubbleEl=o,n.fields==null){n.fields=[];for(let f=0;f<this.columns.length;f++){var a=this.columns[f];n.fields.push(a.field+(typeof a.render=="string"?":"+a.render:""))}}let m=n.fields;if(typeof m=="function"&&(m=m(r,{self:this,index:e,colIndex:t,summary:!!i})),typeof n.render=="function")u=n.render(r,{self:this,index:e,colIndex:t,summary:!!i});else if(Array.isArray(m)){u='<table cellpadding="0" cellspacing="0">';for(let f=0;f<m.length;f++){var l=String(m[f]).split(":");if(l[0]==""||l[0]=="-"||l[0]=="--"||l[0]=="---")u+='<tr><td colspan=2><div style="border-top: '+(l[0]==""?"0":"1")+'px solid #C1BEBE; margin: 6px 0px;"></div></td></tr>';else{let _=this.getColumn(l[0]),g=(_=_??{field:l[0],caption:l[0]})?this.parseField(r,_.field):"";1<l.length&&(b.formatters[l[1]]?g=b.formatters[l[1]](g,l[2]||null,r):console.log('ERROR: w2utils.formatters["'+l[1]+'"] does not exists.')),(n.showEmpty===!0||g!=null&&g!="")&&(n.maxLength!=null&&typeof g=="string"&&g.length>n.maxLength&&(g=g.substr(0,n.maxLength)+"..."),u+="<tr><td>"+_.text+"</td><td>"+((g===0?"0":g)||"")+"</td></tr>")}}u+="</table>"}else if(b.isPlainObject(m)){for(var c in u='<table cellpadding="0" cellspacing="0">',m){var h=m[c];if(h==""||h=="-"||h=="--"||h=="---")u+='<tr><td colspan=2><div style="border-top: '+(h==""?"0":"1")+'px solid #C1BEBE; margin: 6px 0px;"></div></td></tr>';else{var d=String(h).split(":");let f=this.getColumn(d[0]),_=(f=f??{field:d[0],caption:d[0]})?this.parseField(r,f.field):"";1<d.length&&(b.formatters[d[1]]?_=b.formatters[d[1]](_,d[2]||null,r):console.log('ERROR: w2utils.formatters["'+d[1]+'"] does not exists.')),typeof h=="function"&&(_=h(r,{self:this,index:e,colIndex:t,summary:!!i})),(n.showEmpty===!0||_!=null&&_!="")&&(n.maxLength!=null&&typeof _=="string"&&_.length>n.maxLength&&(_=_.substr(0,n.maxLength)+"..."),u+="<tr><td>"+c+"</td><td>"+((_===0?"0":_)||"")+"</td></tr>")}}u+="</table>"}return Ne.show(b.extend({name:this.name+"-bubble",html:u,anchor:o.get(0),position:"top|bottom",class:"w2ui-info-bubble",style:"",hideOn:["doc-click"]},n.options??{})).hide(()=>[this.last.bubbleEl=null])}}getCellEditable(e,t){var i=this.columns[t],n=this.records[e];if(!n||!i)return null;let r=n.w2ui?n.w2ui.editable:null;return r===!1?null:(r!=null&&r!==!0||typeof(r=0<Object.keys(i.editable??{}).length?i.editable:null)=="function"&&(i=this.getCellValue(e,t,!1),r=r.call(this,n,{self:this,value:i,index:e,colIndex:t})),r)}getCellValue(e,t,i,n){var u,m;var r=this.columns[t],o=(i!==!0?this.records:this.summary)[e];let a=this.parseField(o,r.field),l="",c="",h="",d="";if(((m=(u=o==null?void 0:o.w2ui)==null?void 0:u.changes)==null?void 0:m[r.field])!=null&&(a=o.w2ui.changes[r.field]),r.render!=null&&e!==-1){if(typeof r.render=="function"&&o!=null){let f;try{f=r.render(o,{self:this,value:a,index:e,colIndex:t,summary:!!i})}catch(_){throw new Error(`Render function for column "${r.field}" in grid "${this.name}": -- `+_.message)}f!=null&&typeof f=="object"&&typeof f!="function"?(f.id!=null&&f.text!=null?a=f.text:typeof f.html=="string"?a=(f.html||"").trim():(a="",console.log("ERROR: render function should return a primitive or an object of the following structure.",{html:"",attr:"",style:"",class:"",divAttr:""})),h=f.attr??"",c=f.style??"",l=f.class??"",d=f.divAttr??""):a=String(f||"").trim()}if(typeof r.render=="object"&&(e=r.render[a])!=null&&e!==""&&(a=e),typeof r.render=="string"){t=r.render.toLowerCase().indexOf(":"),i=[],t==-1?(i[0]=r.render.toLowerCase(),i[1]=""):(i[0]=r.render.toLowerCase().substr(0,t),i[1]=r.render.toLowerCase().substr(t+1));let f=b.formatters[i[0]];r.options&&r.options.autoFormat===!1&&(f=null),a=typeof f=="function"?f(a,i[1],o):""}}return a==null&&(a=""),n?{value:a,attr:h,style:c,className:l,divAttr:d}:a}getFooterHTML(){return'<div>    <div class="w2ui-footer-left"></div>    <div class="w2ui-footer-right"></div>    <div class="w2ui-footer-center"></div></div>'}status(e){if(e!=null)p(this.box).find(`#grid_${this.name}_footer`).find(".w2ui-footer-left").html(e);else{let t="";if(e=this.getSelection(),0<e.length&&(this.show.statusSelection&&1<e.length&&(t=String(e.length).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+b.settings.groupSymbol)+" "+b.lang("selected")),this.show.statusRecordID)&&e.length==1){let i=e[0];typeof i=="object"&&(i=i.recid+", "+b.lang("Column")+": "+i.column),t=b.lang("Record ID")+": "+i+" "}p(this.box).find("#grid_"+this.name+"_footer .w2ui-footer-left").html(t)}}lock(e,t){let i=Array.from(arguments);i.unshift(this.box),setTimeout(()=>{p(this.box).find("#grid_"+this.name+"_empty_msg").remove(),b.lock(...i)},10)}unlock(e){setTimeout(()=>{p(this.box).find(".w2ui-message").hasClass("w2ui-closing")||b.unlock(this.box,e)},25)}stateSave(e){var t={columns:[],show:b.clone(this.show),last:{search:this.last.search,multi:this.last.multi,logic:this.last.logic,label:this.last.label,field:this.last.field,scrollTop:this.last.scrollTop,scrollLeft:this.last.scrollLeft},sortData:[],searchData:[]};let i;for(let r=0;r<this.columns.length;r++){let o=this.columns[r],a={};Object.keys(this.stateColProps).forEach((l,c)=>{this.stateColProps[l]&&(i=o[l]!==void 0?o[l]:this.colTemplate[l]||null,a[l]=i)}),t.columns.push(a)}for(let r=0;r<this.sortData.length;r++)t.sortData.push(b.clone(this.sortData[r]));for(let r=0;r<this.searchData.length;r++)t.searchData.push(b.clone(this.searchData[r]));var n=this.trigger("stateSave",{target:this.name,state:t});if(n.isCancelled!==!0)return e!==!0&&this.cacheSave("state",t),n.finish(),t}stateRestore(e){var o,a,l;let t=typeof this.url!="object"?this.url:this.url.get;e=e||this.cache("state");var i=this.trigger("stateRestore",{target:this.name,state:e});if(i.isCancelled!==!0){if(b.isPlainObject(e)){b.extend(this.show,e.show??{}),b.extend(this.last,e.last??{});let c=this.last.scrollTop,h=this.last.scrollLeft;for(let d=0;d<((o=e.columns)==null?void 0:o.length);d++){var n=e.columns[d],r=this.getColumn(n.field,!0);r!==null&&(b.extend(this.columns[r],n),d!==r)&&this.columns.splice(d,0,this.columns.splice(r,1)[0])}this.sortData.splice(0,this.sortData.length);for(let d=0;d<((a=e.sortData)==null?void 0:a.length);d++)this.sortData.push(e.sortData[d]);this.searchData.splice(0,this.searchData.length);for(let d=0;d<((l=e.searchData)==null?void 0:l.length);d++)this.searchData.push(e.searchData[d]);setTimeout(()=>{t||(0<this.sortData.length&&this.localSort(),0<this.searchData.length&&this.localSearch()),this.last.scrollTop=c,this.last.scrollLeft=h,this.refresh()},1),console.log(`INFO (w2ui): state restored for "${this.name}"`)}return i.finish(),!0}}stateReset(){this.stateRestore(this.last.state),this.cacheSave("state",null)}parseField(e,t){if(this.nestedFields){let n="";try{n=e;var i=String(t).split(".");for(let r=0;r<i.length;r++)n=n[i[r]]}catch{n=""}return n}return e?e[t]:""}prepareData(){let e=this;for(let t=0;t<this.records.length;t++)(function i(n){var r,o;for(let a=0;a<e.columns.length;a++){let l=e.columns[a];if(n[l.field]!=null&&typeof l.render=="string"){if(["number","int","float","money","currency","percent"].indexOf(l.render.split(":")[0])!=-1&&typeof n[l.field]!="number"&&(n[l.field]=parseFloat(n[l.field])),["date","age"].indexOf(l.render.split(":")[0])!=-1&&!n[l.field+"_"]){let c=n[l.field];b.isInt(c)&&(c=parseInt(c)),n[l.field+"_"]=new Date(c)}if(["time"].indexOf(l.render)!=-1)if(b.isTime(n[l.field])){let c=b.isTime(n[l.field],!0),h=new Date;h.setHours(c.hours,c.minutes,c.seconds||0,0),n[l.field+"_"]||(n[l.field+"_"]=h)}else{let c=n[l.field],h=(c=(c=b.isInt(c)?parseInt(c):c)!=null?new Date(c):new Date,new Date);h.setHours(c.getHours(),c.getMinutes(),c.getSeconds(),0),n[l.field+"_"]||(n[l.field+"_"]=h)}}}if((r=n.w2ui)!=null&&r.children&&((o=n.w2ui)==null?void 0:o.expanded)!==!0)for(let a=0;a<n.w2ui.children.length;a++){let l=n.w2ui.children[a];i(l)}})(this.records[t])}nextCell(e,t,i){if(t+=1,t>=this.columns.length)return(e=this.nextRow(e))==null?e:this.nextCell(e,-1,i);var r=this.records[e].w2ui,n=this.columns[t],r=r&&r.colspan&&!isNaN(r.colspan[n.field])?parseInt(r.colspan[n.field]):1;return n==null?null:n&&n.hidden||r===0?this.nextCell(e,t,i):i&&(n=this.getCellEditable(e,t),n==null||["checkbox","check"].indexOf(n.type)!=-1)?this.nextCell(e,t,i):{index:e,colIndex:t}}prevCell(e,t,i){if(t-=1,t<0)return(e=this.prevRow(e))==null?e:this.prevCell(e,this.columns.length,i);if(t<0)return null;var r=this.records[e].w2ui,n=this.columns[t],r=r&&r.colspan&&!isNaN(r.colspan[n.field])?parseInt(r.colspan[n.field]):1;return n==null?null:n&&n.hidden||r===0?this.prevCell(e,t,i):i&&(n=this.getCellEditable(e,t),n==null||["checkbox","check"].indexOf(n.type)!=-1)?this.prevCell(e,t,i):{index:e,colIndex:t}}nextRow(e,t,i){var n=this.last.searchIds;let r=null;if((i=i??1)==-1)return this.records.length-1;if(e+i<this.records.length&&n.length===0||0<n.length&&e<n[n.length-i]){if(e+=i,0<n.length)for(;!(n.includes(e)||e>this.records.length);)e+=i;var a=this.records[e].w2ui,o=this.columns[t],a=a&&a.colspan&&o!=null&&!isNaN(a.colspan[o.field])?parseInt(a.colspan[o.field]):1;r=a===0?this.nextRow(e,t,i):e}return r}prevRow(e,t,i){var n=this.last.searchIds;let r=null;if((i=i??1)==-1)return 0;if(0<=e-i&&n.length===0||0<n.length&&e>n[0]){if(e-=i,0<n.length)for(;!(n.includes(e)||e<0);)e-=i;var a=this.records[e].w2ui,o=this.columns[t],a=a&&a.colspan&&o!=null&&!isNaN(a.colspan[o.field])?parseInt(a.colspan[o.field]):1;r=a===0?this.prevRow(e,t,i):e}return r}selectionSave(){return this.last.saved_sel=this.getSelection(),this.last.saved_sel}selectionRestore(e){var t,i=Date.now(),n=(this.last.selection={indexes:[],columns:{}},this.last.selection),r=this.last.saved_sel;if(r)for(let o=0;o<r.length;o++)b.isPlainObject(r[o])?(t=this.get(r[o].recid,!0))!=null&&(n.indexes.indexOf(t)==-1&&n.indexes.push(t),n.columns[t]||(n.columns[t]=[]),n.columns[t].push(r[o].column)):(t=this.get(r[o],!0))!=null&&n.indexes.push(t);return delete this.last.saved_sel,e!==!0&&this.refresh(),Date.now()-i}message(e){return b.message({owner:this,box:this.box,after:".w2ui-grid-header"},e)}confirm(e){return b.confirm({owner:this,box:this.box,after:".w2ui-grid-header"},e)}}class No extends _n{constructor(e,t){super(),typeof e=="string"&&t==null&&(t={type:e}),typeof e=="object"&&t==null&&(t=b.clone(e)),typeof e=="string"&&typeof t=="object"&&(t.type=e),t.type=String(t.type).toLowerCase(),this.el=t.el??null,this.selected=null,this.helpers={},this.type=t.type??"text",this.options=b.clone(t),this.onClick=t.onClick??null,this.onAdd=t.onAdd??null,this.onNew=t.onNew??null,this.onRemove=t.onRemove??null,this.onMouseEnter=t.onMouseEnter??null,this.onMouseLeave=t.onMouseLeave??null,this.onScroll=t.onScroll??null,this.tmp={},delete this.options.type,delete this.options.onClick,delete this.options.onMouseEnter,delete this.options.onMouseLeave,delete this.options.onScroll,this.el&&this.render(this.el)}render(e){e instanceof HTMLElement?(e._w2field?e._w2field.reset():e._w2field=this,this.el=e,this.init()):console.log("ERROR: Cannot init w2field on empty subject")}init(){let e=this.options,t;if(["INPUT","TEXTAREA"].includes(this.el.tagName.toUpperCase())){switch(this.type){case"text":case"int":case"float":case"money":case"currency":case"percent":case"alphanumeric":case"bin":case"hex":t={min:null,max:null,step:1,autoFormat:!0,autoCorrect:!0,currencyPrefix:b.settings.currencyPrefix,currencySuffix:b.settings.currencySuffix,currencyPrecision:b.settings.currencyPrecision,decimalSymbol:b.settings.decimalSymbol,groupSymbol:b.settings.groupSymbol,arrow:!1,keyboard:!0,precision:null,prefix:"",suffix:""},this.options=b.extend({},t,e),(e=this.options).numberRE=new RegExp("["+e.groupSymbol+"]","g"),e.moneyRE=new RegExp("["+e.currencyPrefix+e.currencySuffix+e.groupSymbol+"]","g"),e.percentRE=new RegExp("["+e.groupSymbol+"%]","g"),["text","alphanumeric","hex","bin"].includes(this.type)&&(e.arrow=!1,e.keyboard=!1);break;case"color":t={prefix:"#",suffix:`<div style="width: ${parseInt(getComputedStyle(this.el)["font-size"])||12}px">&#160;</div>`,arrow:!1,advanced:null,transparent:!0},this.options=b.extend({},t,e),e=this.options;break;case"date":t={format:b.settings.dateFormat,keyboard:!0,autoCorrect:!0,start:null,end:null,blockDates:[],blockWeekdays:[],colored:{},btnNow:!0},this.options=b.extend({type:"date"},t,e),e=this.options,p(this.el).attr("placeholder")==null&&p(this.el).attr("placeholder",e.format);break;case"time":t={format:b.settings.timeFormat,keyboard:!0,autoCorrect:!0,start:null,end:null,btnNow:!0,noMinutes:!1},this.options=b.extend({type:"time"},t,e),e=this.options,p(this.el).attr("placeholder")==null&&p(this.el).attr("placeholder",e.format);break;case"datetime":t={format:b.settings.dateFormat+"|"+b.settings.timeFormat,keyboard:!0,autoCorrect:!0,start:null,end:null,startTime:null,endTime:null,blockDates:[],blockWeekdays:[],colored:{},btnNow:!0,noMinutes:!1},this.options=b.extend({type:"datetime"},t,e),e=this.options,p(this.el).attr("placeholder")==null&&p(this.el).attr("placeholder",e.placeholder||e.format);break;case"list":case"combo":t={items:[],selected:{},url:null,recId:null,recText:null,method:null,debounce:250,postData:{},minLength:1,cacheMax:250,maxDropHeight:350,maxDropWidth:null,minDropWidth:null,match:"begins",icon:null,iconStyle:"",align:"both",altRows:!0,renderDrop:null,compare:null,filter:!0,hideSelected:!1,prefix:"",suffix:"",msgNoItems:"No matches",msgSearch:"Type to search...",openOnFocus:!1,markSearch:!1,onSearch:null,onRequest:null,onLoad:null,onError:null},typeof e.items=="function"&&(e._items_fun=e.items),e.items=b.normMenu.call(this,e.items),this.type==="list"&&(p(this.el).addClass("w2ui-select"),!b.isPlainObject(e.selected))&&Array.isArray(e.items)&&e.items.forEach(i=>{i&&i.id===e.selected&&(e.selected=b.clone(i))}),e=b.extend({},t,e),this.options=e,b.isPlainObject(e.selected)||(e.selected={}),this.selected=e.selected,p(this.el).attr("autocapitalize","off").attr("autocomplete","off").attr("autocorrect","off").attr("spellcheck","false"),e.selected.text!=null&&p(this.el).val(e.selected.text);break;case"enum":t={items:[],selected:[],max:0,url:null,recId:null,recText:null,debounce:250,method:null,postData:{},minLength:1,cacheMax:250,maxItemWidth:250,maxDropHeight:350,maxDropWidth:null,match:"contains",align:"",altRows:!0,openOnFocus:!1,markSearch:!1,renderDrop:null,renderItem:null,compare:null,filter:!0,hideSelected:!0,style:"",msgNoItems:"No matches",msgSearch:"Type to search...",onSearch:null,onRequest:null,onLoad:null,onError:null,onClick:null,onAdd:null,onNew:null,onRemove:null,onMouseEnter:null,onMouseLeave:null,onScroll:null},typeof(e=b.extend({},t,e,{suffix:""})).items=="function"&&(e._items_fun=e.items),e.items=b.normMenu.call(this,e.items),e.selected=b.normMenu.call(this,e.selected),this.options=e,Array.isArray(e.selected)||(e.selected=[]),this.selected=e.selected;break;case"file":t={selected:[],max:0,maxSize:0,maxFileSize:0,maxItemWidth:250,maxDropHeight:350,maxDropWidth:null,readContent:!0,silent:!0,align:"both",altRows:!0,renderItem:null,style:"",onClick:null,onAdd:null,onRemove:null,onMouseEnter:null,onMouseLeave:null},e=b.extend({},t,e),this.options=e,Array.isArray(e.selected)||(e.selected=[]),this.selected=e.selected,p(this.el).attr("placeholder")==null&&p(this.el).attr("placeholder",b.lang("Attach files by dragging and dropping or Click to Select"))}p(this.el).css("box-sizing","border-box").addClass("w2field w2ui-input").off(".w2field").on("change.w2field",i=>{this.change(i)}).on("click.w2field",i=>{this.click(i)}).on("focus.w2field",i=>{this.focus(i)}).on("blur.w2field",i=>{this.type!=="list"&&this.blur(i)}).on("keydown.w2field",i=>{this.keyDown(i)}).on("keyup.w2field",i=>{this.keyUp(i)}),this.addPrefix(),this.addSuffix(),this.addSearch(),this.addMultiSearch(),this.change(new Event("change"))}else console.log("ERROR: w2field could only be applied to INPUT or TEXTAREA.",this.el)}get(){return["list","enum","file"].indexOf(this.type)!==-1?this.selected:p(this.el).val()}set(e,t){["list","enum","file"].indexOf(this.type)!==-1?(this.type!=="list"&&t?(Array.isArray(this.selected)||(this.selected=[]),this.selected.push(e),(t=Ot.get(this.el.id+"_menu"))&&(t.options.selected=this.selected)):(e==null&&(e=[]),t=this.type!=="enum"||Array.isArray(e)?e:[e],this.selected=t),p(this.el).trigger("input").trigger("change"),this.refresh()):p(this.el).val(e)}setIndex(e,t){if(["list","enum"].indexOf(this.type)!==-1){var i=this.options.items;if(i&&i[e])return this.type=="list"&&(this.selected=i[e]),this.type=="enum"&&(t||(this.selected=[]),this.selected.push(i[e])),(t=Ot.get(this.el.id+"_menu"))&&(t.options.selected=this.selected),p(this.el).trigger("input").trigger("change"),this.refresh(),!0}return!1}refresh(){var l,c;let e=this.options;var t=Date.now(),i=getComputedStyle(this.el);if(this.type=="list"){if(p(this.el).parent().css("white-space","nowrap"),this.helpers.prefix&&this.helpers.prefix.hide(),!this.helpers.search)return;this.selected==null&&e.icon?e.prefix=`
                    <span class="w2ui-icon ${e.icon} "style="cursor: pointer; font-size: 14px;
                        display: inline-block; margin-top: -1px; color: #7F98AD; ${e.iconStyle}">
                    </span>`:e.prefix="",this.addPrefix();let h=p(this.helpers.search_focus);var n=p(h[0].previousElementSibling);h.css({outline:"none"}),h.val()===""?(h.css("opacity",0),n.css("opacity",0),(l=this.selected)!=null&&l.id?(a=this.selected.text,o=this.findItemIndex(e.items,this.selected.id),a!=null&&p(this.el).val(b.lang(a)).data({selected:a,selectedIndex:o[0]})):(this.el.value="",p(this.el).removeData("selected selectedIndex"))):(h.css("opacity",1),n.css("opacity",1),p(this.el).val(""),setTimeout(()=>{this.helpers.prefix&&this.helpers.prefix.hide(),e.icon?(h.css("margin-left","17px"),p(this.helpers.search).find(".w2ui-icon-search").addClass("show-search")):(h.css("margin-left","0px"),p(this.helpers.search).find(".w2ui-icon-search").removeClass("show-search"))},1)),p(this.el).prop("readOnly")||p(this.el).prop("disabled")?setTimeout(()=>{this.helpers.prefix&&p(this.helpers.prefix).css("opacity","0.6"),this.helpers.suffix&&p(this.helpers.suffix).css("opacity","0.6")},1):setTimeout(()=>{this.helpers.prefix&&p(this.helpers.prefix).css("opacity","1"),this.helpers.suffix&&p(this.helpers.suffix).css("opacity","1")},1)}let r=this.helpers.multi;if(["enum","file"].includes(this.type)&&r){let h="";Array.isArray(this.selected)&&this.selected.forEach((d,u)=>{d!=null&&(h+=`
                        <div class="li-item" index="${u}" style="max-width: ${parseInt(e.maxItemWidth)}px; ${d.style||""}">
                        ${typeof e.renderItem=="function"?e.renderItem(d,u,`<div class="w2ui-list-remove" index="${u}">&#160;&#160;</div>`):`
                               ${d.icon?`<span class="w2ui-icon ${d.icon}"></span>`:""}
                               <div class="w2ui-list-remove" index="${u}">&#160;&#160;</div>
                               ${(this.type==="enum"?d.text:d.name)??d.id??d}
                               ${d.size?`<span class="file-size"> - ${b.formatSize(d.size)}</span>`:""}
                            `}
                        </div>`)});var o,a=r.find(".w2ui-multi-items");e.style&&r.attr("style",r.attr("style")+";"+e.style),p(this.el).css("z-index","-1"),p(this.el).prop("readOnly")||p(this.el).prop("disabled")?setTimeout(()=>{r[0].scrollTop=0,r.addClass("w2ui-readonly").find(".li-item").css("opacity","0.9").parent().find(".li-search").hide().find("input").prop("readOnly",!0).closest(".w2ui-multi-items").find(".w2ui-list-remove").hide()},1):setTimeout(()=>{r.removeClass("w2ui-readonly").find(".li-item").css("opacity","1").parent().find(".li-search").show().find("input").prop("readOnly",!1).closest(".w2ui-multi-items").find(".w2ui-list-remove").show()},1),0<((c=this.selected)==null?void 0:c.length)&&p(this.el).attr("placeholder",""),r.find(".w2ui-enum-placeholder").remove(),a.find(".li-item").remove(),h!==""?a.prepend(h):p(this.el).attr("placeholder")!=null&&r.find("input").val()===""&&(o=b.stripSpaces(`
                    padding-top: ${i["padding-top"]};
                    padding-left: ${i["padding-left"]};
                    box-sizing: ${i["box-sizing"]};
                    line-height: ${i["line-height"]};
                    font-size: ${i["font-size"]};
                    font-family: ${i["font-family"]};
                `),r.prepend(`<div class="w2ui-enum-placeholder" style="${o}">${p(this.el).attr("placeholder")}</div>`)),r.off(".w2item").on("scroll.w2item",d=>{d=this.trigger("scroll",{target:this.el,originalEvent:d}),d.isCancelled!==!0&&(Ne.hide(this.el.id+"_preview"),d.finish())}).find(".li-item").on("click.w2item",d=>{var u=p(d.target).closest(".li-item"),m=u.attr("index"),f=this.selected[m];if(!p(u).hasClass("li-search")){d.stopPropagation();let _;if(p(d.target).hasClass("w2ui-list-remove"))p(this.el).prop("readOnly")||p(this.el).prop("disabled")||(_=this.trigger("remove",{target:this.el,originalEvent:d,item:f})).isCancelled!==!0&&(this.selected.splice(m,1),p(this.el).trigger("input").trigger("change"),p(d.target).remove());else if((_=this.trigger("click",{target:this.el,originalEvent:d.originalEvent,item:f})).isCancelled!==!0){let g=f.tooltip;if(this.type==="file"&&(/image/i.test(f.type)&&(g=`
                                    <div class="w2ui-file-preview">
                                        <img src="${f.content?"data:"+f.type+";base64,"+f.content:""}"
                                            style="max-width: 300px">
                                    </div>`),g+=`
                                <div class="w2ui-file-info">
                                    <div class="file-caption">${b.lang("Name")}:</div>
                                    <div class="file-value">${f.name}</div>
                                    <div class="file-caption">${b.lang("Size")}:</div>
                                    <div class="file-value">${b.formatSize(f.size)}</div>
                                    <div class="file-caption">${b.lang("Type")}:</div>
                                    <div class="file-value file-type">${f.type}</div>
                                    <div class="file-caption">${b.lang("Modified")}:</div>
                                    <div class="file-value">${b.date(f.modified)}</div>
                                </div>`),g){let v=this.el.id+"_preview";Ne.show({name:v,anchor:u.get(0),html:g,hideOn:["doc-click"],class:""}).show(y=>{p(`#w2overlay-${v} img`).on("load",function(x){var E=this.clientWidth,R=this.clientHeight;E<300&R<300||(R<=E&&300<E&&p(this).css("width","300px"),E<R&&300<R&&p(this).css("height","300px"))}).on("error",function(x){this.style.display="none"})})}_.finish()}}}).on("mouseenter.w2item",d=>{var u=p(d.target).closest(".li-item");p(u).hasClass("li-search")||(u=this.selected[p(d.target).attr("index")],(d=this.trigger("mouseEnter",{target:this.el,originalEvent:d,item:u})).isCancelled!==!0&&d.finish())}).on("mouseleave.w2item",d=>{var u=p(d.target).closest(".li-item");p(u).hasClass("li-search")||(u=this.selected[p(d.target).attr("index")],(d=this.trigger("mouseLeave",{target:this.el,originalEvent:d,item:u})).isCancelled!==!0&&d.finish())}),this.type==="enum"?this.helpers.multi.find("input").css({width:"15px"}):this.helpers.multi.find(".li-search").hide(),this.resize()}return Date.now()-t}resize(){var e=this.el.clientWidth,t=getComputedStyle(this.el),o=this.helpers.search,i=this.helpers.multi,n=this.helpers.suffix,r=this.helpers.prefix,o=(o&&p(o).css("width",e),i&&p(i).css("width",e-parseInt(t["margin-left"],10)-parseInt(t["margin-right"],10)),n&&this.addSuffix(),r&&this.addPrefix(),this.helpers.multi);if(["enum","file"].includes(this.type)&&o){p(this.el).css("height","auto");let a=p(o).find(":scope div.w2ui-multi-items").get(0).clientHeight+5;(a=(a=a<20?20:a)>this.tmp["max-height"]?this.tmp["max-height"]:a)<this.tmp["min-height"]&&(a=this.tmp["min-height"]),i=b.getSize(this.el,"height")-2,i>a&&(a=i),p(o).css({height:a+"px",overflow:a==this.tmp["max-height"]?"auto":"hidden"}),p(o).css("height",a+"px"),p(this.el).css({height:a+"px"})}this.tmp.current_width=e}reset(){this.tmp!=null&&(p(this.el).css("height","auto"),Array("padding-left","padding-right","background-color","border-color").forEach(e=>{this.tmp&&this.tmp["old-"+e]!=null&&(p(this.el).css(e,this.tmp["old-"+e]),delete this.tmp["old-"+e])}),clearInterval(this.tmp.sizeTimer)),p(this.el).val(this.clean(p(this.el).val())).removeClass("w2field").removeData("selected selectedIndex").off(".w2field"),Object.keys(this.helpers).forEach(e=>{p(this.helpers[e]).remove()}),this.helpers={}}clean(e){var t;return e=typeof e!="number"&&(t=this.options,e=String(e).trim(),["int","float","money","currency","percent"].includes(this.type))?(e=typeof e=="string"?(e=t.autoFormat&&(["money","currency"].includes(this.type)&&(e=String(e).replace(t.moneyRE,"")),this.type==="percent"&&(e=String(e).replace(t.percentRE,"")),["int","float"].includes(this.type))?String(e).replace(t.numberRE,""):e).replace(/\s+/g,"").replace(new RegExp(t.groupSymbol,"g"),"").replace(t.decimalSymbol,"."):e)!==""&&b.isFloat(e)?Number(e):"":e}format(e){var t=this.options;if(t.autoFormat&&e!==""){switch(this.type){case"money":case"currency":(e=b.formatNumber(e,t.currencyPrecision,!0))!==""&&(e=t.currencyPrefix+e+t.currencySuffix);break;case"percent":(e=b.formatNumber(e,t.precision,!0))!==""&&(e+="%");break;case"float":e=b.formatNumber(e,t.precision,!0);break;case"int":e=b.formatNumber(e,0,!0)}var i=parseInt(1e3).toLocaleString(b.settings.locale,{useGrouping:!0}).slice(1,2);i!==this.options.groupSymbol&&(e=e.replaceAll(i,this.options.groupSymbol))}return e}change(e){if(["int","float","money","currency","percent"].indexOf(this.type)!==-1){var t=p(this.el).val(),i=this.format(this.clean(p(this.el).val()));if(t!==""&&t!=i)return p(this.el).val(i),e.stopPropagation(),e.preventDefault(),!1}if(this.type==="color"){let n=p(this.el).val();n.substr(0,3).toLowerCase()!=="rgb"&&(n="#"+n,(t=p(this.el).val().length)!==8)&&t!==6&&t!==3&&(n=""),i=p(this.el).get(0).nextElementSibling,p(i).find("div").css("background-color",n),p(this.el).hasClass("has-focus")&&this.updateOverlay()}if(["list","enum","file"].indexOf(this.type)!==-1&&this.refresh(),["date","time","datetime"].indexOf(this.type)!==-1){let n=parseInt(this.el.value);b.isInt(this.el.value)&&3e3<n&&(this.type==="time"&&(n=b.formatTime(new Date(n),this.options.format)),this.type==="date"&&(n=b.formatDate(new Date(n),this.options.format)),this.type==="datetime"&&(n=b.formatDateTime(new Date(n),this.options.format)),p(this.el).val(n).trigger("input").trigger("change"))}}click(e){["list","combo","enum"].includes(this.type)&&(p(this.el).hasClass("has-focus")||this.focus(e),this.type=="combo"&&this.updateOverlay(),this.type=="list")&&(this.updateOverlay(),e.stopPropagation()),["date","time","datetime","color"].includes(this.type)&&this.updateOverlay()}focus(e){if(this.type=="list"&&document.activeElement==this.el)this.helpers.search_focus.focus();else{if(["color","date","time","datetime"].indexOf(this.type)!==-1){if(p(this.el).prop("readOnly")||p(this.el).prop("disabled"))return;this.updateOverlay()}if(["list","combo","enum"].indexOf(this.type)!==-1){if(p(this.el).prop("readOnly")||p(this.el).prop("disabled"))return void p(this.el).addClass("has-focus");typeof this.options._items_fun=="function"&&(this.options.items=b.normMenu.call(this,this.options._items_fun)),this.helpers.search&&((t=this.helpers.search_focus).value="",t.select()),this.type=="enum"&&(t=p(this.el.previousElementSibling).find(".li-search input").get(0),document.activeElement!==t)&&t.focus(),this.resize(),e.showMenu===!1||this.options.openOnFocus===!1&&!p(this.el).hasClass("has-focus")||setTimeout(()=>{this.updateOverlay()},100)}var t;this.type=="file"&&(t=p(this.el).get(0).previousElementSibling,p(t).addClass("has-focus")),p(this.el).addClass("has-focus")}}blur(e){var n;var t,i=p(this.el).val().trim();if(p(this.el).removeClass("has-focus"),["int","float","money","currency","percent"].includes(this.type)&&i!==""){let r=i,o="";this.isStrValid(i)?(t=this.clean(i),this.options.min!=null&&t<this.options.min&&(r=this.options.min,o="Should be >= "+this.options.min),this.options.max!=null&&t>this.options.max&&(r=this.options.max,o="Should be <= "+this.options.max)):r="",this.options.autoCorrect&&(p(this.el).val(r).trigger("input").trigger("change"),o)&&(Ne.show({name:this.el.id+"_error",anchor:this.el,html:o}),setTimeout(()=>{Ne.hide(this.el.id+"_error")},3e3))}["date","time","datetime"].includes(this.type)&&this.options.autoCorrect&&i!==""&&(t=this.type=="date"?b.isDate:this.type=="time"?b.isTime:b.isDateTime,tr.inRange(this.el.value,this.options)&&t.bind(b)(this.el.value,this.options.format)||p(this.el).val("").trigger("input").trigger("change")),this.type==="enum"&&p(this.helpers.multi).find("input").val("").css("width","15px"),this.type=="file"&&(i=this.el.previousElementSibling,p(i).removeClass("has-focus")),this.type==="list"&&(this.el.value=((n=this.selected)==null?void 0:n.text)??"")}keyDown(e,r){var i,n=this.options,r=e.keyCode||r&&r.keyCode;let o=!1,a,l,c,h,d,u;if(["int","float","money","currency","percent","hex","bin","color","alphanumeric"].includes(this.type)&&!(e.metaKey||e.ctrlKey||e.altKey||this.isStrValid(e.key??"1",!0)||[9,8,13,27,37,38,39,40,46].includes(e.keyCode)))return e.preventDefault(),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,!1;if(["int","float","money","currency","percent"].includes(this.type)){if(!n.keyboard||p(this.el).prop("readOnly")||p(this.el).prop("disabled"))return;switch(a=parseFloat(p(this.el).val().replace(n.moneyRE,""))||0,l=n.step,(e.ctrlKey||e.metaKey)&&(l=10*n.step),r){case 38:e.shiftKey||(d=a+l<=n.max||n.max==null?Number((a+l).toFixed(12)):n.max,p(this.el).val(d).trigger("input").trigger("change"),o=!0);break;case 40:e.shiftKey||(d=a-l>=n.min||n.min==null?Number((a-l).toFixed(12)):n.min,p(this.el).val(d).trigger("input").trigger("change"),o=!0)}o&&(e.preventDefault(),this.moveCaret2end())}if(["date","datetime"].includes(this.type)){if(!n.keyboard||p(this.el).prop("readOnly")||p(this.el).prop("disabled"))return;var m=(this.type=="date"?b.isDate:b.isDateTime).bind(b),f=(this.type=="date"?b.formatDate:b.formatDateTime).bind(b);switch(c=864e5,l=1,(e.ctrlKey||e.metaKey)&&(l=10),(h=m(p(this.el).val(),n.format,!0))||(h=new Date,c=0),r){case 38:e.shiftKey||(l==10?h.setMonth(h.getMonth()+1):h.setTime(h.getTime()+c),u=f(h.getTime(),n.format),p(this.el).val(u).trigger("input").trigger("change"),o=!0);break;case 40:e.shiftKey||(l==10?h.setMonth(h.getMonth()-1):h.setTime(h.getTime()-c),u=f(h.getTime(),n.format),p(this.el).val(u).trigger("input").trigger("change"),o=!0)}o&&(e.preventDefault(),this.moveCaret2end(),this.updateOverlay())}if(this.type==="time"){if(!n.keyboard||p(this.el).prop("readOnly")||p(this.el).prop("disabled"))return;l=e.ctrlKey||e.metaKey?60:1,a=p(this.el).val();let _=tr.str2min(a)||tr.str2min(new Date().getHours()+":"+(new Date().getMinutes()-1));switch(r){case 38:e.shiftKey||(_+=l,o=!0);break;case 40:e.shiftKey||(_-=l,o=!0)}o&&(e.preventDefault(),p(this.el).val(tr.min2str(_)).trigger("input").trigger("change"),this.moveCaret2end())}if(["list","enum"].includes(this.type))switch(r){case 8:case 46:this.type=="list"?p(this.helpers.search_focus).val()==""&&(this.selected=null,Ot.hide(this.el.id+"_menu"),p(this.el).val("").trigger("input").trigger("change")):p(this.helpers.multi).find("input").val()==""&&(Ot.hide(this.el.id+"_menu"),this.selected.pop(),(i=Ot.get(this.el.id+"_menu"))&&(i.options.selected=this.selected),this.refresh());break;case 9:case 16:break;case 27:Ot.hide(this.el.id+"_menu"),this.refresh()}}keyUp(e){var n,r;if(this.type=="list"){let o=p(this.helpers.search_focus);o.val()!==""?p(this.el).attr("placeholder",""):p(this.el).attr("placeholder",this.tmp.pholder),e.keyCode==13&&setTimeout(()=>{o.val(""),Ot.hide(this.el.id+"_menu"),this.refresh()},1),[38,40].includes(e.keyCode)&&!this.tmp.overlay.overlay.displayed&&this.updateOverlay(),this.refresh()}var t,i;this.type=="combo"&&this.updateOverlay(),this.type=="enum"&&(t=this.helpers.multi.find("input"),i=getComputedStyle(t.get(0)),i=b.getStrWidth(t.val(),`font-family: ${i["font-family"]}; font-size: ${i["font-size"]};`),t.css({width:i+15+"px"}),this.resize(),[38,40].includes(e.keyCode))&&!((r=(n=this.tmp.overlay)==null?void 0:n.overlay)!=null&&r.displayed)&&this.updateOverlay()}findItemIndex(e,t,i){let n=[];var r;return i=i||[],["list","combo","enum"].includes(this.type)&&this.options.url&&(r=Ot.get(this.el.id+"_menu"))&&(e=r.options.items,this.options.items=e),e.forEach((o,a)=>{o.id===t&&(n=i.concat([a]),this.options.index=[a]),n.length==0&&o.items&&0<o.items.length&&(i.push(a),n=this.findItemIndex(o.items,t,i),i.pop())}),n}updateOverlay(e){let t=this.options;if(this.type==="color"){if(p(this.el).prop("readOnly")||p(this.el).prop("disabled"))return;cf.show(b.extend({name:this.el.id+"_color",anchor:this.el,transparent:t.transparent,advanced:t.advanced,color:this.el.value,liveUpdate:!0},this.options)).select(n=>{n=n.detail.color,p(this.el).val(n).trigger("input").trigger("change")}).liveUpdate(n=>{n=n.detail.color,p(this.helpers.suffix).find(":scope > div").css("background-color","#"+n)})}if(["list","combo","enum"].includes(this.type)){var i;this.el;let n=this.el;this.type==="enum"&&(i=this.helpers.multi.get(0),n=p(i).find("input").get(0)),this.type==="list"&&(i=this.selected,b.isPlainObject(i)&&0<Object.keys(i).length&&0<(i=this.findItemIndex(t.items,i.id)).length&&(t.index=i),n=this.helpers.search_focus),!p(this.el).hasClass("has-focus")||this.el.readOnly||this.el.disabled||(i=b.extend({},t,{name:this.el.id+"_menu",anchor:n,selected:this.selected,search:!1,render:t.renderDrop,anchorClass:"",offsetY:5,maxHeight:t.maxDropHeight,maxWidth:t.maxDropWidth,minWidth:t.minDropWidth}),this.tmp.overlay=Ot.show(i).select(r=>{var l;var o,a;["list","combo"].includes(this.type)?(this.selected=r.detail.item,p(n).val(""),p(this.el).val(this.selected.text).trigger("input").trigger("change"),this.focus({showMenu:!1})):(a=this.selected,(o=(l=r.detail)==null?void 0:l.item)&&(r=this.trigger("add",{target:this.el,item:o,originalEvent:r})).isCancelled!==!0&&(a.length>=t.max&&0<t.max&&a.pop(),delete o.hidden,a.push(o),p(this.el).trigger("input").trigger("change"),p(this.helpers.multi).find("input").val(""),(a=Ot.get(this.el.id+"_menu"))&&(a.options.selected=this.selected),r.finish()))}))}!["date","time","datetime"].includes(this.type)||p(this.el).prop("readOnly")||p(this.el).prop("disabled")||tr.show(b.extend({name:this.el.id+"_date",anchor:this.el,value:this.el.value},this.options)).select(n=>{n=n.detail.date,n!=null&&p(this.el).val(n).trigger("input").trigger("change")})}isStrValid(e,t){let i=!0;switch(this.type){case"int":i=!(!t||!["-",this.options.groupSymbol].includes(e))||b.isInt(e.replace(this.options.numberRE,""));break;case"percent":e=e.replace(/%/g,"");case"float":i=!(!t||!["-","",this.options.decimalSymbol,this.options.groupSymbol].includes(e))||b.isFloat(e.replace(this.options.numberRE,""));break;case"money":case"currency":i=!(!t||!["-",this.options.decimalSymbol,this.options.groupSymbol,this.options.currencyPrefix,this.options.currencySuffix].includes(e))||b.isFloat(e.replace(this.options.moneyRE,""));break;case"bin":i=b.isBin(e);break;case"color":case"hex":i=b.isHex(e);break;case"alphanumeric":i=b.isAlphaNumeric(e)}return i}addPrefix(){var e,t;this.options.prefix&&(t=getComputedStyle(this.el),this.tmp["old-padding-left"]==null&&(this.tmp["old-padding-left"]=t["padding-left"]),this.helpers.prefix&&p(this.helpers.prefix).remove(),p(this.el).before(`<div class="w2ui-field-helper">${this.options.prefix}</div>`),e=p(this.el).get(0).previousElementSibling,p(e).css({color:t.color,"font-family":t["font-family"],"font-size":t["font-size"],height:this.el.clientHeight+"px","padding-top":t["padding-top"],"padding-bottom":t["padding-bottom"],"padding-left":this.tmp["old-padding-left"],"padding-right":0,"margin-top":parseInt(t["margin-top"],10)+2+"px","margin-bottom":parseInt(t["margin-bottom"],10)+1+"px","margin-left":t["margin-left"],"margin-right":0,"z-index":1}),p(this.el).css("padding-left",e.clientWidth+"px !important"),this.helpers.prefix=e)}addSuffix(){if(this.options.suffix||this.options.arrow){let i,n=this;var e=getComputedStyle(this.el),t=(this.tmp["old-padding-right"]==null&&(this.tmp["old-padding-right"]=e["padding-right"]),parseInt(e["padding-right"]||0));this.options.arrow&&(this.helpers.arrow&&p(this.helpers.arrow).remove(),p(this.el).after('<div class="w2ui-field-helper" style="border: 1px solid transparent">&#160;    <div class="w2ui-field-up" type="up">        <div class="arrow-up" type="up"></div>    </div>    <div class="w2ui-field-down" type="down">        <div class="arrow-down" type="down"></div>    </div></div>'),i=p(this.el).get(0).nextElementSibling,p(i).css({color:e.color,"font-family":e["font-family"],"font-size":e["font-size"],height:this.el.clientHeight+"px",padding:0,"margin-top":parseInt(e["margin-top"],10)+1+"px","margin-bottom":0,"border-left":"1px solid silver",width:"16px",transform:"translateX(-100%)"}).on("mousedown",function(r){p(r.target).hasClass("arrow-up")&&n.keyDown(r,{keyCode:38}),p(r.target).hasClass("arrow-down")&&n.keyDown(r,{keyCode:40})}),t+=i.clientWidth,p(this.el).css("padding-right",t+"px !important"),this.helpers.arrow=i),this.options.suffix!==""&&(this.helpers.suffix&&p(this.helpers.suffix).remove(),p(this.el).after(`<div class="w2ui-field-helper">${this.options.suffix}</div>`),i=p(this.el).get(0).nextElementSibling,p(i).css({color:e.color,"font-family":e["font-family"],"font-size":e["font-size"],height:this.el.clientHeight+"px","padding-top":e["padding-top"],"padding-bottom":e["padding-bottom"],"padding-left":0,"padding-right":e["padding-right"],"margin-top":parseInt(e["margin-top"],10)+2+"px","margin-bottom":parseInt(e["margin-bottom"],10)+1+"px",transform:"translateX(-100%)"}),p(this.el).css("padding-right",i.clientWidth+"px !important"),this.helpers.suffix=i)}}addSearch(){if(this.type==="list"){this.helpers.search&&p(this.helpers.search).remove();let i=parseInt(p(this.el).attr("tabIndex")),n=(isNaN(i)||i===-1||(this.tmp["old-tabIndex"]=i),(i=this.tmp["old-tabIndex"]?this.tmp["old-tabIndex"]:i)!=null&&!isNaN(i)||(i=0),"");var e=`
            <div class="w2ui-field-helper">
                <span class="w2ui-icon w2ui-icon-search"></span>
                <input ${n=p(this.el).attr("id")!=null?'id="'+p(this.el).attr("id")+'_search"':n} type="text" tabIndex="${i}" autocapitalize="off" autocomplete="off" autocorrect="off" spellcheck="false"/>
            </div>`,e=(p(this.el).attr("tabindex",-1).before(e),p(this.el).get(0).previousElementSibling),t=(this.helpers.search=e,this.helpers.search_focus=p(e).find("input").get(0),getComputedStyle(this.el));p(e).css({width:this.el.clientWidth+"px","margin-top":t["margin-top"],"margin-left":t["margin-left"],"margin-bottom":t["margin-bottom"],"margin-right":t["margin-right"]}).find("input").css({cursor:"default",width:"100%",opacity:1,padding:t.padding,margin:t.margin,border:"1px solid transparent","background-color":"transparent"}),p(e).find("input").off(".helper").on("focus.helper",r=>{p(r.target).val(""),this.tmp.pholder=p(this.el).attr("placeholder")??"",this.focus(r),r.stopPropagation()}).on("blur.helper",r=>{p(r.target).val(""),this.tmp.pholder!=null&&p(this.el).attr("placeholder",this.tmp.pholder),this.blur(r),r.stopPropagation()}).on("keydown.helper",r=>{this.keyDown(r)}).on("keyup.helper",r=>{this.keyUp(r)}),p(e).on("click",r=>{p(r.target).find("input").focus()})}}addMultiSearch(){if(["enum","file"].includes(this.type)){p(this.helpers.multi).remove();let r="";var e,t,i=getComputedStyle(this.el),n=b.stripSpaces(`
            margin-top: 0px;
            margin-bottom: 0px;
            margin-left: ${i["margin-left"]};
            margin-right: ${i["margin-right"]};
            width: ${b.getSize(this.el,"width")-parseInt(i["margin-left"],10)-parseInt(i["margin-right"],10)}px;
        `);this.tmp["min-height"]==null&&(e=this.tmp["min-height"]=parseInt((i["min-height"]!="none"?i["min-height"]:0)||0),t=parseInt(i.height),this.tmp["min-height"]=Math.max(e,t)),this.tmp["max-height"]==null&&i["max-height"]!="none"&&(this.tmp["max-height"]=parseInt(i["max-height"]));let o="",a=(p(this.el).attr("id")!=null&&(o=`id="${p(this.el).attr("id")}_search"`),parseInt(p(this.el).attr("tabIndex"))),l=(isNaN(a)||a===-1||(this.tmp["old-tabIndex"]=a),(a=this.tmp["old-tabIndex"]?this.tmp["old-tabIndex"]:a)!=null&&!isNaN(a)||(a=0),this.type==="enum"&&(r=`
            <div class="w2ui-field-helper w2ui-list" style="${n}">
                <div class="w2ui-multi-items">
                    <div class="li-search">
                        <input ${o} type="text" autocapitalize="off" autocomplete="off" autocorrect="off" spellcheck="false"
                            tabindex="${a}"
                            ${p(this.el).prop("readOnly")?"readonly":""}
                            ${p(this.el).prop("disabled")?"disabled":""}>
                    </div>
                </div>
            </div>`),this.type==="file"&&(r=`
            <div class="w2ui-field-helper w2ui-list" style="${n}">
                <div class="w2ui-multi-file">
                    <input name="attachment" class="file-input" type="file" tabindex="-1"'
                        style="width: 100%; height: 100%; opacity: 0" title=""
                        ${this.options.max!==1?"multiple":""}
                        ${p(this.el).prop("readOnly")||p(this.el).prop("disabled")?"disabled":""}
                        ${p(this.el).attr("accept")?' accept="'+p(this.el).attr("accept")+'"':""}>
                </div>
                <div class="w2ui-multi-items">
                    <div class="li-search" style="display: none">
                        <input ${o} type="text" autocapitalize="off" autocomplete="off" autocorrect="off" spellcheck="false"
                            tabindex="${a}"
                            ${p(this.el).prop("readOnly")?"readonly":""}
                            ${p(this.el).prop("disabled")?"disabled":""}>
                    </div>
                </div>
            </div>`),this.tmp["old-background-color"]=i["background-color"],this.tmp["old-border-color"]=i["border-color"],p(this.el).before(r).css({"border-color":"transparent","background-color":"transparent"}),p(this.el.previousElementSibling));this.helpers.multi=l,p(this.el).attr("tabindex",-1),l.on("click",c=>{this.focus(c)}),l.find("input:not(.file-input)").on("click",c=>{this.click(c)}).on("focus",c=>{this.focus(c)}).on("blur",c=>{this.blur(c)}).on("keydown",c=>{this.keyDown(c)}).on("keyup",c=>{this.keyUp(c)}),this.type==="file"&&l.find("input.file-input").off(".drag").on("click.drag",c=>{c.stopPropagation(),p(this.el).prop("readOnly")||p(this.el).prop("disabled")||this.focus(c)}).on("dragenter.drag",c=>{p(this.el).prop("readOnly")||p(this.el).prop("disabled")||l.addClass("w2ui-file-dragover")}).on("dragleave.drag",c=>{p(this.el).prop("readOnly")||p(this.el).prop("disabled")||l.removeClass("w2ui-file-dragover")}).on("drop.drag",c=>{p(this.el).prop("readOnly")||p(this.el).prop("disabled")||(l.removeClass("w2ui-file-dragover"),Array.from(c.dataTransfer.files).forEach(h=>{this.addFile(h)}),this.focus(c),c.preventDefault(),c.stopPropagation())}).on("dragover.drag",c=>{c.preventDefault(),c.stopPropagation()}).on("change.drag",c=>{c.target.files!==void 0&&Array.from(c.target.files).forEach(h=>{this.addFile(h)}),this.focus(c)}),this.refresh()}}addFile(e){var t=this.options,i=this.selected;let n={name:e.name,type:e.type,modified:e.lastModifiedDate,size:e.size,content:null,file:e},r=0,o=0,a=[],l=(Array.isArray(i)&&i.forEach(c=>{c.name==e.name&&c.size==e.size&&a.push(b.lang('The file "${name}" (${size}) is already added.',{name:e.name,size:b.formatSize(e.size)})),r+=c.size,o++}),t.maxFileSize!==0&&n.size>t.maxFileSize&&a.push(b.lang("Maximum file size is ${size}",{size:b.formatSize(t.maxFileSize)})),t.maxSize!==0&&r+n.size>t.maxSize&&a.push(b.lang("Maximum total size is ${size}",{size:b.formatSize(t.maxSize)})),t.max!==0&&o>=t.max&&a.push(b.lang("Maximum number of files is ${count}",{count:t.max})),this.trigger("add",{target:this.el,file:n,total:o,totalSize:r,errors:a}));if(l.isCancelled!==!0)if(t.silent!==!0&&0<a.length)Ne.show({anchor:this.el,html:"Errors: "+a.join("<br>")}),console.log("ERRORS (while adding files): ",a);else if(i.push(n),typeof FileReader<"u"&&t.readContent===!0){i=new FileReader;let c=this;i.onload=function(d){var d=d.target.result,u=d.indexOf(",");n.content=d.substr(u+1),c.refresh(),p(c.el).trigger("input").trigger("change"),l.finish()},i.readAsDataURL(e)}else this.refresh(),p(this.el).trigger("input").trigger("change"),l.finish()}moveCaret2end(){setTimeout(()=>{this.el.setSelectionRange(this.el.value.length,this.el.value.length)},0)}}function B1({fields:s,data:e,onChange:t}){const i=document.createElement("div"),n=new z1({name:Math.random().toString().substring(2),box:i,selectType:"cell",recordHeight:26,show:{columnMenu:!1,lineNumbers:!0},columns:V1(s),records:su(e.rawVal,s)});return i.setAttribute("id","grid"),new ResizeObserver(()=>n.refresh()).observe(i),n.onChange=o=>{if(!s[o.detail.column])return;const a=Tr[o.detail.column];n.records[o.detail.index][a]=o.detail.value.new,t&&t(pl(n.records,s))},n.onDelete=o=>{o.detail.force=!0,o.onComplete=()=>{t&&t(pl(n.records,s))}},n.onPaste=o=>{o.onComplete=()=>{n.mergeChanges(),t&&t(pl(n.records,s))}},Ae.derive(()=>{n.records=su(e.val,s),n.refresh()}),i}const Tr="ABCDEFGHIJKLMNOPRST";function V1(s){return Tr.split("").map(t=>({field:t,text:'<div style="text-align: center">'+t+"</div>",size:"90px",resizable:!0,sortable:!0,editable:{type:"text"}})).map(t=>{const i=s.find(n=>n.field===t.field);return i?{...t,...i}:t})}function su(s,e){const t=Array.isArray(s)?s:r(s,e),i=Array(50).fill(0).map((o,a)=>({recid:a})),n=Tr.split("");for(let o=0;o<t.length;o++)for(let a=0;a<t[o].length;a++)i[o][n[a]]=t[o][a];return i;function r(o,a){const l=new Map;return a.forEach(c=>l.set(c.field,c)),Object.keys(o).map(c=>[l.get(c).text,o[c]])}}function pl(s,e){if(Tr.includes(e[0].field))return i(s,e);return n(s,e);function i(r,o){let a=[...Array(r.length)].map(()=>[...Array(o.length)]);const l=Tr.split("");for(let h=0;h<a.length;h++)for(let d=0;d<a[h].length;d++)a[h][d]=r[h][l[d]]??"";return a.slice(0,c(a)+1);function c(h){for(let d=h.length-1;d>=0;d--)if(h[d].some(u=>u!==""))return d}}function n(r,o){return Object.fromEntries(o.map(({field:a},l)=>[a,r[l].B]))}}function nM({sheets:s,onChange:e}){const t=document.createElement("div"),i=document.createElement("div"),n=[],r=new Map;s.forEach((l,c)=>{n.push({id:c,text:l.text}),r.set(c,B1({fields:l.fields,data:l.data,onChange:a}))});const o=new df({box:i,name:"tabs",active:n[0].id,flow:"up",tabs:n});t.id="sheets",i.id="tabs",t.append(r.values().next().value,i),o.onClick=l=>{t.firstChild.replaceWith(r.get(l.target))};function a(l){e&&e({sheet:o.active,data:l})}return t}function sM({topLeft:s,topRight:e,main:t,preview:i,right:n}){const r=document.createElement("div"),o="border: 1px solid #efefef",a=new nu({name:"topLayout",panels:[...s?[{type:"left",size:"50%",html:ir(s.element)}]:[],...e?[{type:"right",size:"50%",html:ir(e.element)}]:[]]});return new nu({box:r,name:"layout",panels:[...s||e?[{type:"top",size:60,style:o,html:a}]:[],{type:"main",style:o,html:ir(t.element),...t.title?{title:t.title}:{}},...i?[{type:"preview",size:"50%",resizable:!0,style:o,html:ir(i.element),...i.title?{title:i.title}:{}}]:[],...n?[{type:"right",size:"65%",resizable:!0,style:o,html:ir(n.element),...n.title?{title:n.title}:{}}]:[]]}),r.id="layout",r}function ir(s){return{render:function(){this.box.append(s)}}}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const pr=globalThis,aa=pr.trustedTypes,ru=aa?aa.createPolicy("lit-html",{createHTML:s=>s}):void 0,uf="$lit$",an=`lit$${Math.random().toFixed(9).slice(2)}$`,pf="?"+an,H1=`<${pf}>`,Wn=document,Ar=()=>Wn.createComment(""),Rr=s=>s===null||typeof s!="object"&&typeof s!="function",oh=Array.isArray,G1=s=>oh(s)||typeof(s==null?void 0:s[Symbol.iterator])=="function",fl=`[ 	
\f\r]`,nr=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,ou=/-->/g,au=/>/g,Tn=RegExp(`>|${fl}(?:([^\\s"'>=/]+)(${fl}*=${fl}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),lu=/'/g,cu=/"/g,ff=/^(?:script|style|textarea|title)$/i,$1=s=>(e,...t)=>({_$litType$:s,strings:e,values:t}),jr=$1(1),Pr=Symbol.for("lit-noChange"),Dt=Symbol.for("lit-nothing"),hu=new WeakMap,kn=Wn.createTreeWalker(Wn,129);function mf(s,e){if(!oh(s)||!s.hasOwnProperty("raw"))throw Error("invalid template strings array");return ru!==void 0?ru.createHTML(e):e}const W1=(s,e)=>{const t=s.length-1,i=[];let n,r=e===2?"<svg>":e===3?"<math>":"",o=nr;for(let a=0;a<t;a++){const l=s[a];let c,h,d=-1,u=0;for(;u<l.length&&(o.lastIndex=u,h=o.exec(l),h!==null);)u=o.lastIndex,o===nr?h[1]==="!--"?o=ou:h[1]!==void 0?o=au:h[2]!==void 0?(ff.test(h[2])&&(n=RegExp("</"+h[2],"g")),o=Tn):h[3]!==void 0&&(o=Tn):o===Tn?h[0]===">"?(o=n??nr,d=-1):h[1]===void 0?d=-2:(d=o.lastIndex-h[2].length,c=h[1],o=h[3]===void 0?Tn:h[3]==='"'?cu:lu):o===cu||o===lu?o=Tn:o===ou||o===au?o=nr:(o=Tn,n=void 0);const m=o===Tn&&s[a+1].startsWith("/>")?" ":"";r+=o===nr?l+H1:d>=0?(i.push(c),l.slice(0,d)+uf+l.slice(d)+an+m):l+an+(d===-2?a:m)}return[mf(s,r+(s[t]||"<?>")+(e===2?"</svg>":e===3?"</math>":"")),i]};class Dr{constructor({strings:e,_$litType$:t},i){let n;this.parts=[];let r=0,o=0;const a=e.length-1,l=this.parts,[c,h]=W1(e,t);if(this.el=Dr.createElement(c,i),kn.currentNode=this.el.content,t===2||t===3){const d=this.el.content.firstChild;d.replaceWith(...d.childNodes)}for(;(n=kn.nextNode())!==null&&l.length<a;){if(n.nodeType===1){if(n.hasAttributes())for(const d of n.getAttributeNames())if(d.endsWith(uf)){const u=h[o++],m=n.getAttribute(d).split(an),f=/([.?@])?(.*)/.exec(u);l.push({type:1,index:r,name:f[2],strings:m,ctor:f[1]==="."?j1:f[1]==="?"?Y1:f[1]==="@"?q1:ga}),n.removeAttribute(d)}else d.startsWith(an)&&(l.push({type:6,index:r}),n.removeAttribute(d));if(ff.test(n.tagName)){const d=n.textContent.split(an),u=d.length-1;if(u>0){n.textContent=aa?aa.emptyScript:"";for(let m=0;m<u;m++)n.append(d[m],Ar()),kn.nextNode(),l.push({type:2,index:++r});n.append(d[u],Ar())}}}else if(n.nodeType===8)if(n.data===pf)l.push({type:2,index:r});else{let d=-1;for(;(d=n.data.indexOf(an,d+1))!==-1;)l.push({type:7,index:r}),d+=an.length-1}r++}}static createElement(e,t){const i=Wn.createElement("template");return i.innerHTML=e,i}}function Ns(s,e,t=s,i){var o,a;if(e===Pr)return e;let n=i!==void 0?(o=t._$Co)==null?void 0:o[i]:t._$Cl;const r=Rr(e)?void 0:e._$litDirective$;return(n==null?void 0:n.constructor)!==r&&((a=n==null?void 0:n._$AO)==null||a.call(n,!1),r===void 0?n=void 0:(n=new r(s),n._$AT(s,t,i)),i!==void 0?(t._$Co??(t._$Co=[]))[i]=n:t._$Cl=n),n!==void 0&&(e=Ns(s,n._$AS(s,e.values),n,i)),e}class X1{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:i}=this._$AD,n=((e==null?void 0:e.creationScope)??Wn).importNode(t,!0);kn.currentNode=n;let r=kn.nextNode(),o=0,a=0,l=i[0];for(;l!==void 0;){if(o===l.index){let c;l.type===2?c=new Yr(r,r.nextSibling,this,e):l.type===1?c=new l.ctor(r,l.name,l.strings,this,e):l.type===6&&(c=new K1(r,this,e)),this._$AV.push(c),l=i[++a]}o!==(l==null?void 0:l.index)&&(r=kn.nextNode(),o++)}return kn.currentNode=Wn,n}p(e){let t=0;for(const i of this._$AV)i!==void 0&&(i.strings!==void 0?(i._$AI(e,i,t),t+=i.strings.length-2):i._$AI(e[t])),t++}}class Yr{get _$AU(){var e;return((e=this._$AM)==null?void 0:e._$AU)??this._$Cv}constructor(e,t,i,n){this.type=2,this._$AH=Dt,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=i,this.options=n,this._$Cv=(n==null?void 0:n.isConnected)??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return t!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Ns(this,e,t),Rr(e)?e===Dt||e==null||e===""?(this._$AH!==Dt&&this._$AR(),this._$AH=Dt):e!==this._$AH&&e!==Pr&&this._(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):G1(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==Dt&&Rr(this._$AH)?this._$AA.nextSibling.data=e:this.T(Wn.createTextNode(e)),this._$AH=e}$(e){var r;const{values:t,_$litType$:i}=e,n=typeof i=="number"?this._$AC(e):(i.el===void 0&&(i.el=Dr.createElement(mf(i.h,i.h[0]),this.options)),i);if(((r=this._$AH)==null?void 0:r._$AD)===n)this._$AH.p(t);else{const o=new X1(n,this),a=o.u(this.options);o.p(t),this.T(a),this._$AH=o}}_$AC(e){let t=hu.get(e.strings);return t===void 0&&hu.set(e.strings,t=new Dr(e)),t}k(e){oh(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let i,n=0;for(const r of e)n===t.length?t.push(i=new Yr(this.O(Ar()),this.O(Ar()),this,this.options)):i=t[n],i._$AI(r),n++;n<t.length&&(this._$AR(i&&i._$AB.nextSibling,n),t.length=n)}_$AR(e=this._$AA.nextSibling,t){var i;for((i=this._$AP)==null?void 0:i.call(this,!1,!0,t);e&&e!==this._$AB;){const n=e.nextSibling;e.remove(),e=n}}setConnected(e){var t;this._$AM===void 0&&(this._$Cv=e,(t=this._$AP)==null||t.call(this,e))}}class ga{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,i,n,r){this.type=1,this._$AH=Dt,this._$AN=void 0,this.element=e,this.name=t,this._$AM=n,this.options=r,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=Dt}_$AI(e,t=this,i,n){const r=this.strings;let o=!1;if(r===void 0)e=Ns(this,e,t,0),o=!Rr(e)||e!==this._$AH&&e!==Pr,o&&(this._$AH=e);else{const a=e;let l,c;for(e=r[0],l=0;l<r.length-1;l++)c=Ns(this,a[i+l],t,l),c===Pr&&(c=this._$AH[l]),o||(o=!Rr(c)||c!==this._$AH[l]),c===Dt?e=Dt:e!==Dt&&(e+=(c??"")+r[l+1]),this._$AH[l]=c}o&&!n&&this.j(e)}j(e){e===Dt?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class j1 extends ga{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Dt?void 0:e}}class Y1 extends ga{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==Dt)}}class q1 extends ga{constructor(e,t,i,n,r){super(e,t,i,n,r),this.type=5}_$AI(e,t=this){if((e=Ns(this,e,t,0)??Dt)===Pr)return;const i=this._$AH,n=e===Dt&&i!==Dt||e.capture!==i.capture||e.once!==i.once||e.passive!==i.passive,r=e!==Dt&&(i===Dt||n);n&&this.element.removeEventListener(this.name,this,i),r&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t;typeof this._$AH=="function"?this._$AH.call(((t=this.options)==null?void 0:t.host)??this.element,e):this._$AH.handleEvent(e)}}class K1{constructor(e,t,i){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(e){Ns(this,e)}}const ml=pr.litHtmlPolyfillSupport;ml==null||ml(Dr,Yr),(pr.litHtmlVersions??(pr.litHtmlVersions=[])).push("3.2.1");const gf=(s,e,t)=>{const i=e;let n=i._$litPart$;return n===void 0&&(i._$litPart$=n=new Yr(e.insertBefore(Ar(),null),null,void 0,{})),n._$AI(s),n};function rM(s){const e=document.createElement("div"),t=jr`<svg
      class="flex-shrink-0 size-7"
      xmlns="http://www.w3.org/2000/svg"
      width="40"
      height="40"
      viewBox="0 -3 35 35"
      fill="#015f73"
    >
      <path
        d="M2,29.14l9.86-16.87c1.86,3.34,4.56,7.62,3.34,11.57a7.61,7.61,0,0,1-2.61,3.68,7.78,7.78,0,0,1-5,1.61c-1.48,0-3,0-4.47,0A4.5,4.5,0,0,0,2,29.14Z"
      ></path>
      <path
        d="M12.86,10.43l5.71-10L35.12,29.14H31a13.92,13.92,0,0,1-8.44-3.54,18.23,18.23,0,0,1-3.44-4.5c-.55-.92-1.08-1.85-1.61-2.79-1.25-2.21-2.56-4.39-3.85-6.58Z"
      ></path>
    </svg>

    <h1>${s}</h1>`;return e.id="title",gf(t,e),e}function oM({getStarted:s,author:e}){const t=document.createElement("div"),i=jr` <ul>
    <li>
      <div class="popup">
        <button>Get started</button>
        <div>${s}</div>
      </div>
    </li>
    <li>
      <div class="popup">
        <button>Author</button>
        <div>${e}</div>
      </div>
    </li>
    <li class="tooltip" data-tooltip="Awatif Newsletter">
      <a
        href="https://awatif.us19.list-manage.com/subscribe?u=80eec59eb329b1c9c00258524&id=95cfe71596"
        target="_blank"
        >${Q1}</a
      >
    </li>
    <li class="tooltip" data-tooltip="Awatif LinkedIn Page">
      <a href="https://www.linkedin.com/company/awatifsoftware" target="_blank"
        >${Z1}</a
      >
    </li>
    <li class="tooltip" data-tooltip="Awatif GitHub Project">
      <a href="https://github.com/madil4/awatif" target="_blank"
        >${J1}</a
      >
    </li>
  </ul>`;return t.id="marketing",gf(i,t),t.querySelectorAll(".tooltip").forEach((n,r)=>{n.addEventListener("mouseenter",()=>{Ne.show({html:n.getAttribute("data-tooltip"),name:"custom-"+r,anchor:n})}),n.addEventListener("mouseleave",()=>{Ne.hide("custom-"+r)})}),t.querySelectorAll(".popup").forEach(n=>{n.addEventListener("click",()=>{var r,o;N1.open({title:(r=n.querySelector("button"))==null?void 0:r.textContent,body:(o=n.querySelector("div"))==null?void 0:o.outerHTML,width:600,height:450})})}),t}const Z1=jr`<svg
  xmlns="http://www.w3.org/2000/svg"
  xmlns:xlink="http://www.w3.org/1999/xlink"
  fill="#000000"
  version="1.1"
  id="Layer_1"
  viewBox="0 0 310 310"
  xml:space="preserve"
>
  <g id="XMLID_801_">
    <path
      id="XMLID_802_"
      d="M72.16,99.73H9.927c-2.762,0-5,2.239-5,5v199.928c0,2.762,2.238,5,5,5H72.16c2.762,0,5-2.238,5-5V104.73   C77.16,101.969,74.922,99.73,72.16,99.73z"
    />
    <path
      id="XMLID_803_"
      d="M41.066,0.341C18.422,0.341,0,18.743,0,41.362C0,63.991,18.422,82.4,41.066,82.4   c22.626,0,41.033-18.41,41.033-41.038C82.1,18.743,63.692,0.341,41.066,0.341z"
    />
    <path
      id="XMLID_804_"
      d="M230.454,94.761c-24.995,0-43.472,10.745-54.679,22.954V104.73c0-2.761-2.238-5-5-5h-59.599   c-2.762,0-5,2.239-5,5v199.928c0,2.762,2.238,5,5,5h62.097c2.762,0,5-2.238,5-5v-98.918c0-33.333,9.054-46.319,32.29-46.319   c25.306,0,27.317,20.818,27.317,48.034v97.204c0,2.762,2.238,5,5,5H305c2.762,0,5-2.238,5-5V194.995   C310,145.43,300.549,94.761,230.454,94.761z"
    />
  </g>
</svg>`,J1=jr`<svg
  xmlns="http://www.w3.org/2000/svg"
  xmlns:xlink="http://www.w3.org/1999/xlink"
  viewBox="0 0 20 20"
  version="1.1"
>
  <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
    <g transform="translate(-140.000000, -7559.000000)" fill="#000000">
      <g id="icons" transform="translate(56.000000, 160.000000)">
        <path
          d="M94,7399 C99.523,7399 104,7403.59 104,7409.253 C104,7413.782 101.138,7417.624 97.167,7418.981 C96.66,7419.082 96.48,7418.762 96.48,7418.489 C96.48,7418.151 96.492,7417.047 96.492,7415.675 C96.492,7414.719 96.172,7414.095 95.813,7413.777 C98.04,7413.523 100.38,7412.656 100.38,7408.718 C100.38,7407.598 99.992,7406.684 99.35,7405.966 C99.454,7405.707 99.797,7404.664 99.252,7403.252 C99.252,7403.252 98.414,7402.977 96.505,7404.303 C95.706,7404.076 94.85,7403.962 94,7403.958 C93.15,7403.962 92.295,7404.076 91.497,7404.303 C89.586,7402.977 88.746,7403.252 88.746,7403.252 C88.203,7404.664 88.546,7405.707 88.649,7405.966 C88.01,7406.684 87.619,7407.598 87.619,7408.718 C87.619,7412.646 89.954,7413.526 92.175,7413.785 C91.889,7414.041 91.63,7414.493 91.54,7415.156 C90.97,7415.418 89.522,7415.871 88.63,7414.304 C88.63,7414.304 88.101,7413.319 87.097,7413.247 C87.097,7413.247 86.122,7413.234 87.029,7413.87 C87.029,7413.87 87.684,7414.185 88.139,7415.37 C88.139,7415.37 88.726,7417.2 91.508,7416.58 C91.513,7417.437 91.522,7418.245 91.522,7418.489 C91.522,7418.76 91.338,7419.077 90.839,7418.982 C86.865,7417.627 84,7413.783 84,7409.253 C84,7403.59 88.478,7399 94,7399"
          id="github-[#142]"
        ></path>
      </g>
    </g>
  </g>
</svg>`,Q1=jr`<svg
  xmlns="http://www.w3.org/2000/svg"
  fill="#000000"
  viewBox="0 0 20 20"
>
  <path
    d="M18 3H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1zM4 10h6v1H4v-1zm8 4H4v-1h8v1zm5-6h-3V5h3v3z"
  />
</svg>`;export{Ir as B,qt as D,dt as F,Es as L,Ft as M,sc as P,Tx as R,dr as S,k as V,Ae as a,Ms as b,mt as c,mn as d,Vi as e,ta as f,B1 as g,sM as l,oM as m,nM as s,rM as t,iM as v,jr as x};
